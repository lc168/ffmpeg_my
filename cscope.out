cscope 15 $HOME/ffmpeg_my/ffmpeg-3.3.2/ffmpeg-3.3.2/ffmpeg_my -q 0000002180 0000347755
	@cmdutils.c

22 
	~<¡ršg.h
>

23 
	~<¡dšt.h
>

24 
	~<¡dlib.h
>

25 
	~<”ºo.h
>

26 
	~<m©h.h
>

32 
	~"cÚfig.h
"

33 
	~"com·t/va_cİy.h
"

34 
	~"libavfÜm©/avfÜm©.h
"

35 
	~"libavf‹r/avf‹r.h
"

36 
	~"libavdeviû/avdeviû.h
"

37 
	~"libav»§m¶e/av»§m¶e.h
"

38 
	~"libswsÿË/swsÿË.h
"

39 
	~"libsw»§m¶e/sw»§m¶e.h
"

40 
	~"libpo¡´oc/po¡´oûss.h
"

41 
	~"libavut/avas£¹.h
"

42 
	~"libavut/av¡ršg.h
"

43 
	~"libavut/b´št.h
"

44 
	~"libavut/di¥Ïy.h
"

45 
	~"libavut/m©hem©ics.h
"

46 
	~"libavut/imguts.h
"

47 
	~"libavut/libm.h
"

48 
	~"libavut/·r£uts.h
"

49 
	~"libavut/pixdesc.h
"

50 
	~"libavut/ev®.h
"

51 
	~"libavut/diù.h
"

52 
	~"libavut/İt.h
"

53 
	~"libavut/ıu.h
"

54 
	~"libavut/ffv”siÚ.h
"

55 
	~"libavut/v”siÚ.h
"

56 
	~"cmduts.h
"

57 #ià
CONFIG_NETWORK


58 
	~"libavfÜm©/ÃtwÜk.h
"

60 #ià
HAVE_SYS_RESOURCE_H


61 
	~<sys/time.h
>

62 
	~<sys/»sourû.h
>

64 #ifdeà
_WIN32


65 
	~<wšdows.h
>

68 
š™_»pÜt
(cÚ¡ *
’v
);

70 
AVDiùiÚ¬y
 *
	gsws_diù
;

71 
AVDiùiÚ¬y
 *
	gswr_İts
;

72 
AVDiùiÚ¬y
 *
	gfÜm©_İts
, *
	gcodec_İts
, *
	g»§m¶e_İts
;

74 
FILE
 *
	g»pÜt_fe
;

75 
	g»pÜt_fe_Ëv–
 = 
AV_LOG_DEBUG
;

76 
	ghide_bªÃr
 = 0;

78 
	eshow_muxdemux”s
 {

79 
	mSHOW_DEFAULT
,

80 
	mSHOW_DEMUXERS
,

81 
	mSHOW_MUXERS
,

84 
	$š™_İts
()

86 
	`av_diù_£t
(&
sws_diù
, "flags", "bicubic", 0);

87 
	}
}

89 
	$unš™_İts
()

91 
	`av_diù_ä“
(&
swr_İts
);

92 
	`av_diù_ä“
(&
sws_diù
);

93 
	`av_diù_ä“
(&
fÜm©_İts
);

94 
	`av_diù_ä“
(&
codec_İts
);

95 
	`av_diù_ä“
(&
»§m¶e_İts
);

96 
	}
}

98 
	$log_ÿÎback_h–p
(*
±r
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
vl
)

100 
	`vårštf
(
¡dout
, 
fmt
, 
vl
);

101 
	}
}

103 
	$log_ÿÎback_»pÜt
(*
±r
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
vl
)

105 
va_li¡
 
vl2
;

106 
lše
[1024];

107 
´št_´efix
 = 1;

109 
	`va_cİy
(
vl2
, 
vl
);

110 
	`av_log_deçuÉ_ÿÎback
(
±r
, 
Ëv–
, 
fmt
, 
vl
);

111 
	`av_log_fÜm©_lše
(
±r
, 
Ëv–
, 
fmt
, 
vl2
, 
lše
, Öše), &
´št_´efix
);

112 
	`va_’d
(
vl2
);

113 ià(
»pÜt_fe_Ëv–
 >ğ
Ëv–
) {

114 
	`åuts
(
lše
, 
»pÜt_fe
);

115 
	`fæush
(
»pÜt_fe
);

117 
	}
}

119 
	$š™_dyÆßd
()

121 #ifdeà
_WIN32


124 
	`S‘DÎDœeùÜy
("");

126 
	}
}

128 (*
´og¿m_ex™
)(
»t
);

130 
	`»gi¡”_ex™
((*
cb
)(
»t
))

132 
´og¿m_ex™
 = 
cb
;

133 
	}
}

135 
	$ex™_´og¿m
(
»t
)

137 ià(
´og¿m_ex™
)

138 
	`´og¿m_ex™
(
»t
);

140 
	`ex™
(
»t
);

141 
	}
}

143 
	$·r£_numb”_Ü_d›
(cÚ¡ *
cÚ‹xt
, cÚ¡ *
num¡r
, 
ty³
,

144 
mš
, 
max
)

146 *

;

147 cÚ¡ *
”rÜ
;

148 
d
 = 
	`av_¡¹od
(
num¡r
, &

);

149 ià(*

)

150 
”rÜ
 = "Expected‚umber for %s but found: %s\n";

151 ià(
d
 < 
mš
 || d > 
max
)

152 
”rÜ
 = "The value for %s was %s which is‚ot within %f - %f\n";

153 ià(
ty³
 =ğ
OPT_INT64
 && (
št64_t
)
d
 != d)

154 
”rÜ
 = "Expected int64 for %s but found %s\n";

155 ià(
ty³
 =ğ
OPT_INT
 && ()
d
 != d)

156 
”rÜ
 = "Expected int for %s but found %s\n";

158  
d
;

159 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, 
”rÜ
, 
cÚ‹xt
, 
num¡r
, 
mš
, 
max
);

160 
	`ex™_´og¿m
(1);

162 
	}
}

164 
št64_t
 
	$·r£_time_Ü_d›
(cÚ¡ *
cÚ‹xt
, cÚ¡ *
time¡r
,

165 
is_du¿tiÚ
)

167 
št64_t
 
us
;

168 ià(
	`av_·r£_time
(&
us
, 
time¡r
, 
is_du¿tiÚ
) < 0) {

169 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid %s specification for %s: %s\n",

170 
is_du¿tiÚ
 ? "du¿tiÚ" : "d©e", 
cÚ‹xt
, 
time¡r
);

171 
	`ex™_´og¿m
(1);

173  
us
;

174 
	}
}

176 
	$show_h–p_İtiÚs
(cÚ¡ 
O±iÚDef
 *
İtiÚs
, cÚ¡ *
msg
, 
»q_æags
,

177 
»j_æags
, 
®t_æags
)

179 cÚ¡ 
O±iÚDef
 *
po
;

180 
fœ¡
;

182 
fœ¡
 = 1;

183 
po
 = 
İtiÚs
;…o->
Çme
;…o++) {

184 
buf
[64];

186 ià(((
po
->
æags
 & 
»q_æags
) !=„eq_flags) ||

187 (
®t_æags
 && !(
po
->
æags
 &‡lt_flags)) ||

188 (
po
->
æags
 & 
»j_æags
))

191 ià(
fœ¡
) {

192 
	`´štf
("%s\n", 
msg
);

193 
fœ¡
 = 0;

195 
	`av_¡¾ıy
(
buf
, 
po
->
Çme
, (buf));

196 ià(
po
->
¬gÇme
) {

197 
	`av_¡¾ÿt
(
buf
, " ", (buf));

198 
	`av_¡¾ÿt
(
buf
, 
po
->
¬gÇme
, (buf));

200 
	`´štf
("-%-17  %s\n", 
buf
, 
po
->
h–p
);

202 
	`´štf
("\n");

203 
	}
}

205 
	$show_h–p_chd»n
(cÚ¡ 
AVCÏss
 *
şass
, 
æags
)

207 cÚ¡ 
AVCÏss
 *
chd
 = 
NULL
;

208 ià(
şass
->
İtiÚ
) {

209 
	`av_İt_show2
(&
şass
, 
NULL
, 
æags
, 0);

210 
	`´štf
("\n");

213 
chd
 = 
	`av_İt_chd_şass_Ãxt
(
şass
, child))

214 
	`show_h–p_chd»n
(
chd
, 
æags
);

215 
	}
}

217 cÚ¡ 
O±iÚDef
 *
	$fšd_İtiÚ
(cÚ¡ 
O±iÚDef
 *
po
, cÚ¡ *
Çme
)

219 cÚ¡ *
p
 = 
	`¡rchr
(
Çme
, ':');

220 
Ën
 = 
p
 ?… - 
Çme
 : 
	`¡¾’
(name);

222 
po
->
Çme
) {

223 ià(!
	`¡ºcmp
(
Çme
, 
po
->Çme, 
Ën
è&& 
	`¡¾’
(po->name) ==†en)

225 
po
++;

227  
po
;

228 
	}
}

233 #ià
HAVE_COMMANDLINETOARGVW
 && 
defšed
(
_WIN32
)

234 
	~<sh–Ïpi.h
>

236 ** 
	gwš32_¬gv_utf8
 = 
NULL
;

237 
	gwš32_¬gc
 = 0;

246 
	$´•¬e_­p_¬gum’ts
(*
¬gc_±r
, ***
¬gv_±r
)

248 *
¬g¡r_æ©
;

249 
wch¬_t
 **
¬gv_w
;

250 
i
, 
buffsize
 = 0, 
off£t
 = 0;

252 ià(
wš32_¬gv_utf8
) {

253 *
¬gc_±r
 = 
wš32_¬gc
;

254 *
¬gv_±r
 = 
wš32_¬gv_utf8
;

258 
wš32_¬gc
 = 0;

259 
¬gv_w
 = 
	`CommªdLšeToArgvW
(
	`G‘CommªdLšeW
(), &
wš32_¬gc
);

260 ià(
wš32_¬gc
 <ğ0 || !
¬gv_w
)

264 
i
 = 0; i < 
wš32_¬gc
; i++)

265 
buffsize
 +ğ
	`WideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
¬gv_w
[
i
], -1,

266 
NULL
, 0, NULL, NULL);

268 
wš32_¬gv_utf8
 = 
	`av_m®locz
((*è* (
wš32_¬gc
 + 1è+ 
buffsize
);

269 
¬g¡r_æ©
 = (*)
wš32_¬gv_utf8
 + (*è* (
wš32_¬gc
 + 1);

270 ià(!
wš32_¬gv_utf8
) {

271 
	`LoÿlF»e
(
¬gv_w
);

275 
i
 = 0; i < 
wš32_¬gc
; i++) {

276 
wš32_¬gv_utf8
[
i
] = &
¬g¡r_æ©
[
off£t
];

277 
off£t
 +ğ
	`WideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
¬gv_w
[
i
], -1,

278 &
¬g¡r_æ©
[
off£t
],

279 
buffsize
 - 
off£t
, 
NULL
, NULL);

281 
wš32_¬gv_utf8
[
i
] = 
NULL
;

282 
	`LoÿlF»e
(
¬gv_w
);

284 *
¬gc_±r
 = 
wš32_¬gc
;

285 *
¬gv_±r
 = 
wš32_¬gv_utf8
;

286 
	}
}

288 
šlše
 
	$´•¬e_­p_¬gum’ts
(*
¬gc_±r
, ***
¬gv_±r
)

291 
	}
}

294 
	$wr™e_İtiÚ
(*
İtùx
, cÚ¡ 
O±iÚDef
 *
po
, cÚ¡ *
İt
,

295 cÚ¡ *
¬g
)

299 *
d¡
 = 
po
->
æags
 & (
OPT_OFFSET
 | 
OPT_SPEC
) ?

300 (
ušt8_t
 *)
İtùx
 + 
po
->
u
.
off
 :…o->u.
d¡_±r
;

301 *
d¡couÁ
;

303 ià(
po
->
æags
 & 
OPT_SPEC
) {

304 
S³cif›rO±
 **
so
 = 
d¡
;

305 *
p
 = 
	`¡rchr
(
İt
, ':');

306 *
¡r
;

308 
d¡couÁ
 = (*)(
so
 + 1);

309 *
so
 = 
	`grow_¬¿y
(*so, (**so), 
d¡couÁ
, *dstcount + 1);

310 
¡r
 = 
	`av_¡rdup
(
p
 ?… + 1 : "");

311 ià(!
¡r
)

312  
	`AVERROR
(
ENOMEM
);

313 (*
so
)[*
d¡couÁ
 - 1].
¥ecif›r
 = 
¡r
;

314 
d¡
 = &(*
so
)[*
d¡couÁ
 - 1].
u
;

317 ià(
po
->
æags
 & 
OPT_STRING
) {

318 *
¡r
;

319 
¡r
 = 
	`av_¡rdup
(
¬g
);

320 
	`av_ä“p
(
d¡
);

321 ià(!
¡r
)

322  
	`AVERROR
(
ENOMEM
);

323 *(**)
d¡
 = 
¡r
;

324 } ià(
po
->
æags
 & 
OPT_BOOL
 ||…o->æag & 
OPT_INT
) {

325 *(*)
d¡
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
¬g
, 
OPT_INT64
, 
INT_MIN
, 
INT_MAX
);

326 } ià(
po
->
æags
 & 
OPT_INT64
) {

327 *(
št64_t
 *)
d¡
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
¬g
, 
OPT_INT64
, 
INT64_MIN
, 
INT64_MAX
);

328 } ià(
po
->
æags
 & 
OPT_TIME
) {

329 *(
št64_t
 *)
d¡
 = 
	`·r£_time_Ü_d›
(
İt
, 
¬g
, 1);

330 } ià(
po
->
æags
 & 
OPT_FLOAT
) {

331 *(*)
d¡
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
¬g
, 
OPT_FLOAT
, -
INFINITY
, INFINITY);

332 } ià(
po
->
æags
 & 
OPT_DOUBLE
) {

333 *(*)
d¡
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
¬g
, 
OPT_DOUBLE
, -
INFINITY
, INFINITY);

334 } ià(
po
->
u
.
func_¬g
) {

335 
»t
 = 
po
->
u
.
	`func_¬g
(
İtùx
, 
İt
, 
¬g
);

336 ià(
»t
 < 0) {

337 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

339 
¬g
, 
İt
, 
	`av_”r2¡r
(
»t
));

340  
»t
;

343 ià(
po
->
æags
 & 
OPT_EXIT
)

344 
	`ex™_´og¿m
(0);

347 
	}
}

349 
	$·r£_İtiÚ
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
,

350 cÚ¡ 
O±iÚDef
 *
İtiÚs
)

352 cÚ¡ 
O±iÚDef
 *
po
;

353 
»t
;

355 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
İt
);

356 ià(!
po
->
Çme
 && 
İt
[0] == 'n' && opt[1] == 'o') {

358 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
İt
 + 2);

359 ià((
po
->
Çme
 && (po->
æags
 & 
OPT_BOOL
)))

360 
¬g
 = "0";

361 } ià(
po
->
æags
 & 
OPT_BOOL
)

362 
¬g
 = "1";

364 ià(!
po
->
Çme
)

365 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, "default");

366 ià(!
po
->
Çme
) {

367 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UÄecognized o±iÚ '%s'\n", 
İt
);

368  
	`AVERROR
(
EINVAL
);

370 ià(
po
->
æags
 & 
HAS_ARG
 && !
¬g
) {

371 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Missšg‡rgum’ˆfÜ o±iÚ '%s'\n", 
İt
);

372  
	`AVERROR
(
EINVAL
);

375 
»t
 = 
	`wr™e_İtiÚ
(
İtùx
, 
po
, 
İt
, 
¬g
);

376 ià(
»t
 < 0)

377  
»t
;

379  !!(
po
->
æags
 & 
HAS_ARG
);

380 
	}
}

382 
·r£_İtiÚs
(*
İtùx
, 
¬gc
, **
¬gv
, cÚ¡ 
O±iÚDef
 *
İtiÚs
,

383 (*
·r£_¬g_funùiÚ
)(*, const *))

385 cÚ¡ *
İt
;

386 
İtšdex
, 
hªdËİtiÚs
 = 1, 
»t
;

389 
	`´•¬e_­p_¬gum’ts
(&
¬gc
, &
¬gv
);

392 
İtšdex
 = 1;

393 
İtšdex
 < 
¬gc
) {

394 
İt
 = 
¬gv
[
İtšdex
++];

396 ià(
hªdËİtiÚs
 && 
İt
[0] == '-' && opt[1] != '\0') {

397 ià(
İt
[1] == '-' && opt[2] == '\0') {

398 
hªdËİtiÚs
 = 0;

401 
İt
++;

403 ià((
»t
 = 
	`·r£_İtiÚ
(
İtùx
, 
İt
, 
¬gv
[
İtšdex
], 
İtiÚs
)) < 0)

404 
	`ex™_´og¿m
(1);

405 
İtšdex
 +ğ
»t
;

407 ià(
·r£_¬g_funùiÚ
)

408 
	`·r£_¬g_funùiÚ
(
İtùx
, 
İt
);

411 
	}
}

413 
	$·r£_İtgroup
(*
İtùx
, 
O±iÚGroup
 *
g
)

415 
i
, 
»t
;

417 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Parsing‡ group of options: %s %s.\n",

418 
g
->
group_def
->
Çme
, g->
¬g
);

420 
i
 = 0; i < 
g
->
nb_İts
; i++) {

421 
O±iÚ
 *
o
 = &
g
->
İts
[
i
];

423 ià(
g
->
group_def
->
æags
 &&

424 !(
g
->
group_def
->
æags
 & 
o
->
İt
->flags)) {

425 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Option %s (%s) cannot be‡ppliedo "

428 "f™ b–Úg to.\n", 
o
->
key
, o->
İt
->
h–p
,

429 
g
->
group_def
->
Çme
, g->
¬g
);

430  
	`AVERROR
(
EINVAL
);

433 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Applying option %s (%s) with‡rgument %s.\n",

434 
o
->
key
, o->
İt
->
h–p
, o->
v®
);

436 
»t
 = 
	`wr™e_İtiÚ
(
İtùx
, 
o
->
İt
, o->
key
, o->
v®
);

437 ià(
»t
 < 0)

438  
»t
;

441 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Successfully…arsed‡ group of options.\n");

444 
	}
}

446 
	$loÿ‹_İtiÚ
(
¬gc
, **
¬gv
, cÚ¡ 
O±iÚDef
 *
İtiÚs
,

447 cÚ¡ *
İŠame
)

449 cÚ¡ 
O±iÚDef
 *
po
;

450 
i
;

452 
i
 = 1; i < 
¬gc
; i++) {

453 cÚ¡ *
cur_İt
 = 
¬gv
[
i
];

455 ià(*
cur_İt
++ != '-')

458 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
cur_İt
);

459 ià(!
po
->
Çme
 && 
cur_İt
[0] == 'n' && cur_opt[1] == 'o')

460 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
cur_İt
 + 2);

462 ià((!
po
->
Çme
 && !
	`¡rcmp
(
cur_İt
, 
İŠame
)) ||

463 (
po
->
Çme
 && !
	`¡rcmp
(
İŠame
,…o->name)))

464  
i
;

466 ià(!
po
->
Çme
 ||…o->
æags
 & 
HAS_ARG
)

467 
i
++;

470 
	}
}

472 
	$dump_¬gum’t
(cÚ¡ *
a
)

474 cÚ¡ *
p
;

476 
p
 = 
a
; *p;…++)

477 ià(!((*
p
 >= '+' && *p <= ':') || (*p >= '@' && *p <= 'Z') ||

478 *
p
 == '_' || (*p >= 'a' && *p <= 'z')))

480 ià(!*
p
) {

481 
	`åuts
(
a
, 
»pÜt_fe
);

484 
	`åutc
('"', 
»pÜt_fe
);

485 
p
 = 
a
; *p;…++) {

486 ià(*
p
 == '\\' || *p == '"' || *p == '$' || *p == '`')

487 
	`årštf
(
»pÜt_fe
, "\\%c", *
p
);

488 ià(*
p
 < ' ' || *p > '~')

489 
	`årštf
(
»pÜt_fe
, "\\x%02x", *
p
);

491 
	`åutc
(*
p
, 
»pÜt_fe
);

493 
	`åutc
('"', 
»pÜt_fe
);

494 
	}
}

496 
	$check_İtiÚs
(cÚ¡ 
O±iÚDef
 *
po
)

498 
po
->
Çme
) {

499 ià(
po
->
æags
 & 
OPT_PERFILE
)

500 
	`av_as£¹0
(
po
->
æags
 & (
OPT_INPUT
 | 
OPT_OUTPUT
));

501 
po
++;

503 
	}
}

505 
	$·r£_logËv–
(
¬gc
, **
¬gv
, cÚ¡ 
O±iÚDef
 *
İtiÚs
)

507 
idx
 = 
	`loÿ‹_İtiÚ
(
¬gc
, 
¬gv
, 
İtiÚs
, "loglevel");

508 cÚ¡ *
’v
;

510 
	`check_İtiÚs
(
İtiÚs
);

512 ià(!
idx
)

513 
idx
 = 
	`loÿ‹_İtiÚ
(
¬gc
, 
¬gv
, 
İtiÚs
, "v");

514 ià(
idx
 && 
¬gv
[idx + 1])

515 
	`İt_logËv–
(
NULL
, "logËv–", 
¬gv
[
idx
 + 1]);

516 
idx
 = 
	`loÿ‹_İtiÚ
(
¬gc
, 
¬gv
, 
İtiÚs
, "report");

517 ià((
’v
 = 
	`g‘’v
("FFREPORT")è|| 
idx
) {

518 
	`š™_»pÜt
(
’v
);

519 ià(
»pÜt_fe
) {

520 
i
;

521 
	`årštf
(
»pÜt_fe
, "Command†ine:\n");

522 
i
 = 0; i < 
¬gc
; i++) {

523 
	`dump_¬gum’t
(
¬gv
[
i
]);

524 
	`åutc
(
i
 < 
¬gc
 - 1 ? ' ' : '\n', 
»pÜt_fe
);

526 
	`fæush
(
»pÜt_fe
);

529 
idx
 = 
	`loÿ‹_İtiÚ
(
¬gc
, 
¬gv
, 
İtiÚs
, "hide_banner");

530 ià(
idx
)

531 
hide_bªÃr
 = 1;

532 
	}
}

534 cÚ¡ 
AVO±iÚ
 *
	$İt_fšd
(*
obj
, cÚ¡ *
Çme
, cÚ¡ *
un™
,

535 
İt_æags
, 
£¬ch_æags
)

537 cÚ¡ 
AVO±iÚ
 *
o
 = 
	`av_İt_fšd
(
obj
, 
Çme
, 
un™
, 
İt_æags
, 
£¬ch_æags
);

538 if(
o
 && !o->
æags
)

539  
NULL
;

540  
o
;

541 
	}
}

543 
	#FLAGS
 (
o
->
ty³
 =ğ
AV_OPT_TYPE_FLAGS
 && (
¬g
[0]=='-' ||‡rg[0]=='+')è? 
AV_DICT_APPEND
 : 0

	)

544 
	$İt_deçuÉ
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

546 cÚ¡ 
AVO±iÚ
 *
o
;

547 
cÚsumed
 = 0;

548 
İt_¡r³d
[128];

549 cÚ¡ *
p
;

550 cÚ¡ 
AVCÏss
 *
cc
 = 
	`avcodec_g‘_şass
(), *
fc
 = 
	`avfÜm©_g‘_şass
();

551 #ià
CONFIG_AVRESAMPLE


552 cÚ¡ 
AVCÏss
 *
rc
 = 
	`av»§m¶e_g‘_şass
();

554 #ià
CONFIG_SWSCALE


555 cÚ¡ 
AVCÏss
 *
sc
 = 
	`sws_g‘_şass
();

557 #ià
CONFIG_SWRESAMPLE


558 cÚ¡ 
AVCÏss
 *
swr_şass
 = 
	`swr_g‘_şass
();

561 ià(!
	`¡rcmp
(
İt
, "debug") || !strcmp(opt, "fdebug"))

562 
	`av_log_£t_Ëv–
(
AV_LOG_DEBUG
);

564 ià(!(
p
 = 
	`¡rchr
(
İt
, ':')))

565 
p
 = 
İt
 + 
	`¡¾’
(opt);

566 
	`av_¡¾ıy
(
İt_¡r³d
, 
İt
, 
	`FFMIN
((İt_¡r³d), 
p
 - opt + 1));

568 ià((
o
 = 
	`İt_fšd
(&
cc
, 
İt_¡r³d
, 
NULL
, 0,

569 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
)) ||

570 ((
İt
[0] == 'v' || opt[0] == 'a' || opt[0] == 's') &&

571 (
o
 = 
	`İt_fšd
(&
cc
, 
İt
 + 1, 
NULL
, 0, 
AV_OPT_SEARCH_FAKE_OBJ
)))) {

572 
	`av_diù_£t
(&
codec_İts
, 
İt
, 
¬g
, 
FLAGS
);

573 
cÚsumed
 = 1;

575 ià((
o
 = 
	`İt_fšd
(&
fc
, 
İt
, 
NULL
, 0,

576 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
))) {

577 
	`av_diù_£t
(&
fÜm©_İts
, 
İt
, 
¬g
, 
FLAGS
);

578 ià(
cÚsumed
)

579 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "Routšg o±iÚ % tØbÙh codeøªd mux”†ay”\n", 
İt
);

580 
cÚsumed
 = 1;

582 #ià
CONFIG_SWSCALE


583 ià(!
cÚsumed
 && (
o
 = 
	`İt_fšd
(&
sc
, 
İt
, 
NULL
, 0,

584 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
))) {

585 
SwsCÚ‹xt
 *
sws
 = 
	`sws_®loc_cÚ‹xt
();

586 
»t
 = 
	`av_İt_£t
(
sws
, 
İt
, 
¬g
, 0);

587 
	`sws_ä“CÚ‹xt
(
sws
);

588 ià(!
	`¡rcmp
(
İt
, "srcw") || !strcmp(opt, "srch") ||

589 !
	`¡rcmp
(
İt
, "dstw") || !strcmp(opt, "dsth") ||

590 !
	`¡rcmp
(
İt
, "src_format") || !strcmp(opt, "dst_format")) {

591 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Directly using swscale dimensions/format options is‚ot supported,…lease usehe -s or -pix_fmt options\n");

592  
	`AVERROR
(
EINVAL
);

594 ià(
»t
 < 0) {

595 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü s‘tšg o±iÚ %s.\n", 
İt
);

596  
»t
;

599 
	`av_diù_£t
(&
sws_diù
, 
İt
, 
¬g
, 
FLAGS
);

601 
cÚsumed
 = 1;

604 ià(!
cÚsumed
 && !
	`¡rcmp
(
İt
, "sws_flags")) {

605 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "IgnÜšg % %s, dutØdi§bËd swsÿË\n", 
İt
, 
¬g
);

606 
cÚsumed
 = 1;

609 #ià
CONFIG_SWRESAMPLE


610 ià(!
cÚsumed
 && (
o
=
	`İt_fšd
(&
swr_şass
, 
İt
, 
NULL
, 0,

611 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
))) {

612 
SwrCÚ‹xt
 *
swr
 = 
	`swr_®loc
();

613 
»t
 = 
	`av_İt_£t
(
swr
, 
İt
, 
¬g
, 0);

614 
	`swr_ä“
(&
swr
);

615 ià(
»t
 < 0) {

616 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü s‘tšg o±iÚ %s.\n", 
İt
);

617  
»t
;

619 
	`av_diù_£t
(&
swr_İts
, 
İt
, 
¬g
, 
FLAGS
);

620 
cÚsumed
 = 1;

623 #ià
CONFIG_AVRESAMPLE


624 ià((
o
=
	`İt_fšd
(&
rc
, 
İt
, 
NULL
, 0,

625 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
))) {

626 
	`av_diù_£t
(&
»§m¶e_İts
, 
İt
, 
¬g
, 
FLAGS
);

627 
cÚsumed
 = 1;

631 ià(
cÚsumed
)

633  
AVERROR_OPTION_NOT_FOUND
;

634 
	}
}

641 
	$m©ch_group_£·¿tÜ
(cÚ¡ 
O±iÚGroupDef
 *
groups
, 
nb_groups
,

642 cÚ¡ *
İt
)

644 
i
;

646 
i
 = 0; i < 
nb_groups
; i++) {

647 cÚ¡ 
O±iÚGroupDef
 *
p
 = &
groups
[
i
];

648 ià(
p
->
£p
 && !
	`¡rcmp
Õ->£p, 
İt
))

649  
i
;

653 
	}
}

661 
	$fšish_group
(
O±iÚP¬£CÚ‹xt
 *
oùx
, 
group_idx
,

662 cÚ¡ *
¬g
)

664 
O±iÚGroupLi¡
 *
l
 = &
oùx
->
groups
[
group_idx
];

665 
O±iÚGroup
 *
g
;

667 
	`GROW_ARRAY
(
l
->
groups
,†->
nb_groups
);

668 
g
 = &
l
->
groups
[l->
nb_groups
 - 1];

670 *
g
 = 
oùx
->
cur_group
;

671 
g
->
¬g
 =‡rg;

672 
g
->
group_def
 = 
l
->group_def;

673 
g
->
sws_diù
 = sws_dict;

674 
g
->
swr_İts
 = swr_opts;

675 
g
->
codec_İts
 = codec_opts;

676 
g
->
fÜm©_İts
 = format_opts;

677 
g
->
»§m¶e_İts
 =„esample_opts;

679 
codec_İts
 = 
NULL
;

680 
fÜm©_İts
 = 
NULL
;

681 
»§m¶e_İts
 = 
NULL
;

682 
sws_diù
 = 
NULL
;

683 
swr_İts
 = 
NULL
;

684 
	`š™_İts
();

686 
	`mem£t
(&
oùx
->
cur_group
, 0, (octx->cur_group));

687 
	}
}

692 
	$add_İt
(
O±iÚP¬£CÚ‹xt
 *
oùx
, cÚ¡ 
O±iÚDef
 *
İt
,

693 cÚ¡ *
key
, cÚ¡ *
v®
)

695 
glob®
 = !(
İt
->
æags
 & (
OPT_PERFILE
 | 
OPT_SPEC
 | 
OPT_OFFSET
));

696 
O±iÚGroup
 *
g
 = 
glob®
 ? &
oùx
->
glob®_İts
 : &oùx->
cur_group
;

698 
	`GROW_ARRAY
(
g
->
İts
, g->
nb_İts
);

699 
g
->
İts
[g->
nb_İts
 - 1].
İt
 = opt;

700 
g
->
İts
[g->
nb_İts
 - 1].
key
 = key;

701 
g
->
İts
[g->
nb_İts
 - 1].
v®
 = val;

702 
	}
}

704 
	$š™_·r£_cÚ‹xt
(
O±iÚP¬£CÚ‹xt
 *
oùx
,

705 cÚ¡ 
O±iÚGroupDef
 *
groups
, 
nb_groups
)

707 cÚ¡ 
O±iÚGroupDef
 
glob®_group
 = { "global" };

708 
i
;

710 
	`mem£t
(
oùx
, 0, (*octx));

712 
oùx
->
nb_groups
 =‚b_groups;

713 
oùx
->
groups
 = 
	`av_m®locz_¬¿y
(oùx->
nb_groups
, (*octx->groups));

714 ià(!
oùx
->
groups
)

715 
	`ex™_´og¿m
(1);

717 
i
 = 0; i < 
oùx
->
nb_groups
; i++)

718 
oùx
->
groups
[
i
].
group_def
 = &groups[i];

720 
oùx
->
glob®_İts
.
group_def
 = &
glob®_group
;

721 
oùx
->
glob®_İts
.
¬g
 = "";

723 
	`š™_İts
();

724 
	}
}

726 
	$unš™_·r£_cÚ‹xt
(
O±iÚP¬£CÚ‹xt
 *
oùx
)

728 
i
, 
j
;

730 
i
 = 0; i < 
oùx
->
nb_groups
; i++) {

731 
O±iÚGroupLi¡
 *
l
 = &
oùx
->
groups
[
i
];

733 
j
 = 0; j < 
l
->
nb_groups
; j++) {

734 
	`av_ä“p
(&
l
->
groups
[
j
].
İts
);

735 
	`av_diù_ä“
(&
l
->
groups
[
j
].
codec_İts
);

736 
	`av_diù_ä“
(&
l
->
groups
[
j
].
fÜm©_İts
);

737 
	`av_diù_ä“
(&
l
->
groups
[
j
].
»§m¶e_İts
);

739 
	`av_diù_ä“
(&
l
->
groups
[
j
].
sws_diù
);

740 
	`av_diù_ä“
(&
l
->
groups
[
j
].
swr_İts
);

742 
	`av_ä“p
(&
l
->
groups
);

744 
	`av_ä“p
(&
oùx
->
groups
);

746 
	`av_ä“p
(&
oùx
->
cur_group
.
İts
);

747 
	`av_ä“p
(&
oùx
->
glob®_İts
.
İts
);

749 
	`unš™_İts
();

750 
	}
}

752 
	$¥l™_commªdlše
(
O±iÚP¬£CÚ‹xt
 *
oùx
, 
¬gc
, *
¬gv
[],

753 cÚ¡ 
O±iÚDef
 *
İtiÚs
,

754 cÚ¡ 
O±iÚGroupDef
 *
groups
, 
nb_groups
)

756 
İtšdex
 = 1;

757 
dashdash
 = -2;

760 
	`´•¬e_­p_¬gum’ts
(&
¬gc
, &
¬gv
);

762 
	`š™_·r£_cÚ‹xt
(
oùx
, 
groups
, 
nb_groups
);

763 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Splittinghe commandline.\n");

765 
İtšdex
 < 
¬gc
) {

766 cÚ¡ *
İt
 = 
¬gv
[
İtšdex
++], *
¬g
;

767 cÚ¡ 
O±iÚDef
 *
po
;

768 
»t
;

770 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "R—dšg o±iÚ '%s' ...", 
İt
);

772 ià(
İt
[0] == '-' && opt[1] == '-' && !opt[2]) {

773 
dashdash
 = 
İtšdex
;

777 ià(
İt
[0] !ğ'-' || !İt[1] || 
dashdash
+1 =ğ
İtšdex
) {

778 
	`fšish_group
(
oùx
, 0, 
İt
);

779 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, " m©ched‡ %s.\n", 
groups
[0].
Çme
);

782 
İt
++;

784 
	#GET_ARG
(
¬g
) \

786 
¬g
 = 
¬gv
[
İtšdex
++]; \

787 ià(!
¬g
) { \

788 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Missšg‡rgum’ˆfÜ o±iÚ '%s'.\n", 
İt
);\

789  
	`AVERROR
(
EINVAL
); \

791 } 0)

	)

794 ià((
»t
 = 
	`m©ch_group_£·¿tÜ
(
groups
, 
nb_groups
, 
İt
)) >= 0) {

795 
	`GET_ARG
(
¬g
);

796 
	`fšish_group
(
oùx
, 
»t
, 
¬g
);

797 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, " matched‡s %s with‡rgument '%s'.\n",

798 
groups
[
»t
].
Çme
, 
¬g
);

803 
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
İt
);

804 ià(
po
->
Çme
) {

805 ià(
po
->
æags
 & 
OPT_EXIT
) {

807 
¬g
 = 
¬gv
[
İtšdex
++];

808 } ià(
po
->
æags
 & 
HAS_ARG
) {

809 
	`GET_ARG
(
¬g
);

811 
¬g
 = "1";

814 
	`add_İt
(
oùx
, 
po
, 
İt
, 
¬g
);

815 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, " matched‡s option '%s' (%s) with "

816 "¬gum’ˆ'%s'.\n", 
po
->
Çme
,…o->
h–p
, 
¬g
);

821 ià(
¬gv
[
İtšdex
]) {

822 
»t
 = 
	`İt_deçuÉ
(
NULL
, 
İt
, 
¬gv
[
İtšdex
]);

823 ià(
»t
 >= 0) {

824 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, " matched‡s AVOption '%s' with "

825 "¬gum’ˆ'%s'.\n", 
İt
, 
¬gv
[
İtšdex
]);

826 
İtšdex
++;

828 } ià(
»t
 !ğ
AVERROR_OPTION_NOT_FOUND
) {

829 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error…arsing option '%s' "

830 "w™h‡rgum’ˆ'%s'.\n", 
İt
, 
¬gv
[
İtšdex
]);

831  
»t
;

836 ià(
İt
[0] == 'n' && opt[1] == 'o' &&

837 (
po
 = 
	`fšd_İtiÚ
(
İtiÚs
, 
İt
 + 2)) &&

838 
po
->
Çme
 &&…o->
æags
 & 
OPT_BOOL
) {

839 
	`add_İt
(
oùx
, 
po
, 
İt
, "0");

840 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, " matched‡s option '%s' (%s) with "

841 "¬gum’ˆ0.\n", 
po
->
Çme
,…o->
h–p
);

845 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UÄecognized o±iÚ '%s'.\n", 
İt
);

846  
AVERROR_OPTION_NOT_FOUND
;

849 ià(
oùx
->
cur_group
.
nb_İts
 || 
codec_İts
 || 
fÜm©_İts
 || 
»§m¶e_İts
)

850 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Trailing options were found onhe "

853 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Finished splittinghe commandline.\n");

856 
	}
}

858 
	$İt_ıuæags
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

860 
»t
;

861 
æags
 = 
	`av_g‘_ıu_æags
();

863 ià((
»t
 = 
	`av_·r£_ıu_ÿps
(&
æags
, 
¬g
)) < 0)

864  
»t
;

866 
	`av_fÜû_ıu_æags
(
æags
);

868 
	}
}

870 
	$İt_logËv–
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

872 cÚ¡ sŒuù { cÚ¡ *
Çme
; 
Ëv–
; } 
log_Ëv–s
[] = {

873 { "qu›t" , 
AV_LOG_QUIET
 },

874 { "·nic" , 
AV_LOG_PANIC
 },

875 { "çl" , 
AV_LOG_FATAL
 },

876 { "”rÜ" , 
AV_LOG_ERROR
 },

877 { "w¬nšg", 
AV_LOG_WARNING
 },

878 { "šfo" , 
AV_LOG_INFO
 },

879 { "v”bo£", 
AV_LOG_VERBOSE
 },

880 { "debug" , 
AV_LOG_DEBUG
 },

881 { "Œaû" , 
AV_LOG_TRACE
 },

883 *

;

884 
Ëv–
;

885 
æags
;

886 
i
;

888 
æags
 = 
	`av_log_g‘_æags
();

889 

 = 
	`¡r¡r
(
¬g
, "repeat");

890 ià(

)

891 
æags
 &ğ~
AV_LOG_SKIP_REPEATED
;

893 
æags
 |ğ
AV_LOG_SKIP_REPEATED
;

895 
	`av_log_£t_æags
(
æags
);

896 ià(

 =ğ
¬g
)

897 
¬g
 += 6 + (arg[6]=='+');

898 if(

 && !*
¬g
)

901 
i
 = 0; i < 
	`FF_ARRAY_ELEMS
(
log_Ëv–s
); i++) {

902 ià(!
	`¡rcmp
(
log_Ëv–s
[
i
].
Çme
, 
¬g
)) {

903 
	`av_log_£t_Ëv–
(
log_Ëv–s
[
i
].
Ëv–
);

908 
Ëv–
 = 
	`¡¹Ş
(
¬g
, &

, 10);

909 ià(*

) {

910 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid†oglevel \"%s\". "

911 "PossibË†ev– ¬numb” Ü:\n", 
¬g
);

912 
i
 = 0; i < 
	`FF_ARRAY_ELEMS
(
log_Ëv–s
); i++)

913 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "\"%s\"\n", 
log_Ëv–s
[
i
].
Çme
);

914 
	`ex™_´og¿m
(1);

916 
	`av_log_£t_Ëv–
(
Ëv–
);

918 
	}
}

920 
	$ex·nd_f’ame_‹m¶©e
(
AVBPršt
 *
bp
, cÚ¡ *
‹m¶©e
,

921 
tm
 *tm)

923 
c
;

925 (
c
 = *(
‹m¶©e
++))) {

926 ià(
c
 == '%') {

927 ià(!(
c
 = *(
‹m¶©e
++)))

929 
c
) {

931 
	`av_b´štf
(
bp
, "%s", 
´og¿m_Çme
);

934 
	`av_b´štf
(
bp
, "%04d%02d%02d-%02d%02d%02d",

935 
tm
->
tm_y—r
 + 1900,m->
tm_mÚ
 + 1,m->
tm_mday
,

936 
tm
->
tm_hour
,m->
tm_mš
,m->
tm_£c
);

939 
	`av_b´št_ch¬s
(
bp
, 
c
, 1);

943 
	`av_b´št_ch¬s
(
bp
, 
c
, 1);

946 
	}
}

948 
	$š™_»pÜt
(cÚ¡ *
’v
)

950 *
f’ame_‹m¶©e
 = 
NULL
;

951 *
key
, *
v®
;

952 
»t
, 
couÁ
 = 0;

953 
time_t
 
now
;

954 
tm
 *tm;

955 
AVBPršt
 
f’ame
;

957 ià(
»pÜt_fe
)

959 
	`time
(&
now
);

960 
tm
 = 
	`loÿÉime
(&
now
);

962 
’v
 && *env) {

963 ià((
»t
 = 
	`av_İt_g‘_key_v®ue
(&
’v
, "=", ":", 0, &
key
, &
v®
)) < 0) {

964 ià(
couÁ
)

965 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

967 
	`av_”r2¡r
(
»t
));

970 ià(*
’v
)

971 
’v
++;

972 
couÁ
++;

973 ià(!
	`¡rcmp
(
key
, "file")) {

974 
	`av_ä“
(
f’ame_‹m¶©e
);

975 
f’ame_‹m¶©e
 = 
v®
;

976 
v®
 = 
NULL
;

977 } ià(!
	`¡rcmp
(
key
, "level")) {

978 *

;

979 
»pÜt_fe_Ëv–
 = 
	`¡¹Ş
(
v®
, &

, 10);

980 ià(*

) {

981 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid„eport file†evel\n");

982 
	`ex™_´og¿m
(1);

985 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀkey '%s' iÀFFREPORT\n", 
key
);

987 
	`av_ä“
(
v®
);

988 
	`av_ä“
(
key
);

991 
	`av_b´št_š™
(&
f’ame
, 0, 1);

992 
	`ex·nd_f’ame_‹m¶©e
(&
f’ame
,

993 
	`av_x_if_nuÎ
(
f’ame_‹m¶©e
, "%p-%t.log"), 
tm
);

994 
	`av_ä“
(
f’ame_‹m¶©e
);

995 ià(!
	`av_b´št_is_com¶‘e
(&
f’ame
)) {

996 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Out of memory building„eport file‚ame\n");

997  
	`AVERROR
(
ENOMEM
);

1000 
»pÜt_fe
 = 
	`fİ’
(
f’ame
.
¡r
, "w");

1001 ià(!
»pÜt_fe
) {

1002 
»t
 = 
	`AVERROR
(
”ºo
);

1003 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Failedo open„eport \"%s\": %s\n",

1004 
f’ame
.
¡r
, 
	`¡»¼Ü
(
”ºo
));

1005  
»t
;

1007 
	`av_log_£t_ÿÎback
(
log_ÿÎback_»pÜt
);

1008 
	`av_log
(
NULL
, 
AV_LOG_INFO
,

1011 
´og¿m_Çme
,

1012 
tm
->
tm_y—r
 + 1900,m->
tm_mÚ
 + 1,m->
tm_mday
,

1013 
tm
->
tm_hour
,m->
tm_mš
,m->
tm_£c
,

1014 
f’ame
.
¡r
);

1015 
	`av_b´št_fš®ize
(&
f’ame
, 
NULL
);

1017 
	}
}

1019 
	$İt_»pÜt
(cÚ¡ *
İt
)

1021  
	`š™_»pÜt
(
NULL
);

1022 
	}
}

1024 
	$İt_max_®loc
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1026 *

;

1027 
size_t
 
max
;

1029 
max
 = 
	`¡¹Ş
(
¬g
, &

, 10);

1030 ià(*

) {

1031 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id max_®loø\"%s\".\n", 
¬g
);

1032 
	`ex™_´og¿m
(1);

1034 
	`av_max_®loc
(
max
);

1036 
	}
}

1038 
	$İt_tim–im™
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1040 #ià
HAVE_SETRLIMIT


1041 
lim
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
¬g
, 
OPT_INT64
, 0, 
INT_MAX
);

1042 
¾im™
 
¾
 = { 
lim
,†im + 1 };

1043 ià(
	`£Œlim™
(
RLIMIT_CPU
, &
¾
))

1044 
	`³¼Ü
("setrlimit");

1046 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "-% nÙ im¶em’‹d oÀthi OS\n", 
İt
);

1049 
	}
}

1051 
	$´št_”rÜ
(cÚ¡ *
f’ame
, 
”r
)

1053 
”rbuf
[128];

1054 cÚ¡ *
”rbuf_±r
 = 
”rbuf
;

1056 ià(
	`av_¡»¼Ü
(
”r
, 
”rbuf
, (errbuf)) < 0)

1057 
”rbuf_±r
 = 
	`¡»¼Ü
(
	`AVUNERROR
(
”r
));

1058 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "%s: %s\n", 
f’ame
, 
”rbuf_±r
);

1059 
	}
}

1061 
	gw¬Ãd_cfg
 = 0;

1063 
	#INDENT
 1

	)

1064 
	#SHOW_VERSION
 2

	)

1065 
	#SHOW_CONFIG
 4

	)

1066 
	#SHOW_COPYRIGHT
 8

	)

1068 
	#PRINT_LIB_INFO
(
libÇme
, 
LIBNAME
, 
æags
, 
Ëv–
) \

1069 ià(
CONFIG_
##
LIBNAME
) { \

1070 cÚ¡ *
šd’t
 = 
æags
 & 
INDENT
? " " : ""; \

1071 ià(
æags
 & 
SHOW_VERSION
) { \

1072 
v”siÚ
 = 
libÇme
##
	`_v”siÚ
(); \

1073 
	`av_log
(
NULL
, 
Ëv–
, \

1075 
šd’t
, #libname, \

1076 
LIB
##
LIBNAME
##
_VERSION_MAJOR
, \

1077 
LIB
##
LIBNAME
##
_VERSION_MINOR
, \

1078 
LIB
##
LIBNAME
##
_VERSION_MICRO
, \

1079 
	`AV_VERSION_MAJOR
(
v”siÚ
), 
	`AV_VERSION_MINOR
(version),\

1080 
	`AV_VERSION_MICRO
(
v”siÚ
)); \

1082 ià(
æags
 & 
SHOW_CONFIG
) { \

1083 cÚ¡ *
cfg
 = 
libÇme
##
	`_cÚfigu¿tiÚ
(); \

1084 ià(
	`¡rcmp
(
FFMPEG_CONFIGURATION
, 
cfg
)) { \

1085 ià(!
w¬Ãd_cfg
) { \

1086 
	`av_log
(
NULL
, 
Ëv–
, \

1088 
šd’t
); \

1089 
w¬Ãd_cfg
 = 1; \

1091 
	`av_log
(
NULL
, 
Ëv–
, "%s%-11s configuration: %s\n", \

1092 
šd’t
, #libÇme, 
cfg
); \

1096 

	)

1097 
	$´št_®l_libs_šfo
(
æags
, 
Ëv–
)

1099 
	`PRINT_LIB_INFO
(
avut
, 
AVUTIL
, 
æags
, 
Ëv–
);

1100 
	`PRINT_LIB_INFO
(
avcodec
, 
AVCODEC
, 
æags
, 
Ëv–
);

1101 
	`PRINT_LIB_INFO
(
avfÜm©
, 
AVFORMAT
, 
æags
, 
Ëv–
);

1102 
	`PRINT_LIB_INFO
(
avdeviû
, 
AVDEVICE
, 
æags
, 
Ëv–
);

1103 
	`PRINT_LIB_INFO
(
avf‹r
, 
AVFILTER
, 
æags
, 
Ëv–
);

1104 
	`PRINT_LIB_INFO
(
av»§m¶e
, 
AVRESAMPLE
, 
æags
, 
Ëv–
);

1105 
	`PRINT_LIB_INFO
(
swsÿË
, 
SWSCALE
, 
æags
, 
Ëv–
);

1106 
	`PRINT_LIB_INFO
(
sw»§m¶e
, 
SWRESAMPLE
, 
æags
, 
Ëv–
);

1107 
	`PRINT_LIB_INFO
(
po¡´oc
, 
POSTPROC
, 
æags
, 
Ëv–
);

1108 
	}
}

1110 
	$´št_´og¿m_šfo
(
æags
, 
Ëv–
)

1112 cÚ¡ *
šd’t
 = 
æags
 & 
INDENT
? " " : "";

1114 
	`av_log
(
NULL
, 
Ëv–
, "% v”siÚ " 
FFMPEG_VERSION
, 
´og¿m_Çme
);

1115 ià(
æags
 & 
SHOW_COPYRIGHT
)

1116 
	`av_log
(
NULL
, 
Ëv–
, " Copyright (c) %d-%dhe FFmpeg developers",

1117 
´og¿m_bœth_y—r
, 
CONFIG_THIS_YEAR
);

1118 
	`av_log
(
NULL
, 
Ëv–
, "\n");

1119 
	`av_log
(
NULL
, 
Ëv–
, "%sbuˆw™h %s\n", 
šd’t
, 
CC_IDENT
);

1121 
	`av_log
(
NULL
, 
Ëv–
, "%scÚfigu¿tiÚ: " 
FFMPEG_CONFIGURATION
 "\n", 
šd’t
);

1122 
	}
}

1124 
	$´št_budcÚf
(
æags
, 
Ëv–
)

1126 cÚ¡ *
šd’t
 = 
æags
 & 
INDENT
 ? " " : "";

1127 
¡r
[] = { 
FFMPEG_CONFIGURATION
 };

1128 *
cÚæi¡
, *
»move_tde
, *
¥l™cÚf
;

1132 (
cÚæi¡
 = 
	`¡r¡r
(
¡r
, " --")è!ğ
NULL
) {

1133 
	`¡ºıy
(
cÚæi¡
, "~--", 3);

1138 (
»move_tde
 = 
	`¡r¡r
(
¡r
, "pkg-cÚfig~")è!ğ
NULL
) {

1139 
	`¡ºıy
(
»move_tde
, "pkg-config ", 11);

1142 
¥l™cÚf
 = 
	`¡¹ok
(
¡r
, "~");

1143 
	`av_log
(
NULL
, 
Ëv–
, "\n%scÚfigu¿tiÚ:\n", 
šd’t
);

1144 
¥l™cÚf
 !ğ
NULL
) {

1145 
	`av_log
(
NULL
, 
Ëv–
, "%s%s%s\n", 
šd’t
, ind’t, 
¥l™cÚf
);

1146 
¥l™cÚf
 = 
	`¡¹ok
(
NULL
, "~");

1148 
	}
}

1150 
	$show_bªÃr
(
¬gc
, **
¬gv
, cÚ¡ 
O±iÚDef
 *
İtiÚs
)

1152 
idx
 = 
	`loÿ‹_İtiÚ
(
¬gc
, 
¬gv
, 
İtiÚs
, "version");

1153 ià(
hide_bªÃr
 || 
idx
)

1156 
	`´št_´og¿m_šfo
 (
INDENT
|
SHOW_COPYRIGHT
, 
AV_LOG_INFO
);

1157 
	`´št_®l_libs_šfo
(
INDENT
|
SHOW_CONFIG
, 
AV_LOG_INFO
);

1158 
	`´št_®l_libs_šfo
(
INDENT
|
SHOW_VERSION
, 
AV_LOG_INFO
);

1159 
	}
}

1161 
	$show_v”siÚ
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1163 
	`av_log_£t_ÿÎback
(
log_ÿÎback_h–p
);

1164 
	`´št_´og¿m_šfo
 (
SHOW_COPYRIGHT
, 
AV_LOG_INFO
);

1165 
	`´št_®l_libs_šfo
(
SHOW_VERSION
, 
AV_LOG_INFO
);

1168 
	}
}

1170 
	$show_budcÚf
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1172 
	`av_log_£t_ÿÎback
(
log_ÿÎback_h–p
);

1173 
	`´št_budcÚf
 (
INDENT
|0, 
AV_LOG_INFO
);

1176 
	}
}

1178 
	$show_liûn£
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1180 #ià
CONFIG_NONFREE


1181 
	`´štf
(

1184 
´og¿m_Çme
 );

1185 #–ià
CONFIG_GPLV3


1186 
	`´štf
(

1199 
´og¿m_Çme
,…rogram_name,…rogram_name );

1200 #–ià
CONFIG_GPL


1201 
	`´štf
(

1215 
´og¿m_Çme
,…rogram_name,…rogram_name );

1216 #–ià
CONFIG_LGPLV3


1217 
	`´štf
(

1230 
´og¿m_Çme
,…rogram_name,…rogram_name );

1232 
	`´štf
(

1246 
´og¿m_Çme
,…rogram_name,…rogram_name );

1250 
	}
}

1252 
	$is_deviû
(cÚ¡ 
AVCÏss
 *
avşass
)

1254 ià(!
avşass
)

1256  
	`AV_IS_INPUT_DEVICE
(
avşass
->
ÿ‹gÜy
è|| 
	`AV_IS_OUTPUT_DEVICE
(avclass->category);

1257 
	}
}

1259 
	$show_fÜm©s_deviûs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
, 
deviû_Úly
, 
muxdemux”s
)

1261 
AVIÅutFÜm©
 *
ifmt
 = 
NULL
;

1262 
AVOuutFÜm©
 *
ofmt
 = 
NULL
;

1263 cÚ¡ *
Ï¡_Çme
;

1264 
is_dev
;

1266 
	`´štf
("%s\n"

1269 " --\n", 
deviû_Úly
 ? "Devices:" : "File formats:");

1270 
Ï¡_Çme
 = "000";

1272 
decode
 = 0;

1273 
’code
 = 0;

1274 cÚ¡ *
Çme
 = 
NULL
;

1275 cÚ¡ *
lÚg_Çme
 = 
NULL
;

1277 ià(
muxdemux”s
 !=
SHOW_DEMUXERS
) {

1278 (
ofmt
 = 
	`av_ofÜm©_Ãxt
(ofmt))) {

1279 
is_dev
 = 
	`is_deviû
(
ofmt
->
´iv_şass
);

1280 ià(!
is_dev
 && 
deviû_Úly
)

1282 ià((!
Çme
 || 
	`¡rcmp
(
ofmt
->name,‚ame) < 0) &&

1283 
	`¡rcmp
(
ofmt
->
Çme
, 
Ï¡_Çme
) > 0) {

1284 
Çme
 = 
ofmt
->name;

1285 
lÚg_Çme
 = 
ofmt
->long_name;

1286 
’code
 = 1;

1290 ià(
muxdemux”s
 !ğ
SHOW_MUXERS
) {

1291 (
ifmt
 = 
	`av_ifÜm©_Ãxt
(ifmt))) {

1292 
is_dev
 = 
	`is_deviû
(
ifmt
->
´iv_şass
);

1293 ià(!
is_dev
 && 
deviû_Úly
)

1295 ià((!
Çme
 || 
	`¡rcmp
(
ifmt
->name,‚ame) < 0) &&

1296 
	`¡rcmp
(
ifmt
->
Çme
, 
Ï¡_Çme
) > 0) {

1297 
Çme
 = 
ifmt
->name;

1298 
lÚg_Çme
 = 
ifmt
->long_name;

1299 
’code
 = 0;

1301 ià(
Çme
 && 
	`¡rcmp
(
ifmt
->name,‚ame) == 0)

1302 
decode
 = 1;

1305 ià(!
Çme
)

1307 
Ï¡_Çme
 = 
Çme
;

1309 
	`´štf
(" %s%s %-15s %s\n",

1310 
decode
 ? "D" : " ",

1311 
’code
 ? "E" : " ",

1312 
Çme
,

1313 
lÚg_Çme
 ?†ong_name:" ");

1316 
	}
}

1318 
	$show_fÜm©s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1320  
	`show_fÜm©s_deviûs
(
İtùx
, 
İt
, 
¬g
, 0, 
SHOW_DEFAULT
);

1321 
	}
}

1323 
	$show_mux”s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1325  
	`show_fÜm©s_deviûs
(
İtùx
, 
İt
, 
¬g
, 0, 
SHOW_MUXERS
);

1326 
	}
}

1328 
	$show_demux”s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1330  
	`show_fÜm©s_deviûs
(
İtùx
, 
İt
, 
¬g
, 0, 
SHOW_DEMUXERS
);

1331 
	}
}

1333 
	$show_deviûs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1335  
	`show_fÜm©s_deviûs
(
İtùx
, 
İt
, 
¬g
, 1, 
SHOW_DEFAULT
);

1336 
	}
}

1338 
	#PRINT_CODEC_SUPPORTED
(
codec
, 
f›ld
, 
ty³
, 
li¡_Çme
, 
‹rm
, 
g‘_Çme
) \

1339 ià(
codec
->
f›ld
) { \

1340 cÚ¡ 
ty³
 *
p
 = 
codec
->
f›ld
; \

1342 
	`´štf
(" SuµÜ‹d " 
li¡_Çme
 ":"); \

1343 *
p
 !ğ
‹rm
) { \

1344 
	`g‘_Çme
(*
p
); \

1345 
	`´štf
(" %s", 
Çme
); \

1346 
p
++; \

1348 
	`´štf
("\n"); \

1350 

	)

1351 
	$´št_codec
(cÚ¡ 
AVCodec
 *
c
)

1353 
’cod”
 = 
	`av_codec_is_’cod”
(
c
);

1355 
	`´štf
("% % [%s]:\n", 
’cod”
 ? "Encod”" : "Decod”", 
c
->
Çme
,

1356 
c
->
lÚg_Çme
 ? c->long_name : "");

1358 
	`´štf
(" General capabilities: ");

1359 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DRAW_HORIZ_BAND
)

1360 
	`´štf
("horizband ");

1361 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DR1
)

1362 
	`´štf
("dr1 ");

1363 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_TRUNCATED
)

1364 
	`´štf
("trunc ");

1365 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DELAY
)

1366 
	`´štf
("delay ");

1367 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_SMALL_LAST_FRAME
)

1368 
	`´štf
("small ");

1369 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_SUBFRAMES
)

1370 
	`´štf
("subframes ");

1371 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_EXPERIMENTAL
)

1372 
	`´štf
("exp ");

1373 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_CHANNEL_CONF
)

1374 
	`´štf
("chconf ");

1375 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_PARAM_CHANGE
)

1376 
	`´štf
("paramchange ");

1377 ià(
c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_VARIABLE_FRAME_SIZE
)

1378 
	`´štf
("variable ");

1379 ià(
c
->
ÿ·b™›s
 & (
AV_CODEC_CAP_FRAME_THREADS
 |

1380 
AV_CODEC_CAP_SLICE_THREADS
 |

1381 
AV_CODEC_CAP_AUTO_THREADS
))

1382 
	`´štf
("threads ");

1383 ià(!
c
->
ÿ·b™›s
)

1384 
	`´štf
("none");

1385 
	`´štf
("\n");

1387 ià(
c
->
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||

1388 
c
->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
) {

1389 
	`´štf
(" Threading capabilities: ");

1390 
c
->
ÿ·b™›s
 & (
AV_CODEC_CAP_FRAME_THREADS
 |

1391 
AV_CODEC_CAP_SLICE_THREADS
 |

1392 
AV_CODEC_CAP_AUTO_THREADS
)) {

1393 
AV_CODEC_CAP_FRAME_THREADS
 |

1394 
AV_CODEC_CAP_SLICE_THREADS
: 
	`´štf
("frame‡nd slice"); ;

1395 
AV_CODEC_CAP_FRAME_THREADS
: 
	`´štf
("frame"); ;

1396 
AV_CODEC_CAP_SLICE_THREADS
: 
	`´štf
("slice"); ;

1397 
AV_CODEC_CAP_AUTO_THREADS
 : 
	`´štf
("auto"); ;

1398 : 
	`´štf
("none"); ;

1400 
	`´štf
("\n");

1403 ià(
c
->
suµÜ‹d_äam”©es
) {

1404 cÚ¡ 
AVR©iÚ®
 *
ås
 = 
c
->
suµÜ‹d_äam”©es
;

1406 
	`´štf
(" Supported framerates:");

1407 
ås
->
num
) {

1408 
	`´štf
(" %d/%d", 
ås
->
num
, fps->
d’
);

1409 
ås
++;

1411 
	`´štf
("\n");

1413 
	`PRINT_CODEC_SUPPORTED
(
c
, 
pix_fmts
, 
AVPix–FÜm©
, "pixel formats",

1414 
AV_PIX_FMT_NONE
, 
GET_PIX_FMT_NAME
);

1415 
	`PRINT_CODEC_SUPPORTED
(
c
, 
suµÜ‹d_§m¶”©es
, , "sample„ates", 0,

1416 
GET_SAMPLE_RATE_NAME
);

1417 
	`PRINT_CODEC_SUPPORTED
(
c
, 
§m¶e_fmts
, 
AVSam¶eFÜm©
, "sample formats",

1418 
AV_SAMPLE_FMT_NONE
, 
GET_SAMPLE_FMT_NAME
);

1419 
	`PRINT_CODEC_SUPPORTED
(
c
, 
chªÃl_Ïyouts
, 
ušt64_t
, "channel†ayouts",

1420 0, 
GET_CH_LAYOUT_DESC
);

1422 ià(
c
->
´iv_şass
) {

1423 
	`show_h–p_chd»n
(
c
->
´iv_şass
,

1424 
AV_OPT_FLAG_ENCODING_PARAM
 |

1425 
AV_OPT_FLAG_DECODING_PARAM
);

1427 
	}
}

1429 
	$g‘_medŸ_ty³_ch¬
(
AVMedŸTy³
 
ty³
)

1431 
ty³
) {

1432 
AVMEDIA_TYPE_VIDEO
:  'V';

1433 
AVMEDIA_TYPE_AUDIO
:  'A';

1434 
AVMEDIA_TYPE_DATA
:  'D';

1435 
AVMEDIA_TYPE_SUBTITLE
:  'S';

1436 
AVMEDIA_TYPE_ATTACHMENT
: 'T';

1439 
	}
}

1441 cÚ¡ 
AVCodec
 *
	$Ãxt_codec_fÜ_id
(
AVCodecID
 
id
, cÚ¡ 
AVCodec
 *
´ev
,

1442 
’cod”
)

1444 (
´ev
 = 
	`av_codec_Ãxt
(prev))) {

1445 ià(
´ev
->
id
 == id &&

1446 (
’cod”
 ? 
	`av_codec_is_’cod”
(
´ev
è: 
	`av_codec_is_decod”
(prev)))

1447  
´ev
;

1449  
NULL
;

1450 
	}
}

1452 
	$com·»_codec_desc
(cÚ¡ *
a
, cÚ¡ *
b
)

1454 cÚ¡ 
AVCodecDesütÜ
 * cÚ¡ *
da
 = 
a
;

1455 cÚ¡ 
AVCodecDesütÜ
 * cÚ¡ *
db
 = 
b
;

1457  (*
da
)->
ty³
 !ğ(*
db
)->ty³ ? 
	`FFDIFFSIGN
((*da)->type, (*db)->type) :

1458 
	`¡rcmp
((*
da
)->
Çme
, (*
db
)->name);

1459 
	}
}

1461 
	$g‘_codecs_sÜ‹d
(cÚ¡ 
AVCodecDesütÜ
 ***
rcodecs
)

1463 cÚ¡ 
AVCodecDesütÜ
 *
desc
 = 
NULL
;

1464 cÚ¡ 
AVCodecDesütÜ
 **
codecs
;

1465 
nb_codecs
 = 0, 
i
 = 0;

1467 (
desc
 = 
	`avcodec_desütÜ_Ãxt
(desc)))

1468 
nb_codecs
++;

1469 ià(!(
codecs
 = 
	`av_ÿÎoc
(
nb_codecs
, (*codecs)))) {

1470 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Out of memory\n");

1471 
	`ex™_´og¿m
(1);

1473 
desc
 = 
NULL
;

1474 (
desc
 = 
	`avcodec_desütÜ_Ãxt
(desc)))

1475 
codecs
[
i
++] = 
desc
;

1476 
	`av_as£¹0
(
i
 =ğ
nb_codecs
);

1477 
	`qsÜt
(
codecs
, 
nb_codecs
, (*codecs), 
com·»_codec_desc
);

1478 *
rcodecs
 = 
codecs
;

1479  
nb_codecs
;

1480 
	}
}

1482 
	$´št_codecs_fÜ_id
(
AVCodecID
 
id
, 
’cod”
)

1484 cÚ¡ 
AVCodec
 *
codec
 = 
NULL
;

1486 
	`´štf
(" (%s: ", 
’cod”
 ? "encoders" : "decoders");

1488 (
codec
 = 
	`Ãxt_codec_fÜ_id
(
id
, codec, 
’cod”
)))

1489 
	`´štf
("% ", 
codec
->
Çme
);

1491 
	`´štf
(")");

1492 
	}
}

1494 
	$show_codecs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1496 cÚ¡ 
AVCodecDesütÜ
 **
codecs
;

1497 
i
, 
nb_codecs
 = 
	`g‘_codecs_sÜ‹d
(&
codecs
);

1499 
	`´štf
("Codecs:\n"

1509 
i
 = 0; i < 
nb_codecs
; i++) {

1510 cÚ¡ 
AVCodecDesütÜ
 *
desc
 = 
codecs
[
i
];

1511 cÚ¡ 
AVCodec
 *
codec
 = 
NULL
;

1513 ià(
	`¡r¡r
(
desc
->
Çme
, "_deprecated"))

1516 
	`´štf
(" ");

1517 
	`´štf
(
	`avcodec_fšd_decod”
(
desc
->
id
) ? "D" : ".");

1518 
	`´štf
(
	`avcodec_fšd_’cod”
(
desc
->
id
) ? "E" : ".");

1520 
	`´štf
("%c", 
	`g‘_medŸ_ty³_ch¬
(
desc
->
ty³
));

1521 
	`´štf
((
desc
->
´İs
 & 
AV_CODEC_PROP_INTRA_ONLY
) ? "I" : ".");

1522 
	`´štf
((
desc
->
´İs
 & 
AV_CODEC_PROP_LOSSY
) ? "L" : ".");

1523 
	`´štf
((
desc
->
´İs
 & 
AV_CODEC_PROP_LOSSLESS
) ? "S" : ".");

1525 
	`´štf
(" %-20 %s", 
desc
->
Çme
, desc->
lÚg_Çme
 ? desc->long_name : "");

1529 (
codec
 = 
	`Ãxt_codec_fÜ_id
(
desc
->
id
, codec, 0))) {

1530 ià(
	`¡rcmp
(
codec
->
Çme
, 
desc
->name)) {

1531 
	`´št_codecs_fÜ_id
(
desc
->
id
, 0);

1535 
codec
 = 
NULL
;

1536 (
codec
 = 
	`Ãxt_codec_fÜ_id
(
desc
->
id
, codec, 1))) {

1537 ià(
	`¡rcmp
(
codec
->
Çme
, 
desc
->name)) {

1538 
	`´št_codecs_fÜ_id
(
desc
->
id
, 1);

1543 
	`´štf
("\n");

1545 
	`av_ä“
(
codecs
);

1547 
	}
}

1549 
	$´št_codecs
(
’cod”
)

1551 cÚ¡ 
AVCodecDesütÜ
 **
codecs
;

1552 
i
, 
nb_codecs
 = 
	`g‘_codecs_sÜ‹d
(&
codecs
);

1554 
	`´štf
("%s:\n"

1564 
’cod”
 ? "Encoders" : "Decoders");

1565 
i
 = 0; i < 
nb_codecs
; i++) {

1566 cÚ¡ 
AVCodecDesütÜ
 *
desc
 = 
codecs
[
i
];

1567 cÚ¡ 
AVCodec
 *
codec
 = 
NULL
;

1569 (
codec
 = 
	`Ãxt_codec_fÜ_id
(
desc
->
id
, codec, 
’cod”
))) {

1570 
	`´štf
(" %c", 
	`g‘_medŸ_ty³_ch¬
(
desc
->
ty³
));

1571 
	`´štf
((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_FRAME_THREADS
) ? "F" : ".");

1572 
	`´štf
((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_SLICE_THREADS
) ? "S" : ".");

1573 
	`´štf
((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_EXPERIMENTAL
) ? "X" : ".");

1574 
	`´štf
((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DRAW_HORIZ_BAND
)?"B" : ".");

1575 
	`´štf
((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DR1
) ? "D" : ".");

1577 
	`´štf
(" %-20 %s", 
codec
->
Çme
, codec->
lÚg_Çme
 ? codec->long_name : "");

1578 ià(
	`¡rcmp
(
codec
->
Çme
, 
desc
->name))

1579 
	`´štf
(" (codeø%s)", 
desc
->
Çme
);

1581 
	`´štf
("\n");

1584 
	`av_ä“
(
codecs
);

1585 
	}
}

1587 
	$show_decod”s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1589 
	`´št_codecs
(0);

1591 
	}
}

1593 
	$show_’cod”s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1595 
	`´št_codecs
(1);

1597 
	}
}

1599 
	$show_bsfs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1601 cÚ¡ 
AVB™SŒ—mF‹r
 *
bsf
 = 
NULL
;

1602 *
İaque
 = 
NULL
;

1604 
	`´štf
("Bitstream filters:\n");

1605 (
bsf
 = 
	`av_bsf_Ãxt
(&
İaque
)))

1606 
	`´štf
("%s\n", 
bsf
->
Çme
);

1607 
	`´štf
("\n");

1609 
	}
}

1611 
	$show_´ÙocŞs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1613 *
İaque
 = 
NULL
;

1614 cÚ¡ *
Çme
;

1616 
	`´štf
("Supported file…rotocols:\n"

1618 (
Çme
 = 
	`avio_’um_´ÙocŞs
(&
İaque
, 0)))

1619 
	`´štf
(" %s\n", 
Çme
);

1620 
	`´štf
("Output:\n");

1621 (
Çme
 = 
	`avio_’um_´ÙocŞs
(&
İaque
, 1)))

1622 
	`´štf
(" %s\n", 
Çme
);

1624 
	}
}

1626 
	$show_f‹rs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1628 #ià
CONFIG_AVFILTER


1629 cÚ¡ 
AVF‹r
 *
f‹r
 = 
NULL
;

1630 
desü
[64], *
desü_cur
;

1631 
i
, 
j
;

1632 cÚ¡ 
AVF‹rPad
 *
·d
;

1634 
	`´štf
("Filters:\n"

1642 (
f‹r
 = 
	`avf‹r_Ãxt
(filter))) {

1643 
desü_cur
 = 
desü
;

1644 
i
 = 0; i < 2; i++) {

1645 ià(
i
) {

1646 *(
desü_cur
++) = '-';

1647 *(
desü_cur
++) = '>';

1649 
·d
 = 
i
 ? 
f‹r
->
ouuts
 : f‹r->
šputs
;

1650 
j
 = 0; 
·d
 && 
	`avf‹r_·d_g‘_Çme
(pad, j); j++) {

1651 ià(
desü_cur
 >ğ
desü
 + (descr) - 4)

1653 *(
desü_cur
++èğ
	`g‘_medŸ_ty³_ch¬
(
	`avf‹r_·d_g‘_ty³
(
·d
, 
j
));

1655 ià(!
j
)

1656 *(
desü_cur
++èğ((!
i
 && (
f‹r
->
æags
 & 
AVFILTER_FLAG_DYNAMIC_INPUTS
)) ||

1657 Ğ
i
 && (
f‹r
->
æags
 & 
AVFILTER_FLAG_DYNAMIC_OUTPUTS
))) ? 'N' : '|';

1659 *
desü_cur
 = 0;

1660 
	`´štf
(" %c%c%c %-17s %-10s %s\n",

1661 
f‹r
->
æags
 & 
AVFILTER_FLAG_SUPPORT_TIMELINE
 ? 'T' : '.',

1662 
f‹r
->
æags
 & 
AVFILTER_FLAG_SLICE_THREADS
 ? 'S' : '.',

1663 
f‹r
->
´oûss_commªd
 ? 'C' : '.',

1664 
f‹r
->
Çme
, 
desü
, f‹r->
desütiÚ
);

1667 
	`´štf
("No filters‡vailable:†ibavfilter disabled\n");

1670 
	}
}

1672 
	$show_cŞÜs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1674 cÚ¡ *
Çme
;

1675 cÚ¡ 
ušt8_t
 *
rgb
;

1676 
i
;

1678 
	`´štf
("%-32s #RRGGBB\n", "name");

1680 
i
 = 0; 
Çme
 = 
	`av_g‘_known_cŞÜ_Çme
(i, &
rgb
); i++)

1681 
	`´štf
("%-32 #%02x%02x%02x\n", 
Çme
, 
rgb
[0],„gb[1],„gb[2]);

1684 
	}
}

1686 
	$show_pix_fmts
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1688 cÚ¡ 
AVPixFmtDesütÜ
 *
pix_desc
 = 
NULL
;

1690 
	`´štf
("Pixel formats:\n"

1699 #ià!
CONFIG_SWSCALE


1700 
	#sws_isSuµÜ‹dIÅut
(
x
è0

	)

1701 
	#sws_isSuµÜ‹dOuut
(
x
è0

	)

1704 (
pix_desc
 = 
	`av_pix_fmt_desc_Ãxt
(pix_desc))) {

1705 
AVPix–FÜm©
 
pix_fmt
 = 
	`av_pix_fmt_desc_g‘_id
(
pix_desc
);

1706 
	`´štf
("%c%c%c%c%c %-16s %d %2d\n",

1707 
	`sws_isSuµÜ‹dIÅut
 (
pix_fmt
) ? 'I' : '.',

1708 
	`sws_isSuµÜ‹dOuut
(
pix_fmt
) ? 'O' : '.',

1709 
pix_desc
->
æags
 & 
AV_PIX_FMT_FLAG_HWACCEL
 ? 'H' : '.',

1710 
pix_desc
->
æags
 & 
AV_PIX_FMT_FLAG_PAL
 ? 'P' : '.',

1711 
pix_desc
->
æags
 & 
AV_PIX_FMT_FLAG_BITSTREAM
 ? 'B' : '.',

1712 
pix_desc
->
Çme
,

1713 
pix_desc
->
nb_compÚ’ts
,

1714 
	`av_g‘_b™s_³r_pix–
(
pix_desc
));

1717 
	}
}

1719 
	$show_Ïyouts
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1721 
i
 = 0;

1722 
ušt64_t
 
Ïyout
, 
j
;

1723 cÚ¡ *
Çme
, *
desü
;

1725 
	`´štf
("Individual channels:\n"

1727 
i
 = 0; i < 63; i++) {

1728 
Çme
 = 
	`av_g‘_chªÃl_Çme
((
ušt64_t
)1 << 
i
);

1729 ià(!
Çme
)

1731 
desü
 = 
	`av_g‘_chªÃl_desütiÚ
((
ušt64_t
)1 << 
i
);

1732 
	`´štf
("%-14 %s\n", 
Çme
, 
desü
);

1734 
	`´štf
("\nStandard channel†ayouts:\n"

1736 
i
 = 0; !
	`av_g‘_¡ªd¬d_chªÃl_Ïyout
(i, &
Ïyout
, &
Çme
); i++) {

1737 ià(
Çme
) {

1738 
	`´štf
("%-14 ", 
Çme
);

1739 
j
 = 1; j; j <<= 1)

1740 ià((
Ïyout
 & 
j
))

1741 
	`´štf
("%s%s", (
Ïyout
 & (
j
 - 1)è? "+" : "", 
	`av_g‘_chªÃl_Çme
(j));

1742 
	`´štf
("\n");

1746 
	}
}

1748 
	$show_§m¶e_fmts
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1750 
i
;

1751 
fmt_¡r
[128];

1752 
i
 = -1; i < 
AV_SAMPLE_FMT_NB
; i++)

1753 
	`´štf
("%s\n", 
	`av_g‘_§m¶e_fmt_¡ršg
(
fmt_¡r
, (fmt_¡r), 
i
));

1755 
	}
}

1757 
	$show_h–p_codec
(cÚ¡ *
Çme
, 
’cod”
)

1759 cÚ¡ 
AVCodecDesütÜ
 *
desc
;

1760 cÚ¡ 
AVCodec
 *
codec
;

1762 ià(!
Çme
) {

1763 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "No codec‚ame specified.\n");

1767 
codec
 = 
’cod”
 ? 
	`avcodec_fšd_’cod”_by_Çme
(
Çme
) :

1768 
	`avcodec_fšd_decod”_by_Çme
(
Çme
);

1770 ià(
codec
)

1771 
	`´št_codec
(
codec
);

1772 ià((
desc
 = 
	`avcodec_desütÜ_g‘_by_Çme
(
Çme
))) {

1773 
´š‹d
 = 0;

1775 (
codec
 = 
	`Ãxt_codec_fÜ_id
(
desc
->
id
, codec, 
’cod”
))) {

1776 
´š‹d
 = 1;

1777 
	`´št_codec
(
codec
);

1780 ià(!
´š‹d
) {

1781 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Codec '%s' is knowno FFmpeg, "

1784 
Çme
, 
’cod”
 ? "encoders" : "decoders");

1787 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Codec '%s' is‚ot„ecognized by FFmpeg.\n",

1788 
Çme
);

1790 
	}
}

1792 
	$show_h–p_demux”
(cÚ¡ *
Çme
)

1794 cÚ¡ 
AVIÅutFÜm©
 *
fmt
 = 
	`av_fšd_šput_fÜm©
(
Çme
);

1796 ià(!
fmt
) {

1797 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀfÜm© '%s'.\n", 
Çme
);

1801 
	`´štf
("Demux” % [%s]:\n", 
fmt
->
Çme
, fmt->
lÚg_Çme
);

1803 ià(
fmt
->
ex‹nsiÚs
)

1804 
	`´štf
(" CommÚƒx‹nsiÚs: %s.\n", 
fmt
->
ex‹nsiÚs
);

1806 ià(
fmt
->
´iv_şass
)

1807 
	`show_h–p_chd»n
(
fmt
->
´iv_şass
, 
AV_OPT_FLAG_DECODING_PARAM
);

1808 
	}
}

1810 
	$show_h–p_mux”
(cÚ¡ *
Çme
)

1812 cÚ¡ 
AVCodecDesütÜ
 *
desc
;

1813 cÚ¡ 
AVOuutFÜm©
 *
fmt
 = 
	`av_guess_fÜm©
(
Çme
, 
NULL
, NULL);

1815 ià(!
fmt
) {

1816 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀfÜm© '%s'.\n", 
Çme
);

1820 
	`´štf
("Mux” % [%s]:\n", 
fmt
->
Çme
, fmt->
lÚg_Çme
);

1822 ià(
fmt
->
ex‹nsiÚs
)

1823 
	`´štf
(" CommÚƒx‹nsiÚs: %s.\n", 
fmt
->
ex‹nsiÚs
);

1824 ià(
fmt
->
mime_ty³
)

1825 
	`´štf
(" Mimty³: %s.\n", 
fmt
->
mime_ty³
);

1826 ià(
fmt
->
video_codec
 !ğ
AV_CODEC_ID_NONE
 &&

1827 (
desc
 = 
	`avcodec_desütÜ_g‘
(
fmt
->
video_codec
))) {

1828 
	`´štf
(" DeçuÉ videØcodec: %s.\n", 
desc
->
Çme
);

1830 ià(
fmt
->
audio_codec
 !ğ
AV_CODEC_ID_NONE
 &&

1831 (
desc
 = 
	`avcodec_desütÜ_g‘
(
fmt
->
audio_codec
))) {

1832 
	`´štf
(" DeçuÉ‡udiØcodec: %s.\n", 
desc
->
Çme
);

1834 ià(
fmt
->
subt™Ë_codec
 !ğ
AV_CODEC_ID_NONE
 &&

1835 (
desc
 = 
	`avcodec_desütÜ_g‘
(
fmt
->
subt™Ë_codec
))) {

1836 
	`´štf
(" DeçuÉ subt™Ë codec: %s.\n", 
desc
->
Çme
);

1839 ià(
fmt
->
´iv_şass
)

1840 
	`show_h–p_chd»n
(
fmt
->
´iv_şass
, 
AV_OPT_FLAG_ENCODING_PARAM
);

1841 
	}
}

1843 #ià
CONFIG_AVFILTER


1844 
	$show_h–p_f‹r
(cÚ¡ *
Çme
)

1846 #ià
CONFIG_AVFILTER


1847 cÚ¡ 
AVF‹r
 *
f
 = 
	`avf‹r_g‘_by_Çme
(
Çme
);

1848 
i
, 
couÁ
;

1850 ià(!
Çme
) {

1851 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "No filter‚ame specified.\n");

1853 } ià(!
f
) {

1854 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀf‹¸'%s'.\n", 
Çme
);

1858 
	`´štf
("F‹¸%s\n", 
f
->
Çme
);

1859 ià(
f
->
desütiÚ
)

1860 
	`´štf
(" %s\n", 
f
->
desütiÚ
);

1862 ià(
f
->
æags
 & 
AVFILTER_FLAG_SLICE_THREADS
)

1863 
	`´štf
(" slicehreading supported\n");

1865 
	`´štf
(" Inputs:\n");

1866 
couÁ
 = 
	`avf‹r_·d_couÁ
(
f
->
šputs
);

1867 
i
 = 0; i < 
couÁ
; i++) {

1868 
	`´štf
(" #%d: % (%s)\n", 
i
, 
	`avf‹r_·d_g‘_Çme
(
f
->
šputs
, i),

1869 
	`medŸ_ty³_¡ršg
(
	`avf‹r_·d_g‘_ty³
(
f
->
šputs
, 
i
)));

1871 ià(
f
->
æags
 & 
AVFILTER_FLAG_DYNAMIC_INPUTS
)

1872 
	`´štf
(" dynamic (depending onhe options)\n");

1873 ià(!
couÁ
)

1874 
	`´štf
("‚one (source filter)\n");

1876 
	`´štf
(" Outputs:\n");

1877 
couÁ
 = 
	`avf‹r_·d_couÁ
(
f
->
ouuts
);

1878 
i
 = 0; i < 
couÁ
; i++) {

1879 
	`´štf
(" #%d: % (%s)\n", 
i
, 
	`avf‹r_·d_g‘_Çme
(
f
->
ouuts
, i),

1880 
	`medŸ_ty³_¡ršg
(
	`avf‹r_·d_g‘_ty³
(
f
->
ouuts
, 
i
)));

1882 ià(
f
->
æags
 & 
AVFILTER_FLAG_DYNAMIC_OUTPUTS
)

1883 
	`´štf
(" dynamic (depending onhe options)\n");

1884 ià(!
couÁ
)

1885 
	`´štf
("‚one (sink filter)\n");

1887 ià(
f
->
´iv_şass
)

1888 
	`show_h–p_chd»n
(
f
->
´iv_şass
, 
AV_OPT_FLAG_VIDEO_PARAM
 | 
AV_OPT_FLAG_FILTERING_PARAM
 |

1889 
AV_OPT_FLAG_AUDIO_PARAM
);

1890 ià(
f
->
æags
 & 
AVFILTER_FLAG_SUPPORT_TIMELINE
)

1891 
	`´štf
("This filter has support forimelinehroughhe 'enable' option.\n");

1893 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Build without†ibavfilter; "

1896 
	}
}

1899 
	$show_h–p
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1901 *
tİic
, *
·r
;

1902 
	`av_log_£t_ÿÎback
(
log_ÿÎback_h–p
);

1904 
tİic
 = 
	`av_¡rdup
(
¬g
 ?‡rg : "");

1905 ià(!
tİic
)

1906  
	`AVERROR
(
ENOMEM
);

1907 
·r
 = 
	`¡rchr
(
tİic
, '=');

1908 ià(
·r
)

1909 *
·r
++ = 0;

1911 ià(!*
tİic
) {

1912 
	`show_h–p_deçuÉ
(
tİic
, 
·r
);

1913 } ià(!
	`¡rcmp
(
tİic
, "decoder")) {

1914 
	`show_h–p_codec
(
·r
, 0);

1915 } ià(!
	`¡rcmp
(
tİic
, "encoder")) {

1916 
	`show_h–p_codec
(
·r
, 1);

1917 } ià(!
	`¡rcmp
(
tİic
, "demuxer")) {

1918 
	`show_h–p_demux”
(
·r
);

1919 } ià(!
	`¡rcmp
(
tİic
, "muxer")) {

1920 
	`show_h–p_mux”
(
·r
);

1921 #ià
CONFIG_AVFILTER


1922 } ià(!
	`¡rcmp
(
tİic
, "filter")) {

1923 
	`show_h–p_f‹r
(
·r
);

1926 
	`show_h–p_deçuÉ
(
tİic
, 
·r
);

1929 
	`av_ä“p
(&
tİic
);

1931 
	}
}

1933 
	$»ad_ye¢o
()

1935 
c
 = 
	`g‘ch¬
();

1936 
ye¢o
 = (
	`av_touµ”
(
c
) == 'Y');

1938 
c
 !ğ'\n' && c !ğ
EOF
)

1939 
c
 = 
	`g‘ch¬
();

1941  
ye¢o
;

1942 
	}
}

1944 
FILE
 *
	$g‘_´e£t_fe
(*
f’ame
, 
size_t
 
f’ame_size
,

1945 cÚ¡ *
´e£t_Çme
, 
is_·th
,

1946 cÚ¡ *
codec_Çme
)

1948 
FILE
 *
f
 = 
NULL
;

1949 
i
;

1950 cÚ¡ *
ba£
[3] = { 
	`g‘’v
("FFMPEG_DATADIR"),

1951 
	`g‘’v
("HOME"),

1952 
FFMPEG_DATADIR
, };

1954 ià(
is_·th
) {

1955 
	`av_¡¾ıy
(
f’ame
, 
´e£t_Çme
, 
f’ame_size
);

1956 
f
 = 
	`fİ’
(
f’ame
, "r");

1958 #ifdeà
_WIN32


1959 
d©adœ
[
MAX_PATH
], *
ls
;

1960 
ba£
[2] = 
NULL
;

1962 ià(
	`G‘ModuËFeNameA
(
	`G‘ModuËHªdËA
(
NULL
), 
d©adœ
, (datadir) - 1))

1964 
ls
 = 
d©adœ
;† < d©adœ + 
	`¡¾’
(datadir);†s++)

1965 ià(*
ls
 == '\\') *ls = '/';

1967 ià(
ls
 = 
	`¡¼chr
(
d©adœ
, '/'))

1969 *
ls
 = 0;

1970 
	`¡ºÿt
(
d©adœ
, "/få»£ts", (d©adœè- 1 - 
	`¡¾’
(datadir));

1971 
ba£
[2] = 
d©adœ
;

1975 
i
 = 0; i < 3 && !
f
; i++) {

1976 ià(!
ba£
[
i
])

1978 
	`¢´štf
(
f’ame
, 
f’ame_size
, "%s%s/%s.få»£t", 
ba£
[
i
],

1979 
i
 !ğ1 ? "" : "/.ffm³g", 
´e£t_Çme
);

1980 
f
 = 
	`fİ’
(
f’ame
, "r");

1981 ià(!
f
 && 
codec_Çme
) {

1982 
	`¢´štf
(
f’ame
, 
f’ame_size
,

1984 
ba£
[
i
], i !ğ1 ? "" : "/.ffm³g", 
codec_Çme
,

1985 
´e£t_Çme
);

1986 
f
 = 
	`fİ’
(
f’ame
, "r");

1991  
f
;

1992 
	}
}

1994 
	$check_¡»am_¥ecif›r
(
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
, cÚ¡ *
¥ec
)

1996 
»t
 = 
	`avfÜm©_m©ch_¡»am_¥ecif›r
(
s
, 
¡
, 
¥ec
);

1997 ià(
»t
 < 0)

1998 
	`av_log
(
s
, 
AV_LOG_ERROR
, "Inv®id sŒ—m s³cif›r: %s.\n", 
¥ec
);

1999  
»t
;

2000 
	}
}

2002 
AVDiùiÚ¬y
 *
	$f‹r_codec_İts
(
AVDiùiÚ¬y
 *
İts
, 
AVCodecID
 
codec_id
,

2003 
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
, 
AVCodec
 *
codec
)

2005 
AVDiùiÚ¬y
 *
»t
 = 
NULL
;

2006 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

2007 
æags
 = 
s
->
ofÜm©
 ? 
AV_OPT_FLAG_ENCODING_PARAM


2008 : 
AV_OPT_FLAG_DECODING_PARAM
;

2009 
´efix
 = 0;

2010 cÚ¡ 
AVCÏss
 *
cc
 = 
	`avcodec_g‘_şass
();

2012 ià(!
codec
)

2013 
codec
 = 
s
->
ofÜm©
 ? 
	`avcodec_fšd_’cod”
(
codec_id
)

2014 : 
	`avcodec_fšd_decod”
(
codec_id
);

2016 
¡
->
codeı¬
->
codec_ty³
) {

2017 
AVMEDIA_TYPE_VIDEO
:

2018 
´efix
 = 'v';

2019 
æags
 |ğ
AV_OPT_FLAG_VIDEO_PARAM
;

2021 
AVMEDIA_TYPE_AUDIO
:

2022 
´efix
 = 'a';

2023 
æags
 |ğ
AV_OPT_FLAG_AUDIO_PARAM
;

2025 
AVMEDIA_TYPE_SUBTITLE
:

2026 
´efix
 = 's';

2027 
æags
 |ğ
AV_OPT_FLAG_SUBTITLE_PARAM
;

2031 
t
 = 
	`av_diù_g‘
(
İts
, "",, 
AV_DICT_IGNORE_SUFFIX
)) {

2032 *
p
 = 
	`¡rchr
(
t
->
key
, ':');

2035 ià(
p
)

2036 
	`check_¡»am_¥ecif›r
(
s
, 
¡
, 
p
 + 1)) {

2037 1: *
p
 = 0; ;

2039 : 
	`ex™_´og¿m
(1);

2042 ià(
	`av_İt_fšd
(&
cc
, 
t
->
key
, 
NULL
, 
æags
, 
AV_OPT_SEARCH_FAKE_OBJ
) ||

2043 !
codec
 ||

2044 (
codec
->
´iv_şass
 &&

2045 
	`av_İt_fšd
(&
codec
->
´iv_şass
, 
t
->
key
, 
NULL
, 
æags
,

2046 
AV_OPT_SEARCH_FAKE_OBJ
)))

2047 
	`av_diù_£t
(&
»t
, 
t
->
key
,->
v®ue
, 0);

2048 ià(
t
->
key
[0] =ğ
´efix
 &&

2049 
	`av_İt_fšd
(&
cc
, 
t
->
key
 + 1, 
NULL
, 
æags
,

2050 
AV_OPT_SEARCH_FAKE_OBJ
))

2051 
	`av_diù_£t
(&
»t
, 
t
->
key
 + 1,->
v®ue
, 0);

2053 ià(
p
)

2054 *
p
 = ':';

2056  
»t
;

2057 
	}
}

2059 
AVDiùiÚ¬y
 **
	$£tup_fšd_¡»am_šfo_İts
(
AVFÜm©CÚ‹xt
 *
s
,

2060 
AVDiùiÚ¬y
 *
codec_İts
)

2062 
i
;

2063 
AVDiùiÚ¬y
 **
İts
;

2065 ià(!
s
->
nb_¡»ams
)

2066  
NULL
;

2067 
İts
 = 
	`av_m®locz_¬¿y
(
s
->
nb_¡»ams
, (*opts));

2068 ià(!
İts
) {

2069 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2071  
NULL
;

2073 
i
 = 0; i < 
s
->
nb_¡»ams
; i++)

2074 
İts
[
i
] = 
	`f‹r_codec_İts
(
codec_İts
, 
s
->
¡»ams
[i]->
codeı¬
->
codec_id
,

2075 
s
, s->
¡»ams
[
i
], 
NULL
);

2076  
İts
;

2077 
	}
}

2079 *
	$grow_¬¿y
(*
¬¿y
, 
–em_size
, *
size
, 
Ãw_size
)

2081 ià(
Ãw_size
 >ğ
INT_MAX
 / 
–em_size
) {

2082 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Arrayoo big.\n");

2083 
	`ex™_´og¿m
(1);

2085 ià(*
size
 < 
Ãw_size
) {

2086 
ušt8_t
 *
tmp
 = 
	`av_»®loc_¬¿y
(
¬¿y
, 
Ãw_size
, 
–em_size
);

2087 ià(!
tmp
) {

2088 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Could‚ot‡lloc buffer.\n");

2089 
	`ex™_´og¿m
(1);

2091 
	`mem£t
(
tmp
 + *
size
*
–em_size
, 0, (
Ãw_size
-*size) *ƒlem_size);

2092 *
size
 = 
Ãw_size
;

2093  
tmp
;

2095  
¬¿y
;

2096 
	}
}

2098 
	$g‘_rÙ©iÚ
(
AVSŒ—m
 *
¡
)

2100 
ušt8_t
* 
di¥Ïym©rix
 = 
	`av_¡»am_g‘_side_d©a
(
¡
,

2101 
AV_PKT_DATA_DISPLAYMATRIX
, 
NULL
);

2102 
th‘a
 = 0;

2103 ià(
di¥Ïym©rix
)

2104 
th‘a
 = -
	`av_di¥Ïy_rÙ©iÚ_g‘
((
št32_t
*è
di¥Ïym©rix
);

2106 
th‘a
 -ğ360*
	`æoÜ
(theta/360 + 0.9/360);

2108 ià(
	`çbs
(
th‘a
 - 90*
	`round
(theta/90)) > 2)

2109 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Odd„otation‡ngle.\n"

2114  
th‘a
;

2115 
	}
}

2117 #ià
CONFIG_AVDEVICE


2118 
	$´št_deviû_sourûs
(
AVIÅutFÜm©
 *
fmt
, 
AVDiùiÚ¬y
 *
İts
)

2120 
»t
, 
i
;

2121 
AVDeviûInfoLi¡
 *
deviû_li¡
 = 
NULL
;

2123 ià(!
fmt
 || !fmt->
´iv_şass
 || !
	`AV_IS_INPUT_DEVICE
(fmt->´iv_şass->
ÿ‹gÜy
))

2124  
	`AVERROR
(
EINVAL
);

2126 
	`´štf
("Auto-d‘eùed sourû fÜ %s:\n", 
fmt
->
Çme
);

2127 ià(!
fmt
->
g‘_deviû_li¡
) {

2128 
»t
 = 
	`AVERROR
(
ENOSYS
);

2129 
	`´štf
("Cannot†ist sources. Not implemented.\n");

2130 
ç
;

2133 ià((
»t
 = 
	`avdeviû_li¡_šput_sourûs
(
fmt
, 
NULL
, 
İts
, &
deviû_li¡
)) < 0) {

2134 
	`´štf
("Cannot†ist sources.\n");

2135 
ç
;

2138 
i
 = 0; i < 
deviû_li¡
->
nb_deviûs
; i++) {

2139 
	`´štf
("% % [%s]\n", 
deviû_li¡
->
deçuÉ_deviû
 =ğ
i
 ? "*" : " ",

2140 
deviû_li¡
->
deviûs
[
i
]->
deviû_Çme
, deviû_li¡->deviûs[i]->
deviû_desütiÚ
);

2143 
ç
:

2144 
	`avdeviû_ä“_li¡_deviûs
(&
deviû_li¡
);

2145  
»t
;

2146 
	}
}

2148 
	$´št_deviû_sšks
(
AVOuutFÜm©
 *
fmt
, 
AVDiùiÚ¬y
 *
İts
)

2150 
»t
, 
i
;

2151 
AVDeviûInfoLi¡
 *
deviû_li¡
 = 
NULL
;

2153 ià(!
fmt
 || !fmt->
´iv_şass
 || !
	`AV_IS_OUTPUT_DEVICE
(fmt->´iv_şass->
ÿ‹gÜy
))

2154  
	`AVERROR
(
EINVAL
);

2156 
	`´štf
("Auto-d‘eùed sšk fÜ %s:\n", 
fmt
->
Çme
);

2157 ià(!
fmt
->
g‘_deviû_li¡
) {

2158 
»t
 = 
	`AVERROR
(
ENOSYS
);

2159 
	`´štf
("Cannot†ist sinks. Not implemented.\n");

2160 
ç
;

2163 ià((
»t
 = 
	`avdeviû_li¡_ouut_sšks
(
fmt
, 
NULL
, 
İts
, &
deviû_li¡
)) < 0) {

2164 
	`´štf
("Cannot†ist sinks.\n");

2165 
ç
;

2168 
i
 = 0; i < 
deviû_li¡
->
nb_deviûs
; i++) {

2169 
	`´štf
("% % [%s]\n", 
deviû_li¡
->
deçuÉ_deviû
 =ğ
i
 ? "*" : " ",

2170 
deviû_li¡
->
deviûs
[
i
]->
deviû_Çme
, deviû_li¡->deviûs[i]->
deviû_desütiÚ
);

2173 
ç
:

2174 
	`avdeviû_ä“_li¡_deviûs
(&
deviû_li¡
);

2175  
»t
;

2176 
	}
}

2178 
	$show_sšks_sourûs_·r£_¬g
(cÚ¡ *
¬g
, **
dev
, 
AVDiùiÚ¬y
 **
İts
)

2180 
»t
;

2181 ià(
¬g
) {

2182 *
İts_¡r
 = 
NULL
;

2183 
	`av_as£¹0
(
dev
 && 
İts
);

2184 *
dev
 = 
	`av_¡rdup
(
¬g
);

2185 ià(!*
dev
)

2186  
	`AVERROR
(
ENOMEM
);

2187 ià((
İts_¡r
 = 
	`¡rchr
(*
dev
, ','))) {

2188 *(
İts_¡r
++) = '\0';

2189 ià(
İts_¡r
[0] && ((
»t
 = 
	`av_diù_·r£_¡ršg
(
İts
, opts_str, "=", ":", 0)) < 0)) {

2190 
	`av_ä“p
(
dev
);

2191  
»t
;

2195 
	`´štf
("\nDevice‚ame is‚ot…rovided.\n"

2198 
	}
}

2200 
	$show_sourûs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2202 
AVIÅutFÜm©
 *
fmt
 = 
NULL
;

2203 *
dev
 = 
NULL
;

2204 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

2205 
»t
 = 0;

2206 
”rÜ_Ëv–
 = 
	`av_log_g‘_Ëv–
();

2208 
	`av_log_£t_Ëv–
(
AV_LOG_ERROR
);

2210 ià((
»t
 = 
	`show_sšks_sourûs_·r£_¬g
(
¬g
, &
dev
, &
İts
)) < 0)

2211 
ç
;

2214 
fmt
 = 
	`av_šput_audio_deviû_Ãxt
(fmt);

2215 ià(
fmt
) {

2216 ià(!
	`¡rcmp
(
fmt
->
Çme
, "lavfi"))

2218 ià(
dev
 && !
	`av_m©ch_Çme
(dev, 
fmt
->
Çme
))

2220 
	`´št_deviû_sourûs
(
fmt
, 
İts
);

2222 } 
fmt
);

2224 
fmt
 = 
	`av_šput_video_deviû_Ãxt
(fmt);

2225 ià(
fmt
) {

2226 ià(
dev
 && !
	`av_m©ch_Çme
(dev, 
fmt
->
Çme
))

2228 
	`´št_deviû_sourûs
(
fmt
, 
İts
);

2230 } 
fmt
);

2231 
ç
:

2232 
	`av_diù_ä“
(&
İts
);

2233 
	`av_ä“
(
dev
);

2234 
	`av_log_£t_Ëv–
(
”rÜ_Ëv–
);

2235  
»t
;

2236 
	}
}

2238 
	$show_sšks
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2240 
AVOuutFÜm©
 *
fmt
 = 
NULL
;

2241 *
dev
 = 
NULL
;

2242 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

2243 
»t
 = 0;

2244 
”rÜ_Ëv–
 = 
	`av_log_g‘_Ëv–
();

2246 
	`av_log_£t_Ëv–
(
AV_LOG_ERROR
);

2248 ià((
»t
 = 
	`show_sšks_sourûs_·r£_¬g
(
¬g
, &
dev
, &
İts
)) < 0)

2249 
ç
;

2252 
fmt
 = 
	`av_ouut_audio_deviû_Ãxt
(fmt);

2253 ià(
fmt
) {

2254 ià(
dev
 && !
	`av_m©ch_Çme
(dev, 
fmt
->
Çme
))

2256 
	`´št_deviû_sšks
(
fmt
, 
İts
);

2258 } 
fmt
);

2260 
fmt
 = 
	`av_ouut_video_deviû_Ãxt
(fmt);

2261 ià(
fmt
) {

2262 ià(
dev
 && !
	`av_m©ch_Çme
(dev, 
fmt
->
Çme
))

2264 
	`´št_deviû_sšks
(
fmt
, 
İts
);

2266 } 
fmt
);

2267 
ç
:

2268 
	`av_diù_ä“
(&
İts
);

2269 
	`av_ä“
(
dev
);

2270 
	`av_log_£t_Ëv–
(
”rÜ_Ëv–
);

2271  
»t
;

2272 
	}
}

	@ffmpeg.c

26 
	~"cÚfig.h
"

27 
	~<ùy³.h
>

28 
	~<¡ršg.h
>

29 
	~<m©h.h
>

30 
	~<¡dlib.h
>

31 
	~<”ºo.h
>

32 
	~<lim™s.h
>

33 
	~<¡d©omic.h
>

34 
	~<¡dšt.h
>

36 #ià
HAVE_IO_H


37 
	~<io.h
>

39 #ià
HAVE_UNISTD_H


40 
	~<uni¡d.h
>

43 
	~"libavfÜm©/avfÜm©.h
"

44 
	~"libavdeviû/avdeviû.h
"

45 
	~"libsw»§m¶e/sw»§m¶e.h
"

46 
	~"libavut/İt.h
"

47 
	~"libavut/chªÃl_Ïyout.h
"

48 
	~"libavut/·r£uts.h
"

49 
	~"libavut/§m¶efmt.h
"

50 
	~"libavut/fifo.h
"

51 
	~"libavut/hwcÚ‹xt.h
"

52 
	~"libavut/š‹º®.h
"

53 
	~"libavut/šŒ—dwr™e.h
"

54 
	~"libavut/diù.h
"

55 
	~"libavut/di¥Ïy.h
"

56 
	~"libavut/m©hem©ics.h
"

57 
	~"libavut/pixdesc.h
"

58 
	~"libavut/av¡ršg.h
"

59 
	~"libavut/libm.h
"

60 
	~"libavut/imguts.h
"

61 
	~"libavut/time¡amp.h
"

62 
	~"libavut/b´št.h
"

63 
	~"libavut/time.h
"

64 
	~"libavut/th»admes§ge.h
"

65 
	~"libavcodec/m©hİs.h
"

66 
	~"libavfÜm©/os_suµÜt.h
"

68 
	~"libavf‹r/avf‹r.h
"

69 
	~"libavf‹r/bufãr¤c.h
"

70 
	~"libavf‹r/bufãrsšk.h
"

72 #ià
HAVE_SYS_RESOURCE_H


73 
	~<sys/time.h
>

74 
	~<sys/ty³s.h
>

75 
	~<sys/»sourû.h
>

76 #–ià
HAVE_GETPROCESSTIMES


77 
	~<wšdows.h
>

79 #ià
HAVE_GETPROCESSMEMORYINFO


80 
	~<wšdows.h
>

81 
	~<p§pi.h
>

83 #ià
HAVE_SETCONSOLECTRLHANDLER


84 
	~<wšdows.h
>

88 #ià
HAVE_SYS_SELECT_H


89 
	~<sys/£Ëù.h
>

92 #ià
HAVE_TERMIOS_H


93 
	~<fú.h
>

94 
	~<sys/ioùl.h
>

95 
	~<sys/time.h
>

96 
	~<‹rmios.h
>

97 #–ià
HAVE_KBHIT


98 
	~<cÚio.h
>

101 #ià
HAVE_PTHREADS


102 
	~<±h»ad.h
>

105 
	~<time.h
>

107 
	~"ffm³g.h
"

108 
	~"cmduts.h
"

110 
	~"libavut/avas£¹.h
"

115 
	$maš_cÚ¡ruùÜ
( )

116 
	`__©Œibu‹__
 ((
no_š¡rum’t_funùiÚ
, 
cÚ¡ruùÜ
));

117 
	$maš_de¡ruùÜ
( )

118 
	`__©Œibu‹__
 ((
no_š¡rum’t_funùiÚ
, 
de¡ruùÜ
));

120 
FILE
 *
å
;

121 
	$maš_cÚ¡ruùÜ
( )

123 
å
 = 
	`fİ’
( "trace.txt", "w" );

124 ià(
å
 =ğ
NULL
è
	`ex™
(-1);

125 
	}
}

126 
	$maš_decÚ¡ruùÜ
( )

128 
	`fşo£
Ğ
å
 );

129 
	}
}

131 
	$__cyg_´ofe_func_’‹r
Ğ*
func_add»ss
, *
ÿÎ_s™e
 )

132 
	`__©Œibu‹__
 ((
no_š¡rum’t_funùiÚ
));

133 
	$__cyg_´ofe_func_ex™
 ( *
func_add»ss
, *
ÿÎ_s™e
 )

134 
	`__©Œibu‹__
 ((
no_š¡rum’t_funùiÚ
));

137 
	$__cyg_´ofe_func_’‹r
Ğ*
this
, *
ÿÎs™e
 )

140 
	`årštf
(
å
, "E%p\n", (*)
this
);

141 
	}
}

142 
	$__cyg_´ofe_func_ex™
Ğ*
this
, *
ÿÎs™e
 )

145 
	`årštf
(
å
, "X%p\n", (*)
this
);

146 
	}
}

150 cÚ¡ 
	g´og¿m_Çme
[] = "ffmpeg";

151 cÚ¡ 
	g´og¿m_bœth_y—r
 = 2000;

153 
FILE
 *
	gv¡©s_fe
;

155 cÚ¡ *cÚ¡ 
	gfÜûd_keyäames_cÚ¡_Çmes
[] = {

161 
NULL


164 
do_video_¡©s
(
OuutSŒ—m
 *
o¡
, 
äame_size
);

165 
št64_t
 
g‘utime
();

166 
št64_t
 
g‘maxrss
();

167 
if‹r_has_®l_šput_fÜm©s
(
F‹rG¿ph
 *
fg
);

169 
	grun_as_d«mÚ
 = 0;

170 
	gnb_äames_dup
 = 0;

171 
	gdup_w¬nšg
 = 1000;

172 
	gnb_äames_drİ
 = 0;

173 
št64_t
 
	gdecode_”rÜ_¡©
[2];

175 
	gwªt_sdp
 = 1;

177 
	gcu¼’t_time
;

178 
AVIOCÚ‹xt
 *
	g´og»ss_avio
 = 
NULL
;

180 
ušt8_t
 *
	gsubt™Ë_out
;

182 
IÅutSŒ—m
 **
	gšput_¡»ams
 = 
NULL
;

183 
	gnb_šput_¡»ams
 = 0;

184 
IÅutFe
 **
	gšput_fes
 = 
NULL
;

185 
	gnb_šput_fes
 = 0;

187 
OuutSŒ—m
 **
	gouut_¡»ams
 = 
NULL
;

188 
	gnb_ouut_¡»ams
 = 0;

189 
OuutFe
 **
	gouut_fes
 = 
NULL
;

190 
	gnb_ouut_fes
 = 0;

192 
F‹rG¿ph
 **
	gf‹rg¿phs
;

193 
	gnb_f‹rg¿phs
;

195 #ià
HAVE_TERMIOS_H


198 
‹rmios
 
	gŞd‰y
;

199 
	g»¡Üe_‰y
;

202 #ià
HAVE_PTHREADS


203 
ä“_šput_th»ads
();

211 
	$sub2video_g‘_bÏnk_äame
(
IÅutSŒ—m
 *
i¡
)

213 
»t
;

214 
AVF¿me
 *
äame
 = 
i¡
->
sub2video
.frame;

216 
	`av_äame_uÄef
(
äame
);

217 
i¡
->
sub2video
.
äame
->
width
 = i¡->
dec_ùx
->width ? i¡->dec_ùx->width : i¡->sub2video.
w
;

218 
i¡
->
sub2video
.
äame
->
height
 = i¡->
dec_ùx
->heighˆ? i¡->dec_ùx->heighˆ: i¡->sub2video.
h
;

219 
i¡
->
sub2video
.
äame
->
fÜm©
 = 
AV_PIX_FMT_RGB32
;

220 ià((
»t
 = 
	`av_äame_g‘_bufãr
(
äame
, 32)) < 0)

221  
»t
;

222 
	`mem£t
(
äame
->
d©a
[0], 0, f¿me->
height
 * f¿me->
lšesize
[0]);

224 
	}
}

226 
	$sub2video_cİy_»ù
(
ušt8_t
 *
d¡
, 
d¡_lšesize
, 
w
, 
h
,

227 
AVSubt™ËReù
 *
r
)

229 
ušt32_t
 *
·l
, *
d¡2
;

230 
ušt8_t
 *
¤c
, *
¤c2
;

231 
x
, 
y
;

233 ià(
r
->
ty³
 !ğ
SUBTITLE_BITMAP
) {

234 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "sub2video:‚on-bitmap subtitle\n");

237 ià(
r
->
x
 < 0 ||„->x +„->
w
 > w ||„->
y
 < 0 ||„->y +„->
h
 > h) {

238 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "sub2video:„ectangle (%d %d %d %d) overflowing %d %d\n",

239 
r
->
x
,„->
y
,„->
w
,„->
h
, w, h

244 
d¡
 +ğ
r
->
y
 * 
d¡_lšesize
 +„->
x
 * 4;

245 
¤c
 = 
r
->
d©a
[0];

246 
·l
 = (
ušt32_t
 *)
r
->
d©a
[1];

247 
y
 = 0; y < 
r
->
h
; y++) {

248 
d¡2
 = (
ušt32_t
 *)
d¡
;

249 
¤c2
 = 
¤c
;

250 
x
 = 0; x < 
r
->
w
; x++)

251 *(
d¡2
++èğ
·l
[*(
¤c2
++)];

252 
d¡
 +ğ
d¡_lšesize
;

253 
¤c
 +ğ
r
->
lšesize
[0];

255 
	}
}

257 
	$sub2video_push_»f
(
IÅutSŒ—m
 *
i¡
, 
št64_t
 
±s
)

259 
AVF¿me
 *
äame
 = 
i¡
->
sub2video
.frame;

260 
i
;

262 
	`av_as£¹1
(
äame
->
d©a
[0]);

263 
i¡
->
sub2video
.
Ï¡_±s
 = 
äame
->
±s
 =…ts;

264 
i
 = 0; i < 
i¡
->
nb_f‹rs
; i++)

265 
	`av_bufãr¤c_add_äame_æags
(
i¡
->
f‹rs
[
i
]->
f‹r
, 
äame
,

266 
AV_BUFFERSRC_FLAG_KEEP_REF
 |

267 
AV_BUFFERSRC_FLAG_PUSH
);

268 
	}
}

270 
	$sub2video_upd©e
(
IÅutSŒ—m
 *
i¡
, 
AVSubt™Ë
 *
sub
)

272 
AVF¿me
 *
äame
 = 
i¡
->
sub2video
.frame;

273 
št8_t
 *
d¡
;

274 
d¡_lšesize
;

275 
num_»ùs
, 
i
;

276 
št64_t
 
±s
, 
’d_±s
;

278 ià(!
äame
)

280 ià(
sub
) {

281 
±s
 = 
	`av_»sÿË_q
(
sub
->± + sub->
¡¬t_di¥Ïy_time
 * 1000LL,

282 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

283 
’d_±s
 = 
	`av_»sÿË_q
(
sub
->
±s
 + sub->
’d_di¥Ïy_time
 * 1000LL,

284 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

285 
num_»ùs
 = 
sub
->num_rects;

287 
±s
 = 
i¡
->
sub2video
.
’d_±s
;

288 
’d_±s
 = 
INT64_MAX
;

289 
num_»ùs
 = 0;

291 ià(
	`sub2video_g‘_bÏnk_äame
(
i¡
) < 0) {

292 
	`av_log
(
i¡
->
dec_ùx
, 
AV_LOG_ERROR
,

296 
d¡
 = 
äame
->
d©a
 [0];

297 
d¡_lšesize
 = 
äame
->
lšesize
[0];

298 
i
 = 0; i < 
num_»ùs
; i++)

299 
	`sub2video_cİy_»ù
(
d¡
, 
d¡_lšesize
, 
äame
->
width
, f¿me->
height
, 
sub
->
»ùs
[
i
]);

300 
	`sub2video_push_»f
(
i¡
, 
±s
);

301 
i¡
->
sub2video
.
’d_±s
 =ƒnd_pts;

302 
	}
}

304 
	$sub2video_h—¹b—t
(
IÅutSŒ—m
 *
i¡
, 
št64_t
 
±s
)

306 
IÅutFe
 *
šfe
 = 
šput_fes
[
i¡
->
fe_šdex
];

307 
i
, 
j
, 
nb_»qs
;

308 
št64_t
 
±s2
;

314 
i
 = 0; i < 
šfe
->
nb_¡»ams
; i++) {

315 
IÅutSŒ—m
 *
i¡2
 = 
šput_¡»ams
[
šfe
->
i¡_šdex
 + 
i
];

316 ià(!
i¡2
->
sub2video
.
äame
)

320 
±s2
 = 
	`av_»sÿË_q
(
±s
, 
i¡
->
¡
->
time_ba£
, 
i¡2
->st->time_base) - 1;

322 ià(
±s2
 <ğ
i¡2
->
sub2video
.
Ï¡_±s
)

324 ià(
±s2
 >ğ
i¡2
->
sub2video
.
’d_±s
 || !i¡2->sub2video.
äame
->
d©a
[0])

325 
	`sub2video_upd©e
(
i¡2
, 
NULL
);

326 
j
 = 0, 
nb_»qs
 = 0; j < 
i¡2
->
nb_f‹rs
; j++)

327 
nb_»qs
 +ğ
	`av_bufãr¤c_g‘_nb_çed_»que¡s
(
i¡2
->
f‹rs
[
j
]->
f‹r
);

328 ià(
nb_»qs
)

329 
	`sub2video_push_»f
(
i¡2
, 
±s2
);

331 
	}
}

333 
	$sub2video_æush
(
IÅutSŒ—m
 *
i¡
)

335 
i
;

337 ià(
i¡
->
sub2video
.
’d_±s
 < 
INT64_MAX
)

338 
	`sub2video_upd©e
(
i¡
, 
NULL
);

339 
i
 = 0; i < 
i¡
->
nb_f‹rs
; i++)

340 
	`av_bufãr¤c_add_äame
(
i¡
->
f‹rs
[
i
]->
f‹r
, 
NULL
);

341 
	}
}

345 
	$‹rm_ex™_sig§ã
()

347 #ià
HAVE_TERMIOS_H


348 if(
»¡Üe_‰y
)

349 
	`tc£‰r
 (0, 
TCSANOW
, &
Şd‰y
);

351 
	}
}

353 
	$‹rm_ex™
()

355 
	`av_log
(
NULL
, 
AV_LOG_QUIET
, "%s", "");

356 
	`‹rm_ex™_sig§ã
();

357 
	}
}

359 vŞ©
	g»ûived_sig‹rm
 = 0;

360 vŞ©
	g»ûived_nb_sigÇls
 = 0;

361 
©omic_št
 
	gŒªscode_š™_dÚe
 = 
ATOMIC_VAR_INIT
(0);

362 vŞ©
	gffm³g_ex™ed
 = 0;

363 
	gmaš_»tuº_code
 = 0;

366 
	$sig‹rm_hªdËr
(
sig
)

368 
»ûived_sig‹rm
 = 
sig
;

369 
»ûived_nb_sigÇls
++;

370 
	`‹rm_ex™_sig§ã
();

371 if(
»ûived_nb_sigÇls
 > 3) {

372 
	`wr™e
(2 , "Received > 3 system signals, hardƒxiting\n",

373 
	`¡¾’
("Received > 3 system signals, hardƒxiting\n"));

375 
	`ex™
(123);

377 
	}
}

379 #ià
HAVE_SETCONSOLECTRLHANDLER


380 
BOOL
 
WINAPI
 
	$CŒlHªdËr
(
DWORD
 
fdwCŒlTy³
)

382 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "\nReûived wšdow sigÇÈ%ld\n", 
fdwCŒlTy³
);

384 
fdwCŒlTy³
)

386 
CTRL_C_EVENT
:

387 
CTRL_BREAK_EVENT
:

388 
	`sig‹rm_hªdËr
(
SIGINT
);

389  
TRUE
;

391 
CTRL_CLOSE_EVENT
:

392 
CTRL_LOGOFF_EVENT
:

393 
CTRL_SHUTDOWN_EVENT
:

394 
	`sig‹rm_hªdËr
(
SIGTERM
);

399 !
ffm³g_ex™ed
) {

400 
	`SË•
(0);

402  
TRUE
;

405 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Reûived unknowÀwšdow sigÇÈ%ld\n", 
fdwCŒlTy³
);

406  
FALSE
;

408 
	}
}

411 
	$‹rm_š™
()

413 #ià
HAVE_TERMIOS_H


414 ià(!
run_as_d«mÚ
 && 
¡dš_š‹¿ùiÚ
) {

415 
‹rmios
 
‰y
;

416 ià(
	`tcg‘©Œ
 (0, &
‰y
) == 0) {

417 
Şd‰y
 = 
‰y
;

418 
»¡Üe_‰y
 = 1;

420 
‰y
.
c_iæag
 &ğ~(
IGNBRK
|
BRKINT
|
PARMRK
|
ISTRIP


421 |
INLCR
|
IGNCR
|
ICRNL
|
IXON
);

422 
‰y
.
c_oæag
 |ğ
OPOST
;

423 
‰y
.
c_læag
 &ğ~(
ECHO
|
ECHONL
|
ICANON
|
IEXTEN
);

424 
‰y
.
c_cæag
 &ğ~(
CSIZE
|
PARENB
);

425 
‰y
.
c_cæag
 |ğ
CS8
;

426 
‰y
.
c_cc
[
VMIN
] = 1;

427 
‰y
.
c_cc
[
VTIME
] = 0;

429 
	`tc£‰r
 (0, 
TCSANOW
, &
‰y
);

431 
	`sigÇl
(
SIGQUIT
, 
sig‹rm_hªdËr
);

435 
	`sigÇl
(
SIGINT
 , 
sig‹rm_hªdËr
);

436 
	`sigÇl
(
SIGTERM
, 
sig‹rm_hªdËr
);

437 #ifdeà
SIGXCPU


438 
	`sigÇl
(
SIGXCPU
, 
sig‹rm_hªdËr
);

440 #ià
HAVE_SETCONSOLECTRLHANDLER


441 
	`S‘CÚsŞeCŒlHªdËr
((
PHANDLER_ROUTINE
è
CŒlHªdËr
, 
TRUE
);

443 
	}
}

446 
	$»ad_key
()

448 
ch
;

449 #ià
HAVE_TERMIOS_H


450 
n
 = 1;

451 
timev®
 
tv
;

452 
fd_£t
 
rfds
;

454 
	`FD_ZERO
(&
rfds
);

455 
	`FD_SET
(0, &
rfds
);

456 
tv
.
tv_£c
 = 0;

457 
tv
.
tv_u£c
 = 0;

458 
n
 = 
	`£Ëù
(1, &
rfds
, 
NULL
, NULL, &
tv
);

459 ià(
n
 > 0) {

460 
n
 = 
	`»ad
(0, &
ch
, 1);

461 ià(
n
 == 1)

462  
ch
;

464  
n
;

466 #–ià
HAVE_KBHIT


467 #ià
HAVE_PEEKNAMEDPIPE


468 
is_pe
;

469 
HANDLE
 
šput_hªdË
;

470 
DWORD
 
dw
, 
nch¬s
;

471 if(!
šput_hªdË
){

472 
šput_hªdË
 = 
	`G‘StdHªdË
(
STD_INPUT_HANDLE
);

473 
is_pe
 = !
	`G‘CÚsŞeMode
(
šput_hªdË
, &
dw
);

476 ià(
is_pe
) {

478 ià(!
	`P“kNamedPe
(
šput_hªdË
, 
NULL
, 0, NULL, &
nch¬s
, NULL)) {

483 if(
nch¬s
 != 0) {

484 
	`»ad
(0, &
ch
, 1);

485  
ch
;

491 if(
	`kbh™
())

492 (
	`g‘ch
());

495 
	}
}

497 
	$decode_š‹¼u±_cb
(*
ùx
)

499  
»ûived_nb_sigÇls
 > 
	`©omic_lßd
(&
Œªscode_š™_dÚe
);

500 
	}
}

502 cÚ¡ 
AVIOIÁ”ru±CB
 
	gšt_cb
 = { 
decode_š‹¼u±_cb
, 
NULL
 };

504 
	$ffm³g_ş—nup
(
»t
)

506 
i
, 
j
;

508 ià(
do_b’chm¬k
) {

509 
maxrss
 = 
	`g‘maxrss
() / 1024;

510 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "b’ch: maxrss=%ikB\n", 
maxrss
);

513 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

514 
F‹rG¿ph
 *
fg
 = 
f‹rg¿phs
[
i
];

515 
	`avf‹r_g¿ph_ä“
(&
fg
->
g¿ph
);

516 
j
 = 0; j < 
fg
->
nb_šputs
; j++) {

517 
	`av_fifo_size
(
fg
->
šputs
[
j
]->
äame_queue
)) {

518 
AVF¿me
 *
äame
;

519 
	`av_fifo_g’”ic_»ad
(
fg
->
šputs
[
j
]->
äame_queue
, &
äame
,

520 (
äame
), 
NULL
);

521 
	`av_äame_ä“
(&
äame
);

523 
	`av_fifo_ä“
(
fg
->
šputs
[
j
]->
äame_queue
);

524 ià(
fg
->
šputs
[
j
]->
i¡
->
sub2video
.
sub_queue
) {

525 
	`av_fifo_size
(
fg
->
šputs
[
j
]->
i¡
->
sub2video
.
sub_queue
)) {

526 
AVSubt™Ë
 
sub
;

527 
	`av_fifo_g’”ic_»ad
(
fg
->
šputs
[
j
]->
i¡
->
sub2video
.
sub_queue
,

528 &
sub
, (sub), 
NULL
);

529 
	`avsubt™Ë_ä“
(&
sub
);

531 
	`av_fifo_ä“
(
fg
->
šputs
[
j
]->
i¡
->
sub2video
.
sub_queue
);

533 
	`av_bufãr_uÄef
(&
fg
->
šputs
[
j
]->
hw_äames_ùx
);

534 
	`av_ä“p
(&
fg
->
šputs
[
j
]->
Çme
);

535 
	`av_ä“p
(&
fg
->
šputs
[
j
]);

537 
	`av_ä“p
(&
fg
->
šputs
);

538 
j
 = 0; j < 
fg
->
nb_ouuts
; j++) {

539 
	`av_ä“p
(&
fg
->
ouuts
[
j
]->
Çme
);

540 
	`av_ä“p
(&
fg
->
ouuts
[
j
]->
fÜm©s
);

541 
	`av_ä“p
(&
fg
->
ouuts
[
j
]->
chªÃl_Ïyouts
);

542 
	`av_ä“p
(&
fg
->
ouuts
[
j
]->
§m¶e_¿‹s
);

543 
	`av_ä“p
(&
fg
->
ouuts
[
j
]);

545 
	`av_ä“p
(&
fg
->
ouuts
);

546 
	`av_ä“p
(&
fg
->
g¿ph_desc
);

548 
	`av_ä“p
(&
f‹rg¿phs
[
i
]);

550 
	`av_ä“p
(&
f‹rg¿phs
);

552 
	`av_ä“p
(&
subt™Ë_out
);

555 
i
 = 0; i < 
nb_ouut_fes
; i++) {

556 
OuutFe
 *
of
 = 
ouut_fes
[
i
];

557 
AVFÜm©CÚ‹xt
 *
s
;

558 ià(!
of
)

560 
s
 = 
of
->
ùx
;

561 ià(
s
 && s->
ofÜm©
 && !(s->ofÜm©->
æags
 & 
AVFMT_NOFILE
))

562 
	`avio_şo£p
(&
s
->
pb
);

563 
	`avfÜm©_ä“_cÚ‹xt
(
s
);

564 
	`av_diù_ä“
(&
of
->
İts
);

566 
	`av_ä“p
(&
ouut_fes
[
i
]);

568 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

569 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

571 ià(!
o¡
)

574 
j
 = 0; j < 
o¡
->
nb_b™¡»am_f‹rs
; j++)

575 
	`av_bsf_ä“
(&
o¡
->
bsf_ùx
[
j
]);

576 
	`av_ä“p
(&
o¡
->
bsf_ùx
);

577 
	`av_ä“p
(&
o¡
->
bsf_exŒad©a_upd©ed
);

579 
	`av_äame_ä“
(&
o¡
->
f‹»d_äame
);

580 
	`av_äame_ä“
(&
o¡
->
Ï¡_äame
);

581 
	`av_diù_ä“
(&
o¡
->
’cod”_İts
);

583 
	`av_·r£r_şo£
(
o¡
->
·r£r
);

584 
	`avcodec_ä“_cÚ‹xt
(&
o¡
->
·r£r_avùx
);

586 
	`av_ä“p
(&
o¡
->
fÜûd_keyäames
);

587 
	`av_ex´_ä“
(
o¡
->
fÜûd_keyäames_³x´
);

588 
	`av_ä“p
(&
o¡
->
avf‹r
);

589 
	`av_ä“p
(&
o¡
->
logfe_´efix
);

591 
	`av_ä“p
(&
o¡
->
audio_chªÃls_m­
);

592 
o¡
->
audio_chªÃls_m­³d
 = 0;

594 
	`av_diù_ä“
(&
o¡
->
sws_diù
);

596 
	`avcodec_ä“_cÚ‹xt
(&
o¡
->
’c_ùx
);

597 
	`avcodec_·¿m‘”s_ä“
(&
o¡
->
»f_·r
);

599 ià(
o¡
->
muxšg_queue
) {

600 
	`av_fifo_size
(
o¡
->
muxšg_queue
)) {

601 
AVPack‘
 
pkt
;

602 
	`av_fifo_g’”ic_»ad
(
o¡
->
muxšg_queue
, &
pkt
, Õkt), 
NULL
);

603 
	`av_·ck‘_uÄef
(&
pkt
);

605 
	`av_fifo_ä“p
(&
o¡
->
muxšg_queue
);

608 
	`av_ä“p
(&
ouut_¡»ams
[
i
]);

610 #ià
HAVE_PTHREADS


611 
	`ä“_šput_th»ads
();

613 
i
 = 0; i < 
nb_šput_fes
; i++) {

614 
	`avfÜm©_şo£_šput
(&
šput_fes
[
i
]->
ùx
);

615 
	`av_ä“p
(&
šput_fes
[
i
]);

617 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

618 
IÅutSŒ—m
 *
i¡
 = 
šput_¡»ams
[
i
];

620 
	`av_äame_ä“
(&
i¡
->
decoded_äame
);

621 
	`av_äame_ä“
(&
i¡
->
f‹r_äame
);

622 
	`av_diù_ä“
(&
i¡
->
decod”_İts
);

623 
	`avsubt™Ë_ä“
(&
i¡
->
´ev_sub
.
subt™Ë
);

624 
	`av_äame_ä“
(&
i¡
->
sub2video
.
äame
);

625 
	`av_ä“p
(&
i¡
->
f‹rs
);

626 
	`av_ä“p
(&
i¡
->
hwacûl_deviû
);

627 
	`av_ä“p
(&
i¡
->
dts_bufãr
);

629 
	`avcodec_ä“_cÚ‹xt
(&
i¡
->
dec_ùx
);

631 
	`av_ä“p
(&
šput_¡»ams
[
i
]);

634 ià(
v¡©s_fe
) {

635 ià(
	`fşo£
(
v¡©s_fe
))

636 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

638 
	`av_”r2¡r
(
	`AVERROR
(
”ºo
)));

640 
	`av_ä“p
(&
v¡©s_f’ame
);

642 
	`av_ä“p
(&
šput_¡»ams
);

643 
	`av_ä“p
(&
šput_fes
);

644 
	`av_ä“p
(&
ouut_¡»ams
);

645 
	`av_ä“p
(&
ouut_fes
);

647 
	`unš™_İts
();

649 
	`avfÜm©_ÃtwÜk_deš™
();

651 ià(
»ûived_sig‹rm
) {

652 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Exiting‚ormally,„eceived signal %d.\n",

653 (è
»ûived_sig‹rm
);

654 } ià(
»t
 && 
	`©omic_lßd
(&
Œªscode_š™_dÚe
)) {

655 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Conversion failed!\n");

657 
	`‹rm_ex™
();

658 
ffm³g_ex™ed
 = 1;

659 
	}
}

661 
	$»move_avİtiÚs
(
AVDiùiÚ¬y
 **
a
, AVDiùiÚ¬y *
b
)

663 
AVDiùiÚ¬yEÁry
 *
t
 = 
NULL
;

665 (
t
 = 
	`av_diù_g‘
(
b
, "",, 
AV_DICT_IGNORE_SUFFIX
))) {

666 
	`av_diù_£t
(
a
, 
t
->
key
, 
NULL
, 
AV_DICT_MATCH_CASE
);

668 
	}
}

670 
	$as£¹_avİtiÚs
(
AVDiùiÚ¬y
 *
m
)

672 
AVDiùiÚ¬yEÁry
 *
t
;

673 ià((
t
 = 
	`av_diù_g‘
(
m
, "", 
NULL
, 
AV_DICT_IGNORE_SUFFIX
))) {

674 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "O±iÚ % nÙ found.\n", 
t
->
key
);

675 
	`ex™_´og¿m
(1);

677 
	}
}

679 
	$abÜt_codec_ex³rim’l
(
AVCodec
 *
c
, 
’cod”
)

681 
	`ex™_´og¿m
(1);

682 
	}
}

684 
	$upd©e_b’chm¬k
(cÚ¡ *
fmt
, ...)

686 ià(
do_b’chm¬k_®l
) {

687 
št64_t
 
t
 = 
	`g‘utime
();

688 
va_li¡
 
va
;

689 
buf
[1024];

691 ià(
fmt
) {

692 
	`va_¡¬t
(
va
, 
fmt
);

693 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
va
);

694 
	`va_’d
(
va
);

695 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "b’ch: %8"
PRIu64
" % \n", 
t
 - 
cu¼’t_time
, 
buf
);

697 
cu¼’t_time
 = 
t
;

699 
	}
}

701 
	$şo£_®l_ouut_¡»ams
(
OuutSŒ—m
 *
o¡
, 
OSTFšished
 
this_¡»am
, OSTFšished 
Ùh”s
)

703 
i
;

704 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

705 
OuutSŒ—m
 *
o¡2
 = 
ouut_¡»ams
[
i
];

706 
o¡2
->
fšished
 |ğ
o¡
 =ğo¡2 ? 
this_¡»am
 : 
Ùh”s
;

708 
	}
}

710 
	$wr™e_·ck‘
(
OuutFe
 *
of
, 
AVPack‘
 *
pkt
, 
OuutSŒ—m
 *
o¡
, 
unqueue
)

712 
AVFÜm©CÚ‹xt
 *
s
 = 
of
->
ùx
;

713 
AVSŒ—m
 *
¡
 = 
o¡
->st;

714 
»t
;

724 ià(!(
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 && 
o¡
->
’codšg_Ãeded
è&& !
unqueue
) {

725 ià(
o¡
->
äame_numb”
 >ğo¡->
max_äames
) {

726 
	`av_·ck‘_uÄef
(
pkt
);

729 
o¡
->
äame_numb”
++;

732 ià(!
of
->
h—d”_wr™‹n
) {

733 
AVPack‘
 
tmp_pkt
 = {0};

735 ià(!
	`av_fifo_¥aû
(
o¡
->
muxšg_queue
)) {

736 
Ãw_size
 = 
	`FFMIN
(2 * 
	`av_fifo_size
(
o¡
->
muxšg_queue
),

737 
o¡
->
max_muxšg_queue_size
);

738 ià(
Ãw_size
 <ğ
	`av_fifo_size
(
o¡
->
muxšg_queue
)) {

739 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

741 
o¡
->
fe_šdex
, o¡->
¡
->
šdex
);

742 
	`ex™_´og¿m
(1);

744 
»t
 = 
	`av_fifo_»®loc2
(
o¡
->
muxšg_queue
, 
Ãw_size
);

745 ià(
»t
 < 0)

746 
	`ex™_´og¿m
(1);

748 
»t
 = 
	`av_·ck‘_»f
(&
tmp_pkt
, 
pkt
);

749 ià(
»t
 < 0)

750 
	`ex™_´og¿m
(1);

751 
	`av_fifo_g’”ic_wr™e
(
o¡
->
muxšg_queue
, &
tmp_pkt
, Ñmp_pkt), 
NULL
);

752 
	`av_·ck‘_uÄef
(
pkt
);

756 ià((
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 && 
video_sync_m‘hod
 =ğ
VSYNC_DROP
) ||

757 (
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 && 
audio_sync_m‘hod
 < 0))

758 
pkt
->
±s
 =…kt->
dts
 = 
AV_NOPTS_VALUE
;

760 ià(
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

761 
i
;

762 
ušt8_t
 *
sd
 = 
	`av_·ck‘_g‘_side_d©a
(
pkt
, 
AV_PKT_DATA_QUALITY_STATS
,

763 
NULL
);

764 
o¡
->
qu®™y
 = 
sd
 ? 
	`AV_RL32
(sd) : -1;

765 
o¡
->
più_ty³
 = 
sd
 ? sd[4] : 
AV_PICTURE_TYPE_NONE
;

767 
i
 = 0; i<
	`FF_ARRAY_ELEMS
(
o¡
->
”rÜ
); i++) {

768 ià(
sd
 && 
i
 < sd[5])

769 
o¡
->
”rÜ
[
i
] = 
	`AV_RL64
(
sd
 + 8 + 8*i);

771 
o¡
->
”rÜ
[
i
] = -1;

774 ià(
o¡
->
äame_¿‹
.
num
 && o¡->
is_cä
) {

775 ià(
pkt
->
du¿tiÚ
 > 0)

776 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Overriding…acket duration by frame„ate,his should‚ot happen\n");

777 
pkt
->
du¿tiÚ
 = 
	`av_»sÿË_q
(1, 
	`av_šv_q
(
o¡
->
äame_¿‹
),

778 
o¡
->
mux_timeba£
);

782 
	`av_·ck‘_»sÿË_ts
(
pkt
, 
o¡
->
mux_timeba£
, o¡->
¡
->
time_ba£
);

784 ià(!(
s
->
ofÜm©
->
æags
 & 
AVFMT_NOTIMESTAMPS
)) {

785 ià(
pkt
->
dts
 !ğ
AV_NOPTS_VALUE
 &&

786 
pkt
->
±s
 !ğ
AV_NOPTS_VALUE
 &&

787 
pkt
->
dts
 >…kt->
±s
) {

788 
	`av_log
(
s
, 
AV_LOG_WARNING
, "Inv®id DTS: %"
PRId64
" PTS: %"PRId64" in output stream %d:%d,„eplacing by guess\n",

789 
pkt
->
dts
,…kt->
±s
,

790 
o¡
->
fe_šdex
, o¡->
¡
->
šdex
);

791 
pkt
->
±s
 =

792 
pkt
->
dts
 =…kt->
±s
 +…kt->dt + 
o¡
->
Ï¡_mux_dts
 + 1

793 - 
	`FFMIN3
(
pkt
->
±s
,…kt->
dts
, 
o¡
->
Ï¡_mux_dts
 + 1)

794 - 
	`FFMAX3
(
pkt
->
±s
,…kt->
dts
, 
o¡
->
Ï¡_mux_dts
 + 1);

796 ià((
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 || st->codeı¬->codec_ty³ =ğ
AVMEDIA_TYPE_VIDEO
) &&

797 
pkt
->
dts
 !ğ
AV_NOPTS_VALUE
 &&

798 !(
¡
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_VP9
 && 
o¡
->
¡»am_cİy
) &&

799 
o¡
->
Ï¡_mux_dts
 !ğ
AV_NOPTS_VALUE
) {

800 
št64_t
 
max
 = 
o¡
->
Ï¡_mux_dts
 + !(
s
->
ofÜm©
->
æags
 & 
AVFMT_TS_NONSTRICT
);

801 ià(
pkt
->
dts
 < 
max
) {

802 
logËv–
 = 
max
 - 
pkt
->
dts
 > 2 || 
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ? 
AV_LOG_WARNING
 : 
AV_LOG_DEBUG
;

803 
	`av_log
(
s
, 
logËv–
, "Non-monotonous DTS in output stream "

804 "%d:%d;…»vious: %"
PRId64
", current: %"PRId64"; ",

805 
o¡
->
fe_šdex
, o¡->
¡
->
šdex
, o¡->
Ï¡_mux_dts
, 
pkt
->
dts
);

806 ià(
ex™_Ú_”rÜ
) {

807 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "aborting.\n");

808 
	`ex™_´og¿m
(1);

810 
	`av_log
(
s
, 
logËv–
, "chªgšgØ%"
PRId64
". This may„esult "

812 
max
);

813 ià(
pkt
->
±s
 >ğpkt->
dts
)

814 
pkt
->
±s
 = 
	`FFMAX
Õkt->±s, 
max
);

815 
pkt
->
dts
 = 
max
;

819 
o¡
->
Ï¡_mux_dts
 = 
pkt
->
dts
;

821 
o¡
->
d©a_size
 +ğ
pkt
->
size
;

822 
o¡
->
·ck‘s_wr™‹n
++;

824 
pkt
->
¡»am_šdex
 = 
o¡
->
šdex
;

826 ià(
debug_ts
) {

827 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "muxer <-ype:%s "

829 
	`av_g‘_medŸ_ty³_¡ršg
(
o¡
->
’c_ùx
->
codec_ty³
),

830 
	`av_ts2¡r
(
pkt
->
±s
), 
	`av_ts2time¡r
Õkt->±s, &
o¡
->
¡
->
time_ba£
),

831 
	`av_ts2¡r
(
pkt
->
dts
), 
	`av_ts2time¡r
Õkt->dts, &
o¡
->
¡
->
time_ba£
),

832 
pkt
->
size


836 
»t
 = 
	`av_š‹¾—ved_wr™e_äame
(
s
, 
pkt
);

837 ià(
»t
 < 0) {

838 
	`´št_”rÜ
("av_š‹¾—ved_wr™e_äame()", 
»t
);

839 
maš_»tuº_code
 = 1;

840 
	`şo£_®l_ouut_¡»ams
(
o¡
, 
MUXER_FINISHED
 | 
ENCODER_FINISHED
, ENCODER_FINISHED);

842 
	`av_·ck‘_uÄef
(
pkt
);

843 
	}
}

845 
	$şo£_ouut_¡»am
(
OuutSŒ—m
 *
o¡
)

847 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

849 
o¡
->
fšished
 |ğ
ENCODER_FINISHED
;

850 ià(
of
->
shÜ‹¡
) {

851 
št64_t
 
’d
 = 
	`av_»sÿË_q
(
o¡
->
sync_İts
 - o¡->
fœ¡_±s
, o¡->
’c_ùx
->
time_ba£
, 
AV_TIME_BASE_Q
);

852 
of
->
»cÜdšg_time
 = 
	`FFMIN
(of->»cÜdšg_time, 
’d
);

854 
	}
}

856 
	$ouut_·ck‘
(
OuutFe
 *
of
, 
AVPack‘
 *
pkt
, 
OuutSŒ—m
 *
o¡
)

858 
»t
 = 0;

861 ià(
o¡
->
nb_b™¡»am_f‹rs
) {

862 
idx
;

864 
»t
 = 
	`av_bsf_£nd_·ck‘
(
o¡
->
bsf_ùx
[0], 
pkt
);

865 ià(
»t
 < 0)

866 
fšish
;

868 
idx
 = 1;

869 
idx
) {

871 
»t
 = 
	`av_bsf_»ûive_·ck‘
(
o¡
->
bsf_ùx
[
idx
 - 1], 
pkt
);

872 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

873 
»t
 = 0;

874 
idx
--;

876 } ià(
»t
 < 0)

877 
fšish
;

883 ià(!(
o¡
->
bsf_exŒad©a_upd©ed
[
idx
 - 1] & 1)) {

884 
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
o¡
->
¡
->
codeı¬
, o¡->
bsf_ùx
[
idx
 - 1]->
·r_out
);

885 ià(
»t
 < 0)

886 
fšish
;

887 
o¡
->
bsf_exŒad©a_upd©ed
[
idx
 - 1] |= 1;

891 ià(
idx
 < 
o¡
->
nb_b™¡»am_f‹rs
) {

893 ià(!(
o¡
->
bsf_exŒad©a_upd©ed
[
idx
] & 2)) {

894 
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
o¡
->
bsf_ùx
[
idx
]->
·r_out
, ost->bsf_ctx[idx - 1]->par_out);

895 ià(
»t
 < 0)

896 
fšish
;

897 
o¡
->
bsf_exŒad©a_upd©ed
[
idx
] |= 2;

899 
»t
 = 
	`av_bsf_£nd_·ck‘
(
o¡
->
bsf_ùx
[
idx
], 
pkt
);

900 ià(
»t
 < 0)

901 
fšish
;

902 
idx
++;

904 
	`wr™e_·ck‘
(
of
, 
pkt
, 
o¡
, 0);

907 
	`wr™e_·ck‘
(
of
, 
pkt
, 
o¡
, 0);

909 
fšish
:

910 ià(
»t
 < 0 &&„‘ !ğ
AVERROR_EOF
) {

911 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error‡pplying bitstream filterso‡n output "

912 "·ck‘ fÜ sŒ—m #%d:%d.\n", 
o¡
->
fe_šdex
, o¡->
šdex
);

913 if(
ex™_Ú_”rÜ
)

914 
	`ex™_´og¿m
(1);

916 
	}
}

918 
	$check_»cÜdšg_time
(
OuutSŒ—m
 *
o¡
)

920 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

922 ià(
of
->
»cÜdšg_time
 !ğ
INT64_MAX
 &&

923 
	`av_com·»_ts
(
o¡
->
sync_İts
 - o¡->
fœ¡_±s
, o¡->
’c_ùx
->
time_ba£
, 
of
->
»cÜdšg_time
,

924 
AV_TIME_BASE_Q
) >= 0) {

925 
	`şo£_ouut_¡»am
(
o¡
);

929 
	}
}

931 
	$do_audio_out
(
OuutFe
 *
of
, 
OuutSŒ—m
 *
o¡
,

932 
AVF¿me
 *
äame
)

934 
AVCodecCÚ‹xt
 *
’c
 = 
o¡
->
’c_ùx
;

935 
AVPack‘
 
pkt
;

936 
»t
;

938 
	`av_š™_·ck‘
(&
pkt
);

939 
pkt
.
d©a
 = 
NULL
;

940 
pkt
.
size
 = 0;

942 ià(!
	`check_»cÜdšg_time
(
o¡
))

945 ià(
äame
->
±s
 =ğ
AV_NOPTS_VALUE
 || 
audio_sync_m‘hod
 < 0)

946 
äame
->
±s
 = 
o¡
->
sync_İts
;

947 
o¡
->
sync_İts
 = 
äame
->
±s
 + f¿me->
nb_§m¶es
;

948 
o¡
->
§m¶es_’coded
 +ğ
äame
->
nb_§m¶es
;

949 
o¡
->
äames_’coded
++;

951 
	`av_as£¹0
(
pkt
.
size
 || !pkt.
d©a
);

952 
	`upd©e_b’chm¬k
(
NULL
);

953 ià(
debug_ts
) {

954 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "encoder <-ype:audio "

956 
	`av_ts2¡r
(
äame
->
±s
), 
	`av_ts2time¡r
(äame->±s, &
’c
->
time_ba£
),

957 
’c
->
time_ba£
.
num
,ƒnc->time_ba£.
d’
);

960 
»t
 = 
	`avcodec_£nd_äame
(
’c
, 
äame
);

961 ià(
»t
 < 0)

962 
”rÜ
;

965 
»t
 = 
	`avcodec_»ûive_·ck‘
(
’c
, &
pkt
);

966 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
))

968 ià(
»t
 < 0)

969 
”rÜ
;

971 
	`upd©e_b’chm¬k
("’code_audiØ%d.%d", 
o¡
->
fe_šdex
, o¡->
šdex
);

973 
	`av_·ck‘_»sÿË_ts
(&
pkt
, 
’c
->
time_ba£
, 
o¡
->
mux_timeba£
);

975 ià(
debug_ts
) {

976 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "encoder ->ype:audio "

978 
	`av_ts2¡r
(
pkt
.
±s
), 
	`av_ts2time¡r
Õkt.±s, &
’c
->
time_ba£
),

979 
	`av_ts2¡r
(
pkt
.
dts
), 
	`av_ts2time¡r
Õkt.dts, &
’c
->
time_ba£
));

982 
	`ouut_·ck‘
(
of
, &
pkt
, 
o¡
);

986 
”rÜ
:

987 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Audioƒncoding failed\n");

988 
	`ex™_´og¿m
(1);

989 
	}
}

991 
	$do_subt™Ë_out
(
OuutFe
 *
of
,

992 
OuutSŒ—m
 *
o¡
,

993 
AVSubt™Ë
 *
sub
)

995 
subt™Ë_out_max_size
 = 1024 * 1024;

996 
subt™Ë_out_size
, 
nb
, 
i
;

997 
AVCodecCÚ‹xt
 *
’c
;

998 
AVPack‘
 
pkt
;

999 
št64_t
 
±s
;

1001 ià(
sub
->
±s
 =ğ
AV_NOPTS_VALUE
) {

1002 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Subtitle…ackets must have‡…ts\n");

1003 ià(
ex™_Ú_”rÜ
)

1004 
	`ex™_´og¿m
(1);

1008 
’c
 = 
o¡
->
’c_ùx
;

1010 ià(!
subt™Ë_out
) {

1011 
subt™Ë_out
 = 
	`av_m®loc
(
subt™Ë_out_max_size
);

1012 ià(!
subt™Ë_out
) {

1013 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Failedo‡llocate subtitle_out\n");

1014 
	`ex™_´og¿m
(1);

1021 ià(
’c
->
codec_id
 =ğ
AV_CODEC_ID_DVB_SUBTITLE
)

1022 
nb
 = 2;

1024 
nb
 = 1;

1027 
±s
 = 
sub
->pts;

1028 ià(
ouut_fes
[
o¡
->
fe_šdex
]->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

1029 
±s
 -ğ
ouut_fes
[
o¡
->
fe_šdex
]->
¡¬t_time
;

1030 
i
 = 0; i < 
nb
; i++) {

1031 
§ve_num_»ùs
 = 
sub
->
num_»ùs
;

1033 
o¡
->
sync_İts
 = 
	`av_»sÿË_q
(
±s
, 
AV_TIME_BASE_Q
, 
’c
->
time_ba£
);

1034 ià(!
	`check_»cÜdšg_time
(
o¡
))

1037 
sub
->
±s
 =…ts;

1039 
sub
->
±s
 +ğ
	`av_»sÿË_q
(sub->
¡¬t_di¥Ïy_time
, (
AVR©iÚ®
){ 1, 1000 }, 
AV_TIME_BASE_Q
);

1040 
sub
->
’d_di¥Ïy_time
 -ğsub->
¡¬t_di¥Ïy_time
;

1041 
sub
->
¡¬t_di¥Ïy_time
 = 0;

1042 ià(
i
 == 1)

1043 
sub
->
num_»ùs
 = 0;

1045 
o¡
->
äames_’coded
++;

1047 
subt™Ë_out_size
 = 
	`avcodec_’code_subt™Ë
(
’c
, 
subt™Ë_out
,

1048 
subt™Ë_out_max_size
, 
sub
);

1049 ià(
i
 == 1)

1050 
sub
->
num_»ùs
 = 
§ve_num_»ùs
;

1051 ià(
subt™Ë_out_size
 < 0) {

1052 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Subtitleƒncoding failed\n");

1053 
	`ex™_´og¿m
(1);

1056 
	`av_š™_·ck‘
(&
pkt
);

1057 
pkt
.
d©a
 = 
subt™Ë_out
;

1058 
pkt
.
size
 = 
subt™Ë_out_size
;

1059 
pkt
.
±s
 = 
	`av_»sÿË_q
(
sub
->±s, 
AV_TIME_BASE_Q
, 
o¡
->
mux_timeba£
);

1060 
pkt
.
du¿tiÚ
 = 
	`av_»sÿË_q
(
sub
->
’d_di¥Ïy_time
, (
AVR©iÚ®
){ 1, 1000 }, 
o¡
->
mux_timeba£
);

1061 ià(
’c
->
codec_id
 =ğ
AV_CODEC_ID_DVB_SUBTITLE
) {

1064 ià(
i
 == 0)

1065 
pkt
.
±s
 +ğ
	`av_»sÿË_q
(
sub
->
¡¬t_di¥Ïy_time
, (
AVR©iÚ®
){ 1, 1000 }, 
o¡
->
mux_timeba£
);

1067 
pkt
.
±s
 +ğ
	`av_»sÿË_q
(
sub
->
’d_di¥Ïy_time
, (
AVR©iÚ®
){ 1, 1000 }, 
o¡
->
mux_timeba£
);

1069 
pkt
.
dts
 =…kt.
±s
;

1070 
	`ouut_·ck‘
(
of
, &
pkt
, 
o¡
);

1072 
	}
}

1074 
	$do_video_out
(
OuutFe
 *
of
,

1075 
OuutSŒ—m
 *
o¡
,

1076 
AVF¿me
 *
Ãxt_piùu»
,

1077 
sync_ts
)

1079 
»t
, 
fÜm©_video_sync
;

1080 
AVPack‘
 
pkt
;

1081 
AVCodecCÚ‹xt
 *
’c
 = 
o¡
->
’c_ùx
;

1082 
AVCodecP¬am‘”s
 *
mux_·r
 = 
o¡
->
¡
->
codeı¬
;

1083 
AVR©iÚ®
 
äame_¿‹
;

1084 
nb_äames
, 
nb0_äames
, 
i
;

1085 
d–
, 
d–0
;

1086 
du¿tiÚ
 = 0;

1087 
äame_size
 = 0;

1088 
IÅutSŒ—m
 *
i¡
 = 
NULL
;

1089 
AVF‹rCÚ‹xt
 *
f‹r
 = 
o¡
->filter->filter;

1091 ià(
o¡
->
sourû_šdex
 >= 0)

1092 
i¡
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
];

1094 
äame_¿‹
 = 
	`av_bufãrsšk_g‘_äame_¿‹
(
f‹r
);

1095 ià(
äame_¿‹
.
num
 > 0 && f¿me_¿‹.
d’
 > 0)

1096 
du¿tiÚ
 = 1/(
	`av_q2d
(
äame_¿‹
è*‡v_q2d(
’c
->
time_ba£
));

1098 if(
i¡
 && i¡->
¡
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 && i¡->¡->
fœ¡_dts
 !ğAV_NOPTS_VALUE && 
o¡
->
äame_¿‹
.
num
)

1099 
du¿tiÚ
 = 
	`FFMIN
(du¿tiÚ, 1/(
	`av_q2d
(
o¡
->
äame_¿‹
è*‡v_q2d(
’c
->
time_ba£
)));

1101 ià(!
o¡
->
f‹rs_süt
 &&

1102 !
o¡
->
f‹rs
 &&

1103 
Ãxt_piùu»
 &&

1104 
i¡
 &&

1105 
	`Ìštf
(
	`av_äame_g‘_pkt_du¿tiÚ
(
Ãxt_piùu»
è* 
	`av_q2d
(
i¡
->
¡
->
time_ba£
è/‡v_q2d(
’c
->time_base)) > 0) {

1106 
du¿tiÚ
 = 
	`Ìštf
(
	`av_äame_g‘_pkt_du¿tiÚ
(
Ãxt_piùu»
è* 
	`av_q2d
(
i¡
->
¡
->
time_ba£
è/‡v_q2d(
’c
->time_base));

1109 ià(!
Ãxt_piùu»
) {

1111 
nb0_äames
 = 
nb_äames
 = 
	`mid_´ed
(
o¡
->
Ï¡_nb0_äames
[0],

1112 
o¡
->
Ï¡_nb0_äames
[1],

1113 
o¡
->
Ï¡_nb0_äames
[2]);

1115 
d–0
 = 
sync_ts
 - 
o¡
->
sync_İts
;

1116 
d–
 = 
d–0
 + 
du¿tiÚ
;

1119 
nb0_äames
 = 0;

1120 
nb_äames
 = 1;

1122 
fÜm©_video_sync
 = 
video_sync_m‘hod
;

1123 ià(
fÜm©_video_sync
 =ğ
VSYNC_AUTO
) {

1124 if(!
	`¡rcmp
(
of
->
ùx
->
ofÜm©
->
Çme
, "avi")) {

1125 
fÜm©_video_sync
 = 
VSYNC_VFR
;

1127 
fÜm©_video_sync
 = (
of
->
ùx
->
ofÜm©
->
æags
 & 
AVFMT_VARIABLE_FPS
è? ((of->ùx->ofÜm©->æag & 
AVFMT_NOTIMESTAMPS
è? 
VSYNC_PASSTHROUGH
 : 
VSYNC_VFR
è: 
VSYNC_CFR
;

1128 iàĞ
i¡


1129 && 
fÜm©_video_sync
 =ğ
VSYNC_CFR


1130 && 
šput_fes
[
i¡
->
fe_šdex
]->
ùx
->
nb_¡»ams
 == 1

1131 && 
šput_fes
[
i¡
->
fe_šdex
]->
šput_ts_off£t
 == 0) {

1132 
fÜm©_video_sync
 = 
VSYNC_VSCFR
;

1134 ià(
fÜm©_video_sync
 =ğ
VSYNC_CFR
 && 
cİy_ts
) {

1135 
fÜm©_video_sync
 = 
VSYNC_VSCFR
;

1138 
o¡
->
is_cä
 = (
fÜm©_video_sync
 =ğ
VSYNC_CFR
 || fÜm©_video_synø=ğ
VSYNC_VSCFR
);

1140 ià(
d–0
 < 0 &&

1141 
d–
 > 0 &&

1142 
fÜm©_video_sync
 !ğ
VSYNC_PASSTHROUGH
 &&

1143 
fÜm©_video_sync
 !ğ
VSYNC_DROP
) {

1144 ià(
d–0
 < -0.6) {

1145 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Pa¡ du¿tiÚ %àtoØÏrge\n", -
d–0
);

1147 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Clpšg f¿mš„©cÚv”siÚ by %f\n", -
d–0
);

1148 
sync_ts
 = 
o¡
->
sync_İts
;

1149 
du¿tiÚ
 +ğ
d–0
;

1150 
d–0
 = 0;

1153 
fÜm©_video_sync
) {

1154 
VSYNC_VSCFR
:

1155 ià(
o¡
->
äame_numb”
 =ğ0 && 
d–0
 >= 0.5) {

1156 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "NÙ du¶iÿtšg %d in™ŸÈäames\n", ()
	`Ìštf
(
d–0
));

1157 
d–
 = 
du¿tiÚ
;

1158 
d–0
 = 0;

1159 
o¡
->
sync_İts
 = 
	`Ìšt
(
sync_ts
);

1161 
VSYNC_CFR
:

1163 ià(
äame_drİ_th»shŞd
 && 
d–
 < f¿me_drİ_th»shŞd && 
o¡
->
äame_numb”
) {

1164 
nb_äames
 = 0;

1165 } ià(
d–
 < -1.1)

1166 
nb_äames
 = 0;

1167 ià(
d–
 > 1.1) {

1168 
nb_äames
 = 
	`Ìštf
(
d–
);

1169 ià(
d–0
 > 1.1)

1170 
nb0_äames
 = 
	`Ìštf
(
d–0
 - 0.6);

1173 
VSYNC_VFR
:

1174 ià(
d–
 <= -0.6)

1175 
nb_äames
 = 0;

1176 ià(
d–
 > 0.6)

1177 
o¡
->
sync_İts
 = 
	`Ìšt
(
sync_ts
);

1179 
VSYNC_DROP
:

1180 
VSYNC_PASSTHROUGH
:

1181 
o¡
->
sync_İts
 = 
	`Ìšt
(
sync_ts
);

1184 
	`av_as£¹0
(0);

1188 
nb_äames
 = 
	`FFMIN
Òb_äames, 
o¡
->
max_äames
 - o¡->
äame_numb”
);

1189 
nb0_äames
 = 
	`FFMIN
Òb0_äames, 
nb_äames
);

1191 
	`memmove
(
o¡
->
Ï¡_nb0_äames
 + 1,

1192 
o¡
->
Ï¡_nb0_äames
,

1193 (
o¡
->
Ï¡_nb0_äames
[0]è* (
	`FF_ARRAY_ELEMS
(ost->last_nb0_frames) - 1));

1194 
o¡
->
Ï¡_nb0_äames
[0] = 
nb0_äames
;

1196 ià(
nb0_äames
 =ğ0 && 
o¡
->
Ï¡_drİ³d
) {

1197 
nb_äames_drİ
++;

1198 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
,

1199 "*** drİpšg f¿m%d from sŒ—m %d‡ˆt %"
PRId64
"\n",

1200 
o¡
->
äame_numb”
, o¡->
¡
->
šdex
, o¡->
Ï¡_äame
->
±s
);

1202 ià(
nb_äames
 > (
nb0_äames
 && 
o¡
->
Ï¡_drİ³d
) + (nb_frames >‚b0_frames)) {

1203 ià(
nb_äames
 > 
dts_”rÜ_th»shŞd
 * 30) {

1204 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "%d f¿mdu¶iÿtiÚoØÏrge, skpšg\n", 
nb_äames
 - 1);

1205 
nb_äames_drİ
++;

1208 
nb_äames_dup
 +ğ
nb_äames
 - (
nb0_äames
 && 
o¡
->
Ï¡_drİ³d
) - (nb_frames >‚b0_frames);

1209 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "*** %d dup!\n", 
nb_äames
 - 1);

1210 ià(
nb_äames_dup
 > 
dup_w¬nšg
) {

1211 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "MÜthª %d f¿me du¶iÿ‹d\n", 
dup_w¬nšg
);

1212 
dup_w¬nšg
 *= 10;

1215 
o¡
->
Ï¡_drİ³d
 = 
nb_äames
 =ğ
nb0_äames
 && 
Ãxt_piùu»
;

1218 
i
 = 0; i < 
nb_äames
; i++) {

1219 
AVF¿me
 *
š_piùu»
;

1220 
	`av_š™_·ck‘
(&
pkt
);

1221 
pkt
.
d©a
 = 
NULL
;

1222 
pkt
.
size
 = 0;

1224 ià(
i
 < 
nb0_äames
 && 
o¡
->
Ï¡_äame
) {

1225 
š_piùu»
 = 
o¡
->
Ï¡_äame
;

1227 
š_piùu»
 = 
Ãxt_piùu»
;

1229 ià(!
š_piùu»
)

1232 
š_piùu»
->
±s
 = 
o¡
->
sync_İts
;

1235 ià(!
	`check_»cÜdšg_time
(
o¡
))

1237 ià(
o¡
->
äame_numb”
 >ğo¡->
max_äames
)

1241 #ià
FF_API_LAVF_FMT_RAWPICTURE


1242 ià(
of
->
ùx
->
ofÜm©
->
æags
 & 
AVFMT_RAWPICTURE
 &&

1243 
’c
->
codec
->
id
 =ğ
AV_CODEC_ID_RAWVIDEO
) {

1247 ià(
š_piùu»
->
š‹¾aûd_äame
)

1248 
mux_·r
->
f›ld_Üd”
 = 
š_piùu»
->
tİ_f›ld_fœ¡
 ? 
AV_FIELD_TB
:
AV_FIELD_BT
;

1250 
mux_·r
->
f›ld_Üd”
 = 
AV_FIELD_PROGRESSIVE
;

1251 
pkt
.
d©a
 = (
ušt8_t
 *)
š_piùu»
;

1252 
pkt
.
size
 = (
AVPiùu»
);

1253 
pkt
.
±s
 = 
	`av_»sÿË_q
(
š_piùu»
->±s, 
’c
->
time_ba£
, 
o¡
->
mux_timeba£
);

1254 
pkt
.
æags
 |ğ
AV_PKT_FLAG_KEY
;

1256 
	`ouut_·ck‘
(
of
, &
pkt
, 
o¡
);

1260 
fÜûd_keyäame
 = 0;

1261 
±s_time
;

1263 ià(
’c
->
æags
 & (
AV_CODEC_FLAG_INTERLACED_DCT
 | 
AV_CODEC_FLAG_INTERLACED_ME
) &&

1264 
o¡
->
tİ_f›ld_fœ¡
 >= 0)

1265 
š_piùu»
->
tİ_f›ld_fœ¡
 = !!
o¡
->top_field_first;

1267 ià(
š_piùu»
->
š‹¾aûd_äame
) {

1268 ià(
’c
->
codec
->
id
 =ğ
AV_CODEC_ID_MJPEG
)

1269 
mux_·r
->
f›ld_Üd”
 = 
š_piùu»
->
tİ_f›ld_fœ¡
 ? 
AV_FIELD_TT
:
AV_FIELD_BB
;

1271 
mux_·r
->
f›ld_Üd”
 = 
š_piùu»
->
tİ_f›ld_fœ¡
 ? 
AV_FIELD_TB
:
AV_FIELD_BT
;

1273 
mux_·r
->
f›ld_Üd”
 = 
AV_FIELD_PROGRESSIVE
;

1275 
š_piùu»
->
qu®™y
 = 
’c
->
glob®_qu®™y
;

1276 
š_piùu»
->
più_ty³
 = 0;

1278 
±s_time
 = 
š_piùu»
->
±s
 !ğ
AV_NOPTS_VALUE
 ?

1279 
š_piùu»
->
±s
 * 
	`av_q2d
(
’c
->
time_ba£
è: 
NAN
;

1280 ià(
o¡
->
fÜûd_kf_šdex
 < o¡->
fÜûd_kf_couÁ
 &&

1281 
š_piùu»
->
±s
 >ğ
o¡
->
fÜûd_kf_±s
[o¡->
fÜûd_kf_šdex
]) {

1282 
o¡
->
fÜûd_kf_šdex
++;

1283 
fÜûd_keyäame
 = 1;

1284 } ià(
o¡
->
fÜûd_keyäames_³x´
) {

1285 
»s
;

1286 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_T
] = 
±s_time
;

1287 
»s
 = 
	`av_ex´_ev®
(
o¡
->
fÜûd_keyäames_³x´
,

1288 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
, 
NULL
);

1289 
	`ff_dlog
(
NULL
, "force_key_frame:‚:%f‚_forced:%f…rev_forced_n:%f:%f…rev_forced_t:%f ->„es:%f\n",

1290 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N
],

1291 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N_FORCED
],

1292 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_N
],

1293 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_T
],

1294 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_T
],

1295 
»s
);

1296 ià(
»s
) {

1297 
fÜûd_keyäame
 = 1;

1298 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_N
] =

1299 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N
];

1300 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_T
] =

1301 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_T
];

1302 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N_FORCED
] += 1;

1305 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N
] += 1;

1306 } iàĞ
o¡
->
fÜûd_keyäames


1307 && !
	`¡ºcmp
(
o¡
->
fÜûd_keyäames
, "source", 6)

1308 && 
š_piùu»
->
key_äame
==1) {

1309 
fÜûd_keyäame
 = 1;

1312 ià(
fÜûd_keyäame
) {

1313 
š_piùu»
->
più_ty³
 = 
AV_PICTURE_TYPE_I
;

1314 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "FÜûd keyäam©im%f\n", 
±s_time
);

1317 
	`upd©e_b’chm¬k
(
NULL
);

1318 ià(
debug_ts
) {

1319 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "encoder <-ype:video "

1321 
	`av_ts2¡r
(
š_piùu»
->
±s
), 
	`av_ts2time¡r
(š_piùu»->±s, &
’c
->
time_ba£
),

1322 
’c
->
time_ba£
.
num
,ƒnc->time_ba£.
d’
);

1325 
o¡
->
äames_’coded
++;

1327 
»t
 = 
	`avcodec_£nd_äame
(
’c
, 
š_piùu»
);

1328 ià(
»t
 < 0)

1329 
”rÜ
;

1332 
»t
 = 
	`avcodec_»ûive_·ck‘
(
’c
, &
pkt
);

1333 
	`upd©e_b’chm¬k
("’code_videØ%d.%d", 
o¡
->
fe_šdex
, o¡->
šdex
);

1334 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
))

1336 ià(
»t
 < 0)

1337 
”rÜ
;

1339 ià(
debug_ts
) {

1340 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "encoder ->ype:video "

1342 
	`av_ts2¡r
(
pkt
.
±s
), 
	`av_ts2time¡r
Õkt.±s, &
’c
->
time_ba£
),

1343 
	`av_ts2¡r
(
pkt
.
dts
), 
	`av_ts2time¡r
Õkt.dts, &
’c
->
time_ba£
));

1346 ià(
pkt
.
±s
 =ğ
AV_NOPTS_VALUE
 && !(
’c
->
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_DELAY
))

1347 
pkt
.
±s
 = 
o¡
->
sync_İts
;

1349 
	`av_·ck‘_»sÿË_ts
(&
pkt
, 
’c
->
time_ba£
, 
o¡
->
mux_timeba£
);

1351 ià(
debug_ts
) {

1352 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "encoder ->ype:video "

1354 
	`av_ts2¡r
(
pkt
.
±s
), 
	`av_ts2time¡r
Õkt.±s, &
o¡
->
mux_timeba£
),

1355 
	`av_ts2¡r
(
pkt
.
dts
), 
	`av_ts2time¡r
Õkt.dts, &
o¡
->
mux_timeba£
));

1358 
äame_size
 = 
pkt
.
size
;

1359 
	`ouut_·ck‘
(
of
, &
pkt
, 
o¡
);

1362 ià(
o¡
->
logfe
 && 
’c
->
¡©s_out
) {

1363 
	`årštf
(
o¡
->
logfe
, "%s", 
’c
->
¡©s_out
);

1367 
o¡
->
sync_İts
++;

1373 
o¡
->
äame_numb”
++;

1375 ià(
v¡©s_f’ame
 && 
äame_size
)

1376 
	`do_video_¡©s
(
o¡
, 
äame_size
);

1379 ià(!
o¡
->
Ï¡_äame
)

1380 
o¡
->
Ï¡_äame
 = 
	`av_äame_®loc
();

1381 
	`av_äame_uÄef
(
o¡
->
Ï¡_äame
);

1382 ià(
Ãxt_piùu»
 && 
o¡
->
Ï¡_äame
)

1383 
	`av_äame_»f
(
o¡
->
Ï¡_äame
, 
Ãxt_piùu»
);

1385 
	`av_äame_ä“
(&
o¡
->
Ï¡_äame
);

1388 
”rÜ
:

1389 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Videoƒncoding failed\n");

1390 
	`ex™_´og¿m
(1);

1391 
	}
}

1393 
	$p¢r
(
d
)

1395  -10.0 * 
	`log10
(
d
);

1396 
	}
}

1398 
	$do_video_¡©s
(
OuutSŒ—m
 *
o¡
, 
äame_size
)

1400 
AVCodecCÚ‹xt
 *
’c
;

1401 
äame_numb”
;

1402 
ti1
, 
b™¿‹
, 
avg_b™¿‹
;

1405 ià(!
v¡©s_fe
) {

1406 
v¡©s_fe
 = 
	`fİ’
(
v¡©s_f’ame
, "w");

1407 ià(!
v¡©s_fe
) {

1408 
	`³¼Ü
("fopen");

1409 
	`ex™_´og¿m
(1);

1413 
’c
 = 
o¡
->
’c_ùx
;

1414 ià(
’c
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

1415 
äame_numb”
 = 
o¡
->
¡
->
nb_äames
;

1416 ià(
v¡©s_v”siÚ
 <= 1) {

1417 
	`årštf
(
v¡©s_fe
, "äameğ%5d qğ%2.1à", 
äame_numb”
,

1418 
o¡
->
qu®™y
 / ()
FF_QP2LAMBDA
);

1420 
	`årštf
(
v¡©s_fe
, "outğ%2d stğ%2d f¿meğ%5d qğ%2.1à", 
o¡
->
fe_šdex
, o¡->
šdex
, 
äame_numb”
,

1421 
o¡
->
qu®™y
 / ()
FF_QP2LAMBDA
);

1424 ià(
o¡
->
”rÜ
[0]>=0 && (
’c
->
æags
 & 
AV_CODEC_FLAG_PSNR
))

1425 
	`årštf
(
v¡©s_fe
, "PSNRğ%6.2à", 
	`p¢r
(
o¡
->
”rÜ
[0] / (
’c
->
width
 *ƒnc->
height
 * 255.0 * 255.0)));

1427 
	`årštf
(
v¡©s_fe
,"f_sizeğ%6d ", 
äame_size
);

1429 
ti1
 = 
	`av_¡»am_g‘_’d_±s
(
o¡
->
¡
è* 
	`av_q2d
(o¡->¡->
time_ba£
);

1430 ià(
ti1
 < 0.01)

1431 
ti1
 = 0.01;

1433 
b™¿‹
 = (
äame_size
 * 8è/ 
	`av_q2d
(
’c
->
time_ba£
) / 1000.0;

1434 
avg_b™¿‹
 = ()(
o¡
->
d©a_size
 * 8è/ 
ti1
 / 1000.0;

1435 
	`årštf
(
v¡©s_fe
, "s_size= %8.0fkBime= %0.3f br= %7.1fkbits/s‡vg_br= %7.1fkbits/s ",

1436 ()
o¡
->
d©a_size
 / 1024, 
ti1
, 
b™¿‹
, 
avg_b™¿‹
);

1437 
	`årštf
(
v¡©s_fe
, "ty³ğ%c\n", 
	`av_g‘_piùu»_ty³_ch¬
(
o¡
->
più_ty³
));

1439 
	}
}

1441 
š™_ouut_¡»am
(
OuutSŒ—m
 *
o¡
, *
”rÜ
, 
”rÜ_Ën
);

1443 
	$fšish_ouut_¡»am
(
OuutSŒ—m
 *
o¡
)

1445 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

1446 
i
;

1448 
o¡
->
fšished
 = 
ENCODER_FINISHED
 | 
MUXER_FINISHED
;

1450 ià(
of
->
shÜ‹¡
) {

1451 
i
 = 0; i < 
of
->
ùx
->
nb_¡»ams
; i++)

1452 
ouut_¡»ams
[
of
->
o¡_šdex
 + 
i
]->
fšished
 = 
ENCODER_FINISHED
 | 
MUXER_FINISHED
;

1454 
	}
}

1462 
	$»­_f‹rs
(
æush
)

1464 
AVF¿me
 *
f‹»d_äame
 = 
NULL
;

1465 
i
;

1468 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

1469 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

1470 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

1471 
AVF‹rCÚ‹xt
 *
f‹r
;

1472 
AVCodecCÚ‹xt
 *
’c
 = 
o¡
->
’c_ùx
;

1473 
»t
 = 0;

1475 ià(!
o¡
->
f‹r
 || !o¡->f‹r->
g¿ph
->graph)

1477 
f‹r
 = 
o¡
->filter->filter;

1479 ià(!
o¡
->
š™Ÿlized
) {

1480 
”rÜ
[1024] = "";

1481 
»t
 = 
	`š™_ouut_¡»am
(
o¡
, 
”rÜ
, (error));

1482 ià(
»t
 < 0) {

1483 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error initializing output stream %d:%d -- %s\n",

1484 
o¡
->
fe_šdex
, o¡->
šdex
, 
”rÜ
);

1485 
	`ex™_´og¿m
(1);

1489 ià(!
o¡
->
f‹»d_äame
 && !(o¡->f‹»d_äamğ
	`av_äame_®loc
())) {

1490  
	`AVERROR
(
ENOMEM
);

1492 
f‹»d_äame
 = 
o¡
->filtered_frame;

1495 
æßt_±s
 = 
AV_NOPTS_VALUE
;

1496 
»t
 = 
	`av_bufãrsšk_g‘_äame_æags
(
f‹r
, 
f‹»d_äame
,

1497 
AV_BUFFERSINK_FLAG_NO_REQUEST
);

1498 ià(
»t
 < 0) {

1499 ià(
»t
 !ğ
	`AVERROR
(
EAGAIN
è&&„‘ !ğ
AVERROR_EOF
) {

1500 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

1501 "E¼Ü iÀav_bufãrsšk_g‘_äame_æags(): %s\n", 
	`av_”r2¡r
(
»t
));

1502 } ià(
æush
 && 
»t
 =ğ
AVERROR_EOF
) {

1503 ià(
	`av_bufãrsšk_g‘_ty³
(
f‹r
è=ğ
AVMEDIA_TYPE_VIDEO
)

1504 
	`do_video_out
(
of
, 
o¡
, 
NULL
, 
AV_NOPTS_VALUE
);

1508 ià(
o¡
->
fšished
) {

1509 
	`av_äame_uÄef
(
f‹»d_äame
);

1512 ià(
f‹»d_äame
->
±s
 !ğ
AV_NOPTS_VALUE
) {

1513 
št64_t
 
¡¬t_time
 = (
of
->¡¬t_tim=ğ
AV_NOPTS_VALUE
) ? 0 : of->start_time;

1514 
AVR©iÚ®
 
f‹r_tb
 = 
	`av_bufãrsšk_g‘_time_ba£
(
f‹r
);

1515 
AVR©iÚ®
 
tb
 = 
’c
->
time_ba£
;

1516 
exŒa_b™s
 = 
	`av_ş
(29 - 
	`av_log2
(
tb
.
d’
), 0, 16);

1518 
tb
.
d’
 <<ğ
exŒa_b™s
;

1519 
æßt_±s
 =

1520 
	`av_»sÿË_q
(
f‹»d_äame
->
±s
, 
f‹r_tb
, 
tb
) -

1521 
	`av_»sÿË_q
(
¡¬t_time
, 
AV_TIME_BASE_Q
, 
tb
);

1522 
æßt_±s
 /ğ1 << 
exŒa_b™s
;

1524 
æßt_±s
 +ğ
	`FFSIGN
(float_pts) * 1.0 / (1<<17);

1526 
f‹»d_äame
->
±s
 =

1527 
	`av_»sÿË_q
(
f‹»d_äame
->
±s
, 
f‹r_tb
, 
’c
->
time_ba£
) -

1528 
	`av_»sÿË_q
(
¡¬t_time
, 
AV_TIME_BASE_Q
, 
’c
->
time_ba£
);

1533 
	`av_bufãrsšk_g‘_ty³
(
f‹r
)) {

1534 
AVMEDIA_TYPE_VIDEO
:

1535 ià(!
o¡
->
äame_a¥eù_¿tio
.
num
)

1536 
’c
->
§m¶e_a¥eù_¿tio
 = 
f‹»d_äame
->sample_aspect_ratio;

1538 ià(
debug_ts
) {

1539 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "filter ->…ts:%s…ts_time:%sƒxact:%fime_base:%d/%d\n",

1540 
	`av_ts2¡r
(
f‹»d_äame
->
±s
), 
	`av_ts2time¡r
(f‹»d_äame->±s, &
’c
->
time_ba£
),

1541 
æßt_±s
,

1542 
’c
->
time_ba£
.
num
,ƒnc->time_ba£.
d’
);

1545 
	`do_video_out
(
of
, 
o¡
, 
f‹»d_äame
, 
æßt_±s
);

1547 
AVMEDIA_TYPE_AUDIO
:

1548 ià(!(
’c
->
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_PARAM_CHANGE
) &&

1549 
’c
->
chªÃls
 !ğ
	`av_äame_g‘_chªÃls
(
f‹»d_äame
)) {

1550 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

1554 
	`do_audio_out
(
of
, 
o¡
, 
f‹»d_äame
);

1558 
	`av_as£¹0
(0);

1561 
	`av_äame_uÄef
(
f‹»d_äame
);

1566 
	}
}

1568 
	$´št_fš®_¡©s
(
št64_t
 
tÙ®_size
)

1570 
ušt64_t
 
video_size
 = 0, 
audio_size
 = 0, 
exŒa_size
 = 0, 
Ùh”_size
 = 0;

1571 
ušt64_t
 
subt™Ë_size
 = 0;

1572 
ušt64_t
 
d©a_size
 = 0;

1573 
³rûÁ
 = -1.0;

1574 
i
, 
j
;

1575 
·ss1_u£d
 = 1;

1577 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

1578 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

1579 
o¡
->
’c_ùx
->
codec_ty³
) {

1580 
AVMEDIA_TYPE_VIDEO
: 
video_size
 +ğ
o¡
->
d©a_size
; ;

1581 
AVMEDIA_TYPE_AUDIO
: 
audio_size
 +ğ
o¡
->
d©a_size
; ;

1582 
AVMEDIA_TYPE_SUBTITLE
: 
subt™Ë_size
 +ğ
o¡
->
d©a_size
; ;

1583 : 
Ùh”_size
 +ğ
o¡
->
d©a_size
; ;

1585 
exŒa_size
 +ğ
o¡
->
’c_ùx
->
exŒad©a_size
;

1586 
d©a_size
 +ğ
o¡
->data_size;

1587 iàĞ(
o¡
->
’c_ùx
->
æags
 & (
AV_CODEC_FLAG_PASS1
 | 
AV_CODEC_FLAG_PASS2
))

1588 !ğ
AV_CODEC_FLAG_PASS1
)

1589 
·ss1_u£d
 = 0;

1592 ià(
d©a_size
 && 
tÙ®_size
>0 &&otal_size >= data_size)

1593 
³rûÁ
 = 100.0 * (
tÙ®_size
 - 
d©a_size
) / data_size;

1595 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "video:%1.0fkB‡udio:%1.0fkB subtitle:%1.0fkB other streams:%1.0fkB global headers:%1.0fkB muxing overhead: ",

1596 
video_size
 / 1024.0,

1597 
audio_size
 / 1024.0,

1598 
subt™Ë_size
 / 1024.0,

1599 
Ùh”_size
 / 1024.0,

1600 
exŒa_size
 / 1024.0);

1601 ià(
³rûÁ
 >= 0.0)

1602 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "%f%%", 
³rûÁ
);

1604 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "unknown");

1605 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "\n");

1608 
i
 = 0; i < 
nb_šput_fes
; i++) {

1609 
IÅutFe
 *
f
 = 
šput_fes
[
i
];

1610 
ušt64_t
 
tÙ®_·ck‘s
 = 0, 
tÙ®_size
 = 0;

1612 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "Input file #%d (%s):\n",

1613 
i
, 
f
->
ùx
->
f’ame
);

1615 
j
 = 0; j < 
f
->
nb_¡»ams
; j++) {

1616 
IÅutSŒ—m
 *
i¡
 = 
šput_¡»ams
[
f
->
i¡_šdex
 + 
j
];

1617 
AVMedŸTy³
 
ty³
 = 
i¡
->
dec_ùx
->
codec_ty³
;

1619 
tÙ®_size
 +ğ
i¡
->
d©a_size
;

1620 
tÙ®_·ck‘s
 +ğ
i¡
->
nb_·ck‘s
;

1622 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " Input stream #%d:%d (%s): ",

1623 
i
, 
j
, 
	`medŸ_ty³_¡ršg
(
ty³
));

1624 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "%"
PRIu64
"…ackets„ead (%"PRIu64" bytes); ",

1625 
i¡
->
nb_·ck‘s
, i¡->
d©a_size
);

1627 ià(
i¡
->
decodšg_Ãeded
) {

1628 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "%"
PRIu64
" frames decoded",

1629 
i¡
->
äames_decoded
);

1630 ià(
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
)

1631 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " (%"
PRIu64
" sam¶es)", 
i¡
->
§m¶es_decoded
);

1632 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "; ");

1635 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "\n");

1638 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " TÙ®: %"
PRIu64
"…ackets (%"PRIu64" bytes) demuxed\n",

1639 
tÙ®_·ck‘s
, 
tÙ®_size
);

1642 
i
 = 0; i < 
nb_ouut_fes
; i++) {

1643 
OuutFe
 *
of
 = 
ouut_fes
[
i
];

1644 
ušt64_t
 
tÙ®_·ck‘s
 = 0, 
tÙ®_size
 = 0;

1646 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "Output file #%d (%s):\n",

1647 
i
, 
of
->
ùx
->
f’ame
);

1649 
j
 = 0; j < 
of
->
ùx
->
nb_¡»ams
; j++) {

1650 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
of
->
o¡_šdex
 + 
j
];

1651 
AVMedŸTy³
 
ty³
 = 
o¡
->
’c_ùx
->
codec_ty³
;

1653 
tÙ®_size
 +ğ
o¡
->
d©a_size
;

1654 
tÙ®_·ck‘s
 +ğ
o¡
->
·ck‘s_wr™‹n
;

1656 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " Output stream #%d:%d (%s): ",

1657 
i
, 
j
, 
	`medŸ_ty³_¡ršg
(
ty³
));

1658 ià(
o¡
->
’codšg_Ãeded
) {

1659 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "%"
PRIu64
" framesƒncoded",

1660 
o¡
->
äames_’coded
);

1661 ià(
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
)

1662 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " (%"
PRIu64
" sam¶es)", 
o¡
->
§m¶es_’coded
);

1663 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "; ");

1666 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "%"
PRIu64
"…ackets muxed (%"PRIu64" bytes); ",

1667 
o¡
->
·ck‘s_wr™‹n
, o¡->
d©a_size
);

1669 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "\n");

1672 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, " TÙ®: %"
PRIu64
"…ackets (%"PRIu64" bytes) muxed\n",

1673 
tÙ®_·ck‘s
, 
tÙ®_size
);

1675 if(
video_size
 + 
d©a_size
 + 
audio_size
 + 
subt™Ë_size
 + 
exŒa_size
 == 0){

1676 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Output file isƒmpty,‚othing wasƒncoded ");

1677 ià(
·ss1_u£d
) {

1678 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "\n");

1680 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "(check -ss / -t / -frames…arameters if used)\n");

1683 
	}
}

1685 
	$´št_»pÜt
(
is_Ï¡_»pÜt
, 
št64_t
 
tim”_¡¬t
, iÁ64_ˆ
cur_time
)

1687 
buf
[1024];

1688 
AVBPršt
 
buf_süt
;

1689 
OuutSŒ—m
 *
o¡
;

1690 
AVFÜm©CÚ‹xt
 *
oc
;

1691 
št64_t
 
tÙ®_size
;

1692 
AVCodecCÚ‹xt
 *
’c
;

1693 
äame_numb”
, 
vid
, 
i
;

1694 
b™¿‹
;

1695 
¥“d
;

1696 
št64_t
 
±s
 = 
INT64_MIN
 + 1;

1697 
št64_t
 
Ï¡_time
 = -1;

1698 
qp_hi¡og¿m
[52];

1699 
hours
, 
mšs
, 
£cs
, 
us
;

1700 
»t
;

1701 
t
;

1703 ià(!
´št_¡©s
 && !
is_Ï¡_»pÜt
 && !
´og»ss_avio
)

1706 ià(!
is_Ï¡_»pÜt
) {

1707 ià(
Ï¡_time
 == -1) {

1708 
Ï¡_time
 = 
cur_time
;

1711 ià((
cur_time
 - 
Ï¡_time
) < 500000)

1713 
Ï¡_time
 = 
cur_time
;

1716 
t
 = (
cur_time
-
tim”_¡¬t
) / 1000000.0;

1719 
oc
 = 
ouut_fes
[0]->
ùx
;

1721 
tÙ®_size
 = 
	`avio_size
(
oc
->
pb
);

1722 ià(
tÙ®_size
 <= 0)

1723 
tÙ®_size
 = 
	`avio_‹Î
(
oc
->
pb
);

1725 
buf
[0] = '\0';

1726 
vid
 = 0;

1727 
	`av_b´št_š™
(&
buf_süt
, 0, 1);

1728 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

1729 
q
 = -1;

1730 
o¡
 = 
ouut_¡»ams
[
i
];

1731 
’c
 = 
o¡
->
’c_ùx
;

1732 ià(!
o¡
->
¡»am_cİy
)

1733 
q
 = 
o¡
->
qu®™y
 / (è
FF_QP2LAMBDA
;

1735 ià(
vid
 && 
’c
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

1736 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf), "q=%2.1à", 
q
);

1737 
	`av_b´štf
(&
buf_süt
, "stream_%d_%d_q=%.1f\n",

1738 
o¡
->
fe_šdex
, o¡->
šdex
, 
q
);

1740 ià(!
vid
 && 
’c
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

1741 
ås
;

1743 
äame_numb”
 = 
o¡
->frame_number;

1744 
ås
 = 
t
 > 1 ? 
äame_numb”
 / : 0;

1745 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf), "frame=%5d fps=%3.*f q=%3.1f ",

1746 
äame_numb”
, 
ås
 < 9.95, fps, 
q
);

1747 
	`av_b´štf
(&
buf_süt
, "äame=%d\n", 
äame_numb”
);

1748 
	`av_b´štf
(&
buf_süt
, "ås=%.1f\n", 
ås
);

1749 
	`av_b´štf
(&
buf_süt
, "stream_%d_%d_q=%.1f\n",

1750 
o¡
->
fe_šdex
, o¡->
šdex
, 
q
);

1751 ià(
is_Ï¡_»pÜt
)

1752 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf), "L");

1753 ià(
qp_hi¡
) {

1754 
j
;

1755 
qp
 = 
	`Ìštf
(
q
);

1756 ià(
qp
 >ğ0 && q°< 
	`FF_ARRAY_ELEMS
(
qp_hi¡og¿m
))

1757 
qp_hi¡og¿m
[
qp
]++;

1758 
j
 = 0; j < 32; j++)

1759 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf), "%X", 
	`av_log2
(
qp_hi¡og¿m
[
j
] + 1));

1762 ià((
’c
->
æags
 & 
AV_CODEC_FLAG_PSNR
è&& (
o¡
->
più_ty³
 !ğ
AV_PICTURE_TYPE_NONE
 || 
is_Ï¡_»pÜt
)) {

1763 
j
;

1764 
”rÜ
, 
”rÜ_sum
 = 0;

1765 
sÿË
, 
sÿË_sum
 = 0;

1766 
p
;

1767 
ty³
[3] = { 'Y','U','V' };

1768 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf), "PSNR=");

1769 
j
 = 0; j < 3; j++) {

1770 ià(
is_Ï¡_»pÜt
) {

1771 
”rÜ
 = 
’c
->”rÜ[
j
];

1772 
sÿË
 = 
’c
->
width
 *ƒnc->
height
 * 255.0 * 255.0 * 
äame_numb”
;

1774 
”rÜ
 = 
o¡
->”rÜ[
j
];

1775 
sÿË
 = 
’c
->
width
 *ƒnc->
height
 * 255.0 * 255.0;

1777 ià(
j
)

1778 
sÿË
 /= 4;

1779 
”rÜ_sum
 +ğ
”rÜ
;

1780 
sÿË_sum
 +ğ
sÿË
;

1781 
p
 = 
	`p¢r
(
”rÜ
 / 
sÿË
);

1782 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf), "%c:%2.2à", 
ty³
[
j
], 
p
);

1783 
	`av_b´štf
(&
buf_süt
, "stream_%d_%d_psnr_%c=%2.2f\n",

1784 
o¡
->
fe_šdex
, o¡->
šdex
, 
ty³
[
j
] | 32, 
p
);

1786 
p
 = 
	`p¢r
(
”rÜ_sum
 / 
sÿË_sum
);

1787 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf), "*:%2.2à", 
	`p¢r
(
”rÜ_sum
 / 
sÿË_sum
));

1788 
	`av_b´štf
(&
buf_süt
, "stream_%d_%d_psnr_all=%2.2f\n",

1789 
o¡
->
fe_šdex
, o¡->
šdex
, 
p
);

1791 
vid
 = 1;

1794 ià(
	`av_¡»am_g‘_’d_±s
(
o¡
->
¡
è!ğ
AV_NOPTS_VALUE
)

1795 
±s
 = 
	`FFMAX
Õts, 
	`av_»sÿË_q
(
	`av_¡»am_g‘_’d_±s
(
o¡
->
¡
),

1796 
o¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
));

1797 ià(
is_Ï¡_»pÜt
)

1798 
nb_äames_drİ
 +ğ
o¡
->
Ï¡_drİ³d
;

1801 
£cs
 = 
	`FFABS
(
±s
è/ 
AV_TIME_BASE
;

1802 
us
 = 
	`FFABS
(
±s
è% 
AV_TIME_BASE
;

1803 
mšs
 = 
£cs
 / 60;

1804 
£cs
 %= 60;

1805 
hours
 = 
mšs
 / 60;

1806 
mšs
 %= 60;

1808 
b™¿‹
 = 
±s
 && 
tÙ®_size
 >= 0 ?otal_size * 8 / (pts / 1000.0) : -1;

1809 
¥“d
 = 
t
 !ğ0.0 ? ()
±s
 / 
AV_TIME_BASE
 / : -1;

1811 ià(
tÙ®_size
 < 0è
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf),

1813 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf),

1814 "size=%8.0fkBime=", 
tÙ®_size
 / 1024.0);

1815 ià(
±s
 < 0)

1816 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf), "-");

1817 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf),

1818 "%02d:%02d:%02d.%02d ", 
hours
, 
mšs
, 
£cs
,

1819 (100 * 
us
è/ 
AV_TIME_BASE
);

1821 ià(
b™¿‹
 < 0) {

1822 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf),"bitrate=N/A");

1823 
	`av_b´štf
(&
buf_süt
, "bitrate=N/A\n");

1825 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf),"b™¿‹=%6.1fkb™s/s", 
b™¿‹
);

1826 
	`av_b´štf
(&
buf_süt
, "b™¿‹=%6.1fkb™s/s\n", 
b™¿‹
);

1829 ià(
tÙ®_size
 < 0è
	`av_b´štf
(&
buf_süt
, "total_size=N/A\n");

1830 
	`av_b´štf
(&
buf_süt
, "tÙ®_size=%"
PRId64
"\n", 
tÙ®_size
);

1831 
	`av_b´štf
(&
buf_süt
, "out_time_ms=%"
PRId64
"\n", 
±s
);

1832 
	`av_b´štf
(&
buf_süt
, "out_time=%02d:%02d:%02d.%06d\n",

1833 
hours
, 
mšs
, 
£cs
, 
us
);

1835 ià(
nb_äames_dup
 || 
nb_äames_drİ
)

1836 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf), " dup=%d drop=%d",

1837 
nb_äames_dup
, 
nb_äames_drİ
);

1838 
	`av_b´štf
(&
buf_süt
, "dup_äames=%d\n", 
nb_äames_dup
);

1839 
	`av_b´štf
(&
buf_süt
, "drİ_äames=%d\n", 
nb_äames_drİ
);

1841 ià(
¥“d
 < 0) {

1842 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (buf) - strlen(buf)," speed=N/A");

1843 
	`av_b´štf
(&
buf_süt
, "speed=N/A\n");

1845 
	`¢´štf
(
buf
 + 
	`¡¾’
(buf), (bufè- sŒËn(buf)," s³ed=%4.3gx", 
¥“d
);

1846 
	`av_b´štf
(&
buf_süt
, "¥“d=%4.3gx\n", 
¥“d
);

1849 ià(
´št_¡©s
 || 
is_Ï¡_»pÜt
) {

1850 cÚ¡ 
’d
 = 
is_Ï¡_»pÜt
 ? '\n' : '\r';

1851 ià(
´št_¡©s
==1 && 
AV_LOG_INFO
 > 
	`av_log_g‘_Ëv–
()) {

1852 
	`årštf
(
¡d”r
, "%  %c", 
buf
, 
’d
);

1854 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "%  %c", 
buf
, 
’d
);

1856 
	`fæush
(
¡d”r
);

1859 ià(
´og»ss_avio
) {

1860 
	`av_b´štf
(&
buf_süt
, "progress=%s\n",

1861 
is_Ï¡_»pÜt
 ? "end" : "continue");

1862 
	`avio_wr™e
(
´og»ss_avio
, 
buf_süt
.
¡r
,

1863 
	`FFMIN
(
buf_süt
.
Ën
, buf_süt.
size
 - 1));

1864 
	`avio_æush
(
´og»ss_avio
);

1865 
	`av_b´št_fš®ize
(&
buf_süt
, 
NULL
);

1866 ià(
is_Ï¡_»pÜt
) {

1867 ià((
»t
 = 
	`avio_şo£p
(&
´og»ss_avio
)) < 0)

1868 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

1869 "E¼Ü closšg…rog»s log,†os oàšfÜm©iÚ…ossibË: %s\n", 
	`av_”r2¡r
(
»t
));

1873 ià(
is_Ï¡_»pÜt
)

1874 
	`´št_fš®_¡©s
(
tÙ®_size
);

1875 
	}
}

1877 
	$æush_’cod”s
()

1879 
i
, 
»t
;

1881 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

1882 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

1883 
AVCodecCÚ‹xt
 *
’c
 = 
o¡
->
’c_ùx
;

1884 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

1886 ià(!
o¡
->
’codšg_Ãeded
)

1891 ià(!
o¡
->
š™Ÿlized
) {

1892 
F‹rG¿ph
 *
fg
 = 
o¡
->
f‹r
->
g¿ph
;

1893 
”rÜ
[1024] = "";

1895 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

1897 
o¡
->
fe_šdex
, o¡->
¡
->
šdex
);

1899 ià(
o¡
->
f‹r
 && !
fg
->
g¿ph
) {

1900 
x
;

1901 
x
 = 0; x < 
fg
->
nb_šputs
; x++) {

1902 
IÅutF‹r
 *
if‹r
 = 
fg
->
šputs
[
x
];

1903 ià(
if‹r
->
fÜm©
 < 0) {

1904 
AVCodecP¬am‘”s
 *
·r
 = 
if‹r
->
i¡
->
¡
->
codeı¬
;

1907 
if‹r
->
fÜm©
 = 
·r
->format;

1908 
if‹r
->
§m¶e_¿‹
 = 
·r
->sample_rate;

1909 
if‹r
->
chªÃls
 = 
·r
->channels;

1910 
if‹r
->
chªÃl_Ïyout
 = 
·r
->channel_layout;

1911 
if‹r
->
width
 = 
·r
->width;

1912 
if‹r
->
height
 = 
·r
->height;

1913 
if‹r
->
§m¶e_a¥eù_¿tio
 = 
·r
->sample_aspect_ratio;

1917 ià(!
	`if‹r_has_®l_šput_fÜm©s
(
fg
))

1920 
»t
 = 
	`cÚfigu»_f‹rg¿ph
(
fg
);

1921 ià(
»t
 < 0) {

1922 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error configuring filter graph\n");

1923 
	`ex™_´og¿m
(1);

1926 
	`fšish_ouut_¡»am
(
o¡
);

1929 
»t
 = 
	`š™_ouut_¡»am
(
o¡
, 
”rÜ
, (error));

1930 ià(
»t
 < 0) {

1931 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error initializing output stream %d:%d -- %s\n",

1932 
o¡
->
fe_šdex
, o¡->
šdex
, 
”rÜ
);

1933 
	`ex™_´og¿m
(1);

1937 ià(
’c
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 &&ƒnc->
äame_size
 <= 1)

1939 #ià
FF_API_LAVF_FMT_RAWPICTURE


1940 ià(
’c
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 && (
of
->
ùx
->
ofÜm©
->
æags
 & 
AVFMT_RAWPICTURE
è&&ƒnc->
codec
->
id
 =ğ
AV_CODEC_ID_RAWVIDEO
)

1944 ià(
’c
->
codec_ty³
 !ğ
AVMEDIA_TYPE_VIDEO
 &&ƒnc->codec_ty³ !ğ
AVMEDIA_TYPE_AUDIO
)

1948 cÚ¡ *
desc
 = 
NULL
;

1949 
AVPack‘
 
pkt
;

1950 
pkt_size
;

1952 
’c
->
codec_ty³
) {

1953 
AVMEDIA_TYPE_AUDIO
:

1954 
desc
 = "audio";

1956 
AVMEDIA_TYPE_VIDEO
:

1957 
desc
 = "video";

1960 
	`av_as£¹0
(0);

1963 
	`av_š™_·ck‘
(&
pkt
);

1964 
pkt
.
d©a
 = 
NULL
;

1965 
pkt
.
size
 = 0;

1967 
	`upd©e_b’chm¬k
(
NULL
);

1969 (
»t
 = 
	`avcodec_»ûive_·ck‘
(
’c
, &
pkt
)è=ğ
	`AVERROR
(
EAGAIN
)) {

1970 
»t
 = 
	`avcodec_£nd_äame
(
’c
, 
NULL
);

1971 ià(
»t
 < 0) {

1972 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%sƒncoding failed: %s\n",

1973 
desc
,

1974 
	`av_”r2¡r
(
»t
));

1975 
	`ex™_´og¿m
(1);

1979 
	`upd©e_b’chm¬k
("æush_% %d.%d", 
desc
, 
o¡
->
fe_šdex
, o¡->
šdex
);

1980 ià(
»t
 < 0 &&„‘ !ğ
AVERROR_EOF
) {

1981 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%sƒncoding failed: %s\n",

1982 
desc
,

1983 
	`av_”r2¡r
(
»t
));

1984 
	`ex™_´og¿m
(1);

1986 ià(
o¡
->
logfe
 && 
’c
->
¡©s_out
) {

1987 
	`årštf
(
o¡
->
logfe
, "%s", 
’c
->
¡©s_out
);

1989 ià(
»t
 =ğ
AVERROR_EOF
) {

1992 ià(
o¡
->
fšished
 & 
MUXER_FINISHED
) {

1993 
	`av_·ck‘_uÄef
(&
pkt
);

1996 
	`av_·ck‘_»sÿË_ts
(&
pkt
, 
’c
->
time_ba£
, 
o¡
->
mux_timeba£
);

1997 
pkt_size
 = 
pkt
.
size
;

1998 
	`ouut_·ck‘
(
of
, &
pkt
, 
o¡
);

1999 ià(
o¡
->
’c_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 && 
v¡©s_f’ame
) {

2000 
	`do_video_¡©s
(
o¡
, 
pkt_size
);

2004 
	}
}

2009 
	$check_ouut_cÚ¡¿šts
(
IÅutSŒ—m
 *
i¡
, 
OuutSŒ—m
 *
o¡
)

2011 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

2012 
i¡_šdex
 = 
šput_fes
[
i¡
->
fe_šdex
]->i¡_šdex + i¡->
¡
->
šdex
;

2014 ià(
o¡
->
sourû_šdex
 !ğ
i¡_šdex
)

2017 ià(
o¡
->
fšished
)

2020 ià(
of
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 && 
i¡
->
±s
 < of->start_time)

2024 
	}
}

2026 
	$do_¡»amcİy
(
IÅutSŒ—m
 *
i¡
, 
OuutSŒ—m
 *
o¡
, cÚ¡ 
AVPack‘
 *
pkt
)

2028 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

2029 
IÅutFe
 *
f
 = 
šput_fes
 [
i¡
->
fe_šdex
];

2030 
št64_t
 
¡¬t_time
 = (
of
->¡¬t_tim=ğ
AV_NOPTS_VALUE
) ? 0 : of->start_time;

2031 
št64_t
 
o¡_tb_¡¬t_time
 = 
	`av_»sÿË_q
(
¡¬t_time
, 
AV_TIME_BASE_Q
, 
o¡
->
mux_timeba£
);

2032 
AVPiùu»
 
più
;

2033 
AVPack‘
 
İkt
;

2035 
	`av_š™_·ck‘
(&
İkt
);

2037 ià((!
o¡
->
äame_numb”
 && !(
pkt
->
æags
 & 
AV_PKT_FLAG_KEY
)) &&

2038 !
o¡
->
cİy_š™Ÿl_nÚkeyäames
)

2041 ià(!
o¡
->
äame_numb”
 && !o¡->
cİy_´iÜ_¡¬t
) {

2042 
št64_t
 
comp_¡¬t
 = 
¡¬t_time
;

2043 ià(
cİy_ts
 && 
f
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

2044 
comp_¡¬t
 = 
	`FFMAX
(
¡¬t_time
, 
f
->¡¬t_tim+ f->
ts_off£t
);

2045 ià(
pkt
->
±s
 =ğ
AV_NOPTS_VALUE
 ?

2046 
i¡
->
±s
 < 
comp_¡¬t
 :

2047 
pkt
->
±s
 < 
	`av_»sÿË_q
(
comp_¡¬t
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
))

2051 ià(
of
->
»cÜdšg_time
 !ğ
INT64_MAX
 &&

2052 
i¡
->
±s
 >ğ
of
->
»cÜdšg_time
 + 
¡¬t_time
) {

2053 
	`şo£_ouut_¡»am
(
o¡
);

2057 ià(
f
->
»cÜdšg_time
 !ğ
INT64_MAX
) {

2058 
¡¬t_time
 = 
f
->
ùx
->start_time;

2059 ià(
f
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 && 
cİy_ts
)

2060 
¡¬t_time
 +ğ
f
->start_time;

2061 ià(
i¡
->
±s
 >ğ
f
->
»cÜdšg_time
 + 
¡¬t_time
) {

2062 
	`şo£_ouut_¡»am
(
o¡
);

2068 ià(
o¡
->
’c_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
)

2069 
o¡
->
sync_İts
++;

2071 ià(
pkt
->
±s
 !ğ
AV_NOPTS_VALUE
)

2072 
İkt
.
±s
 = 
	`av_»sÿË_q
(
pkt
->±s, 
i¡
->
¡
->
time_ba£
, 
o¡
->
mux_timeba£
è- 
o¡_tb_¡¬t_time
;

2074 
İkt
.
±s
 = 
AV_NOPTS_VALUE
;

2076 ià(
pkt
->
dts
 =ğ
AV_NOPTS_VALUE
)

2077 
İkt
.
dts
 = 
	`av_»sÿË_q
(
i¡
->dts, 
AV_TIME_BASE_Q
, 
o¡
->
mux_timeba£
);

2079 
İkt
.
dts
 = 
	`av_»sÿË_q
(
pkt
->dts, 
i¡
->
¡
->
time_ba£
, 
o¡
->
mux_timeba£
);

2080 
İkt
.
dts
 -ğ
o¡_tb_¡¬t_time
;

2082 ià(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 && 
pkt
->
dts
 !ğ
AV_NOPTS_VALUE
) {

2083 
du¿tiÚ
 = 
	`av_g‘_audio_äame_du¿tiÚ
(
i¡
->
dec_ùx
, 
pkt
->
size
);

2084 if(!
du¿tiÚ
)

2085 
du¿tiÚ
 = 
i¡
->
dec_ùx
->
äame_size
;

2086 
İkt
.
dts
 = opkt.
±s
 = 
	`av_»sÿË_d–
(
i¡
->
¡
->
time_ba£
, 
pkt
->dts,

2087 (
AVR©iÚ®
){1, 
i¡
->
dec_ùx
->
§m¶e_¿‹
}, 
du¿tiÚ
, &i¡->
f‹r_š_»sÿË_d–_Ï¡
,

2088 
o¡
->
mux_timeba£
è- 
o¡_tb_¡¬t_time
;

2091 
İkt
.
du¿tiÚ
 = 
	`av_»sÿË_q
(
pkt
->du¿tiÚ, 
i¡
->
¡
->
time_ba£
, 
o¡
->
mux_timeba£
);

2093 
İkt
.
æags
 = 
pkt
->flags;

2095 iàĞ
o¡
->
¡
->
codeı¬
->
codec_id
 !ğ
AV_CODEC_ID_H264


2096 && 
o¡
->
¡
->
codeı¬
->
codec_id
 !ğ
AV_CODEC_ID_MPEG1VIDEO


2097 && 
o¡
->
¡
->
codeı¬
->
codec_id
 !ğ
AV_CODEC_ID_MPEG2VIDEO


2098 && 
o¡
->
¡
->
codeı¬
->
codec_id
 !ğ
AV_CODEC_ID_VC1


2100 
»t
 = 
	`av_·r£r_chªge
(
o¡
->
·r£r
, o¡->
·r£r_avùx
,

2101 &
İkt
.
d©a
, &İkt.
size
,

2102 
pkt
->
d©a
,…kt->
size
,

2103 
pkt
->
æags
 & 
AV_PKT_FLAG_KEY
);

2104 ià(
»t
 < 0) {

2105 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "av_parser_change failed: %s\n",

2106 
	`av_”r2¡r
(
»t
));

2107 
	`ex™_´og¿m
(1);

2109 ià(
»t
) {

2110 
İkt
.
buf
 = 
	`av_bufãr_ü—‹
(İkt.
d©a
, opkt.
size
, 
av_bufãr_deçuÉ_ä“
, 
NULL
, 0);

2111 ià(!
İkt
.
buf
)

2112 
	`ex™_´og¿m
(1);

2115 
İkt
.
d©a
 = 
pkt
->data;

2116 
İkt
.
size
 = 
pkt
->size;

2118 
	`av_cİy_·ck‘_side_d©a
(&
İkt
, 
pkt
);

2120 #ià
FF_API_LAVF_FMT_RAWPICTURE


2121 ià(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 &&

2122 
o¡
->
¡
->
codeı¬
->
codec_id
 =ğ
AV_CODEC_ID_RAWVIDEO
 &&

2123 (
of
->
ùx
->
ofÜm©
->
æags
 & 
AVFMT_RAWPICTURE
)) {

2125 
»t
 = 
	`avpiùu»_fl
(&
più
, 
İkt
.
d©a
, 
o¡
->
¡
->
codeı¬
->
fÜm©
, o¡->¡->codeı¬->
width
, o¡->¡->codeı¬->
height
);

2126 ià(
»t
 < 0) {

2127 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "avpicture_fill failed: %s\n",

2128 
	`av_”r2¡r
(
»t
));

2129 
	`ex™_´og¿m
(1);

2131 
İkt
.
d©a
 = (
ušt8_t
 *)&
più
;

2132 
İkt
.
size
 = (
AVPiùu»
);

2133 
İkt
.
æags
 |ğ
AV_PKT_FLAG_KEY
;

2137 
	`ouut_·ck‘
(
of
, &
İkt
, 
o¡
);

2138 
	}
}

2140 
	$guess_šput_chªÃl_Ïyout
(
IÅutSŒ—m
 *
i¡
)

2142 
AVCodecCÚ‹xt
 *
dec
 = 
i¡
->
dec_ùx
;

2144 ià(!
dec
->
chªÃl_Ïyout
) {

2145 
Ïyout_Çme
[256];

2147 ià(
dec
->
chªÃls
 > 
i¡
->
guess_Ïyout_max
)

2149 
dec
->
chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(dec->
chªÃls
);

2150 ià(!
dec
->
chªÃl_Ïyout
)

2152 
	`av_g‘_chªÃl_Ïyout_¡ršg
(
Ïyout_Çme
, (layout_name),

2153 
dec
->
chªÃls
, dec->
chªÃl_Ïyout
);

2154 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Guessed Channel Layout for Input Stream "

2155 "#%d.%d : %s\n", 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
, 
Ïyout_Çme
);

2158 
	}
}

2160 
	$check_decode_»suÉ
(
IÅutSŒ—m
 *
i¡
, *
gÙ_ouut
, 
»t
)

2162 ià(*
gÙ_ouut
 || 
»t
<0)

2163 
decode_”rÜ_¡©
[
»t
<0] ++;

2165 ià(
»t
 < 0 && 
ex™_Ú_”rÜ
)

2166 
	`ex™_´og¿m
(1);

2168 ià(
ex™_Ú_”rÜ
 && *
gÙ_ouut
 && 
i¡
) {

2169 ià(
	`av_äame_g‘_decode_”rÜ_æags
(
i¡
->
decoded_äame
è|| (i¡->decoded_äame->
æags
 & 
AV_FRAME_FLAG_CORRUPT
)) {

2170 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s: cÜru± decoded f¿mš sŒ—m %d\n", 
šput_fes
[
i¡
->
fe_šdex
]->
ùx
->
f’ame
, i¡->
¡
->
šdex
);

2171 
	`ex™_´og¿m
(1);

2174 
	}
}

2177 
	$if‹r_has_®l_šput_fÜm©s
(
F‹rG¿ph
 *
fg
)

2179 
i
;

2180 
i
 = 0; i < 
fg
->
nb_šputs
; i++) {

2181 ià(
fg
->
šputs
[
i
]->
fÜm©
 < 0 && (fg->šputs[i]->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 ||

2182 
fg
->
šputs
[
i
]->
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
))

2186 
	}
}

2188 
	$if‹r_£nd_äame
(
IÅutF‹r
 *
if‹r
, 
AVF¿me
 *
äame
)

2190 
F‹rG¿ph
 *
fg
 = 
if‹r
->
g¿ph
;

2191 
Ãed_»š™
, 
»t
, 
i
;

2194 
Ãed_»š™
 = 
if‹r
->
fÜm©
 !ğ
äame
->format;

2195 ià(!!
if‹r
->
hw_äames_ùx
 !ğ!!
äame
->hw_frames_ctx ||

2196 (
if‹r
->
hw_äames_ùx
 && if‹r->hw_äames_ùx->
d©a
 !ğ
äame
->hw_frames_ctx->data))

2197 
Ãed_»š™
 = 1;

2199 
if‹r
->
i¡
->
¡
->
codeı¬
->
codec_ty³
) {

2200 
AVMEDIA_TYPE_AUDIO
:

2201 
Ãed_»š™
 |ğ
if‹r
->
§m¶e_¿‹
 !ğ
äame
->sample_rate ||

2202 
if‹r
->
chªÃls
 !ğ
äame
->channels ||

2203 
if‹r
->
chªÃl_Ïyout
 !ğ
äame
->channel_layout;

2205 
AVMEDIA_TYPE_VIDEO
:

2206 
Ãed_»š™
 |ğ
if‹r
->
width
 !ğ
äame
->width ||

2207 
if‹r
->
height
 !ğ
äame
->height;

2211 ià(
Ãed_»š™
) {

2212 
»t
 = 
	`if‹r_·¿m‘”s_äom_äame
(
if‹r
, 
äame
);

2213 ià(
»t
 < 0)

2214  
»t
;

2218 ià(
Ãed_»š™
 || !
fg
->
g¿ph
) {

2219 
i
 = 0; i < 
fg
->
nb_šputs
; i++) {

2220 ià(!
	`if‹r_has_®l_šput_fÜm©s
(
fg
)) {

2221 
AVF¿me
 *
tmp
 = 
	`av_äame_şÚe
(
äame
);

2222 ià(!
tmp
)

2223  
	`AVERROR
(
ENOMEM
);

2224 
	`av_äame_uÄef
(
äame
);

2226 ià(!
	`av_fifo_¥aû
(
if‹r
->
äame_queue
)) {

2227 
»t
 = 
	`av_fifo_»®loc2
(
if‹r
->
äame_queue
, 2 * 
	`av_fifo_size
(ifilter->frame_queue));

2228 ià(
»t
 < 0) {

2229 
	`av_äame_ä“
(&
tmp
);

2230  
»t
;

2233 
	`av_fifo_g’”ic_wr™e
(
if‹r
->
äame_queue
, &
tmp
, Ñmp), 
NULL
);

2238 
»t
 = 
	`»­_f‹rs
(1);

2239 ià(
»t
 < 0 &&„‘ !ğ
AVERROR_EOF
) {

2240 
”rbuf
[128];

2241 
	`av_¡»¼Ü
(
»t
, 
”rbuf
, (errbuf));

2243 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü whf‹ršg: %s\n", 
”rbuf
);

2244  
»t
;

2247 
»t
 = 
	`cÚfigu»_f‹rg¿ph
(
fg
);

2248 ià(
»t
 < 0) {

2249 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error„einitializing filters!\n");

2250  
»t
;

2254 
»t
 = 
	`av_bufãr¤c_add_äame_æags
(
if‹r
->
f‹r
, 
äame
, 
AV_BUFFERSRC_FLAG_PUSH
);

2255 ià(
»t
 < 0) {

2256 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error while filtering\n");

2257  
»t
;

2261 
	}
}

2263 
	$if‹r_£nd_eof
(
IÅutF‹r
 *
if‹r
)

2265 
i
, 
j
, 
»t
;

2267 
if‹r
->
eof
 = 1;

2269 ià(
if‹r
->
f‹r
) {

2270 
»t
 = 
	`av_bufãr¤c_add_äame_æags
(
if‹r
->
f‹r
, 
NULL
, 
AV_BUFFERSRC_FLAG_PUSH
);

2271 ià(
»t
 < 0)

2272  
»t
;

2275 
F‹rG¿ph
 *
fg
 = 
if‹r
->
g¿ph
;

2276 
i
 = 0; i < 
fg
->
nb_šputs
; i++)

2277 ià(!
fg
->
šputs
[
i
]->
eof
)

2279 ià(
i
 =ğ
fg
->
nb_šputs
) {

2283 
j
 = 0; j < 
fg
->
nb_ouuts
; j++)

2284 
	`fšish_ouut_¡»am
(
fg
->
ouuts
[
j
]->
o¡
);

2289 
	}
}

2295 
	$decode
(
AVCodecCÚ‹xt
 *
avùx
, 
AVF¿me
 *
äame
, *
gÙ_äame
, 
AVPack‘
 *
pkt
)

2297 
»t
;

2299 *
gÙ_äame
 = 0;

2301 ià(
pkt
) {

2302 
»t
 = 
	`avcodec_£nd_·ck‘
(
avùx
, 
pkt
);

2305 ià(
»t
 < 0 &&„‘ !ğ
AVERROR_EOF
)

2306  
»t
;

2309 
»t
 = 
	`avcodec_»ûive_äame
(
avùx
, 
äame
);

2310 ià(
»t
 < 0 &&„‘ !ğ
	`AVERROR
(
EAGAIN
))

2311  
»t
;

2312 ià(
»t
 >= 0)

2313 *
gÙ_äame
 = 1;

2316 
	}
}

2318 
	$£nd_äame_to_f‹rs
(
IÅutSŒ—m
 *
i¡
, 
AVF¿me
 *
decoded_äame
)

2320 
i
, 
»t
;

2321 
AVF¿me
 *
f
;

2323 
	`av_as£¹1
(
i¡
->
nb_f‹rs
 > 0);

2324 
i
 = 0; i < 
i¡
->
nb_f‹rs
; i++) {

2325 ià(
i
 < 
i¡
->
nb_f‹rs
 - 1) {

2326 
f
 = 
i¡
->
f‹r_äame
;

2327 
»t
 = 
	`av_äame_»f
(
f
, 
decoded_äame
);

2328 ià(
»t
 < 0)

2331 
f
 = 
decoded_äame
;

2332 
»t
 = 
	`if‹r_£nd_äame
(
i¡
->
f‹rs
[
i
], 
f
);

2333 ià(
»t
 =ğ
AVERROR_EOF
)

2334 
»t
 = 0;

2335 ià(
»t
 < 0) {

2336 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2337 "FaedØšjeù f¿mštØf‹¸ÃtwÜk: %s\n", 
	`av_”r2¡r
(
»t
));

2341  
»t
;

2342 
	}
}

2344 
	$decode_audio
(
IÅutSŒ—m
 *
i¡
, 
AVPack‘
 *
pkt
, *
gÙ_ouut
,

2345 *
decode_çed
)

2347 
AVF¿me
 *
decoded_äame
;

2348 
AVCodecCÚ‹xt
 *
avùx
 = 
i¡
->
dec_ùx
;

2349 
»t
, 
”r
 = 0;

2350 
AVR©iÚ®
 
decoded_äame_tb
;

2352 ià(!
i¡
->
decoded_äame
 && !(i¡->decoded_äamğ
	`av_äame_®loc
()))

2353  
	`AVERROR
(
ENOMEM
);

2354 ià(!
i¡
->
f‹r_äame
 && !(i¡->f‹r_äamğ
	`av_äame_®loc
()))

2355  
	`AVERROR
(
ENOMEM
);

2356 
decoded_äame
 = 
i¡
->decoded_frame;

2358 
	`upd©e_b’chm¬k
(
NULL
);

2359 
»t
 = 
	`decode
(
avùx
, 
decoded_äame
, 
gÙ_ouut
, 
pkt
);

2360 
	`upd©e_b’chm¬k
("decode_audiØ%d.%d", 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

2361 ià(
»t
 < 0)

2362 *
decode_çed
 = 1;

2364 ià(
»t
 >ğ0 && 
avùx
->
§m¶e_¿‹
 <= 0) {

2365 
	`av_log
(
avùx
, 
AV_LOG_ERROR
, "Sam¶¿‹ %d inv®id\n",‡vùx->
§m¶e_¿‹
);

2366 
»t
 = 
AVERROR_INVALIDDATA
;

2369 ià(
»t
 !ğ
AVERROR_EOF
)

2370 
	`check_decode_»suÉ
(
i¡
, 
gÙ_ouut
, 
»t
);

2372 ià(!*
gÙ_ouut
 || 
»t
 < 0)

2373  
»t
;

2375 
i¡
->
§m¶es_decoded
 +ğ
decoded_äame
->
nb_§m¶es
;

2376 
i¡
->
äames_decoded
++;

2381 
i¡
->
Ãxt_±s
 +ğ((
št64_t
)
AV_TIME_BASE
 * 
decoded_äame
->
nb_§m¶es
) /

2382 
avùx
->
§m¶e_¿‹
;

2383 
i¡
->
Ãxt_dts
 +ğ((
št64_t
)
AV_TIME_BASE
 * 
decoded_äame
->
nb_§m¶es
) /

2384 
avùx
->
§m¶e_¿‹
;

2387 ià(
decoded_äame
->
±s
 !ğ
AV_NOPTS_VALUE
) {

2388 
decoded_äame_tb
 = 
i¡
->
¡
->
time_ba£
;

2389 } ià(
pkt
 &&…kt->
±s
 !ğ
AV_NOPTS_VALUE
) {

2390 
decoded_äame
->
±s
 = 
pkt
->pts;

2391 
decoded_äame_tb
 = 
i¡
->
¡
->
time_ba£
;

2393 
decoded_äame
->
±s
 = 
i¡
->
dts
;

2394 
decoded_äame_tb
 = 
AV_TIME_BASE_Q
;

2396 ià(
decoded_äame
->
±s
 !ğ
AV_NOPTS_VALUE
)

2397 
decoded_äame
->
±s
 = 
	`av_»sÿË_d–
(
decoded_äame_tb
, decoded_frame->pts,

2398 (
AVR©iÚ®
){1, 
avùx
->
§m¶e_¿‹
}, 
decoded_äame
->
nb_§m¶es
, &
i¡
->
f‹r_š_»sÿË_d–_Ï¡
,

2399 (
AVR©iÚ®
){1, 
avùx
->
§m¶e_¿‹
});

2400 
i¡
->
nb_§m¶es
 = 
decoded_äame
->nb_samples;

2401 
”r
 = 
	`£nd_äame_to_f‹rs
(
i¡
, 
decoded_äame
);

2403 
	`av_äame_uÄef
(
i¡
->
f‹r_äame
);

2404 
	`av_äame_uÄef
(
decoded_äame
);

2405  
”r
 < 0 ?ƒ¼ : 
»t
;

2406 
	}
}

2408 
	$decode_video
(
IÅutSŒ—m
 *
i¡
, 
AVPack‘
 *
pkt
, *
gÙ_ouut
, 
eof
,

2409 *
decode_çed
)

2411 
AVF¿me
 *
decoded_äame
;

2412 
i
, 
»t
 = 0, 
”r
 = 0;

2413 
št64_t
 
be¡_effÜt_time¡amp
;

2414 
št64_t
 
dts
 = 
AV_NOPTS_VALUE
;

2415 
AVPack‘
 
avpkt
;

2420 ià(!
eof
 && 
pkt
 &&…kt->
size
 == 0)

2423 ià(!
i¡
->
decoded_äame
 && !(i¡->decoded_äamğ
	`av_äame_®loc
()))

2424  
	`AVERROR
(
ENOMEM
);

2425 ià(!
i¡
->
f‹r_äame
 && !(i¡->f‹r_äamğ
	`av_äame_®loc
()))

2426  
	`AVERROR
(
ENOMEM
);

2427 
decoded_äame
 = 
i¡
->decoded_frame;

2428 ià(
i¡
->
dts
 !ğ
AV_NOPTS_VALUE
)

2429 
dts
 = 
	`av_»sÿË_q
(
i¡
->dts, 
AV_TIME_BASE_Q
, i¡->
¡
->
time_ba£
);

2430 ià(
pkt
) {

2431 
avpkt
 = *
pkt
;

2432 
avpkt
.
dts
 = dts;

2437 ià(
eof
) {

2438 *
Ãw
 = 
	`av_»®loc_¬¿y
(
i¡
->
dts_bufãr
, i¡->
nb_dts_bufãr
 + 1, (ist->dts_buffer[0]));

2439 ià(!
Ãw
)

2440  
	`AVERROR
(
ENOMEM
);

2441 
i¡
->
dts_bufãr
 = 
Ãw
;

2442 
i¡
->
dts_bufãr
[i¡->
nb_dts_bufãr
++] = 
dts
;

2445 
	`upd©e_b’chm¬k
(
NULL
);

2446 
»t
 = 
	`decode
(
i¡
->
dec_ùx
, 
decoded_äame
, 
gÙ_ouut
, 
pkt
 ? &
avpkt
 : 
NULL
);

2447 
	`upd©e_b’chm¬k
("decode_videØ%d.%d", 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

2448 ià(
»t
 < 0)

2449 *
decode_çed
 = 1;

2453 ià(
i¡
->
¡
->
codeı¬
->
video_d–ay
 < i¡->
dec_ùx
->
has_b_äames
) {

2454 ià(
i¡
->
dec_ùx
->
codec_id
 =ğ
AV_CODEC_ID_H264
) {

2455 
i¡
->
¡
->
codeı¬
->
video_d–ay
 = i¡->
dec_ùx
->
has_b_äames
;

2457 
	`av_log
(
i¡
->
dec_ùx
, 
AV_LOG_WARNING
,

2462 
i¡
->
dec_ùx
->
has_b_äames
,

2463 
i¡
->
¡
->
codeı¬
->
video_d–ay
);

2466 ià(
»t
 !ğ
AVERROR_EOF
)

2467 
	`check_decode_»suÉ
(
i¡
, 
gÙ_ouut
, 
»t
);

2469 ià(*
gÙ_ouut
 && 
»t
 >= 0) {

2470 ià(
i¡
->
dec_ùx
->
width
 !ğ
decoded_äame
->width ||

2471 
i¡
->
dec_ùx
->
height
 !ğ
decoded_äame
->height ||

2472 
i¡
->
dec_ùx
->
pix_fmt
 !ğ
decoded_äame
->
fÜm©
) {

2473 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Frame…arameters mismatch context %d,%d,%d != %d,%d,%d\n",

2474 
decoded_äame
->
width
,

2475 
decoded_äame
->
height
,

2476 
decoded_äame
->
fÜm©
,

2477 
i¡
->
dec_ùx
->
width
,

2478 
i¡
->
dec_ùx
->
height
,

2479 
i¡
->
dec_ùx
->
pix_fmt
);

2483 ià(!*
gÙ_ouut
 || 
»t
 < 0)

2484  
»t
;

2486 if(
i¡
->
tİ_f›ld_fœ¡
>=0)

2487 
decoded_äame
->
tİ_f›ld_fœ¡
 = 
i¡
->top_field_first;

2489 
i¡
->
äames_decoded
++;

2491 ià(
i¡
->
hwacûl_»Œ›ve_d©a
 && 
decoded_äame
->
fÜm©
 =ği¡->
hwacûl_pix_fmt
) {

2492 
”r
 = 
i¡
->
	`hwacûl_»Œ›ve_d©a
(i¡->
dec_ùx
, 
decoded_äame
);

2493 ià(
”r
 < 0)

2494 
ç
;

2496 
i¡
->
hwacûl_»Œ›ved_pix_fmt
 = 
decoded_äame
->
fÜm©
;

2498 
be¡_effÜt_time¡amp
ğ
	`av_äame_g‘_be¡_effÜt_time¡amp
(
decoded_äame
);

2500 ià(
i¡
->
äam”©e
.
num
)

2501 
be¡_effÜt_time¡amp
 = 
i¡
->
cä_Ãxt_±s
++;

2503 ià(
eof
 && 
be¡_effÜt_time¡amp
 =ğ
AV_NOPTS_VALUE
 && 
i¡
->
nb_dts_bufãr
 > 0) {

2504 
be¡_effÜt_time¡amp
 = 
i¡
->
dts_bufãr
[0];

2506 
i
 = 0; i < 
i¡
->
nb_dts_bufãr
 - 1; i++)

2507 
i¡
->
dts_bufãr
[
i
] = ist->dts_buffer[i + 1];

2508 
i¡
->
nb_dts_bufãr
--;

2511 if(
be¡_effÜt_time¡amp
 !ğ
AV_NOPTS_VALUE
) {

2512 
št64_t
 
ts
 = 
	`av_»sÿË_q
(
decoded_äame
->
±s
 = 
be¡_effÜt_time¡amp
, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

2514 ià(
ts
 !ğ
AV_NOPTS_VALUE
)

2515 
i¡
->
Ãxt_±s
 = i¡->
±s
 = 
ts
;

2518 ià(
debug_ts
) {

2519 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "decoder -> ist_index:%dype:video "

2520 "äame_±s:% äame_±s_time:% be¡_effÜt_ts:%"
PRId64
" best_effort_ts_time:%s keyframe:%d frame_type:%dime_base:%d/%d\n",

2521 
i¡
->
¡
->
šdex
, 
	`av_ts2¡r
(
decoded_äame
->
±s
),

2522 
	`av_ts2time¡r
(
decoded_äame
->
±s
, &
i¡
->
¡
->
time_ba£
),

2523 
be¡_effÜt_time¡amp
,

2524 
	`av_ts2time¡r
(
be¡_effÜt_time¡amp
, &
i¡
->
¡
->
time_ba£
),

2525 
decoded_äame
->
key_äame
, decoded_äame->
più_ty³
,

2526 
i¡
->
¡
->
time_ba£
.
num
, i¡->¡->time_ba£.
d’
);

2529 ià(
i¡
->
¡
->
§m¶e_a¥eù_¿tio
.
num
)

2530 
decoded_äame
->
§m¶e_a¥eù_¿tio
 = 
i¡
->
¡
->sample_aspect_ratio;

2532 
”r
 = 
	`£nd_äame_to_f‹rs
(
i¡
, 
decoded_äame
);

2534 
ç
:

2535 
	`av_äame_uÄef
(
i¡
->
f‹r_äame
);

2536 
	`av_äame_uÄef
(
decoded_äame
);

2537  
”r
 < 0 ?ƒ¼ : 
»t
;

2538 
	}
}

2540 
	$Œªscode_subt™Ës
(
IÅutSŒ—m
 *
i¡
, 
AVPack‘
 *
pkt
, *
gÙ_ouut
,

2541 *
decode_çed
)

2543 
AVSubt™Ë
 
subt™Ë
;

2544 
ä“_sub
 = 1;

2545 
i
, 
»t
 = 
	`avcodec_decode_subt™Ë2
(
i¡
->
dec_ùx
,

2546 &
subt™Ë
, 
gÙ_ouut
, 
pkt
);

2548 
	`check_decode_»suÉ
(
NULL
, 
gÙ_ouut
, 
»t
);

2550 ià(
»t
 < 0 || !*
gÙ_ouut
) {

2551 *
decode_çed
 = 1;

2552 ià(!
pkt
->
size
)

2553 
	`sub2video_æush
(
i¡
);

2554  
»t
;

2557 ià(
i¡
->
fix_sub_du¿tiÚ
) {

2558 
’d
 = 1;

2559 ià(
i¡
->
´ev_sub
.
gÙ_ouut
) {

2560 
’d
 = 
	`av_»sÿË
(
subt™Ë
.
±s
 - 
i¡
->
´ev_sub
.subtitle.pts,

2561 1000, 
AV_TIME_BASE
);

2562 ià(
’d
 < 
i¡
->
´ev_sub
.
subt™Ë
.
’d_di¥Ïy_time
) {

2563 
	`av_log
(
i¡
->
dec_ùx
, 
AV_LOG_DEBUG
,

2564 "Subt™Ë du¿tiÚ„eduûd from %"
PRId32
"o %d%s\n",

2565 
i¡
->
´ev_sub
.
subt™Ë
.
’d_di¥Ïy_time
, 
’d
,

2566 
’d
 <= 0 ? ", dropping it" : "");

2567 
i¡
->
´ev_sub
.
subt™Ë
.
’d_di¥Ïy_time
 = 
’d
;

2570 
	`FFSWAP
(, *
gÙ_ouut
, 
i¡
->
´ev_sub
.got_output);

2571 
	`FFSWAP
(, 
»t
, 
i¡
->
´ev_sub
.ret);

2572 
	`FFSWAP
(
AVSubt™Ë
, 
subt™Ë
, 
i¡
->
´ev_sub
.subtitle);

2573 ià(
’d
 <= 0)

2574 
out
;

2577 ià(!*
gÙ_ouut
)

2578  
»t
;

2580 ià(
i¡
->
sub2video
.
äame
) {

2581 
	`sub2video_upd©e
(
i¡
, &
subt™Ë
);

2582 } ià(
i¡
->
nb_f‹rs
) {

2583 ià(!
i¡
->
sub2video
.
sub_queue
)

2584 
i¡
->
sub2video
.
sub_queue
 = 
	`av_fifo_®loc
(8 * (
AVSubt™Ë
));

2585 ià(!
i¡
->
sub2video
.
sub_queue
)

2586 
	`ex™_´og¿m
(1);

2587 ià(!
	`av_fifo_¥aû
(
i¡
->
sub2video
.
sub_queue
)) {

2588 
»t
 = 
	`av_fifo_»®loc2
(
i¡
->
sub2video
.
sub_queue
, 2 * 
	`av_fifo_size
(ist->sub2video.sub_queue));

2589 ià(
»t
 < 0)

2590 
	`ex™_´og¿m
(1);

2592 
	`av_fifo_g’”ic_wr™e
(
i¡
->
sub2video
.
sub_queue
, &
subt™Ë
, (subt™Ë), 
NULL
);

2593 
ä“_sub
 = 0;

2596 ià(!
subt™Ë
.
num_»ùs
)

2597 
out
;

2599 
i¡
->
äames_decoded
++;

2601 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

2602 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

2604 ià(!
	`check_ouut_cÚ¡¿šts
(
i¡
, 
o¡
è|| !o¡->
’codšg_Ãeded


2605 || 
o¡
->
’c
->
ty³
 !ğ
AVMEDIA_TYPE_SUBTITLE
)

2608 
	`do_subt™Ë_out
(
ouut_fes
[
o¡
->
fe_šdex
], o¡, &
subt™Ë
);

2611 
out
:

2612 ià(
ä“_sub
)

2613 
	`avsubt™Ë_ä“
(&
subt™Ë
);

2614  
»t
;

2615 
	}
}

2617 
	$£nd_f‹r_eof
(
IÅutSŒ—m
 *
i¡
)

2619 
i
, 
»t
;

2620 
i
 = 0; i < 
i¡
->
nb_f‹rs
; i++) {

2621 
»t
 = 
	`if‹r_£nd_eof
(
i¡
->
f‹rs
[
i
]);

2622 ià(
»t
 < 0)

2623  
»t
;

2626 
	}
}

2629 
	$´oûss_šput_·ck‘
(
IÅutSŒ—m
 *
i¡
, cÚ¡ 
AVPack‘
 *
pkt
, 
no_eof
)

2631 
»t
 = 0, 
i
;

2632 
»³©šg
 = 0;

2633 
eof_»ached
 = 0;

2635 
AVPack‘
 
avpkt
;

2636 ià(!
i¡
->
§w_fœ¡_ts
) {

2637 
i¡
->
dts
 = i¡->
¡
->
avg_äame_¿‹
.
num
 ? - i¡->
dec_ùx
->
has_b_äames
 * 
AV_TIME_BASE
 / 
	`av_q2d
(ist->st->avg_frame_rate) : 0;

2638 
i¡
->
±s
 = 0;

2639 ià(
pkt
 &&…kt->
±s
 !ğ
AV_NOPTS_VALUE
 && !
i¡
->
decodšg_Ãeded
) {

2640 
i¡
->
dts
 +ğ
	`av_»sÿË_q
(
pkt
->
±s
, i¡->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

2641 
i¡
->
±s
 = i¡->
dts
;

2643 
i¡
->
§w_fœ¡_ts
 = 1;

2646 ià(
i¡
->
Ãxt_dts
 =ğ
AV_NOPTS_VALUE
)

2647 
i¡
->
Ãxt_dts
 = i¡->
dts
;

2648 ià(
i¡
->
Ãxt_±s
 =ğ
AV_NOPTS_VALUE
)

2649 
i¡
->
Ãxt_±s
 = i¡->
±s
;

2651 ià(!
pkt
) {

2653 
	`av_š™_·ck‘
(&
avpkt
);

2654 
avpkt
.
d©a
 = 
NULL
;

2655 
avpkt
.
size
 = 0;

2657 
avpkt
 = *
pkt
;

2660 ià(
pkt
 &&…kt->
dts
 !ğ
AV_NOPTS_VALUE
) {

2661 
i¡
->
Ãxt_dts
 = i¡->
dts
 = 
	`av_»sÿË_q
(
pkt
->dts, i¡->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

2662 ià(
i¡
->
dec_ùx
->
codec_ty³
 !ğ
AVMEDIA_TYPE_VIDEO
 || !i¡->
decodšg_Ãeded
)

2663 
i¡
->
Ãxt_±s
 = i¡->
±s
 = i¡->
dts
;

2667 
i¡
->
decodšg_Ãeded
) {

2668 
du¿tiÚ
 = 0;

2669 
gÙ_ouut
 = 0;

2670 
decode_çed
 = 0;

2672 
i¡
->
±s
 = i¡->
Ãxt_±s
;

2673 
i¡
->
dts
 = i¡->
Ãxt_dts
;

2675 
i¡
->
dec_ùx
->
codec_ty³
) {

2676 
AVMEDIA_TYPE_AUDIO
:

2677 
»t
 = 
	`decode_audio
 (
i¡
, 
»³©šg
 ? 
NULL
 : &
avpkt
, &
gÙ_ouut
,

2678 &
decode_çed
);

2680 
AVMEDIA_TYPE_VIDEO
:

2681 
»t
 = 
	`decode_video
 (
i¡
, 
»³©šg
 ? 
NULL
 : &
avpkt
, &
gÙ_ouut
, !
pkt
,

2682 &
decode_çed
);

2683 ià(!
»³©šg
 || !
pkt
 || 
gÙ_ouut
) {

2684 ià(
pkt
 &&…kt->
du¿tiÚ
) {

2685 
du¿tiÚ
 = 
	`av_»sÿË_q
(
pkt
->du¿tiÚ, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

2686 } if(
i¡
->
dec_ùx
->
äam”©e
.
num
 !ğ0 && i¡->dec_ùx->äam”©e.
d’
 != 0) {

2687 
ticks
ğ
	`av_¡»am_g‘_·r£r
(
i¡
->
¡
è?‡v_¡»am_g‘_·r£r(i¡->¡)->
»³©_più
+1 : i¡->
dec_ùx
->
ticks_³r_äame
;

2688 
du¿tiÚ
 = ((
št64_t
)
AV_TIME_BASE
 *

2689 
i¡
->
dec_ùx
->
äam”©e
.
d’
 * 
ticks
) /

2690 
i¡
->
dec_ùx
->
äam”©e
.
num
 / i¡->dec_ùx->
ticks_³r_äame
;

2693 if(
i¡
->
dts
 !ğ
AV_NOPTS_VALUE
 && 
du¿tiÚ
) {

2694 
i¡
->
Ãxt_dts
 +ğ
du¿tiÚ
;

2696 
i¡
->
Ãxt_dts
 = 
AV_NOPTS_VALUE
;

2699 ià(
gÙ_ouut
)

2700 
i¡
->
Ãxt_±s
 +ğ
du¿tiÚ
;

2702 
AVMEDIA_TYPE_SUBTITLE
:

2703 ià(
»³©šg
)

2705 
»t
 = 
	`Œªscode_subt™Ës
(
i¡
, &
avpkt
, &
gÙ_ouut
, &
decode_çed
);

2706 ià(!
pkt
 && 
»t
 >= 0)

2707 
»t
 = 
AVERROR_EOF
;

2713 ià(
»t
 =ğ
AVERROR_EOF
) {

2714 
eof_»ached
 = 1;

2718 ià(
»t
 < 0) {

2719 ià(
decode_çed
) {

2720 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error while decoding stream #%d:%d: %s\n",

2721 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
, 
	`av_”r2¡r
(
»t
));

2723 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error while…rocessinghe decoded "

2724 "d©¨fÜ sŒ—m #%d:%d\n", 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

2726 ià(!
decode_çed
 || 
ex™_Ú_”rÜ
)

2727 
	`ex™_´og¿m
(1);

2731 ià(
gÙ_ouut
)

2732 
i¡
->
gÙ_ouut
 = 1;

2734 ià(!
gÙ_ouut
)

2745 ià(!
pkt
)

2748 
»³©šg
 = 1;

2753 ià(!
pkt
 && 
i¡
->
decodšg_Ãeded
 && 
eof_»ached
 && !
no_eof
) {

2754 
»t
 = 
	`£nd_f‹r_eof
(
i¡
);

2755 ià(
»t
 < 0) {

2756 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error marking filters‡s finished\n");

2757 
	`ex™_´og¿m
(1);

2762 ià(!
i¡
->
decodšg_Ãeded
) {

2763 
i¡
->
dts
 = i¡->
Ãxt_dts
;

2764 
i¡
->
dec_ùx
->
codec_ty³
) {

2765 
AVMEDIA_TYPE_AUDIO
:

2766 
i¡
->
Ãxt_dts
 +ğ((
št64_t
)
AV_TIME_BASE
 * i¡->
dec_ùx
->
äame_size
) /

2767 
i¡
->
dec_ùx
->
§m¶e_¿‹
;

2769 
AVMEDIA_TYPE_VIDEO
:

2770 ià(
i¡
->
äam”©e
.
num
) {

2772 
AVR©iÚ®
 
time_ba£_q
 = 
AV_TIME_BASE_Q
;

2773 
št64_t
 
Ãxt_dts
 = 
	`av_»sÿË_q
(
i¡
->Ãxt_dts, 
time_ba£_q
, 
	`av_šv_q
(i¡->
äam”©e
));

2774 
i¡
->
Ãxt_dts
 = 
	`av_»sÿË_q
Òext_dt + 1, 
	`av_šv_q
(i¡->
äam”©e
), 
time_ba£_q
);

2775 } ià(
pkt
->
du¿tiÚ
) {

2776 
i¡
->
Ãxt_dts
 +ğ
	`av_»sÿË_q
(
pkt
->
du¿tiÚ
, i¡->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

2777 } if(
i¡
->
dec_ùx
->
äam”©e
.
num
 != 0) {

2778 
ticks
ğ
	`av_¡»am_g‘_·r£r
(
i¡
->
¡
è?‡v_¡»am_g‘_·r£r(i¡->¡)->
»³©_più
 + 1 : i¡->
dec_ùx
->
ticks_³r_äame
;

2779 
i¡
->
Ãxt_dts
 +ğ((
št64_t
)
AV_TIME_BASE
 *

2780 
i¡
->
dec_ùx
->
äam”©e
.
d’
 * 
ticks
) /

2781 
i¡
->
dec_ùx
->
äam”©e
.
num
 / i¡->dec_ùx->
ticks_³r_äame
;

2785 
i¡
->
±s
 = i¡->
dts
;

2786 
i¡
->
Ãxt_±s
 = i¡->
Ãxt_dts
;

2788 
i
 = 0; 
pkt
 && i < 
nb_ouut_¡»ams
; i++) {

2789 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

2791 ià(!
	`check_ouut_cÚ¡¿šts
(
i¡
, 
o¡
è|| o¡->
’codšg_Ãeded
)

2794 
	`do_¡»amcİy
(
i¡
, 
o¡
, 
pkt
);

2797  !
eof_»ached
;

2798 
	}
}

2800 
	$´št_sdp
()

2802 
sdp
[16384];

2803 
i
;

2804 
j
;

2805 
AVIOCÚ‹xt
 *
sdp_pb
;

2806 
AVFÜm©CÚ‹xt
 **
avc
;

2808 
i
 = 0; i < 
nb_ouut_fes
; i++) {

2809 ià(!
ouut_fes
[
i
]->
h—d”_wr™‹n
)

2813 
avc
 = 
	`av_m®loc_¬¿y
(
nb_ouut_fes
, (*avc));

2814 ià(!
avc
)

2815 
	`ex™_´og¿m
(1);

2816 
i
 = 0, 
j
 = 0; i < 
nb_ouut_fes
; i++) {

2817 ià(!
	`¡rcmp
(
ouut_fes
[
i
]->
ùx
->
ofÜm©
->
Çme
, "rtp")) {

2818 
avc
[
j
] = 
ouut_fes
[
i
]->
ùx
;

2819 
j
++;

2823 ià(!
j
)

2824 
ç
;

2826 
	`av_sdp_ü—‹
(
avc
, 
j
, 
sdp
, (sdp));

2828 ià(!
sdp_f’ame
) {

2829 
	`´štf
("SDP:\n%s\n", 
sdp
);

2830 
	`fæush
(
¡dout
);

2832 ià(
	`avio_İ’2
(&
sdp_pb
, 
sdp_f’ame
, 
AVIO_FLAG_WRITE
, &
št_cb
, 
NULL
) < 0) {

2833 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "FaedØİ’ sd°f'%s'\n", 
sdp_f’ame
);

2835 
	`avio_´štf
(
sdp_pb
, "SDP:\n%s", 
sdp
);

2836 
	`avio_şo£p
(&
sdp_pb
);

2837 
	`av_ä“p
(&
sdp_f’ame
);

2841 
ç
:

2842 
	`av_ä“p
(&
avc
);

2843 
	}
}

2845 cÚ¡ 
HWAcûl
 *
	$g‘_hwacûl
(
AVPix–FÜm©
 
pix_fmt
)

2847 
i
;

2848 
i
 = 0; 
hwacûls
[i].
Çme
; i++)

2849 ià(
hwacûls
[
i
].
pix_fmt
 ==…ix_fmt)

2850  &
hwacûls
[
i
];

2851  
NULL
;

2852 
	}
}

2854 
AVPix–FÜm©
 
	$g‘_fÜm©
(
AVCodecCÚ‹xt
 *
s
, cÚ¡ 
AVPix–FÜm©
 *
pix_fmts
)

2856 
IÅutSŒ—m
 *
i¡
 = 
s
->
İaque
;

2857 cÚ¡ 
AVPix–FÜm©
 *
p
;

2858 
»t
;

2860 
p
 = 
pix_fmts
; *p != -1;…++) {

2861 cÚ¡ 
AVPixFmtDesütÜ
 *
desc
 = 
	`av_pix_fmt_desc_g‘
(*
p
);

2862 cÚ¡ 
HWAcûl
 *
hwacûl
;

2864 ià(!(
desc
->
æags
 & 
AV_PIX_FMT_FLAG_HWACCEL
))

2867 
hwacûl
 = 
	`g‘_hwacûl
(*
p
);

2868 ià(!
hwacûl
 ||

2869 (
i¡
->
aùive_hwacûl_id
 && i¡->aùive_hwacûl_id !ğ
hwacûl
->
id
) ||

2870 (
i¡
->
hwacûl_id
 !ğ
HWACCEL_AUTO
 && i¡->hwacûl_id !ğ
hwacûl
->
id
))

2873 
»t
 = 
hwacûl
->
	`š™
(
s
);

2874 ià(
»t
 < 0) {

2875 ià(
i¡
->
hwacûl_id
 =ğ
hwacûl
->
id
) {

2876 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

2878 "buˆÿÂÙ bš™Ÿlized.\n", 
hwacûl
->
Çme
,

2879 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

2880  
AV_PIX_FMT_NONE
;

2885 ià(
i¡
->
hw_äames_ùx
) {

2886 
s
->
hw_äames_ùx
 = 
	`av_bufãr_»f
(
i¡
->hw_frames_ctx);

2887 ià(!
s
->
hw_äames_ùx
)

2888  
AV_PIX_FMT_NONE
;

2891 
i¡
->
aùive_hwacûl_id
 = 
hwacûl
->
id
;

2892 
i¡
->
hwacûl_pix_fmt
 = *
p
;

2896  *
p
;

2897 
	}
}

2899 
	$g‘_bufãr
(
AVCodecCÚ‹xt
 *
s
, 
AVF¿me
 *
äame
, 
æags
)

2901 
IÅutSŒ—m
 *
i¡
 = 
s
->
İaque
;

2903 ià(
i¡
->
hwacûl_g‘_bufãr
 && 
äame
->
fÜm©
 =ği¡->
hwacûl_pix_fmt
)

2904  
i¡
->
	`hwacûl_g‘_bufãr
(
s
, 
äame
, 
æags
);

2906  
	`avcodec_deçuÉ_g‘_bufãr2
(
s
, 
äame
, 
æags
);

2907 
	}
}

2909 
	$š™_šput_¡»am
(
i¡_šdex
, *
”rÜ
, 
”rÜ_Ën
)

2911 
»t
;

2912 
IÅutSŒ—m
 *
i¡
 = 
šput_¡»ams
[
i¡_šdex
];

2914 ià(
i¡
->
decodšg_Ãeded
) {

2915 
AVCodec
 *
codec
 = 
i¡
->
dec
;

2916 ià(!
codec
) {

2917 
	`¢´štf
(
”rÜ
, 
”rÜ_Ën
, "Decoder (codec %s)‚ot found for input stream #%d:%d",

2918 
	`avcodec_g‘_Çme
(
i¡
->
dec_ùx
->
codec_id
), i¡->
fe_šdex
, i¡->
¡
->
šdex
);

2919  
	`AVERROR
(
EINVAL
);

2922 
i¡
->
dec_ùx
->
İaque
 = ist;

2923 
i¡
->
dec_ùx
->
g‘_fÜm©
 = get_format;

2924 
i¡
->
dec_ùx
->
g‘_bufãr2
 = 
g‘_bufãr
;

2925 
i¡
->
dec_ùx
->
th»ad_§ã_ÿÎbacks
 = 1;

2927 
	`av_İt_£t_št
(
i¡
->
dec_ùx
, "refcounted_frames", 1, 0);

2928 ià(
i¡
->
dec_ùx
->
codec_id
 =ğ
AV_CODEC_ID_DVB_SUBTITLE
 &&

2929 (
i¡
->
decodšg_Ãeded
 & 
DECODING_FOR_OST
)) {

2930 
	`av_diù_£t
(&
i¡
->
decod”_İts
, "compu‹_edt", "1", 
AV_DICT_DONT_OVERWRITE
);

2931 ià(
i¡
->
decodšg_Ãeded
 & 
DECODING_FOR_FILTER
)

2932 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Warning using DVB subtitles for filtering‡nd output‡the sameime is‚ot fully supported,‡lso see -compute_edt [0|1]\n");

2935 
	`av_diù_£t
(&
i¡
->
decod”_İts
, "sub_‹xt_fÜm©", "ass", 
AV_DICT_DONT_OVERWRITE
);

2939 
	`av_codec_£t_pkt_timeba£
(
i¡
->
dec_ùx
, i¡->
¡
->
time_ba£
);

2941 ià(!
	`av_diù_g‘
(
i¡
->
decod”_İts
, "th»ads", 
NULL
, 0))

2942 
	`av_diù_£t
(&
i¡
->
decod”_İts
, "threads", "auto", 0);

2943 ià((
»t
 = 
	`avcodec_İ’2
(
i¡
->
dec_ùx
, 
codec
, &i¡->
decod”_İts
)) < 0) {

2944 ià(
»t
 =ğ
AVERROR_EXPERIMENTAL
)

2945 
	`abÜt_codec_ex³rim’l
(
codec
, 0);

2947 
	`¢´štf
(
”rÜ
, 
”rÜ_Ën
,

2950 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
, 
	`av_”r2¡r
(
»t
));

2951  
»t
;

2953 
	`as£¹_avİtiÚs
(
i¡
->
decod”_İts
);

2956 
i¡
->
Ãxt_±s
 = 
AV_NOPTS_VALUE
;

2957 
i¡
->
Ãxt_dts
 = 
AV_NOPTS_VALUE
;

2960 
	}
}

2962 
IÅutSŒ—m
 *
	$g‘_šput_¡»am
(
OuutSŒ—m
 *
o¡
)

2964 ià(
o¡
->
sourû_šdex
 >= 0)

2965  
šput_¡»ams
[
o¡
->
sourû_šdex
];

2966  
NULL
;

2967 
	}
}

2969 
	$com·»_št64
(cÚ¡ *
a
, cÚ¡ *
b
)

2971  
	`FFDIFFSIGN
(*(cÚ¡ 
št64_t
 *)
a
, *(cÚ¡ iÁ64_ˆ*)
b
);

2972 
	}
}

2975 
	$check_š™_ouut_fe
(
OuutFe
 *
of
, 
fe_šdex
)

2977 
»t
, 
i
;

2979 
i
 = 0; i < 
of
->
ùx
->
nb_¡»ams
; i++) {

2980 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
of
->
o¡_šdex
 + 
i
];

2981 ià(!
o¡
->
š™Ÿlized
)

2985 
of
->
ùx
->
š‹¼u±_ÿÎback
 = 
št_cb
;

2987 
»t
 = 
	`avfÜm©_wr™e_h—d”
(
of
->
ùx
, &of->
İts
);

2988 ià(
»t
 < 0) {

2989 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2992 
fe_šdex
, 
	`av_”r2¡r
(
»t
));

2993  
»t
;

2996 
of
->
h—d”_wr™‹n
 = 1;

2998 
	`av_dump_fÜm©
(
of
->
ùx
, 
fe_šdex
, of->ùx->
f’ame
, 1);

3000 ià(
sdp_f’ame
 || 
wªt_sdp
)

3001 
	`´št_sdp
();

3004 
i
 = 0; i < 
of
->
ùx
->
nb_¡»ams
; i++) {

3005 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
of
->
o¡_šdex
 + 
i
];

3008 ià(!
	`av_fifo_size
(
o¡
->
muxšg_queue
))

3009 
o¡
->
mux_timeba£
 = o¡->
¡
->
time_ba£
;

3011 
	`av_fifo_size
(
o¡
->
muxšg_queue
)) {

3012 
AVPack‘
 
pkt
;

3013 
	`av_fifo_g’”ic_»ad
(
o¡
->
muxšg_queue
, &
pkt
, Õkt), 
NULL
);

3014 
	`wr™e_·ck‘
(
of
, &
pkt
, 
o¡
, 1);

3019 
	}
}

3021 
	$š™_ouut_bsfs
(
OuutSŒ—m
 *
o¡
)

3023 
AVBSFCÚ‹xt
 *
ùx
;

3024 
i
, 
»t
;

3026 ià(!
o¡
->
nb_b™¡»am_f‹rs
)

3029 
i
 = 0; i < 
o¡
->
nb_b™¡»am_f‹rs
; i++) {

3030 
ùx
 = 
o¡
->
bsf_ùx
[
i
];

3032 
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
ùx
->
·r_š
,

3033 
i
 ? 
o¡
->
bsf_ùx
[˜- 1]->
·r_out
 : o¡->
¡
->
codeı¬
);

3034 ià(
»t
 < 0)

3035  
»t
;

3037 
ùx
->
time_ba£_š
 = 
i
 ? 
o¡
->
bsf_ùx
[˜- 1]->
time_ba£_out
 : o¡->
¡
->
time_ba£
;

3039 
»t
 = 
	`av_bsf_š™
(
ùx
);

3040 ià(
»t
 < 0) {

3041 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error initializing bitstream filter: %s\n",

3042 
o¡
->
bsf_ùx
[
i
]->
f‹r
->
Çme
);

3043  
»t
;

3047 
ùx
 = 
o¡
->
bsf_ùx
[o¡->
nb_b™¡»am_f‹rs
 - 1];

3048 
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
o¡
->
¡
->
codeı¬
, 
ùx
->
·r_out
);

3049 ià(
»t
 < 0)

3050  
»t
;

3052 
o¡
->
¡
->
time_ba£
 = 
ùx
->
time_ba£_out
;

3055 
	}
}

3057 
	$š™_ouut_¡»am_¡»amcİy
(
OuutSŒ—m
 *
o¡
)

3059 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

3060 
IÅutSŒ—m
 *
i¡
 = 
	`g‘_šput_¡»am
(
o¡
);

3061 
AVCodecP¬am‘”s
 *
·r_d¡
 = 
o¡
->
¡
->
codeı¬
;

3062 
AVCodecP¬am‘”s
 *
·r_¤c
 = 
o¡
->
»f_·r
;

3063 
AVR©iÚ®
 
§r
;

3064 
i
, 
»t
;

3065 
ušt32_t
 
codec_g
 = 
·r_d¡
->codec_tag;

3067 
	`av_as£¹0
(
i¡
 && !
o¡
->
f‹r
);

3069 
»t
 = 
	`avcodec_·¿m‘”s_to_cÚ‹xt
(
o¡
->
’c_ùx
, 
i¡
->
¡
->
codeı¬
);

3070 ià(
»t
 >= 0)

3071 
»t
 = 
	`av_İt_£t_diù
(
o¡
->
’c_ùx
, &o¡->
’cod”_İts
);

3072 ià(
»t
 < 0) {

3073 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

3075  
»t
;

3077 
	`avcodec_·¿m‘”s_äom_cÚ‹xt
(
·r_¤c
, 
o¡
->
’c_ùx
);

3079 ià(!
codec_g
) {

3080 
codec_g_tmp
;

3081 ià(!
of
->
ùx
->
ofÜm©
->
codec_g
 ||

3082 
	`av_codec_g‘_id
 (
of
->
ùx
->
ofÜm©
->
codec_g
, 
·r_¤c
->codec_gè=ğ·r_¤c->
codec_id
 ||

3083 !
	`av_codec_g‘_g2
(
of
->
ùx
->
ofÜm©
->
codec_g
, 
·r_¤c
->
codec_id
, &
codec_g_tmp
))

3084 
codec_g
 = 
·r_¤c
->codec_tag;

3087 
»t
 = 
	`avcodec_·¿m‘”s_cİy
(
·r_d¡
, 
·r_¤c
);

3088 ià(
»t
 < 0)

3089  
»t
;

3091 
·r_d¡
->
codec_g
 = codec_tag;

3093 ià(!
o¡
->
äame_¿‹
.
num
)

3094 
o¡
->
äame_¿‹
 = 
i¡
->
äam”©e
;

3095 
o¡
->
¡
->
avg_äame_¿‹
 = o¡->
äame_¿‹
;

3097 
»t
 = 
	`avfÜm©_Œªsãr_š‹º®_¡»am_timšg_šfo
(
of
->
ùx
->
ofÜm©
, 
o¡
->
¡
, 
i¡
->¡, 
cİy_tb
);

3098 ià(
»t
 < 0)

3099  
»t
;

3102 ià(
o¡
->
¡
->
time_ba£
.
num
 <ğ0 || o¡->¡->time_ba£.
d’
 <= 0)

3103 
o¡
->
¡
->
time_ba£
 = 
	`av_add_q
(
	`av_¡»am_g‘_codec_timeba£
(o¡->¡), (
AVR©iÚ®
){0, 1});

3106 ià(
o¡
->
¡
->
du¿tiÚ
 <ğ0 && 
i¡
->st->duration > 0)

3107 
o¡
->
¡
->
du¿tiÚ
 = 
	`av_»sÿË_q
(
i¡
->¡->du¿tiÚ, i¡->¡->
time_ba£
, ost->st->time_base);

3110 
o¡
->
¡
->
di¥os™iÚ
 = 
i¡
->st->disposition;

3112 ià(
i¡
->
¡
->
nb_side_d©a
) {

3113 
o¡
->
¡
->
side_d©a
 = 
	`av_»®loc_¬¿y
(
NULL
, 
i¡
->¡->
nb_side_d©a
,

3114 (*
i¡
->
¡
->
side_d©a
));

3115 ià(!
o¡
->
¡
->
side_d©a
)

3116  
	`AVERROR
(
ENOMEM
);

3118 
o¡
->
¡
->
nb_side_d©a
 = 0;

3119 
i
 = 0; i < 
i¡
->
¡
->
nb_side_d©a
; i++) {

3120 cÚ¡ 
AVPack‘SideD©a
 *
sd_¤c
 = &
i¡
->
¡
->
side_d©a
[
i
];

3121 
AVPack‘SideD©a
 *
sd_d¡
 = &
o¡
->
¡
->
side_d©a
[o¡->¡->
nb_side_d©a
];

3123 
sd_d¡
->
d©a
 = 
	`av_m®loc
(
sd_¤c
->
size
);

3124 ià(!
sd_d¡
->
d©a
)

3125  
	`AVERROR
(
ENOMEM
);

3126 
	`memıy
(
sd_d¡
->
d©a
, 
sd_¤c
->d©a, sd_¤c->
size
);

3127 
sd_d¡
->
size
 = 
sd_¤c
->size;

3128 
sd_d¡
->
ty³
 = 
sd_¤c
->type;

3129 
o¡
->
¡
->
nb_side_d©a
++;

3133 ià(
o¡
->
rÙ©e_ov”ridd’
) {

3134 
ušt8_t
 *
sd
 = 
	`av_¡»am_Ãw_side_d©a
(
o¡
->
¡
, 
AV_PKT_DATA_DISPLAYMATRIX
,

3135 (
št32_t
) * 9);

3136 ià(
sd
)

3137 
	`av_di¥Ïy_rÙ©iÚ_£t
((
št32_t
 *)
sd
, -
o¡
->
rÙ©e_ov”ride_v®ue
);

3140 
o¡
->
·r£r
 = 
	`av_·r£r_š™
(
·r_d¡
->
codec_id
);

3141 
o¡
->
·r£r_avùx
 = 
	`avcodec_®loc_cÚ‹xt3
(
NULL
);

3142 ià(!
o¡
->
·r£r_avùx
)

3143  
	`AVERROR
(
ENOMEM
);

3145 
·r_d¡
->
codec_ty³
) {

3146 
AVMEDIA_TYPE_AUDIO
:

3147 ià(
audio_vŞume
 != 256) {

3148 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "-acodec copy‡nd -vol‡re incompatible (frames‡re‚ot decoded)\n");

3149 
	`ex™_´og¿m
(1);

3151 if((
·r_d¡
->
block_®ign
 =ğ1 ||…¬_d¡->block_®igÀ=ğ1152 ||…¬_d¡->block_®igÀ=ğ576è&&…¬_d¡->
codec_id
 =ğ
AV_CODEC_ID_MP3
)

3152 
·r_d¡
->
block_®ign
= 0;

3153 if(
·r_d¡
->
codec_id
 =ğ
AV_CODEC_ID_AC3
)

3154 
·r_d¡
->
block_®ign
= 0;

3156 
AVMEDIA_TYPE_VIDEO
:

3157 ià(
o¡
->
äame_a¥eù_¿tio
.
num
) {

3158 
§r
 =

3159 
	`av_mul_q
(
o¡
->
äame_a¥eù_¿tio
,

3160 (
AVR©iÚ®
){ 
·r_d¡
->
height
,…¬_d¡->
width
 });

3161 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Overriding‡spect„atio "

3164 ià(
i¡
->
¡
->
§m¶e_a¥eù_¿tio
.
num
)

3165 
§r
 = 
i¡
->
¡
->
§m¶e_a¥eù_¿tio
;

3167 
§r
 = 
·r_¤c
->
§m¶e_a¥eù_¿tio
;

3168 
o¡
->
¡
->
§m¶e_a¥eù_¿tio
 = 
·r_d¡
->§m¶e_a¥eù_¿tiØğ
§r
;

3169 
o¡
->
¡
->
avg_äame_¿‹
 = 
i¡
->st->avg_frame_rate;

3170 
o¡
->
¡
->
r_äame_¿‹
 = 
i¡
->st->r_frame_rate;

3174 
o¡
->
mux_timeba£
 = 
i¡
->
¡
->
time_ba£
;

3177 
	}
}

3179 
	$£t_’cod”_id
(
OuutFe
 *
of
, 
OuutSŒ—m
 *
o¡
)

3181 
AVDiùiÚ¬yEÁry
 *
e
;

3183 
ušt8_t
 *
’cod”_¡ršg
;

3184 
’cod”_¡ršg_Ën
;

3185 
fÜm©_æags
 = 0;

3186 
codec_æags
 = 0;

3188 ià(
	`av_diù_g‘
(
o¡
->
¡
->
m‘ad©a
, "’cod”", 
NULL
, 0))

3191 
e
 = 
	`av_diù_g‘
(
of
->
İts
, "fæags", 
NULL
, 0);

3192 ià(
e
) {

3193 cÚ¡ 
AVO±iÚ
 *
o
 = 
	`av_İt_fšd
(
of
->
ùx
, "fæags", 
NULL
, 0, 0);

3194 ià(!
o
)

3196 
	`av_İt_ev®_æags
(
of
->
ùx
, 
o
, 
e
->
v®ue
, &
fÜm©_æags
);

3198 
e
 = 
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "æags", 
NULL
, 0);

3199 ià(
e
) {

3200 cÚ¡ 
AVO±iÚ
 *
o
 = 
	`av_İt_fšd
(
o¡
->
’c_ùx
, "æags", 
NULL
, 0, 0);

3201 ià(!
o
)

3203 
	`av_İt_ev®_æags
(
o¡
->
’c_ùx
, 
o
, 
e
->
v®ue
, &
codec_æags
);

3206 
’cod”_¡ršg_Ën
 = (
LIBAVCODEC_IDENT
è+ 
	`¡¾’
(
o¡
->
’c
->
Çme
) + 2;

3207 
’cod”_¡ršg
 = 
	`av_m®locz
(
’cod”_¡ršg_Ën
);

3208 ià(!
’cod”_¡ršg
)

3209 
	`ex™_´og¿m
(1);

3211 ià(!(
fÜm©_æags
 & 
AVFMT_FLAG_BITEXACT
è&& !(
codec_æags
 & 
AV_CODEC_FLAG_BITEXACT
))

3212 
	`av_¡¾ıy
(
’cod”_¡ršg
, 
LIBAVCODEC_IDENT
 " ", 
’cod”_¡ršg_Ën
);

3214 
	`av_¡¾ıy
(
’cod”_¡ršg
, "Lavø", 
’cod”_¡ršg_Ën
);

3215 
	`av_¡¾ÿt
(
’cod”_¡ršg
, 
o¡
->
’c
->
Çme
, 
’cod”_¡ršg_Ën
);

3216 
	`av_diù_£t
(&
o¡
->
¡
->
m‘ad©a
, "’cod”", 
’cod”_¡ršg
,

3217 
AV_DICT_DONT_STRDUP_VAL
 | 
AV_DICT_DONT_OVERWRITE
);

3218 
	}
}

3220 
	$·r£_fÜûd_key_äames
(*
kf
, 
OuutSŒ—m
 *
o¡
,

3221 
AVCodecCÚ‹xt
 *
avùx
)

3223 *
p
;

3224 
n
 = 1, 
i
, 
size
, 
šdex
 = 0;

3225 
št64_t
 
t
, *
±s
;

3227 
p
 = 
kf
; *p;…++)

3228 ià(*
p
 == ',')

3229 
n
++;

3230 
size
 = 
n
;

3231 
±s
 = 
	`av_m®loc_¬¿y
(
size
, (*pts));

3232 ià(!
±s
) {

3233 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡llocate forced key frames‡rray.\n");

3234 
	`ex™_´og¿m
(1);

3237 
p
 = 
kf
;

3238 
i
 = 0; i < 
n
; i++) {

3239 *
Ãxt
 = 
	`¡rchr
(
p
, ',');

3241 ià(
Ãxt
)

3242 *
Ãxt
++ = 0;

3244 ià(!
	`memcmp
(
p
, "chapters", 8)) {

3246 
AVFÜm©CÚ‹xt
 *
avf
 = 
ouut_fes
[
o¡
->
fe_šdex
]->
ùx
;

3247 
j
;

3249 ià(
avf
->
nb_ch­‹rs
 > 
INT_MAX
 - 
size
 ||

3250 !(
±s
 = 
	`av_»®loc_f
Õts, 
size
 +ğ
avf
->
nb_ch­‹rs
 - 1,

3251 (*
±s
)))) {

3252 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

3254 
	`ex™_´og¿m
(1);

3256 
t
 = 
p
[8] ? 
	`·r£_time_Ü_d›
("force_key_frames",… + 8, 1) : 0;

3257 
t
 = 
	`av_»sÿË_q
Ñ, 
AV_TIME_BASE_Q
, 
avùx
->
time_ba£
);

3259 
j
 = 0; j < 
avf
->
nb_ch­‹rs
; j++) {

3260 
AVCh­‹r
 *
c
 = 
avf
->
ch­‹rs
[
j
];

3261 
	`av_as£¹1
(
šdex
 < 
size
);

3262 
±s
[
šdex
++] = 
	`av_»sÿË_q
(
c
->
¡¬t
, c->
time_ba£
,

3263 
avùx
->
time_ba£
è+ 
t
;

3268 
t
 = 
	`·r£_time_Ü_d›
("fÜû_key_äames", 
p
, 1);

3269 
	`av_as£¹1
(
šdex
 < 
size
);

3270 
±s
[
šdex
++] = 
	`av_»sÿË_q
(
t
, 
AV_TIME_BASE_Q
, 
avùx
->
time_ba£
);

3274 
p
 = 
Ãxt
;

3277 
	`av_as£¹0
(
šdex
 =ğ
size
);

3278 
	`qsÜt
(
±s
, 
size
, (*±s), 
com·»_št64
);

3279 
o¡
->
fÜûd_kf_couÁ
 = 
size
;

3280 
o¡
->
fÜûd_kf_±s
 = 
±s
;

3281 
	}
}

3283 
	$š™_ouut_¡»am_’code
(
OuutSŒ—m
 *
o¡
)

3285 
IÅutSŒ—m
 *
i¡
 = 
	`g‘_šput_¡»am
(
o¡
);

3286 
AVCodecCÚ‹xt
 *
’c_ùx
 = 
o¡
->enc_ctx;

3287 
AVCodecCÚ‹xt
 *
dec_ùx
 = 
NULL
;

3288 
AVFÜm©CÚ‹xt
 *
oc
 = 
ouut_fes
[
o¡
->
fe_šdex
]->
ùx
;

3289 
j
, 
»t
;

3291 
	`£t_’cod”_id
(
ouut_fes
[
o¡
->
fe_šdex
], ost);

3296 
	`av_diù_£t
(&
o¡
->
¡
->
m‘ad©a
, "rÙ©e", 
NULL
, 0);

3298 ià(
i¡
) {

3299 
o¡
->
¡
->
di¥os™iÚ
 = 
i¡
->st->disposition;

3301 
dec_ùx
 = 
i¡
->dec_ctx;

3303 
’c_ùx
->
chroma_§m¶e_loÿtiÚ
 = 
dec_ùx
->chroma_sample_location;

3305 
j
 = 0; j < 
oc
->
nb_¡»ams
; j++) {

3306 
AVSŒ—m
 *
¡
 = 
oc
->
¡»ams
[
j
];

3307 ià(
¡
 !ğ
o¡
->¡ && st->
codeı¬
->
codec_ty³
 == ost->st->codecpar->codec_type)

3310 ià(
j
 =ğ
oc
->
nb_¡»ams
)

3311 ià(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 ||

3312 
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
)

3313 
o¡
->
¡
->
di¥os™iÚ
 = 
AV_DISPOSITION_DEFAULT
;

3316 ià(
’c_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

3317 ià(!
o¡
->
äame_¿‹
.
num
)

3318 
o¡
->
äame_¿‹
 = 
	`av_bufãrsšk_g‘_äame_¿‹
(o¡->
f‹r
->filter);

3319 ià(
i¡
 && !
o¡
->
äame_¿‹
.
num
)

3320 
o¡
->
äame_¿‹
 = 
i¡
->
äam”©e
;

3321 ià(
i¡
 && !
o¡
->
äame_¿‹
.
num
)

3322 
o¡
->
äame_¿‹
 = 
i¡
->
¡
->
r_äame_¿‹
;

3323 ià(
i¡
 && !
o¡
->
äame_¿‹
.
num
) {

3324 
o¡
->
äame_¿‹
 = (
AVR©iÚ®
){25, 1};

3325 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

3330 
o¡
->
fe_šdex
, o¡->
šdex
);

3333 ià(
o¡
->
’c
->
suµÜ‹d_äam”©es
 && !o¡->
fÜû_ås
) {

3334 
idx
 = 
	`av_fšd_Ã¬e¡_q_idx
(
o¡
->
äame_¿‹
, o¡->
’c
->
suµÜ‹d_äam”©es
);

3335 
o¡
->
äame_¿‹
 = o¡->
’c
->
suµÜ‹d_äam”©es
[
idx
];

3338 ià(
’c_ùx
->
codec_id
 =ğ
AV_CODEC_ID_MPEG4
) {

3339 
	`av_»duû
(&
o¡
->
äame_¿‹
.
num
, &o¡->äame_¿‹.
d’
,

3340 
o¡
->
äame_¿‹
.
num
, o¡->äame_¿‹.
d’
, 65535);

3344 
’c_ùx
->
codec_ty³
) {

3345 
AVMEDIA_TYPE_AUDIO
:

3346 
’c_ùx
->
§m¶e_fmt
 = 
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->filter);

3347 ià(
dec_ùx
)

3348 
’c_ùx
->
b™s_³r_¿w_§m¶e
 = 
	`FFMIN
(
dec_ùx
->bits_per_raw_sample,

3349 
	`av_g‘_by‹s_³r_§m¶e
(
’c_ùx
->
§m¶e_fmt
) << 3);

3350 
’c_ùx
->
§m¶e_¿‹
 = 
	`av_bufãrsšk_g‘_§m¶e_¿‹
(
o¡
->
f‹r
->filter);

3351 
’c_ùx
->
chªÃl_Ïyout
 = 
	`av_bufãrsšk_g‘_chªÃl_Ïyout
(
o¡
->
f‹r
->filter);

3352 
’c_ùx
->
chªÃls
 = 
	`av_bufãrsšk_g‘_chªÃls
(
o¡
->
f‹r
->filter);

3353 
’c_ùx
->
time_ba£
 = (
AVR©iÚ®
){ 1,ƒnc_ùx->
§m¶e_¿‹
 };

3355 
AVMEDIA_TYPE_VIDEO
:

3356 
’c_ùx
->
time_ba£
 = 
	`av_šv_q
(
o¡
->
äame_¿‹
);

3357 ià(!(
’c_ùx
->
time_ba£
.
num
 &&ƒnc_ùx->time_ba£.
d’
))

3358 
’c_ùx
->
time_ba£
 = 
	`av_bufãrsšk_g‘_time_ba£
(
o¡
->
f‹r
->filter);

3359 iàĞ
	`av_q2d
(
’c_ùx
->
time_ba£
è< 0.001 && 
video_sync_m‘hod
 !ğ
VSYNC_PASSTHROUGH


3360 && (
video_sync_m‘hod
 =ğ
VSYNC_CFR
 || video_sync_m‘hod =ğ
VSYNC_VSCFR
 || (video_sync_m‘hod =ğ
VSYNC_AUTO
 && !(
oc
->
ofÜm©
->
æags
 & 
AVFMT_VARIABLE_FPS
)))){

3361 
	`av_log
(
oc
, 
AV_LOG_WARNING
, "Frame„ate very high for‡ muxer‚otƒfficiently supporting it.\n"

3364 
j
 = 0; j < 
o¡
->
fÜûd_kf_couÁ
; j++)

3365 
o¡
->
fÜûd_kf_±s
[
j
] = 
	`av_»sÿË_q
(ost->forced_kf_pts[j],

3366 
AV_TIME_BASE_Q
,

3367 
’c_ùx
->
time_ba£
);

3369 
’c_ùx
->
width
 = 
	`av_bufãrsšk_g‘_w
(
o¡
->
f‹r
->filter);

3370 
’c_ùx
->
height
 = 
	`av_bufãrsšk_g‘_h
(
o¡
->
f‹r
->filter);

3371 
’c_ùx
->
§m¶e_a¥eù_¿tio
 = 
o¡
->
¡
->sample_aspect_ratio =

3372 
o¡
->
äame_a¥eù_¿tio
.
num
 ?

3373 
	`av_mul_q
(
o¡
->
äame_a¥eù_¿tio
, (
AVR©iÚ®
){ 
’c_ùx
->
height
,ƒnc_ùx->
width
 }) :

3374 
	`av_bufãrsšk_g‘_§m¶e_a¥eù_¿tio
(
o¡
->
f‹r
->filter);

3375 ià(!
	`¡ºcmp
(
o¡
->
’c
->
Çme
, "libx264", 7) &&

3376 
’c_ùx
->
pix_fmt
 =ğ
AV_PIX_FMT_NONE
 &&

3377 
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->f‹rè!ğ
AV_PIX_FMT_YUV420P
)

3378 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

3381 
	`av_g‘_pix_fmt_Çme
(
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->filter)));

3382 ià(!
	`¡ºcmp
(
o¡
->
’c
->
Çme
, "mpeg2video", 10) &&

3383 
’c_ùx
->
pix_fmt
 =ğ
AV_PIX_FMT_NONE
 &&

3384 
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->f‹rè!ğ
AV_PIX_FMT_YUV420P
)

3385 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

3388 
	`av_g‘_pix_fmt_Çme
(
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->filter)));

3389 
’c_ùx
->
pix_fmt
 = 
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->filter);

3390 ià(
dec_ùx
)

3391 
’c_ùx
->
b™s_³r_¿w_§m¶e
 = 
	`FFMIN
(
dec_ùx
->bits_per_raw_sample,

3392 
	`av_pix_fmt_desc_g‘
(
’c_ùx
->
pix_fmt
)->
comp
[0].
d•th
);

3394 
’c_ùx
->
äam”©e
 = 
o¡
->
äame_¿‹
;

3396 
o¡
->
¡
->
avg_äame_¿‹
 = o¡->
äame_¿‹
;

3398 ià(!
dec_ùx
 ||

3399 
’c_ùx
->
width
 !ğ
dec_ùx
->width ||

3400 
’c_ùx
->
height
 !ğ
dec_ùx
->height ||

3401 
’c_ùx
->
pix_fmt
 !ğ
dec_ùx
->pix_fmt) {

3402 
’c_ùx
->
b™s_³r_¿w_§m¶e
 = 
äame_b™s_³r_¿w_§m¶e
;

3405 ià(
o¡
->
fÜûd_keyäames
) {

3406 ià(!
	`¡ºcmp
(
o¡
->
fÜûd_keyäames
, "expr:", 5)) {

3407 
»t
 = 
	`av_ex´_·r£
(&
o¡
->
fÜûd_keyäames_³x´
, o¡->
fÜûd_keyäames
+5,

3408 
fÜûd_keyäames_cÚ¡_Çmes
, 
NULL
, NULL, NULL, NULL, 0, NULL);

3409 ià(
»t
 < 0) {

3410 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

3411 "Inv®id fÜû_key_äame ex´essiÚ '%s'\n", 
o¡
->
fÜûd_keyäames
+5);

3412  
»t
;

3414 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N
] = 0;

3415 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_N_FORCED
] = 0;

3416 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_N
] = 
NAN
;

3417 
o¡
->
fÜûd_keyäames_ex´_cÚ¡_v®ues
[
FKF_PREV_FORCED_T
] = 
NAN
;

3421 } if(
	`¡ºcmp
(
o¡
->
fÜûd_keyäames
, "source", 6)) {

3422 
	`·r£_fÜûd_key_äames
(
o¡
->
fÜûd_keyäames
, o¡, o¡->
’c_ùx
);

3426 
AVMEDIA_TYPE_SUBTITLE
:

3427 
’c_ùx
->
time_ba£
 = 
AV_TIME_BASE_Q
;

3428 ià(!
’c_ùx
->
width
) {

3429 
’c_ùx
->
width
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
]->
¡
->
codeı¬
->width;

3430 
’c_ùx
->
height
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
]->
¡
->
codeı¬
->height;

3433 
AVMEDIA_TYPE_DATA
:

3436 
	`abÜt
();

3440 
o¡
->
mux_timeba£
 = 
’c_ùx
->
time_ba£
;

3443 
	}
}

3445 
	$š™_ouut_¡»am
(
OuutSŒ—m
 *
o¡
, *
”rÜ
, 
”rÜ_Ën
)

3447 
»t
 = 0;

3449 ià(
o¡
->
’codšg_Ãeded
) {

3450 
AVCodec
 *
codec
 = 
o¡
->
’c
;

3451 
AVCodecCÚ‹xt
 *
dec
 = 
NULL
;

3452 
IÅutSŒ—m
 *
i¡
;

3454 
»t
 = 
	`š™_ouut_¡»am_’code
(
o¡
);

3455 ià(
»t
 < 0)

3456  
»t
;

3458 ià((
i¡
 = 
	`g‘_šput_¡»am
(
o¡
)))

3459 
dec
 = 
i¡
->
dec_ùx
;

3460 ià(
dec
 && dec->
subt™Ë_h—d”
) {

3462 
o¡
->
’c_ùx
->
subt™Ë_h—d”
 = 
	`av_m®locz
(
dec
->
subt™Ë_h—d”_size
 + 1);

3463 ià(!
o¡
->
’c_ùx
->
subt™Ë_h—d”
)

3464  
	`AVERROR
(
ENOMEM
);

3465 
	`memıy
(
o¡
->
’c_ùx
->
subt™Ë_h—d”
, 
dec
->subt™Ë_h—d”, dec->
subt™Ë_h—d”_size
);

3466 
o¡
->
’c_ùx
->
subt™Ë_h—d”_size
 = 
dec
->subtitle_header_size;

3468 ià(!
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "th»ads", 
NULL
, 0))

3469 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, "threads", "auto", 0);

3470 ià(
o¡
->
’c
->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 &&

3471 !
codec
->
deçuÉs
 &&

3472 !
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "b", 
NULL
, 0) &&

3473 !
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "ab", 
NULL
, 0))

3474 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, "b", "128000", 0);

3476 ià(
o¡
->
f‹r
 && 
	`av_bufãrsšk_g‘_hw_äames_ùx
(ost->filter->filter) &&

3477 ((
AVHWF¿mesCÚ‹xt
*)
	`av_bufãrsšk_g‘_hw_äames_ùx
(
o¡
->
f‹r
->f‹r)->
d©a
)->
fÜm©
 ==

3478 
	`av_bufãrsšk_g‘_fÜm©
(
o¡
->
f‹r
->filter)) {

3479 
o¡
->
’c_ùx
->
hw_äames_ùx
 = 
	`av_bufãr_»f
(
	`av_bufãrsšk_g‘_hw_äames_ùx
(o¡->
f‹r
->filter));

3480 ià(!
o¡
->
’c_ùx
->
hw_äames_ùx
)

3481  
	`AVERROR
(
ENOMEM
);

3484 ià((
»t
 = 
	`avcodec_İ’2
(
o¡
->
’c_ùx
, 
codec
, &o¡->
’cod”_İts
)) < 0) {

3485 ià(
»t
 =ğ
AVERROR_EXPERIMENTAL
)

3486 
	`abÜt_codec_ex³rim’l
(
codec
, 1);

3487 
	`¢´štf
(
”rÜ
, 
”rÜ_Ën
,

3490 
o¡
->
fe_šdex
, o¡->
šdex
);

3491  
»t
;

3493 ià(
o¡
->
’c
->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 &&

3494 !(
o¡
->
’c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_VARIABLE_FRAME_SIZE
))

3495 
	`av_bufãrsšk_£t_äame_size
(
o¡
->
f‹r
->filter,

3496 
o¡
->
’c_ùx
->
äame_size
);

3497 
	`as£¹_avİtiÚs
(
o¡
->
’cod”_İts
);

3498 ià(
o¡
->
’c_ùx
->
b™_¿‹
 && ost->enc_ctx->bit_rate < 1000)

3499 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "The bitrate…arameter is setoo†ow."

3502 
»t
 = 
	`avcodec_·¿m‘”s_äom_cÚ‹xt
(
o¡
->
¡
->
codeı¬
, o¡->
’c_ùx
);

3503 ià(
»t
 < 0) {

3504 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

3506 
	`ex™_´og¿m
(1);

3511 
»t
 = 
	`avcodec_cİy_cÚ‹xt
(
o¡
->
¡
->
codec
, o¡->
’c_ùx
);

3512 ià(
»t
 < 0)

3513  
»t
;

3515 ià(
o¡
->
’c_ùx
->
nb_coded_side_d©a
) {

3516 
i
;

3518 
o¡
->
¡
->
side_d©a
 = 
	`av_»®loc_¬¿y
(
NULL
, o¡->
’c_ùx
->
nb_coded_side_d©a
,

3519 (*
o¡
->
¡
->
side_d©a
));

3520 ià(!
o¡
->
¡
->
side_d©a
)

3521  
	`AVERROR
(
ENOMEM
);

3523 
i
 = 0; i < 
o¡
->
’c_ùx
->
nb_coded_side_d©a
; i++) {

3524 cÚ¡ 
AVPack‘SideD©a
 *
sd_¤c
 = &
o¡
->
’c_ùx
->
coded_side_d©a
[
i
];

3525 
AVPack‘SideD©a
 *
sd_d¡
 = &
o¡
->
¡
->
side_d©a
[
i
];

3527 
sd_d¡
->
d©a
 = 
	`av_m®loc
(
sd_¤c
->
size
);

3528 ià(!
sd_d¡
->
d©a
)

3529  
	`AVERROR
(
ENOMEM
);

3530 
	`memıy
(
sd_d¡
->
d©a
, 
sd_¤c
->d©a, sd_¤c->
size
);

3531 
sd_d¡
->
size
 = 
sd_¤c
->size;

3532 
sd_d¡
->
ty³
 = 
sd_¤c
->type;

3533 
o¡
->
¡
->
nb_side_d©a
++;

3544 ià(
i¡
) {

3545 
i
;

3546 
i
 = 0; i < 
i¡
->
¡
->
nb_side_d©a
; i++) {

3547 
AVPack‘SideD©a
 *
sd
 = &
i¡
->
¡
->
side_d©a
[
i
];

3548 
ušt8_t
 *
d¡
 = 
	`av_¡»am_Ãw_side_d©a
(
o¡
->
¡
, 
sd
->
ty³
, sd->
size
);

3549 ià(!
d¡
)

3550  
	`AVERROR
(
ENOMEM
);

3551 
	`memıy
(
d¡
, 
sd
->
d©a
, sd->
size
);

3552 ià(
i¡
->
autÜÙ©e
 && 
sd
->
ty³
 =ğ
AV_PKT_DATA_DISPLAYMATRIX
)

3553 
	`av_di¥Ïy_rÙ©iÚ_£t
((
ušt32_t
 *)
d¡
, 0);

3558 ià(
o¡
->
¡
->
time_ba£
.
num
 <ğ0 || o¡->¡->time_ba£.
d’
 <= 0)

3559 
o¡
->
¡
->
time_ba£
 = 
	`av_add_q
(o¡->
’c_ùx
->time_ba£, (
AVR©iÚ®
){0, 1});

3562 ià(
o¡
->
¡
->
du¿tiÚ
 <ğ0 && 
i¡
 && ist->st->duration > 0)

3563 
o¡
->
¡
->
du¿tiÚ
 = 
	`av_»sÿË_q
(
i¡
->¡->du¿tiÚ, i¡->¡->
time_ba£
, ost->st->time_base);

3565 
o¡
->
¡
->
codec
->codecğo¡->
’c_ùx
->codec;

3566 } ià(
o¡
->
¡»am_cİy
) {

3567 
»t
 = 
	`š™_ouut_¡»am_¡»amcİy
(
o¡
);

3568 ià(
»t
 < 0)

3569  
»t
;

3575 
»t
 = 
	`avcodec_·¿m‘”s_to_cÚ‹xt
(
o¡
->
·r£r_avùx
, o¡->
¡
->
codeı¬
);

3576 ià(
»t
 < 0)

3577  
»t
;

3581 ià(
o¡
->
di¥os™iÚ
) {

3582 cÚ¡ 
AVO±iÚ
 
İts
[] = {

3583 { "di¥os™iÚ" , 
NULL
, 0, 
AV_OPT_TYPE_FLAGS
, { .
i64
 = 0 }, 
INT64_MIN
, 
INT64_MAX
, .
un™
 = "flags" },

3584 { "deçuÉ" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_DEFAULT
 }, .
un™
 = "flags" },

3585 { "dub" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_DUB
 }, .
un™
 = "flags" },

3586 { "Üigš®" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_ORIGINAL
 }, .
un™
 = "flags" },

3587 { "comm’t" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_COMMENT
 }, .
un™
 = "flags" },

3588 { "lyrics" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_LYRICS
 }, .
un™
 = "flags" },

3589 { "k¬aoke" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_KARAOKE
 }, .
un™
 = "flags" },

3590 { "fÜûd" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_FORCED
 }, .
un™
 = "flags" },

3591 { "h—ršg_im·œed" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_HEARING_IMPAIRED
 }, .
un™
 = "flags" },

3592 { "visu®_im·œed" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_VISUAL_IMPAIRED
 }, .
un™
 = "flags" },

3593 { "ş—n_efãùs" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_CLEAN_EFFECTS
 }, .
un™
 = "flags" },

3594 { "ÿ±iÚs" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_CAPTIONS
 }, .
un™
 = "flags" },

3595 { "desütiÚs" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_DESCRIPTIONS
 }, .
un™
 = "flags" },

3596 { "m‘ad©a" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
AV_DISPOSITION_METADATA
 }, .
un™
 = "flags" },

3597 { 
NULL
 },

3599 cÚ¡ 
AVCÏss
 
şass
 = {

3600 .
şass_Çme
 = "",

3601 .
™em_Çme
 = 
av_deçuÉ_™em_Çme
,

3602 .
İtiÚ
 = 
İts
,

3603 .
v”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

3605 cÚ¡ 
AVCÏss
 *
pşass
 = &
şass
;

3607 
»t
 = 
	`av_İt_ev®_æags
(&
pşass
, &
İts
[0], 
o¡
->
di¥os™iÚ
, &o¡->
¡
->disposition);

3608 ià(
»t
 < 0)

3609  
»t
;

3615 
»t
 = 
	`š™_ouut_bsfs
(
o¡
);

3616 ià(
»t
 < 0)

3617  
»t
;

3619 
o¡
->
š™Ÿlized
 = 1;

3621 
»t
 = 
	`check_š™_ouut_fe
(
ouut_fes
[
o¡
->
fe_šdex
], ost->file_index);

3622 ià(
»t
 < 0)

3623  
»t
;

3625  
»t
;

3626 
	}
}

3628 
	$»pÜt_Ãw_¡»am
(
šput_šdex
, 
AVPack‘
 *
pkt
)

3630 
IÅutFe
 *
fe
 = 
šput_fes
[
šput_šdex
];

3631 
AVSŒ—m
 *
¡
 = 
fe
->
ùx
->
¡»ams
[
pkt
->
¡»am_šdex
];

3633 ià(
pkt
->
¡»am_šdex
 < 
fe
->
nb_¡»ams_w¬n
)

3635 
	`av_log
(
fe
->
ùx
, 
AV_LOG_WARNING
,

3636 "New % ¡»am %d:%d‡ˆpos:%"
PRId64
"‡nd DTS:%ss\n",

3637 
	`av_g‘_medŸ_ty³_¡ršg
(
¡
->
codeı¬
->
codec_ty³
),

3638 
šput_šdex
, 
pkt
->
¡»am_šdex
,

3639 
pkt
->
pos
, 
	`av_ts2time¡r
Õkt->
dts
, &
¡
->
time_ba£
));

3640 
fe
->
nb_¡»ams_w¬n
 = 
pkt
->
¡»am_šdex
 + 1;

3641 
	}
}

3643 
	$Œªscode_š™
()

3645 
»t
 = 0, 
i
, 
j
, 
k
;

3646 
AVFÜm©CÚ‹xt
 *
oc
;

3647 
OuutSŒ—m
 *
o¡
;

3648 
IÅutSŒ—m
 *
i¡
;

3649 
”rÜ
[1024] = {0};

3651 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

3652 
F‹rG¿ph
 *
fg
 = 
f‹rg¿phs
[
i
];

3653 
j
 = 0; j < 
fg
->
nb_ouuts
; j++) {

3654 
OuutF‹r
 *
of‹r
 = 
fg
->
ouuts
[
j
];

3655 ià(!
of‹r
->
o¡
 || of‹r->o¡->
sourû_šdex
 >= 0)

3657 ià(
fg
->
nb_šputs
 != 1)

3659 
k
 = 
nb_šput_¡»ams
-1; k >= 0 ; k--)

3660 ià(
fg
->
šputs
[0]->
i¡
 =ğ
šput_¡»ams
[
k
])

3662 
of‹r
->
o¡
->
sourû_šdex
 = 
k
;

3667 
i
 = 0; i < 
nb_šput_fes
; i++) {

3668 
IÅutFe
 *
ife
 = 
šput_fes
[
i
];

3669 ià(
ife
->
¿‹_emu
)

3670 
j
 = 0; j < 
ife
->
nb_¡»ams
; j++)

3671 
šput_¡»ams
[
j
 + 
ife
->
i¡_šdex
]->
¡¬t
 = 
	`av_g‘time_»Ïtive
();

3675 
i
 = 0; i < 
nb_šput_¡»ams
; i++)

3676 ià((
»t
 = 
	`š™_šput_¡»am
(
i
, 
”rÜ
, (error))) < 0) {

3677 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

3678 
o¡
 = 
ouut_¡»ams
[
i
];

3679 
	`avcodec_şo£
(
o¡
->
’c_ùx
);

3681 
dump_fÜm©
;

3685 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

3687 ià(
ouut_¡»ams
[
i
]->
f‹r
)

3690 
»t
 = 
	`š™_ouut_¡»am
(
ouut_¡»ams
[
i
], 
”rÜ
, (error));

3691 ià(
»t
 < 0)

3692 
dump_fÜm©
;

3696 
i
 = 0; i < 
nb_šput_fes
; i++) {

3697 
IÅutFe
 *
ife
 = 
šput_fes
[
i
];

3698 
j
 = 0; j < 
ife
->
ùx
->
nb_´og¿ms
; j++) {

3699 
AVProg¿m
 *
p
 = 
ife
->
ùx
->
´og¿ms
[
j
];

3700 
disÿrd
 = 
AVDISCARD_ALL
;

3702 
k
 = 0; k < 
p
->
nb_¡»am_šdexes
; k++)

3703 ià(!
šput_¡»ams
[
ife
->
i¡_šdex
 + 
p
->
¡»am_šdex
[
k
]]->
disÿrd
) {

3704 
disÿrd
 = 
AVDISCARD_DEFAULT
;

3707 
p
->
disÿrd
 = discard;

3712 
i
 = 0; i < 
nb_ouut_fes
; i++) {

3713 
oc
 = 
ouut_fes
[
i
]->
ùx
;

3714 ià(
oc
->
ofÜm©
->
æags
 & 
AVFMT_NOSTREAMS
 && oc->
nb_¡»ams
 == 0) {

3715 
»t
 = 
	`check_š™_ouut_fe
(
ouut_fes
[
i
], i);

3716 ià(
»t
 < 0)

3717 
dump_fÜm©
;

3721 
dump_fÜm©
:

3723 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Stream mapping:\n");

3724 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

3725 
i¡
 = 
šput_¡»ams
[
i
];

3727 
j
 = 0; j < 
i¡
->
nb_f‹rs
; j++) {

3728 ià(!
	`f‹rg¿ph_is_sim¶e
(
i¡
->
f‹rs
[
j
]->
g¿ph
)) {

3729 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " Stream #%d:%d (%s) -> %s",

3730 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
, i¡->
dec
 ? i¡->dec->
Çme
 : "?",

3731 
i¡
->
f‹rs
[
j
]->
Çme
);

3732 ià(
nb_f‹rg¿phs
 > 1)

3733 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " (g¿ph %d)", 
i¡
->
f‹rs
[
j
]->
g¿ph
->
šdex
);

3734 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "\n");

3739 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

3740 
o¡
 = 
ouut_¡»ams
[
i
];

3742 ià(
o¡
->
©chm’t_f’ame
) {

3744 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " File %s -> Stream #%d:%d\n",

3745 
o¡
->
©chm’t_f’ame
, o¡->
fe_šdex
, o¡->
šdex
);

3749 ià(
o¡
->
f‹r
 && !
	`f‹rg¿ph_is_sim¶e
(o¡->f‹r->
g¿ph
)) {

3751 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " %s", 
o¡
->
f‹r
->
Çme
);

3752 ià(
nb_f‹rg¿phs
 > 1)

3753 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " (g¿ph %d)", 
o¡
->
f‹r
->
g¿ph
->
šdex
);

3755 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " -> SŒ—m #%d:%d (%s)\n", 
o¡
->
fe_šdex
,

3756 
o¡
->
šdex
, o¡->
’c
 ? o¡->’c->
Çme
 : "?");

3760 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " Stream #%d:%d -> #%d:%d",

3761 
šput_¡»ams
[
o¡
->
sourû_šdex
]->
fe_šdex
,

3762 
šput_¡»ams
[
o¡
->
sourû_šdex
]->
¡
->
šdex
,

3763 
o¡
->
fe_šdex
,

3764 
o¡
->
šdex
);

3765 ià(
o¡
->
sync_i¡
 !ğ
šput_¡»ams
[o¡->
sourû_šdex
])

3766 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " [sync #%d:%d]",

3767 
o¡
->
sync_i¡
->
fe_šdex
,

3768 
o¡
->
sync_i¡
->
¡
->
šdex
);

3769 ià(
o¡
->
¡»am_cİy
)

3770 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " (copy)");

3772 cÚ¡ 
AVCodec
 *
š_codec
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
]->
dec
;

3773 cÚ¡ 
AVCodec
 *
out_codec
 = 
o¡
->
’c
;

3774 cÚ¡ *
decod”_Çme
 = "?";

3775 cÚ¡ *
š_codec_Çme
 = "?";

3776 cÚ¡ *
’cod”_Çme
 = "?";

3777 cÚ¡ *
out_codec_Çme
 = "?";

3778 cÚ¡ 
AVCodecDesütÜ
 *
desc
;

3780 ià(
š_codec
) {

3781 
decod”_Çme
 = 
š_codec
->
Çme
;

3782 
desc
 = 
	`avcodec_desütÜ_g‘
(
š_codec
->
id
);

3783 ià(
desc
)

3784 
š_codec_Çme
 = 
desc
->
Çme
;

3785 ià(!
	`¡rcmp
(
decod”_Çme
, 
š_codec_Çme
))

3786 
decod”_Çme
 = "native";

3789 ià(
out_codec
) {

3790 
’cod”_Çme
 = 
out_codec
->
Çme
;

3791 
desc
 = 
	`avcodec_desütÜ_g‘
(
out_codec
->
id
);

3792 ià(
desc
)

3793 
out_codec_Çme
 = 
desc
->
Çme
;

3794 ià(!
	`¡rcmp
(
’cod”_Çme
, 
out_codec_Çme
))

3795 
’cod”_Çme
 = "native";

3798 
	`av_log
(
NULL
, 
AV_LOG_INFO
, " (%s (%s) -> %s (%s))",

3799 
š_codec_Çme
, 
decod”_Çme
,

3800 
out_codec_Çme
, 
’cod”_Çme
);

3802 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "\n");

3805 ià(
»t
) {

3806 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "%s\n", 
”rÜ
);

3807  
»t
;

3810 
	`©omic_¡Üe
(&
Œªscode_š™_dÚe
, 1);

3813 
	}
}

3816 
	$Ãed_ouut
()

3818 
i
;

3820 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

3821 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

3822 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

3823 
AVFÜm©CÚ‹xt
 *
os
 = 
ouut_fes
[
o¡
->
fe_šdex
]->
ùx
;

3825 ià(
o¡
->
fšished
 ||

3826 (
os
->
pb
 && 
	`avio_‹Î
(os->pbè>ğ
of
->
lim™_fesize
))

3828 ià(
o¡
->
äame_numb”
 >ğo¡->
max_äames
) {

3829 
j
;

3830 
j
 = 0; j < 
of
->
ùx
->
nb_¡»ams
; j++)

3831 
	`şo£_ouut_¡»am
(
ouut_¡»ams
[
of
->
o¡_šdex
 + 
j
]);

3839 
	}
}

3846 
OuutSŒ—m
 *
	$choo£_ouut
()

3848 
i
;

3849 
št64_t
 
İts_mš
 = 
INT64_MAX
;

3850 
OuutSŒ—m
 *
o¡_mš
 = 
NULL
;

3852 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

3853 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

3854 
št64_t
 
İts
 = 
o¡
->
¡
->
cur_dts
 =ğ
AV_NOPTS_VALUE
 ? 
INT64_MIN
 :

3855 
	`av_»sÿË_q
(
o¡
->
¡
->
cur_dts
, o¡->¡->
time_ba£
,

3856 
AV_TIME_BASE_Q
);

3857 ià(
o¡
->
¡
->
cur_dts
 =ğ
AV_NOPTS_VALUE
)

3858 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "cur_dts is invalid (this is harmless if it occurs once‡the start…er stream)\n");

3860 ià(!
o¡
->
š™Ÿlized
 && !o¡->
šputs_dÚe
)

3861  
o¡
;

3863 ià(!
o¡
->
fšished
 && 
İts
 < 
İts_mš
) {

3864 
İts_mš
 = 
İts
;

3865 
o¡_mš
 = 
o¡
->
uÇvaabË
 ? 
NULL
 : ost;

3868  
o¡_mš
;

3869 
	}
}

3871 
	$£t_‰y_echo
(
Ú
)

3873 #ià
HAVE_TERMIOS_H


3874 
‹rmios
 
‰y
;

3875 ià(
	`tcg‘©Œ
(0, &
‰y
) == 0) {

3876 ià(
Ú
è
‰y
.
c_læag
 |ğ
ECHO
;

3877 
‰y
.
c_læag
 &ğ~
ECHO
;

3878 
	`tc£‰r
(0, 
TCSANOW
, &
‰y
);

3881 
	}
}

3883 
	$check_keybßrd_š‹¿ùiÚ
(
št64_t
 
cur_time
)

3885 
i
, 
»t
, 
key
;

3886 
št64_t
 
Ï¡_time
;

3887 ià(
»ûived_nb_sigÇls
)

3888  
AVERROR_EXIT
;

3890 if(
cur_time
 - 
Ï¡_time
 >ğ100000 && !
run_as_d«mÚ
){

3891 
key
 = 
	`»ad_key
();

3892 
Ï¡_time
 = 
cur_time
;

3894 
key
 = -1;

3895 ià(
key
 == 'q')

3896  
AVERROR_EXIT
;

3897 ià(
key
 =ğ'+'è
	`av_log_£t_Ëv–
(
	`av_log_g‘_Ëv–
()+10);

3898 ià(
key
 =ğ'-'è
	`av_log_£t_Ëv–
(
	`av_log_g‘_Ëv–
()-10);

3899 ià(
key
 =ğ's'è
qp_hi¡
 ^= 1;

3900 ià(
key
 == 'h'){

3901 ià(
do_hex_dump
){

3902 
do_hex_dump
 = 
do_pkt_dump
 = 0;

3903 } if(
do_pkt_dump
){

3904 
do_hex_dump
 = 1;

3906 
do_pkt_dump
 = 1;

3907 
	`av_log_£t_Ëv–
(
AV_LOG_DEBUG
);

3909 ià(
key
 == 'c' || key == 'C'){

3910 
buf
[4096], 
rg‘
[64], 
commªd
[256], 
¬g
[256] = {0};

3911 
time
;

3912 
k
, 
n
 = 0;

3913 
	`årštf
(
¡d”r
, "\nEnter command: <target>|all <time>|-1 <command>[ <argument>]\n");

3914 
i
 = 0;

3915 
	`£t_‰y_echo
(1);

3916 (
k
 = 
	`»ad_key
()è!ğ'\n' && k !ğ'\r' && 
i
 < (
buf
)-1)

3917 ià(
k
 > 0)

3918 
buf
[
i
++] = 
k
;

3919 
buf
[
i
] = 0;

3920 
	`£t_‰y_echo
(0);

3921 
	`årštf
(
¡d”r
, "\n");

3922 ià(
k
 > 0 &&

3923 (
n
 = 
	`ssÿnf
(
buf
, "%63[^ ] %là%255[^ ] %255[^\n]", 
rg‘
, &
time
, 
commªd
, 
¬g
)) >= 3) {

3924 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Processing commandarget:%sime:%f command:%s‡rg:%s",

3925 
rg‘
, 
time
, 
commªd
, 
¬g
);

3926 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

3927 
F‹rG¿ph
 *
fg
 = 
f‹rg¿phs
[
i
];

3928 ià(
fg
->
g¿ph
) {

3929 ià(
time
 < 0) {

3930 
»t
 = 
	`avf‹r_g¿ph_£nd_commªd
(
fg
->
g¿ph
, 
rg‘
, 
commªd
, 
¬g
, 
buf
, (buf),

3931 
key
 =ğ'c' ? 
AVFILTER_CMD_FLAG_ONE
 : 0);

3932 
	`årštf
(
¡d”r
, "Commªd„•ly fÜ sŒ—m %d:„‘:%d„es:\n%s", 
i
, 
»t
, 
buf
);

3933 } ià(
key
 == 'c') {

3934 
	`årštf
(
¡d”r
, "Queuing commands only on filters supportinghe specific command is unsupported\n");

3935 
»t
 = 
AVERROR_PATCHWELCOME
;

3937 
»t
 = 
	`avf‹r_g¿ph_queue_commªd
(
fg
->
g¿ph
, 
rg‘
, 
commªd
, 
¬g
, 0, 
time
);

3938 ià(
»t
 < 0)

3939 
	`årštf
(
¡d”r
, "Queušg commªd faed w™hƒ¼Ü %s\n", 
	`av_”r2¡r
(
»t
));

3944 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

3946 "Úly %d giv’ iÀ¡ršg '%s'\n", 
n
, 
buf
);

3949 ià(
key
 == 'd' || key == 'D'){

3950 
debug
=0;

3951 if(
key
 == 'D') {

3952 
debug
 = 
šput_¡»ams
[0]->
¡
->
codec
->debug<<1;

3953 if(!
debug
) debug = 1;

3954 
debug
 & (
FF_DEBUG_DCT_COEFF
|
FF_DEBUG_VIS_QP
|
FF_DEBUG_VIS_MB_TYPE
))

3955 
debug
 += debug;

3957 
buf
[32];

3958 
k
 = 0;

3959 
i
 = 0;

3960 
	`£t_‰y_echo
(1);

3961 (
k
 = 
	`»ad_key
()è!ğ'\n' && k !ğ'\r' && 
i
 < (
buf
)-1)

3962 ià(
k
 > 0)

3963 
buf
[
i
++] = 
k
;

3964 
buf
[
i
] = 0;

3965 
	`£t_‰y_echo
(0);

3966 
	`årštf
(
¡d”r
, "\n");

3967 ià(
k
 <ğ0 || 
	`ssÿnf
(
buf
, "%d", &
debug
)!=1)

3968 
	`årštf
(
¡d”r
,"error…arsing debug value\n");

3970 
i
=0;i<
nb_šput_¡»ams
;i++) {

3971 
šput_¡»ams
[
i
]->
¡
->
codec
->
debug
 = debug;

3973 
i
=0;i<
nb_ouut_¡»ams
;i++) {

3974 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

3975 
o¡
->
’c_ùx
->
debug
 = debug;

3977 if(
debug
è
	`av_log_£t_Ëv–
(
AV_LOG_DEBUG
);

3978 
	`årštf
(
¡d”r
,"debug=%d\n", 
debug
);

3980 ià(
key
 == '?'){

3981 
	`årštf
(
¡d”r
, "key function\n"

3994 
	}
}

3996 #ià
HAVE_PTHREADS


3997 *
	$šput_th»ad
(*
¬g
)

3999 
IÅutFe
 *
f
 = 
¬g
;

4000 
æags
 = 
f
->
nÚ_blockšg
 ? 
AV_THREAD_MESSAGE_NONBLOCK
 : 0;

4001 
»t
 = 0;

4004 
AVPack‘
 
pkt
;

4005 
»t
 = 
	`av_»ad_äame
(
f
->
ùx
, &
pkt
);

4007 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

4008 
	`av_u¦“p
(10000);

4011 ià(
»t
 < 0) {

4012 
	`av_th»ad_mes§ge_queue_£t_”r_»cv
(
f
->
š_th»ad_queue
, 
»t
);

4015 
»t
 = 
	`av_th»ad_mes§ge_queue_£nd
(
f
->
š_th»ad_queue
, &
pkt
, 
æags
);

4016 ià(
æags
 && 
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

4017 
æags
 = 0;

4018 
»t
 = 
	`av_th»ad_mes§ge_queue_£nd
(
f
->
š_th»ad_queue
, &
pkt
, 
æags
);

4019 
	`av_log
(
f
->
ùx
, 
AV_LOG_WARNING
,

4022 
f
->
th»ad_queue_size
);

4024 ià(
»t
 < 0) {

4025 ià(
»t
 !ğ
AVERROR_EOF
)

4026 
	`av_log
(
f
->
ùx
, 
AV_LOG_ERROR
,

4028 
	`av_”r2¡r
(
»t
));

4029 
	`av_·ck‘_uÄef
(&
pkt
);

4030 
	`av_th»ad_mes§ge_queue_£t_”r_»cv
(
f
->
š_th»ad_queue
, 
»t
);

4035  
NULL
;

4036 
	}
}

4038 
	$ä“_šput_th»ads
()

4040 
i
;

4042 
i
 = 0; i < 
nb_šput_fes
; i++) {

4043 
IÅutFe
 *
f
 = 
šput_fes
[
i
];

4044 
AVPack‘
 
pkt
;

4046 ià(!
f
 || !f->
š_th»ad_queue
)

4048 
	`av_th»ad_mes§ge_queue_£t_”r_£nd
(
f
->
š_th»ad_queue
, 
AVERROR_EOF
);

4049 
	`av_th»ad_mes§ge_queue_»cv
(
f
->
š_th»ad_queue
, &
pkt
, 0) >= 0)

4050 
	`av_·ck‘_uÄef
(&
pkt
);

4052 
	`±h»ad_još
(
f
->
th»ad
, 
NULL
);

4053 
f
->
jošed
 = 1;

4054 
	`av_th»ad_mes§ge_queue_ä“
(&
f
->
š_th»ad_queue
);

4056 
	}
}

4058 
	$š™_šput_th»ads
()

4060 
i
, 
»t
;

4062 ià(
nb_šput_fes
 == 1)

4065 
i
 = 0; i < 
nb_šput_fes
; i++) {

4066 
IÅutFe
 *
f
 = 
šput_fes
[
i
];

4068 ià(
f
->
ùx
->
pb
 ? !f->ùx->pb->
£ekabË
 :

4069 
	`¡rcmp
(
f
->
ùx
->
ifÜm©
->
Çme
, "lavfi"))

4070 
f
->
nÚ_blockšg
 = 1;

4071 
»t
 = 
	`av_th»ad_mes§ge_queue_®loc
(&
f
->
š_th»ad_queue
,

4072 
f
->
th»ad_queue_size
, (
AVPack‘
));

4073 ià(
»t
 < 0)

4074  
»t
;

4076 ià((
»t
 = 
	`±h»ad_ü—‹
(&
f
->
th»ad
, 
NULL
, 
šput_th»ad
, f))) {

4077 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "±h»ad_ü—‹ faed: %s. TryØšü—£ `ulim™ -v` o¸deü—£ `ulim™ -s`.\n", 
	`¡»¼Ü
(
»t
));

4078 
	`av_th»ad_mes§ge_queue_ä“
(&
f
->
š_th»ad_queue
);

4079  
	`AVERROR
(
»t
);

4083 
	}
}

4085 
	$g‘_šput_·ck‘_mt
(
IÅutFe
 *
f
, 
AVPack‘
 *
pkt
)

4087  
	`av_th»ad_mes§ge_queue_»cv
(
f
->
š_th»ad_queue
, 
pkt
,

4088 
f
->
nÚ_blockšg
 ?

4089 
AV_THREAD_MESSAGE_NONBLOCK
 : 0);

4090 
	}
}

4093 
	$g‘_šput_·ck‘
(
IÅutFe
 *
f
, 
AVPack‘
 *
pkt
)

4095 ià(
f
->
¿‹_emu
) {

4096 
i
;

4097 
i
 = 0; i < 
f
->
nb_¡»ams
; i++) {

4098 
IÅutSŒ—m
 *
i¡
 = 
šput_¡»ams
[
f
->
i¡_šdex
 + 
i
];

4099 
št64_t
 
±s
 = 
	`av_»sÿË
(
i¡
->
dts
, 1000000, 
AV_TIME_BASE
);

4100 
št64_t
 
now
 = 
	`av_g‘time_»Ïtive
(è- 
i¡
->
¡¬t
;

4101 ià(
±s
 > 
now
)

4102  
	`AVERROR
(
EAGAIN
);

4106 #ià
HAVE_PTHREADS


4107 ià(
nb_šput_fes
 > 1)

4108  
	`g‘_šput_·ck‘_mt
(
f
, 
pkt
);

4110  
	`av_»ad_äame
(
f
->
ùx
, 
pkt
);

4111 
	}
}

4113 
	$gÙ_—gaš
()

4115 
i
;

4116 
i
 = 0; i < 
nb_ouut_¡»ams
; i++)

4117 ià(
ouut_¡»ams
[
i
]->
uÇvaabË
)

4120 
	}
}

4122 
	$»£t_—gaš
()

4124 
i
;

4125 
i
 = 0; i < 
nb_šput_fes
; i++)

4126 
šput_fes
[
i
]->
—gaš
 = 0;

4127 
i
 = 0; i < 
nb_ouut_¡»ams
; i++)

4128 
ouut_¡»ams
[
i
]->
uÇvaabË
 = 0;

4129 
	}
}

4132 
AVR©iÚ®
 
	$du¿tiÚ_max
(
št64_t
 
tmp
, iÁ64_ˆ*
du¿tiÚ
, 
AVR©iÚ®
 
tmp_time_ba£
,

4133 
AVR©iÚ®
 
time_ba£
)

4135 
»t
;

4137 ià(!*
du¿tiÚ
) {

4138 *
du¿tiÚ
 = 
tmp
;

4139  
tmp_time_ba£
;

4142 
»t
 = 
	`av_com·»_ts
(*
du¿tiÚ
, 
time_ba£
, 
tmp
, 
tmp_time_ba£
);

4143 ià(
»t
 < 0) {

4144 *
du¿tiÚ
 = 
tmp
;

4145  
tmp_time_ba£
;

4148  
time_ba£
;

4149 
	}
}

4151 
	$£ek_to_¡¬t
(
IÅutFe
 *
ife
, 
AVFÜm©CÚ‹xt
 *
is
)

4153 
IÅutSŒ—m
 *
i¡
;

4154 
AVCodecCÚ‹xt
 *
avùx
;

4155 
i
, 
»t
, 
has_audio
 = 0;

4156 
št64_t
 
du¿tiÚ
 = 0;

4158 
»t
 = 
	`av_£ek_äame
(
is
, -1, is->
¡¬t_time
, 0);

4159 ià(
»t
 < 0)

4160  
»t
;

4162 
i
 = 0; i < 
ife
->
nb_¡»ams
; i++) {

4163 
i¡
 = 
šput_¡»ams
[
ife
->
i¡_šdex
 + 
i
];

4164 
avùx
 = 
i¡
->
dec_ùx
;

4167 ià(
i¡
->
decodšg_Ãeded
) {

4168 
	`´oûss_šput_·ck‘
(
i¡
, 
NULL
, 1);

4169 
	`avcodec_æush_bufãrs
(
avùx
);

4175 ià(
avùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 && 
i¡
->
nb_§m¶es
)

4176 
has_audio
 = 1;

4179 
i
 = 0; i < 
ife
->
nb_¡»ams
; i++) {

4180 
i¡
 = 
šput_¡»ams
[
ife
->
i¡_šdex
 + 
i
];

4181 
avùx
 = 
i¡
->
dec_ùx
;

4183 ià(
has_audio
) {

4184 ià(
avùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 && 
i¡
->
nb_§m¶es
) {

4185 
AVR©iÚ®
 
§m¶e_¿‹
 = {1, 
avùx
->sample_rate};

4187 
du¿tiÚ
 = 
	`av_»sÿË_q
(
i¡
->
nb_§m¶es
, 
§m¶e_¿‹
, i¡->
¡
->
time_ba£
);

4191 ià(
i¡
->
äam”©e
.
num
) {

4192 
du¿tiÚ
 = 
	`av_»sÿË_q
(1, 
i¡
->
äam”©e
, i¡->
¡
->
time_ba£
);

4193 } ià(
i¡
->
¡
->
avg_äame_¿‹
.
num
) {

4194 
du¿tiÚ
 = 
	`av_»sÿË_q
(1, 
i¡
->
¡
->
avg_äame_¿‹
, i¡->¡->
time_ba£
);

4195 } 
du¿tiÚ
 = 1;

4197 ià(!
ife
->
du¿tiÚ
)

4198 
ife
->
time_ba£
 = 
i¡
->
¡
->time_base;

4201 
du¿tiÚ
 +ğ
i¡
->
max_±s
 - i¡->
mš_±s
;

4202 
ife
->
time_ba£
 = 
	`du¿tiÚ_max
(
du¿tiÚ
, &ife->du¿tiÚ, 
i¡
->
¡
->time_base,

4203 
ife
->
time_ba£
);

4206 ià(
ife
->
loİ
 > 0)

4207 
ife
->
loİ
--;

4209  
»t
;

4210 
	}
}

4219 
	$´oûss_šput
(
fe_šdex
)

4221 
IÅutFe
 *
ife
 = 
šput_fes
[
fe_šdex
];

4222 
AVFÜm©CÚ‹xt
 *
is
;

4223 
IÅutSŒ—m
 *
i¡
;

4224 
AVPack‘
 
pkt
;

4225 
»t
, 
i
, 
j
;

4226 
št64_t
 
du¿tiÚ
;

4227 
št64_t
 
pkt_dts
;

4229 
is
 = 
ife
->
ùx
;

4230 
»t
 = 
	`g‘_šput_·ck‘
(
ife
, &
pkt
);

4232 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

4233 
ife
->
—gaš
 = 1;

4234  
»t
;

4236 ià(
»t
 < 0 && 
ife
->
loİ
) {

4237 ià((
»t
 = 
	`£ek_to_¡¬t
(
ife
, 
is
)) < 0)

4238  
»t
;

4239 
»t
 = 
	`g‘_šput_·ck‘
(
ife
, &
pkt
);

4240 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

4241 
ife
->
—gaš
 = 1;

4242  
»t
;

4245 ià(
»t
 < 0) {

4246 ià(
»t
 !ğ
AVERROR_EOF
) {

4247 
	`´št_”rÜ
(
is
->
f’ame
, 
»t
);

4248 ià(
ex™_Ú_”rÜ
)

4249 
	`ex™_´og¿m
(1);

4252 
i
 = 0; i < 
ife
->
nb_¡»ams
; i++) {

4253 
i¡
 = 
šput_¡»ams
[
ife
->
i¡_šdex
 + 
i
];

4254 ià(
i¡
->
decodšg_Ãeded
) {

4255 
»t
 = 
	`´oûss_šput_·ck‘
(
i¡
, 
NULL
, 0);

4256 ià(
»t
>0)

4261 
j
 = 0; j < 
nb_ouut_¡»ams
; j++) {

4262 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
j
];

4264 ià(
o¡
->
sourû_šdex
 =ğ
ife
->
i¡_šdex
 + 
i
 &&

4265 (
o¡
->
¡»am_cİy
 || o¡->
’c
->
ty³
 =ğ
AVMEDIA_TYPE_SUBTITLE
))

4266 
	`fšish_ouut_¡»am
(
o¡
);

4270 
ife
->
eof_»ached
 = 1;

4271  
	`AVERROR
(
EAGAIN
);

4274 
	`»£t_—gaš
();

4276 ià(
do_pkt_dump
) {

4277 
	`av_pkt_dump_log2
(
NULL
, 
AV_LOG_INFO
, &
pkt
, 
do_hex_dump
,

4278 
is
->
¡»ams
[
pkt
.
¡»am_šdex
]);

4282 ià(
pkt
.
¡»am_šdex
 >ğ
ife
->
nb_¡»ams
) {

4283 
	`»pÜt_Ãw_¡»am
(
fe_šdex
, &
pkt
);

4284 
disÿrd_·ck‘
;

4287 
i¡
 = 
šput_¡»ams
[
ife
->
i¡_šdex
 + 
pkt
.
¡»am_šdex
];

4289 
i¡
->
d©a_size
 +ğ
pkt
.
size
;

4290 
i¡
->
nb_·ck‘s
++;

4292 ià(
i¡
->
disÿrd
)

4293 
disÿrd_·ck‘
;

4295 ià(
ex™_Ú_”rÜ
 && (
pkt
.
æags
 & 
AV_PKT_FLAG_CORRUPT
)) {

4296 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s: cÜru± iÅuˆ·ck‘ iÀ¡»am %d\n", 
is
->
f’ame
, 
pkt
.
¡»am_šdex
);

4297 
	`ex™_´og¿m
(1);

4300 ià(
debug_ts
) {

4301 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "demuxer -> ist_index:%dype:%s "

4303 
ife
->
i¡_šdex
 + 
pkt
.
¡»am_šdex
, 
	`av_g‘_medŸ_ty³_¡ršg
(
i¡
->
dec_ùx
->
codec_ty³
),

4304 
	`av_ts2¡r
(
i¡
->
Ãxt_dts
), 
	`av_ts2time¡r
(i¡->Ãxt_dts, &
AV_TIME_BASE_Q
),

4305 
	`av_ts2¡r
(
i¡
->
Ãxt_±s
), 
	`av_ts2time¡r
(i¡->Ãxt_±s, &
AV_TIME_BASE_Q
),

4306 
	`av_ts2¡r
(
pkt
.
±s
), 
	`av_ts2time¡r
Õkt.±s, &
i¡
->
¡
->
time_ba£
),

4307 
	`av_ts2¡r
(
pkt
.
dts
), 
	`av_ts2time¡r
Õkt.dts, &
i¡
->
¡
->
time_ba£
),

4308 
	`av_ts2¡r
(
šput_fes
[
i¡
->
fe_šdex
]->
ts_off£t
),

4309 
	`av_ts2time¡r
(
šput_fes
[
i¡
->
fe_šdex
]->
ts_off£t
, &
AV_TIME_BASE_Q
));

4312 if(!
i¡
->
w¿p_cÜ»ùiÚ_dÚe
 && 
is
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 && i¡->
¡
->
±s_w¿p_b™s
 < 64){

4313 
št64_t
 
¡ime
, 
¡ime2
;

4317 iàĞ
i¡
->
Ãxt_dts
 =ğ
AV_NOPTS_VALUE


4318 && 
ife
->
ts_off£t
 =ğ-
is
->
¡¬t_time


4319 && (
is
->
ifÜm©
->
æags
 & 
AVFMT_TS_DISCONT
)) {

4320 
št64_t
 
Ãw_¡¬t_time
 = 
INT64_MAX
;

4321 
i
=0; i<
is
->
nb_¡»ams
; i++) {

4322 
AVSŒ—m
 *
¡
 = 
is
->
¡»ams
[
i
];

4323 if(
¡
->
disÿrd
 =ğ
AVDISCARD_ALL
 || st->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
)

4325 
Ãw_¡¬t_time
 = 
	`FFMIN
Òew_¡¬t_time, 
	`av_»sÿË_q
(
¡
->
¡¬t_time
, st->
time_ba£
, 
AV_TIME_BASE_Q
));

4327 ià(
Ãw_¡¬t_time
 > 
is
->
¡¬t_time
) {

4328 
	`av_log
(
is
, 
AV_LOG_VERBOSE
, "CÜ»ùšg s¹imby %"
PRId64
"\n", 
Ãw_¡¬t_time
 - is->
¡¬t_time
);

4329 
ife
->
ts_off£t
 = -
Ãw_¡¬t_time
;

4333 
¡ime
 = 
	`av_»sÿË_q
(
is
->
¡¬t_time
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4334 
¡ime2
ğ
¡ime
 + (1ULL<<
i¡
->
¡
->
±s_w¿p_b™s
);

4335 
i¡
->
w¿p_cÜ»ùiÚ_dÚe
 = 1;

4337 if(
¡ime2
 > 
¡ime
 && 
pkt
.
dts
 !ğ
AV_NOPTS_VALUE
 &&…kt.dt > stim+ (1LL<<(
i¡
->
¡
->
±s_w¿p_b™s
-1))) {

4338 
pkt
.
dts
 -ğ1ULL<<
i¡
->
¡
->
±s_w¿p_b™s
;

4339 
i¡
->
w¿p_cÜ»ùiÚ_dÚe
 = 0;

4341 if(
¡ime2
 > 
¡ime
 && 
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
 &&…kt.± > stim+ (1LL<<(
i¡
->
¡
->
±s_w¿p_b™s
-1))) {

4342 
pkt
.
±s
 -ğ1ULL<<
i¡
->
¡
->
±s_w¿p_b™s
;

4343 
i¡
->
w¿p_cÜ»ùiÚ_dÚe
 = 0;

4348 ià(
i¡
->
nb_·ck‘s
 == 1) {

4349 
i
 = 0; i < 
i¡
->
¡
->
nb_side_d©a
; i++) {

4350 
AVPack‘SideD©a
 *
¤c_sd
 = &
i¡
->
¡
->
side_d©a
[
i
];

4351 
ušt8_t
 *
d¡_d©a
;

4353 ià(
¤c_sd
->
ty³
 =ğ
AV_PKT_DATA_DISPLAYMATRIX
)

4356 ià(
	`av_·ck‘_g‘_side_d©a
(&
pkt
, 
¤c_sd
->
ty³
, 
NULL
))

4359 
d¡_d©a
 = 
	`av_·ck‘_Ãw_side_d©a
(&
pkt
, 
¤c_sd
->
ty³
, src_sd->
size
);

4360 ià(!
d¡_d©a
)

4361 
	`ex™_´og¿m
(1);

4363 
	`memıy
(
d¡_d©a
, 
¤c_sd
->
d©a
, src_sd->
size
);

4367 ià(
pkt
.
dts
 !ğ
AV_NOPTS_VALUE
)

4368 
pkt
.
dts
 +ğ
	`av_»sÿË_q
(
ife
->
ts_off£t
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4369 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
)

4370 
pkt
.
±s
 +ğ
	`av_»sÿË_q
(
ife
->
ts_off£t
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4372 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
)

4373 
pkt
.
±s
 *ğ
i¡
->
ts_sÿË
;

4374 ià(
pkt
.
dts
 !ğ
AV_NOPTS_VALUE
)

4375 
pkt
.
dts
 *ğ
i¡
->
ts_sÿË
;

4377 
pkt_dts
 = 
	`av_»sÿË_q_ºd
(
pkt
.
dts
, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
, 
AV_ROUND_NEAR_INF
|
AV_ROUND_PASS_MINMAX
);

4378 ià((
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||

4379 
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
) &&

4380 
pkt_dts
 !ğ
AV_NOPTS_VALUE
 && 
i¡
->
Ãxt_dts
 =ğAV_NOPTS_VALUE && !
cİy_ts


4381 && (
is
->
ifÜm©
->
æags
 & 
AVFMT_TS_DISCONT
è&& 
ife
->
Ï¡_ts
 !ğ
AV_NOPTS_VALUE
) {

4382 
št64_t
 
d–
 = 
pkt_dts
 - 
ife
->
Ï¡_ts
;

4383 ià(
d–
 < -1LL*
dts_d–_th»shŞd
*
AV_TIME_BASE
 ||

4384 
d–
 > 1LL*
dts_d–_th»shŞd
*
AV_TIME_BASE
){

4385 
ife
->
ts_off£t
 -ğ
d–
;

4386 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
,

4387 "IÁ” sŒ—mime¡am°discÚtšu™y %"
PRId64
",‚ew offset= %"PRId64"\n",

4388 
d–
, 
ife
->
ts_off£t
);

4389 
pkt
.
dts
 -ğ
	`av_»sÿË_q
(
d–
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4390 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
)

4391 
pkt
.
±s
 -ğ
	`av_»sÿË_q
(
d–
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4395 
du¿tiÚ
 = 
	`av_»sÿË_q
(
ife
->du¿tiÚ, ife->
time_ba£
, 
i¡
->
¡
->time_base);

4396 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
) {

4397 
pkt
.
±s
 +ğ
du¿tiÚ
;

4398 
i¡
->
max_±s
 = 
	`FFMAX
(
pkt
.
±s
, ist->max_pts);

4399 
i¡
->
mš_±s
 = 
	`FFMIN
(
pkt
.
±s
, ist->min_pts);

4402 ià(
pkt
.
dts
 !ğ
AV_NOPTS_VALUE
)

4403 
pkt
.
dts
 +ğ
du¿tiÚ
;

4405 
pkt_dts
 = 
	`av_»sÿË_q_ºd
(
pkt
.
dts
, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
, 
AV_ROUND_NEAR_INF
|
AV_ROUND_PASS_MINMAX
);

4406 ià((
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||

4407 
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
) &&

4408 
pkt_dts
 !ğ
AV_NOPTS_VALUE
 && 
i¡
->
Ãxt_dts
 != AV_NOPTS_VALUE &&

4409 !
cİy_ts
) {

4410 
št64_t
 
d–
 = 
pkt_dts
 - 
i¡
->
Ãxt_dts
;

4411 ià(
is
->
ifÜm©
->
æags
 & 
AVFMT_TS_DISCONT
) {

4412 ià(
d–
 < -1LL*
dts_d–_th»shŞd
*
AV_TIME_BASE
 ||

4413 
d–
 > 1LL*
dts_d–_th»shŞd
*
AV_TIME_BASE
 ||

4414 
pkt_dts
 + 
AV_TIME_BASE
/10 < 
	`FFMAX
(
i¡
->
±s
, i¡->
dts
)) {

4415 
ife
->
ts_off£t
 -ğ
d–
;

4416 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
,

4417 "time¡am°discÚtšu™y %"
PRId64
",‚ew offset= %"PRId64"\n",

4418 
d–
, 
ife
->
ts_off£t
);

4419 
pkt
.
dts
 -ğ
	`av_»sÿË_q
(
d–
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4420 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
)

4421 
pkt
.
±s
 -ğ
	`av_»sÿË_q
(
d–
, 
AV_TIME_BASE_Q
, 
i¡
->
¡
->
time_ba£
);

4424 iàĞ
d–
 < -1LL*
dts_”rÜ_th»shŞd
*
AV_TIME_BASE
 ||

4425 
d–
 > 1LL*
dts_”rÜ_th»shŞd
*
AV_TIME_BASE
) {

4426 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "DTS %"
PRId64
",‚ext:%"PRId64" st:%d inv®id drİpšg\n", 
pkt
.
dts
, 
i¡
->
Ãxt_dts
,…kt.
¡»am_šdex
);

4427 
pkt
.
dts
 = 
AV_NOPTS_VALUE
;

4429 ià(
pkt
.
±s
 !ğ
AV_NOPTS_VALUE
){

4430 
št64_t
 
pkt_±s
 = 
	`av_»sÿË_q
(
pkt
.
±s
, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

4431 
d–
 = 
pkt_±s
 - 
i¡
->
Ãxt_dts
;

4432 iàĞ
d–
 < -1LL*
dts_”rÜ_th»shŞd
*
AV_TIME_BASE
 ||

4433 
d–
 > 1LL*
dts_”rÜ_th»shŞd
*
AV_TIME_BASE
) {

4434 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "PTS %"
PRId64
",‚ext:%"PRId64" inv®id drİpšg st:%d\n", 
pkt
.
±s
, 
i¡
->
Ãxt_dts
,…kt.
¡»am_šdex
);

4435 
pkt
.
±s
 = 
AV_NOPTS_VALUE
;

4441 ià(
pkt
.
dts
 !ğ
AV_NOPTS_VALUE
)

4442 
ife
->
Ï¡_ts
 = 
	`av_»sÿË_q
(
pkt
.
dts
, 
i¡
->
¡
->
time_ba£
, 
AV_TIME_BASE_Q
);

4444 ià(
debug_ts
) {

4445 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "demuxer+ffmpeg -> ist_index:%dype:%s…kt_pts:%s…kt_pts_time:%s…kt_dts:%s…kt_dts_time:%s off:%s off_time:%s\n",

4446 
ife
->
i¡_šdex
 + 
pkt
.
¡»am_šdex
, 
	`av_g‘_medŸ_ty³_¡ršg
(
i¡
->
dec_ùx
->
codec_ty³
),

4447 
	`av_ts2¡r
(
pkt
.
±s
), 
	`av_ts2time¡r
Õkt.±s, &
i¡
->
¡
->
time_ba£
),

4448 
	`av_ts2¡r
(
pkt
.
dts
), 
	`av_ts2time¡r
Õkt.dts, &
i¡
->
¡
->
time_ba£
),

4449 
	`av_ts2¡r
(
šput_fes
[
i¡
->
fe_šdex
]->
ts_off£t
),

4450 
	`av_ts2time¡r
(
šput_fes
[
i¡
->
fe_šdex
]->
ts_off£t
, &
AV_TIME_BASE_Q
));

4453 
	`sub2video_h—¹b—t
(
i¡
, 
pkt
.
±s
);

4455 
	`´oûss_šput_·ck‘
(
i¡
, &
pkt
, 0);

4457 
disÿrd_·ck‘
:

4458 
	`av_·ck‘_uÄef
(&
pkt
);

4461 
	}
}

4470 
	$Œªscode_äom_f‹r
(
F‹rG¿ph
 *
g¿ph
, 
IÅutSŒ—m
 **
be¡_i¡
)

4472 
i
, 
»t
;

4473 
nb_»que¡s
, 
nb_»que¡s_max
 = 0;

4474 
IÅutF‹r
 *
if‹r
;

4475 
IÅutSŒ—m
 *
i¡
;

4477 *
be¡_i¡
 = 
NULL
;

4478 
»t
 = 
	`avf‹r_g¿ph_»que¡_Şde¡
(
g¿ph
->graph);

4479 ià(
»t
 >= 0)

4480  
	`»­_f‹rs
(0);

4482 ià(
»t
 =ğ
AVERROR_EOF
) {

4483 
»t
 = 
	`»­_f‹rs
(1);

4484 
i
 = 0; i < 
g¿ph
->
nb_ouuts
; i++)

4485 
	`şo£_ouut_¡»am
(
g¿ph
->
ouuts
[
i
]->
o¡
);

4486  
»t
;

4488 ià(
»t
 !ğ
	`AVERROR
(
EAGAIN
))

4489  
»t
;

4491 
i
 = 0; i < 
g¿ph
->
nb_šputs
; i++) {

4492 
if‹r
 = 
g¿ph
->
šputs
[
i
];

4493 
i¡
 = 
if‹r
->ist;

4494 ià(
šput_fes
[
i¡
->
fe_šdex
]->
—gaš
 ||

4495 
šput_fes
[
i¡
->
fe_šdex
]->
eof_»ached
)

4497 
nb_»que¡s
 = 
	`av_bufãr¤c_g‘_nb_çed_»que¡s
(
if‹r
->
f‹r
);

4498 ià(
nb_»que¡s
 > 
nb_»que¡s_max
) {

4499 
nb_»que¡s_max
 = 
nb_»que¡s
;

4500 *
be¡_i¡
 = 
i¡
;

4504 ià(!*
be¡_i¡
)

4505 
i
 = 0; i < 
g¿ph
->
nb_ouuts
; i++)

4506 
g¿ph
->
ouuts
[
i
]->
o¡
->
uÇvaabË
 = 1;

4509 
	}
}

4516 
	$Œªscode_¡•
()

4518 
OuutSŒ—m
 *
o¡
;

4519 
IÅutSŒ—m
 *
i¡
 = 
NULL
;

4520 
»t
;

4522 
o¡
 = 
	`choo£_ouut
();

4523 ià(!
o¡
) {

4524 ià(
	`gÙ_—gaš
()) {

4525 
	`»£t_—gaš
();

4526 
	`av_u¦“p
(10000);

4529 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "No more inputso„ead from, finishing.\n");

4530  
AVERROR_EOF
;

4533 ià(
o¡
->
f‹r
 && !o¡->f‹r->
g¿ph
->graph) {

4534 ià(
	`if‹r_has_®l_šput_fÜm©s
(
o¡
->
f‹r
->
g¿ph
)) {

4535 
»t
 = 
	`cÚfigu»_f‹rg¿ph
(
o¡
->
f‹r
->
g¿ph
);

4536 ià(
»t
 < 0) {

4537 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error„einitializing filters!\n");

4538  
»t
;

4543 ià(
o¡
->
f‹r
 && o¡->f‹r->
g¿ph
->graph) {

4544 ià((
»t
 = 
	`Œªscode_äom_f‹r
(
o¡
->
f‹r
->
g¿ph
, &
i¡
)) < 0)

4545  
»t
;

4546 ià(!
i¡
)

4548 } ià(
o¡
->
f‹r
) {

4549 
i
;

4550 
i
 = 0; i < 
o¡
->
f‹r
->
g¿ph
->
nb_šputs
; i++) {

4551 
IÅutF‹r
 *
if‹r
 = 
o¡
->
f‹r
->
g¿ph
->
šputs
[
i
];

4552 ià(!
if‹r
->
i¡
->
gÙ_ouut
 && !
šput_fes
[if‹r->i¡->
fe_šdex
]->
eof_»ached
) {

4553 
i¡
 = 
if‹r
->ist;

4557 ià(!
i¡
) {

4558 
o¡
->
šputs_dÚe
 = 1;

4562 
	`av_as£¹0
(
o¡
->
sourû_šdex
 >= 0);

4563 
i¡
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
];

4566 
»t
 = 
	`´oûss_šput
(
i¡
->
fe_šdex
);

4567 ià(
»t
 =ğ
	`AVERROR
(
EAGAIN
)) {

4568 ià(
šput_fes
[
i¡
->
fe_šdex
]->
—gaš
)

4569 
o¡
->
uÇvaabË
 = 1;

4573 ià(
»t
 < 0)

4574  
»t
 =ğ
AVERROR_EOF
 ? 0 :„et;

4576  
	`»­_f‹rs
(0);

4577 
	}
}

4582 
	$Œªscode
()

4584 
»t
, 
i
;

4585 
AVFÜm©CÚ‹xt
 *
os
;

4586 
OuutSŒ—m
 *
o¡
;

4587 
IÅutSŒ—m
 *
i¡
;

4588 
št64_t
 
tim”_¡¬t
;

4589 
št64_t
 
tÙ®_·ck‘s_wr™‹n
 = 0;

4591 
»t
 = 
	`Œªscode_š™
();

4592 ià(
»t
 < 0)

4593 
ç
;

4595 ià(
¡dš_š‹¿ùiÚ
) {

4596 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Press [q]o stop, [?] for help\n");

4599 
tim”_¡¬t
 = 
	`av_g‘time_»Ïtive
();

4601 #ià
HAVE_PTHREADS


4602 ià((
»t
 = 
	`š™_šput_th»ads
()) < 0)

4603 
ç
;

4606 !
»ûived_sig‹rm
) {

4607 
št64_t
 
cur_time
ğ
	`av_g‘time_»Ïtive
();

4610 ià(
¡dš_š‹¿ùiÚ
)

4611 ià(
	`check_keybßrd_š‹¿ùiÚ
(
cur_time
) < 0)

4615 ià(!
	`Ãed_ouut
()) {

4616 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "No more output streamso writeo, finishing.\n");

4620 
»t
 = 
	`Œªscode_¡•
();

4621 ià(
»t
 < 0 &&„‘ !ğ
AVERROR_EOF
) {

4622 
”rbuf
[128];

4623 
	`av_¡»¼Ü
(
»t
, 
”rbuf
, (errbuf));

4625 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü whf‹ršg: %s\n", 
”rbuf
);

4630 
	`´št_»pÜt
(0, 
tim”_¡¬t
, 
cur_time
);

4632 #ià
HAVE_PTHREADS


4633 
	`ä“_šput_th»ads
();

4637 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

4638 
i¡
 = 
šput_¡»ams
[
i
];

4639 ià(!
šput_fes
[
i¡
->
fe_šdex
]->
eof_»ached
 && i¡->
decodšg_Ãeded
) {

4640 
	`´oûss_šput_·ck‘
(
i¡
, 
NULL
, 0);

4643 
	`æush_’cod”s
();

4645 
	`‹rm_ex™
();

4648 
i
 = 0; i < 
nb_ouut_fes
; i++) {

4649 
os
 = 
ouut_fes
[
i
]->
ùx
;

4650 ià(!
ouut_fes
[
i
]->
h—d”_wr™‹n
) {

4651 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

4654 
i
, 
os
->
f’ame
);

4657 ià((
»t
 = 
	`av_wr™e_Œa”
(
os
)) < 0) {

4658 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü wr™šg¿” oà%s: %s\n", 
os
->
f’ame
, 
	`av_”r2¡r
(
»t
));

4659 ià(
ex™_Ú_”rÜ
)

4660 
	`ex™_´og¿m
(1);

4665 
	`´št_»pÜt
(1, 
tim”_¡¬t
, 
	`av_g‘time_»Ïtive
());

4668 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

4669 
o¡
 = 
ouut_¡»ams
[
i
];

4670 ià(
o¡
->
’codšg_Ãeded
) {

4671 
	`av_ä“p
(&
o¡
->
’c_ùx
->
¡©s_š
);

4673 
tÙ®_·ck‘s_wr™‹n
 +ğ
o¡
->
·ck‘s_wr™‹n
;

4676 ià(!
tÙ®_·ck‘s_wr™‹n
 && (
abÜt_Ú_æags
 & 
ABORT_ON_FLAG_EMPTY_OUTPUT
)) {

4677 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Empty output\n");

4678 
	`ex™_´og¿m
(1);

4682 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

4683 
i¡
 = 
šput_¡»ams
[
i
];

4684 ià(
i¡
->
decodšg_Ãeded
) {

4685 
	`avcodec_şo£
(
i¡
->
dec_ùx
);

4686 ià(
i¡
->
hwacûl_unš™
)

4687 
i¡
->
	`hwacûl_unš™
(i¡->
dec_ùx
);

4691 
	`av_bufãr_uÄef
(&
hw_deviû_ùx
);

4694 
»t
 = 0;

4696 
ç
:

4697 #ià
HAVE_PTHREADS


4698 
	`ä“_šput_th»ads
();

4701 ià(
ouut_¡»ams
) {

4702 
i
 = 0; i < 
nb_ouut_¡»ams
; i++) {

4703 
o¡
 = 
ouut_¡»ams
[
i
];

4704 ià(
o¡
) {

4705 ià(
o¡
->
logfe
) {

4706 ià(
	`fşo£
(
o¡
->
logfe
))

4707 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

4709 
	`av_”r2¡r
(
	`AVERROR
(
”ºo
)));

4710 
o¡
->
logfe
 = 
NULL
;

4712 
	`av_ä“p
(&
o¡
->
fÜûd_kf_±s
);

4713 
	`av_ä“p
(&
o¡
->
­ad
);

4714 
	`av_ä“p
(&
o¡
->
di¥os™iÚ
);

4715 
	`av_diù_ä“
(&
o¡
->
’cod”_İts
);

4716 
	`av_diù_ä“
(&
o¡
->
sws_diù
);

4717 
	`av_diù_ä“
(&
o¡
->
swr_İts
);

4718 
	`av_diù_ä“
(&
o¡
->
»§m¶e_İts
);

4722  
»t
;

4723 
	}
}

4726 
št64_t
 
	$g‘utime
()

4728 #ià
HAVE_GETRUSAGE


4729 
ru§ge
„usage;

4731 
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru§ge
);

4732  (
ru§ge
.
ru_utime
.
tv_£c
 * 1000000LLè+„u§ge.ru_utime.
tv_u£c
;

4733 #–ià
HAVE_GETPROCESSTIMES


4734 
HANDLE
 
´oc
;

4735 
FILETIME
 
c
, 
e
, 
k
, 
u
;

4736 
´oc
 = 
	`G‘Cu¼’tProûss
();

4737 
	`G‘ProûssTimes
(
´oc
, &
c
, &
e
, &
k
, &
u
);

4738  ((
št64_t
è
u
.
dwHighD©eTime
 << 32 | u.
dwLowD©eTime
) / 10;

4740  
	`av_g‘time_»Ïtive
();

4742 
	}
}

4744 
št64_t
 
	$g‘maxrss
()

4746 #ià
HAVE_GETRUSAGE
 && 
HAVE_STRUCT_RUSAGE_RU_MAXRSS


4747 
ru§ge
„usage;

4748 
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru§ge
);

4749  (
št64_t
)
ru§ge
.
ru_maxrss
 * 1024;

4750 #–ià
HAVE_GETPROCESSMEMORYINFO


4751 
HANDLE
 
´oc
;

4752 
PROCESS_MEMORY_COUNTERS
 
memcouÁ”s
;

4753 
´oc
 = 
	`G‘Cu¼’tProûss
();

4754 
memcouÁ”s
.
cb
 = (memcounters);

4755 
	`G‘ProûssMemÜyInfo
(
´oc
, &
memcouÁ”s
, (memcounters));

4756  
memcouÁ”s
.
P—kPagefeU§ge
;

4760 
	}
}

4762 
	$log_ÿÎback_nuÎ
(*
±r
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
vl
)

4764 
	}
}

4766 
	$maš
(
¬gc
, **
¬gv
)

4768 
i
, 
»t
;

4769 
št64_t
 
ti
;

4771 
	`š™_dyÆßd
();

4773 
	`»gi¡”_ex™
(
ffm³g_ş—nup
);

4775 
	`£tvbuf
(
¡d”r
,
NULL
,
_IONBF
,0);

4777 
	`av_log_£t_æags
(
AV_LOG_SKIP_REPEATED
);

4778 
	`·r£_logËv–
(
¬gc
, 
¬gv
, 
İtiÚs
);

4780 if(
¬gc
>1 && !
	`¡rcmp
(
¬gv
[1], "-d")){

4781 
run_as_d«mÚ
=1;

4782 
	`av_log_£t_ÿÎback
(
log_ÿÎback_nuÎ
);

4783 
¬gc
--;

4784 
¬gv
++;

4787 
	`avcodec_»gi¡”_®l
();

4788 #ià
CONFIG_AVDEVICE


4789 
	`avdeviû_»gi¡”_®l
();

4791 
	`avf‹r_»gi¡”_®l
();

4792 
	`av_»gi¡”_®l
();

4793 
	`avfÜm©_ÃtwÜk_š™
();

4795 
	`show_bªÃr
(
¬gc
, 
¬gv
, 
İtiÚs
);

4798 
»t
 = 
	`ffm³g_·r£_İtiÚs
(
¬gc
, 
¬gv
);

4799 ià(
»t
 < 0)

4800 
	`ex™_´og¿m
(1);

4802 ià(
nb_ouut_fes
 <ğ0 && 
nb_šput_fes
 == 0) {

4803 
	`show_u§ge
();

4804 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "U£ -hØg‘ fuÎ h–°Ü,ƒv’ b‘‹r,„uÀ'mª %s'\n", 
´og¿m_Çme
);

4805 
	`ex™_´og¿m
(1);

4809 ià(
nb_ouut_fes
 <= 0) {

4810 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "At†east one output file must be specified\n");

4811 
	`ex™_´og¿m
(1);

4819 
i
 = 0; i < 
nb_ouut_fes
; i++) {

4820 ià(
	`¡rcmp
(
ouut_fes
[
i
]->
ùx
->
ofÜm©
->
Çme
, "rtp"))

4821 
wªt_sdp
 = 0;

4824 
cu¼’t_time
 = 
ti
 = 
	`g‘utime
();

4825 ià(
	`Œªscode
() < 0)

4826 
	`ex™_´og¿m
(1);

4827 
ti
 = 
	`g‘utime
() -i;

4828 ià(
do_b’chm¬k
) {

4829 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "b’ch: utime=%0.3fs\n", 
ti
 / 1000000.0);

4831 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "%"
PRIu64
" frames successfully decoded, %"PRIu64" decodingƒrrors\n",

4832 
decode_”rÜ_¡©
[0], decode_error_stat[1]);

4833 ià((
decode_”rÜ_¡©
[0] + decode_”rÜ_¡©[1]è* 
max_”rÜ_¿‹
 < decode_error_stat[1])

4834 
	`ex™_´og¿m
(69);

4836 
	`ex™_´og¿m
(
»ûived_nb_sigÇls
 ? 255 : 
maš_»tuº_code
);

4837  
maš_»tuº_code
;

4838 
	}
}

	@ffmpeg_cuvid.c

19 
	~"libavut/hwcÚ‹xt.h
"

20 
	~"libavut/pixdesc.h
"

22 
	~"ffm³g.h
"

24 
	$cuvid_unš™
(
AVCodecCÚ‹xt
 *
avùx
)

26 
IÅutSŒ—m
 *
i¡
 = 
avùx
->
İaque
;

27 
	`av_bufãr_uÄef
(&
i¡
->
hw_äames_ùx
);

28 
	}
}

30 
	$cuvid_š™
(
AVCodecCÚ‹xt
 *
avùx
)

32 
IÅutSŒ—m
 *
i¡
 = 
avùx
->
İaque
;

33 
AVHWF¿mesCÚ‹xt
 *
äames_ùx
;

34 
»t
;

36 
	`av_log
(
avùx
, 
AV_LOG_VERBOSE
, "Initializing cuvid hwaccel\n");

38 ià(!
hw_deviû_ùx
) {

39 
»t
 = 
	`av_hwdeviû_ùx_ü—‹
(&
hw_deviû_ùx
, 
AV_HWDEVICE_TYPE_CUDA
,

40 
i¡
->
hwacûl_deviû
, 
NULL
, 0);

41 ià(
»t
 < 0) {

42 
	`av_log
(
avùx
, 
AV_LOG_ERROR
, "Error creating‡ CUDA device\n");

43  
»t
;

47 
	`av_bufãr_uÄef
(&
i¡
->
hw_äames_ùx
);

48 
i¡
->
hw_äames_ùx
 = 
	`av_hwäame_ùx_®loc
(
hw_deviû_ùx
);

49 ià(!
i¡
->
hw_äames_ùx
) {

50 
	`av_log
(
avùx
, 
AV_LOG_ERROR
, "Error creating‡ CUDA frames context\n");

51  
	`AVERROR
(
ENOMEM
);

54 
äames_ùx
 = (
AVHWF¿mesCÚ‹xt
*)
i¡
->
hw_äames_ùx
->
d©a
;

56 
äames_ùx
->
fÜm©
 = 
AV_PIX_FMT_CUDA
;

57 
äames_ùx
->
sw_fÜm©
 = 
avùx
->
sw_pix_fmt
;

58 
äames_ùx
->
width
 = 
avùx
->width;

59 
äames_ùx
->
height
 = 
avùx
->height;

61 
	`av_log
(
avùx
, 
AV_LOG_DEBUG
, "Initializing CUDA frames context: sw_format = %s, width = %d, height = %d\n",

62 
	`av_g‘_pix_fmt_Çme
(
äames_ùx
->
sw_fÜm©
), f¿mes_ùx->
width
, f¿mes_ùx->
height
);

64 
»t
 = 
	`av_hwäame_ùx_š™
(
i¡
->
hw_äames_ùx
);

65 ià(
»t
 < 0) {

66 
	`av_log
(
avùx
, 
AV_LOG_ERROR
, "Error initializing‡ CUDA frame…ool\n");

67  
»t
;

70 
i¡
->
hwacûl_unš™
 = 
cuvid_unš™
;

73 
	}
}

	@ffmpeg_filter.c

21 
	~<¡dšt.h
>

23 
	~"ffm³g.h
"

25 
	~"libavf‹r/avf‹r.h
"

26 
	~"libavf‹r/bufãrsšk.h
"

27 
	~"libavf‹r/bufãr¤c.h
"

29 
	~"libav»§m¶e/av»§m¶e.h
"

31 
	~"libavut/avas£¹.h
"

32 
	~"libavut/av¡ršg.h
"

33 
	~"libavut/b´št.h
"

34 
	~"libavut/chªÃl_Ïyout.h
"

35 
	~"libavut/di¥Ïy.h
"

36 
	~"libavut/İt.h
"

37 
	~"libavut/pixdesc.h
"

38 
	~"libavut/pixfmt.h
"

39 
	~"libavut/imguts.h
"

40 
	~"libavut/§m¶efmt.h
"

42 cÚ¡ 
AVPix–FÜm©
 *
	$g‘_com¶Ÿnû_unofficŸl_pix_fmts
(
AVCodecID
 
codec_id
, cÚ¡ 
AVPix–FÜm©
 
deçuÉ_fÜm©s
[])

44 cÚ¡ 
AVPix–FÜm©
 
mj³g_fÜm©s
[] =

45 { 
AV_PIX_FMT_YUVJ420P
, 
AV_PIX_FMT_YUVJ422P
, 
AV_PIX_FMT_YUVJ444P
,

46 
AV_PIX_FMT_YUV420P
, 
AV_PIX_FMT_YUV422P
, 
AV_PIX_FMT_YUV444P
,

47 
AV_PIX_FMT_NONE
 };

48 cÚ¡ 
AVPix–FÜm©
 
lj³g_fÜm©s
[] =

49 { 
AV_PIX_FMT_BGR24
 , 
AV_PIX_FMT_BGRA
 , 
AV_PIX_FMT_BGR0
,

50 
AV_PIX_FMT_YUVJ420P
, 
AV_PIX_FMT_YUVJ444P
, 
AV_PIX_FMT_YUVJ422P
,

51 
AV_PIX_FMT_YUV420P
 , 
AV_PIX_FMT_YUV444P
 , 
AV_PIX_FMT_YUV422P
,

52 
AV_PIX_FMT_NONE
};

54 ià(
codec_id
 =ğ
AV_CODEC_ID_MJPEG
) {

55  
mj³g_fÜm©s
;

56 } ià(
codec_id
 =ğ
AV_CODEC_ID_LJPEG
) {

57  
lj³g_fÜm©s
;

59  
deçuÉ_fÜm©s
;

61 
	}
}

63 
AVPix–FÜm©
 
	$choo£_pix–_fmt
(
AVSŒ—m
 *
¡
, 
AVCodecCÚ‹xt
 *
’c_ùx
, 
AVCodec
 *
codec
, 
AVPix–FÜm©
 
rg‘
)

65 ià(
codec
 && codec->
pix_fmts
) {

66 cÚ¡ 
AVPix–FÜm©
 *
p
 = 
codec
->
pix_fmts
;

67 cÚ¡ 
AVPixFmtDesütÜ
 *
desc
 = 
	`av_pix_fmt_desc_g‘
(
rg‘
);

68 
has_®pha
 = 
desc
 ? desc->
nb_compÚ’ts
 % 2 == 0 : 0;

69 
AVPix–FÜm©
 
be¡
ğ
AV_PIX_FMT_NONE
;

71 ià(
’c_ùx
->
¡riù_¡d_com¶Ÿnû
 <ğ
FF_COMPLIANCE_UNOFFICIAL
) {

72 
p
 = 
	`g‘_com¶Ÿnû_unofficŸl_pix_fmts
(
’c_ùx
->
codec_id
,…);

74 ; *
p
 !ğ
AV_PIX_FMT_NONE
;…++) {

75 
be¡
ğ
	`avcodec_fšd_be¡_pix_fmt_of_2
(be¡, *
p
, 
rg‘
, 
has_®pha
, 
NULL
);

76 ià(*
p
 =ğ
rg‘
)

79 ià(*
p
 =ğ
AV_PIX_FMT_NONE
) {

80 ià(
rg‘
 !ğ
AV_PIX_FMT_NONE
)

81 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

83 
	`av_g‘_pix_fmt_Çme
(
rg‘
),

84 
codec
->
Çme
,

85 
	`av_g‘_pix_fmt_Çme
(
be¡
));

86  
be¡
;

89  
rg‘
;

90 
	}
}

92 
	$choo£_§m¶e_fmt
(
AVSŒ—m
 *
¡
, 
AVCodec
 *
codec
)

94 ià(
codec
 && codec->
§m¶e_fmts
) {

95 cÚ¡ 
AVSam¶eFÜm©
 *
p
 = 
codec
->
§m¶e_fmts
;

96 ; *
p
 != -1;…++) {

97 ià(*
p
 =ğ
¡
->
codeı¬
->
fÜm©
)

100 ià(*
p
 == -1) {

101 if((
codec
->
ÿ·b™›s
 & 
AV_CODEC_CAP_LOSSLESS
è&& 
	`av_g‘_§m¶e_fmt_Çme
(
¡
->
codeı¬
->
fÜm©
è>‡v_g‘_§m¶e_fmt_Çme(codec->
§m¶e_fmts
[0]))

102 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Conversion will‚ot be†ossless.\n");

103 if(
	`av_g‘_§m¶e_fmt_Çme
(
¡
->
codeı¬
->
fÜm©
))

104 
	`av_log
(
NULL
, 
AV_LOG_WARNING
,

106 
	`av_g‘_§m¶e_fmt_Çme
(
¡
->
codeı¬
->
fÜm©
),

107 
codec
->
Çme
,

108 
	`av_g‘_§m¶e_fmt_Çme
(
codec
->
§m¶e_fmts
[0]));

109 
¡
->
codeı¬
->
fÜm©
 = 
codec
->
§m¶e_fmts
[0];

112 
	}
}

114 *
	$choo£_pix_fmts
(
OuutF‹r
 *
of‹r
)

116 
OuutSŒ—m
 *
o¡
 = 
of‹r
->ost;

117 
AVDiùiÚ¬yEÁry
 *
¡riù_diù
 = 
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "¡riù", 
NULL
, 0);

118 ià(
¡riù_diù
)

120 
	`av_İt_£t
(
o¡
->
’c_ùx
, "¡riù", 
¡riù_diù
->
v®ue
, 0);

122 ià(
o¡
->
k“p_pix_fmt
) {

123 
	`avf‹r_g¿ph_£t_auto_cÚv”t
(
of‹r
->
g¿ph
->graph,

124 
AVFILTER_AUTO_CONVERT_NONE
);

125 ià(
o¡
->
’c_ùx
->
pix_fmt
 =ğ
AV_PIX_FMT_NONE
)

126  
NULL
;

127  
	`av_¡rdup
(
	`av_g‘_pix_fmt_Çme
(
o¡
->
’c_ùx
->
pix_fmt
));

129 ià(
o¡
->
’c_ùx
->
pix_fmt
 !ğ
AV_PIX_FMT_NONE
) {

130  
	`av_¡rdup
(
	`av_g‘_pix_fmt_Çme
(
	`choo£_pix–_fmt
(
o¡
->
¡
, o¡->
’c_ùx
, o¡->
’c
, o¡->’c_ùx->
pix_fmt
)));

131 } ià(
o¡
->
’c
 && o¡->’c->
pix_fmts
) {

132 cÚ¡ 
AVPix–FÜm©
 *
p
;

133 
AVIOCÚ‹xt
 *
s
 = 
NULL
;

134 
ušt8_t
 *
»t
;

135 
Ën
;

137 ià(
	`avio_İ’_dyn_buf
(&
s
) < 0)

138 
	`ex™_´og¿m
(1);

140 
p
 = 
o¡
->
’c
->
pix_fmts
;

141 ià(
o¡
->
’c_ùx
->
¡riù_¡d_com¶Ÿnû
 <ğ
FF_COMPLIANCE_UNOFFICIAL
) {

142 
p
 = 
	`g‘_com¶Ÿnû_unofficŸl_pix_fmts
(
o¡
->
’c_ùx
->
codec_id
,…);

145 ; *
p
 !ğ
AV_PIX_FMT_NONE
;…++) {

146 cÚ¡ *
Çme
 = 
	`av_g‘_pix_fmt_Çme
(*
p
);

147 
	`avio_´štf
(
s
, "%s|", 
Çme
);

149 
Ën
 = 
	`avio_şo£_dyn_buf
(
s
, &
»t
);

150 
»t
[
Ën
 - 1] = 0;

151  
»t
;

153  
NULL
;

154 
	}
}

158 
	#DEF_CHOOSE_FORMAT
(
suffix
, 
ty³
, 
v¬
, 
suµÜ‹d_li¡
, 
nÚe
, 
g‘_Çme
) \

159 *
choo£_
 ## 
	`suffix
 (
OuutF‹r
 *
of‹r
) \

161 ià(
of‹r
->
v¬
 !ğ
nÚe
) { \

162 
	`g‘_Çme
(
of‹r
->
v¬
); \

163  
	`av_¡rdup
(
Çme
); \

164 } ià(
of‹r
->
suµÜ‹d_li¡
) { \

165 cÚ¡ 
ty³
 *
p
; \

166 
AVIOCÚ‹xt
 *
s
 = 
NULL
; \

167 
ušt8_t
 *
»t
; \

168 
Ën
; \

170 ià(
	`avio_İ’_dyn_buf
(&
s
) < 0) \

171 
	`ex™_´og¿m
(1); \

173 
p
 = 
of‹r
->
suµÜ‹d_li¡
; *°!ğ
nÚe
;…++) { \

174 
	`g‘_Çme
(*
p
); \

175 
	`avio_´štf
(
s
, "%s|", 
Çme
); \

177 
Ën
 = 
	`avio_şo£_dyn_buf
(
s
, &
»t
); \

178 
»t
[
Ën
 - 1] = 0; \

179  
»t
; \

181  
NULL
; \

182 }

	)

187 
	$DEF_CHOOSE_FORMAT
(
§m¶e_fmts
, 
AVSam¶eFÜm©
, 
fÜm©
, 
fÜm©s
,

188 
AV_SAMPLE_FMT_NONE
, 
GET_SAMPLE_FMT_NAME
)

190 
	$DEF_CHOOSE_FORMAT
(
§m¶e_¿‹s
, , 
§m¶e_¿‹
, sample_rates, 0,

191 
GET_SAMPLE_RATE_NAME
)

193 
	$DEF_CHOOSE_FORMAT
(
chªÃl_Ïyouts
, 
ušt64_t
, 
chªÃl_Ïyout
, channel_layouts, 0,

194 
GET_CH_LAYOUT_NAME
)

196 
	$š™_sim¶e_f‹rg¿ph
(
IÅutSŒ—m
 *
i¡
, 
OuutSŒ—m
 *
o¡
)

198 
F‹rG¿ph
 *
fg
 = 
	`av_m®locz
((*fg));

200 ià(!
fg
)

201 
	`ex™_´og¿m
(1);

202 
fg
->
šdex
 = 
nb_f‹rg¿phs
;

204 
	`GROW_ARRAY
(
fg
->
ouuts
, fg->
nb_ouuts
);

205 ià(!(
fg
->
ouuts
[0] = 
	`av_m®locz
((*fg->outputs[0]))))

206 
	`ex™_´og¿m
(1);

207 
fg
->
ouuts
[0]->
o¡
 = ost;

208 
fg
->
ouuts
[0]->
g¿ph
 = fg;

209 
fg
->
ouuts
[0]->
fÜm©
 = -1;

211 
o¡
->
f‹r
 = 
fg
->
ouuts
[0];

213 
	`GROW_ARRAY
(
fg
->
šputs
, fg->
nb_šputs
);

214 ià(!(
fg
->
šputs
[0] = 
	`av_m®locz
((*fg->inputs[0]))))

215 
	`ex™_´og¿m
(1);

216 
fg
->
šputs
[0]->
i¡
 = ist;

217 
fg
->
šputs
[0]->
g¿ph
 = fg;

218 
fg
->
šputs
[0]->
fÜm©
 = -1;

220 
fg
->
šputs
[0]->
äame_queue
 = 
	`av_fifo_®loc
(8 * (
AVF¿me
*));

221 ià(!
fg
->
šputs
[0]->
äame_queue
)

222 
	`ex™_´og¿m
(1);

224 
	`GROW_ARRAY
(
i¡
->
f‹rs
, i¡->
nb_f‹rs
);

225 
i¡
->
f‹rs
[i¡->
nb_f‹rs
 - 1] = 
fg
->
šputs
[0];

227 
	`GROW_ARRAY
(
f‹rg¿phs
, 
nb_f‹rg¿phs
);

228 
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1] = 
fg
;

231 
	}
}

233 *
	$desüibe_f‹r_lšk
(
F‹rG¿ph
 *
fg
, 
AVF‹rInOut
 *
šout
, 
š
)

235 
AVF‹rCÚ‹xt
 *
ùx
 = 
šout
->
f‹r_ùx
;

236 
AVF‹rPad
 *
·ds
 = 
š
 ? 
ùx
->
šput_·ds
 : ctx->
ouut_·ds
;

237 
nb_·ds
 = 
š
 ? 
ùx
->
nb_šputs
 : ctx->
nb_ouuts
;

238 
AVIOCÚ‹xt
 *
pb
;

239 
ušt8_t
 *
»s
 = 
NULL
;

241 ià(
	`avio_İ’_dyn_buf
(&
pb
) < 0)

242 
	`ex™_´og¿m
(1);

244 
	`avio_´štf
(
pb
, "%s", 
ùx
->
f‹r
->
Çme
);

245 ià(
nb_·ds
 > 1)

246 
	`avio_´štf
(
pb
, ":%s", 
	`avf‹r_·d_g‘_Çme
(
·ds
, 
šout
->
·d_idx
));

247 
	`avio_w8
(
pb
, 0);

248 
	`avio_şo£_dyn_buf
(
pb
, &
»s
);

249  
»s
;

250 
	}
}

252 
	$š™_šput_f‹r
(
F‹rG¿ph
 *
fg
, 
AVF‹rInOut
 *
š
)

254 
IÅutSŒ—m
 *
i¡
 = 
NULL
;

255 
AVMedŸTy³
 
ty³
 = 
	`avf‹r_·d_g‘_ty³
(
š
->
f‹r_ùx
->
šput_·ds
, in->
·d_idx
);

256 
i
;

259 ià(
ty³
 !ğ
AVMEDIA_TYPE_VIDEO
 &&y³ !ğ
AVMEDIA_TYPE_AUDIO
) {

260 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Only video‡nd‡udio filters supported "

262 
	`ex™_´og¿m
(1);

265 ià(
š
->
Çme
) {

266 
AVFÜm©CÚ‹xt
 *
s
;

267 
AVSŒ—m
 *
¡
 = 
NULL
;

268 *
p
;

269 
fe_idx
 = 
	`¡¹Ş
(
š
->
Çme
, &
p
, 0);

271 ià(
fe_idx
 < 0 || fe_idx >ğ
nb_šput_fes
) {

272 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid file index %d in filtergraph description %s.\n",

273 
fe_idx
, 
fg
->
g¿ph_desc
);

274 
	`ex™_´og¿m
(1);

276 
s
 = 
šput_fes
[
fe_idx
]->
ùx
;

278 
i
 = 0; i < 
s
->
nb_¡»ams
; i++) {

279 
AVMedŸTy³
 
¡»am_ty³
 = 
s
->
¡»ams
[
i
]->
codeı¬
->
codec_ty³
;

280 ià(
¡»am_ty³
 !ğ
ty³
 &&

281 !(
¡»am_ty³
 =ğ
AVMEDIA_TYPE_SUBTITLE
 &&

282 
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ))

284 ià(
	`check_¡»am_¥ecif›r
(
s
, s->
¡»ams
[
i
], *
p
 == ':' ?… + 1 :…) == 1) {

285 
¡
 = 
s
->
¡»ams
[
i
];

289 ià(!
¡
) {

290 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Stream specifier '%s' in filtergraph description %s "

291 "m©che nØ¡»ams.\n", 
p
, 
fg
->
g¿ph_desc
);

292 
	`ex™_´og¿m
(1);

294 
i¡
 = 
šput_¡»ams
[
šput_fes
[
fe_idx
]->
i¡_šdex
 + 
¡
->
šdex
];

297 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

298 
i¡
 = 
šput_¡»ams
[
i
];

299 ià(
i¡
->
dec_ùx
->
codec_ty³
 =ğ
ty³
 && i¡->
disÿrd
)

302 ià(
i
 =ğ
nb_šput_¡»ams
) {

303 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Cannot find‡ matching stream for "

304 "uÆab–ed iÅuˆ·d %d oÀf‹¸%s\n", 
š
->
·d_idx
,

305 
š
->
f‹r_ùx
->
Çme
);

306 
	`ex™_´og¿m
(1);

309 
	`av_as£¹0
(
i¡
);

311 
i¡
->
disÿrd
 = 0;

312 
i¡
->
decodšg_Ãeded
 |ğ
DECODING_FOR_FILTER
;

313 
i¡
->
¡
->
disÿrd
 = 
AVDISCARD_NONE
;

315 
	`GROW_ARRAY
(
fg
->
šputs
, fg->
nb_šputs
);

316 ià(!(
fg
->
šputs
[fg->
nb_šputs
 - 1] = 
	`av_m®locz
((*fg->inputs[0]))))

317 
	`ex™_´og¿m
(1);

318 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
i¡
 = ist;

319 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
g¿ph
 = fg;

320 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
fÜm©
 = -1;

321 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
ty³
 = 
i¡
->
¡
->
codeı¬
->
codec_ty³
;

322 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
Çme
 = 
	`desüibe_f‹r_lšk
(fg, 
š
, 1);

324 
fg
->
šputs
[fg->
nb_šputs
 - 1]->
äame_queue
 = 
	`av_fifo_®loc
(8 * (
AVF¿me
*));

325 ià(!
fg
->
šputs
[fg->
nb_šputs
 - 1]->
äame_queue
)

326 
	`ex™_´og¿m
(1);

328 
	`GROW_ARRAY
(
i¡
->
f‹rs
, i¡->
nb_f‹rs
);

329 
i¡
->
f‹rs
[i¡->
nb_f‹rs
 - 1] = 
fg
->
šputs
[fg->
nb_šputs
 - 1];

330 
	}
}

332 
	$š™_com¶ex_f‹rg¿ph
(
F‹rG¿ph
 *
fg
)

334 
AVF‹rInOut
 *
šputs
, *
ouuts
, *
cur
;

335 
AVF‹rG¿ph
 *
g¿ph
;

336 
»t
 = 0;

340 
g¿ph
 = 
	`avf‹r_g¿ph_®loc
();

341 ià(!
g¿ph
)

342  
	`AVERROR
(
ENOMEM
);

344 
»t
 = 
	`avf‹r_g¿ph_·r£2
(
g¿ph
, 
fg
->
g¿ph_desc
, &
šputs
, &
ouuts
);

345 ià(
»t
 < 0)

346 
ç
;

348 
cur
 = 
šputs
; cur; cu¸ğcur->
Ãxt
)

349 
	`š™_šput_f‹r
(
fg
, 
cur
);

351 
cur
 = 
ouuts
; cur;) {

352 
	`GROW_ARRAY
(
fg
->
ouuts
, fg->
nb_ouuts
);

353 
fg
->
ouuts
[fg->
nb_ouuts
 - 1] = 
	`av_m®locz
((*fg->outputs[0]));

354 ià(!
fg
->
ouuts
[fg->
nb_ouuts
 - 1])

355 
	`ex™_´og¿m
(1);

357 
fg
->
ouuts
[fg->
nb_ouuts
 - 1]->
g¿ph
 = fg;

358 
fg
->
ouuts
[fg->
nb_ouuts
 - 1]->
out_tmp
 = 
cur
;

359 
fg
->
ouuts
[fg->
nb_ouuts
 - 1]->
ty³
 = 
	`avf‹r_·d_g‘_ty³
(
cur
->
f‹r_ùx
->
ouut_·ds
,

360 
cur
->
·d_idx
);

361 
fg
->
ouuts
[fg->
nb_ouuts
 - 1]->
Çme
 = 
	`desüibe_f‹r_lšk
(fg, 
cur
, 0);

362 
cur
 = cur->
Ãxt
;

363 
fg
->
ouuts
[fg->
nb_ouuts
 - 1]->
out_tmp
->
Ãxt
 = 
NULL
;

366 
ç
:

367 
	`avf‹r_šout_ä“
(&
šputs
);

368 
	`avf‹r_g¿ph_ä“
(&
g¿ph
);

369  
»t
;

370 
	}
}

372 
	$š£¹_Œim
(
št64_t
 
¡¬t_time
, iÁ64_ˆ
du¿tiÚ
,

373 
AVF‹rCÚ‹xt
 **
Ï¡_f‹r
, *
·d_idx
,

374 cÚ¡ *
f‹r_Çme
)

376 
AVF‹rG¿ph
 *
g¿ph
 = (*
Ï¡_f‹r
)->graph;

377 
AVF‹rCÚ‹xt
 *
ùx
;

378 cÚ¡ 
AVF‹r
 *
Œim
;

379 
AVMedŸTy³
 
ty³
 = 
	`avf‹r_·d_g‘_ty³
((*
Ï¡_f‹r
)->
ouut_·ds
, *
·d_idx
);

380 cÚ¡ *
Çme
 = (
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) ? "trim" : "atrim";

381 
»t
 = 0;

383 ià(
du¿tiÚ
 =ğ
INT64_MAX
 && 
¡¬t_time
 =ğ
AV_NOPTS_VALUE
)

386 
Œim
 = 
	`avf‹r_g‘_by_Çme
(
Çme
);

387 ià(!
Œim
) {

388 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "%s filter‚ot…resent, cannot†imit "

389 "»cÜdšgime.\n", 
Çme
);

390  
AVERROR_FILTER_NOT_FOUND
;

393 
ùx
 = 
	`avf‹r_g¿ph_®loc_f‹r
(
g¿ph
, 
Œim
, 
f‹r_Çme
);

394 ià(!
ùx
)

395  
	`AVERROR
(
ENOMEM
);

397 ià(
du¿tiÚ
 !ğ
INT64_MAX
) {

398 
»t
 = 
	`av_İt_£t_št
(
ùx
, "du¿tiÚi", 
du¿tiÚ
,

399 
AV_OPT_SEARCH_CHILDREN
);

401 ià(
»t
 >ğ0 && 
¡¬t_time
 !ğ
AV_NOPTS_VALUE
) {

402 
»t
 = 
	`av_İt_£t_št
(
ùx
, "¡¬ti", 
¡¬t_time
,

403 
AV_OPT_SEARCH_CHILDREN
);

405 ià(
»t
 < 0) {

406 
	`av_log
(
ùx
, 
AV_LOG_ERROR
, "E¼Ü cÚfiguršgh% f‹r", 
Çme
);

407  
»t
;

410 
»t
 = 
	`avf‹r_š™_¡r
(
ùx
, 
NULL
);

411 ià(
»t
 < 0)

412  
»t
;

414 
»t
 = 
	`avf‹r_lšk
(*
Ï¡_f‹r
, *
·d_idx
, 
ùx
, 0);

415 ià(
»t
 < 0)

416  
»t
;

418 *
Ï¡_f‹r
 = 
ùx
;

419 *
·d_idx
 = 0;

421 
	}
}

423 
	$š£¹_f‹r
(
AVF‹rCÚ‹xt
 **
Ï¡_f‹r
, *
·d_idx
,

424 cÚ¡ *
f‹r_Çme
, cÚ¡ *
¬gs
)

426 
AVF‹rG¿ph
 *
g¿ph
 = (*
Ï¡_f‹r
)->graph;

427 
AVF‹rCÚ‹xt
 *
ùx
;

428 
»t
;

430 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ùx
,

431 
	`avf‹r_g‘_by_Çme
(
f‹r_Çme
),

432 
f‹r_Çme
, 
¬gs
, 
NULL
, 
g¿ph
);

433 ià(
»t
 < 0)

434  
»t
;

436 
»t
 = 
	`avf‹r_lšk
(*
Ï¡_f‹r
, *
·d_idx
, 
ùx
, 0);

437 ià(
»t
 < 0)

438  
»t
;

440 *
Ï¡_f‹r
 = 
ùx
;

441 *
·d_idx
 = 0;

443 
	}
}

445 
	$cÚfigu»_ouut_video_f‹r
(
F‹rG¿ph
 *
fg
, 
OuutF‹r
 *
of‹r
, 
AVF‹rInOut
 *
out
)

447 *
pix_fmts
;

448 
OuutSŒ—m
 *
o¡
 = 
of‹r
->ost;

449 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

450 
AVF‹rCÚ‹xt
 *
Ï¡_f‹r
 = 
out
->
f‹r_ùx
;

451 
·d_idx
 = 
out
->pad_idx;

452 
»t
;

453 
Çme
[255];

455 
	`¢´štf
(
Çme
, Òame), "out_%d_%d", 
o¡
->
fe_šdex
, o¡->
šdex
);

456 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
of‹r
->
f‹r
,

457 
	`avf‹r_g‘_by_Çme
("buffersink"),

458 
Çme
, 
NULL
, NULL, 
fg
->
g¿ph
);

460 ià(
»t
 < 0)

461  
»t
;

463 ià(
of‹r
->
width
 || of‹r->
height
) {

464 
¬gs
[255];

465 
AVF‹rCÚ‹xt
 *
f‹r
;

466 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

468 
	`¢´štf
(
¬gs
, (args), "%d:%d",

469 
of‹r
->
width
, of‹r->
height
);

471 (
e
 = 
	`av_diù_g‘
(
o¡
->
sws_diù
, "",ƒ,

472 
AV_DICT_IGNORE_SUFFIX
))) {

473 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), ":%s=%s", 
e
->
key
,ƒ->
v®ue
);

476 
	`¢´štf
(
Çme
, (name), "scaler_out_%d_%d",

477 
o¡
->
fe_šdex
, o¡->
šdex
);

478 ià((
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
f‹r
, 
	`avf‹r_g‘_by_Çme
("scale"),

479 
Çme
, 
¬gs
, 
NULL
, 
fg
->
g¿ph
)) < 0)

480  
»t
;

481 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
f‹r
, 0)) < 0)

482  
»t
;

484 
Ï¡_f‹r
 = 
f‹r
;

485 
·d_idx
 = 0;

488 ià((
pix_fmts
 = 
	`choo£_pix_fmts
(
of‹r
))) {

489 
AVF‹rCÚ‹xt
 *
f‹r
;

490 
	`¢´štf
(
Çme
, (name), "format_out_%d_%d",

491 
o¡
->
fe_šdex
, o¡->
šdex
);

492 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
f‹r
,

493 
	`avf‹r_g‘_by_Çme
("format"),

494 "fÜm©", 
pix_fmts
, 
NULL
, 
fg
->
g¿ph
);

495 
	`av_ä“p
(&
pix_fmts
);

496 ià(
»t
 < 0)

497  
»t
;

498 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
f‹r
, 0)) < 0)

499  
»t
;

501 
Ï¡_f‹r
 = 
f‹r
;

502 
·d_idx
 = 0;

505 ià(
o¡
->
äame_¿‹
.
num
 && 0) {

506 
AVF‹rCÚ‹xt
 *
ås
;

507 
¬gs
[255];

509 
	`¢´štf
(
¬gs
, ×rgs), "ås=%d/%d", 
o¡
->
äame_¿‹
.
num
,

510 
o¡
->
äame_¿‹
.
d’
);

511 
	`¢´štf
(
Çme
, (name), "fps_out_%d_%d",

512 
o¡
->
fe_šdex
, o¡->
šdex
);

513 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ås
, 
	`avf‹r_g‘_by_Çme
("fps"),

514 
Çme
, 
¬gs
, 
NULL
, 
fg
->
g¿ph
);

515 ià(
»t
 < 0)

516  
»t
;

518 
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
ås
, 0);

519 ià(
»t
 < 0)

520  
»t
;

521 
Ï¡_f‹r
 = 
ås
;

522 
·d_idx
 = 0;

525 
	`¢´štf
(
Çme
, (name), "trim_out_%d_%d",

526 
o¡
->
fe_šdex
, o¡->
šdex
);

527 
»t
 = 
	`š£¹_Œim
(
of
->
¡¬t_time
, of->
»cÜdšg_time
,

528 &
Ï¡_f‹r
, &
·d_idx
, 
Çme
);

529 ià(
»t
 < 0)

530  
»t
;

533 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
of‹r
->
f‹r
, 0)) < 0)

534  
»t
;

537 
	}
}

539 
	$cÚfigu»_ouut_audio_f‹r
(
F‹rG¿ph
 *
fg
, 
OuutF‹r
 *
of‹r
, 
AVF‹rInOut
 *
out
)

541 
OuutSŒ—m
 *
o¡
 = 
of‹r
->ost;

542 
OuutFe
 *
of
 = 
ouut_fes
[
o¡
->
fe_šdex
];

543 
AVCodecCÚ‹xt
 *
codec
 = 
o¡
->
’c_ùx
;

544 
AVF‹rCÚ‹xt
 *
Ï¡_f‹r
 = 
out
->
f‹r_ùx
;

545 
·d_idx
 = 
out
->pad_idx;

546 *
§m¶e_fmts
, *
§m¶e_¿‹s
, *
chªÃl_Ïyouts
;

547 
Çme
[255];

548 
»t
;

550 
	`¢´štf
(
Çme
, Òame), "out_%d_%d", 
o¡
->
fe_šdex
, o¡->
šdex
);

551 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
of‹r
->
f‹r
,

552 
	`avf‹r_g‘_by_Çme
("abuffersink"),

553 
Çme
, 
NULL
, NULL, 
fg
->
g¿ph
);

554 ià(
»t
 < 0)

555  
»t
;

556 ià((
»t
 = 
	`av_İt_£t_št
(
of‹r
->
f‹r
, "®l_chªÃl_couÁs", 1, 
AV_OPT_SEARCH_CHILDREN
)) < 0)

557  
»t
;

559 
	#AUTO_INSERT_FILTER
(
İt_Çme
, 
f‹r_Çme
, 
¬g
) do { \

560 
AVF‹rCÚ‹xt
 *
ft_ùx
; \

562 
	`av_log
(
NULL
, 
AV_LOG_INFO
, 
İt_Çme
 " is forwardedo†avfi " \

563 "sim¬lyØ-aà" 
f‹r_Çme
 "=%s.\n", 
¬g
); \

565 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_ùx
, \

566 
	`avf‹r_g‘_by_Çme
(
f‹r_Çme
), \

567 
f‹r_Çme
, 
¬g
, 
NULL
, 
fg
->
g¿ph
); \

568 ià(
»t
 < 0) \

569  
»t
; \

571 
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
ft_ùx
, 0); \

572 ià(
»t
 < 0) \

573  
»t
; \

575 
Ï¡_f‹r
 = 
ft_ùx
; \

576 
·d_idx
 = 0; \

577 } 0)

	)

578 ià(
o¡
->
audio_chªÃls_m­³d
) {

579 
i
;

580 
AVBPršt
 
·n_buf
;

581 
	`av_b´št_š™
(&
·n_buf
, 256, 8192);

582 
	`av_b´štf
(&
·n_buf
, "0x%"
PRIx64
,

583 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
o¡
->
audio_chªÃls_m­³d
));

584 
i
 = 0; i < 
o¡
->
audio_chªÃls_m­³d
; i++)

585 ià(
o¡
->
audio_chªÃls_m­
[
i
] != -1)

586 
	`av_b´štf
(&
·n_buf
, "|c%d=c%d", 
i
, 
o¡
->
audio_chªÃls_m­
[i]);

588 
	`AUTO_INSERT_FILTER
("-m­_chªÃl", "·n", 
·n_buf
.
¡r
);

589 
	`av_b´št_fš®ize
(&
·n_buf
, 
NULL
);

592 ià(
codec
->
chªÃls
 && !codec->
chªÃl_Ïyout
)

593 
codec
->
chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(codec->
chªÃls
);

595 
§m¶e_fmts
 = 
	`choo£_§m¶e_fmts
(
of‹r
);

596 
§m¶e_¿‹s
 = 
	`choo£_§m¶e_¿‹s
(
of‹r
);

597 
chªÃl_Ïyouts
 = 
	`choo£_chªÃl_Ïyouts
(
of‹r
);

598 ià(
§m¶e_fmts
 || 
§m¶e_¿‹s
 || 
chªÃl_Ïyouts
) {

599 
AVF‹rCÚ‹xt
 *
fÜm©
;

600 
¬gs
[256];

601 
¬gs
[0] = 0;

603 ià(
§m¶e_fmts
)

604 
	`av_¡¾ÿtf
(
¬gs
, (args), "sample_fmts=%s:",

605 
§m¶e_fmts
);

606 ià(
§m¶e_¿‹s
)

607 
	`av_¡¾ÿtf
(
¬gs
, (args), "sample_rates=%s:",

608 
§m¶e_¿‹s
);

609 ià(
chªÃl_Ïyouts
)

610 
	`av_¡¾ÿtf
(
¬gs
, (args), "channel_layouts=%s:",

611 
chªÃl_Ïyouts
);

613 
	`av_ä“p
(&
§m¶e_fmts
);

614 
	`av_ä“p
(&
§m¶e_¿‹s
);

615 
	`av_ä“p
(&
chªÃl_Ïyouts
);

617 
	`¢´štf
(
Çme
, (name), "format_out_%d_%d",

618 
o¡
->
fe_šdex
, o¡->
šdex
);

619 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
fÜm©
,

620 
	`avf‹r_g‘_by_Çme
("aformat"),

621 
Çme
, 
¬gs
, 
NULL
, 
fg
->
g¿ph
);

622 ià(
»t
 < 0)

623  
»t
;

625 
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
fÜm©
, 0);

626 ià(
»t
 < 0)

627  
»t
;

629 
Ï¡_f‹r
 = 
fÜm©
;

630 
·d_idx
 = 0;

633 ià(
audio_vŞume
 != 256 && 0) {

634 
¬gs
[256];

636 
	`¢´štf
(
¬gs
, ×rgs), "%f", 
audio_vŞume
 / 256.);

637 
	`AUTO_INSERT_FILTER
("-vŞ", "vŞume", 
¬gs
);

640 ià(
o¡
->
­ad
 && 
of
->
shÜ‹¡
) {

641 
¬gs
[256];

642 
i
;

644 
i
=0; i<
of
->
ùx
->
nb_¡»ams
; i++)

645 ià(
of
->
ùx
->
¡»ams
[
i
]->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
)

648 ià(
i
<
of
->
ùx
->
nb_¡»ams
) {

649 
	`¢´štf
(
¬gs
, ×rgs), "%s", 
o¡
->
­ad
);

650 
	`AUTO_INSERT_FILTER
("-­ad", "­ad", 
¬gs
);

654 
	`¢´štf
(
Çme
, (name), "trim for output stream %d:%d",

655 
o¡
->
fe_šdex
, o¡->
šdex
);

656 
»t
 = 
	`š£¹_Œim
(
of
->
¡¬t_time
, of->
»cÜdšg_time
,

657 &
Ï¡_f‹r
, &
·d_idx
, 
Çme
);

658 ià(
»t
 < 0)

659  
»t
;

661 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 
·d_idx
, 
of‹r
->
f‹r
, 0)) < 0)

662  
»t
;

665 
	}
}

667 
	$cÚfigu»_ouut_f‹r
(
F‹rG¿ph
 *
fg
, 
OuutF‹r
 *
of‹r
, 
AVF‹rInOut
 *
out
)

669 ià(!
of‹r
->
o¡
) {

670 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "F‹¸% ha ª uncÚÃùed ouut\n", 
of‹r
->
Çme
);

671 
	`ex™_´og¿m
(1);

674 
	`avf‹r_·d_g‘_ty³
(
out
->
f‹r_ùx
->
ouut_·ds
, out->
·d_idx
)) {

675 
AVMEDIA_TYPE_VIDEO
:  
	`cÚfigu»_ouut_video_f‹r
(
fg
, 
of‹r
, 
out
);

676 
AVMEDIA_TYPE_AUDIO
:  
	`cÚfigu»_ouut_audio_f‹r
(
fg
, 
of‹r
, 
out
);

677 : 
	`av_as£¹0
(0);

679 
	}
}

681 
	$check_f‹r_ouuts
()

683 
i
;

684 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

685 
n
;

686 
n
 = 0;‚ < 
f‹rg¿phs
[
i
]->
nb_ouuts
;‚++) {

687 
OuutF‹r
 *
ouut
 = 
f‹rg¿phs
[
i
]->
ouuts
[
n
];

688 ià(!
ouut
->
o¡
) {

689 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "F‹¸% ha ª uncÚÃùed ouut\n", 
ouut
->
Çme
);

690 
	`ex™_´og¿m
(1);

694 
	}
}

696 
	$sub2video_´•¬e
(
IÅutSŒ—m
 *
i¡
, 
IÅutF‹r
 *
if‹r
)

698 
AVFÜm©CÚ‹xt
 *
avf
 = 
šput_fes
[
i¡
->
fe_šdex
]->
ùx
;

699 
i
, 
w
, 
h
;

704 
w
 = 
if‹r
->
width
;

705 
h
 = 
if‹r
->
height
;

706 ià(!(
w
 && 
h
)) {

707 
i
 = 0; i < 
avf
->
nb_¡»ams
; i++) {

708 ià(
avf
->
¡»ams
[
i
]->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
) {

709 
w
 = 
	`FFMAX
(w, 
avf
->
¡»ams
[
i
]->
codeı¬
->
width
);

710 
h
 = 
	`FFMAX
(h, 
avf
->
¡»ams
[
i
]->
codeı¬
->
height
);

713 ià(!(
w
 && 
h
)) {

714 
w
 = 
	`FFMAX
(w, 720);

715 
h
 = 
	`FFMAX
(h, 576);

717 
	`av_log
(
avf
, 
AV_LOG_INFO
, "sub2video: usšg %dx%d cªvas\n", 
w
, 
h
);

719 
i¡
->
sub2video
.
w
 = 
if‹r
->
width
 = w;

720 
i¡
->
sub2video
.
h
 = 
if‹r
->
height
 = h;

722 
if‹r
->
width
 = 
i¡
->
dec_ùx
->width ? i¡->dec_ùx->width : i¡->
sub2video
.
w
;

723 
if‹r
->
height
 = 
i¡
->
dec_ùx
->heighˆ? i¡->dec_ùx->heighˆ: i¡->
sub2video
.
h
;

727 
if‹r
->
fÜm©
 = 
AV_PIX_FMT_RGB32
;

729 
i¡
->
sub2video
.
äame
 = 
	`av_äame_®loc
();

730 ià(!
i¡
->
sub2video
.
äame
)

731  
	`AVERROR
(
ENOMEM
);

732 
i¡
->
sub2video
.
Ï¡_±s
 = 
INT64_MIN
;

734 
	}
}

736 
	$cÚfigu»_šput_video_f‹r
(
F‹rG¿ph
 *
fg
, 
IÅutF‹r
 *
if‹r
,

737 
AVF‹rInOut
 *
š
)

739 
AVF‹rCÚ‹xt
 *
Ï¡_f‹r
;

740 cÚ¡ 
AVF‹r
 *
bufãr_ft
 = 
	`avf‹r_g‘_by_Çme
("buffer");

741 
IÅutSŒ—m
 *
i¡
 = 
if‹r
->ist;

742 
IÅutFe
 *
f
 = 
šput_fes
[
i¡
->
fe_šdex
];

743 
AVR©iÚ®
 
tb
 = 
i¡
->
äam”©e
.
num
 ? 
	`av_šv_q
(ist->framerate) :

744 
i¡
->
¡
->
time_ba£
;

745 
AVR©iÚ®
 
ä
 = 
i¡
->
äam”©e
;

746 
AVR©iÚ®
 
§r
;

747 
AVBPršt
 
¬gs
;

748 
Çme
[255];

749 
»t
, 
·d_idx
 = 0;

750 
št64_t
 
tsoff£t
 = 0;

751 
AVBufãrSrcP¬am‘”s
 *
·r
 = 
	`av_bufãr¤c_·¿m‘”s_®loc
();

753 ià(!
·r
)

754  
	`AVERROR
(
ENOMEM
);

755 
	`mem£t
(
·r
, 0, (*par));

756 
·r
->
fÜm©
 = 
AV_PIX_FMT_NONE
;

758 ià(
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
) {

759 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Cannot connect video filtero‡udio input\n");

760 
»t
 = 
	`AVERROR
(
EINVAL
);

761 
ç
;

764 ià(!
ä
.
num
)

765 
ä
 = 
	`av_guess_äame_¿‹
(
šput_fes
[
i¡
->
fe_šdex
]->
ùx
, i¡->
¡
, 
NULL
);

767 ià(
i¡
->
dec_ùx
->
codec_ty³
 =ğ
AVMEDIA_TYPE_SUBTITLE
) {

768 
»t
 = 
	`sub2video_´•¬e
(
i¡
, 
if‹r
);

769 ià(
»t
 < 0)

770 
ç
;

773 
§r
 = 
if‹r
->
§m¶e_a¥eù_¿tio
;

774 if(!
§r
.
d’
)

775 
§r
 = (
AVR©iÚ®
){0,1};

776 
	`av_b´št_š™
(&
¬gs
, 0, 1);

777 
	`av_b´štf
(&
¬gs
,

780 
if‹r
->
width
, if‹r->
height
, if‹r->
fÜm©
,

781 
tb
.
num
,b.
d’
, 
§r
.num, sar.den,

782 
SWS_BILINEAR
 + ((
i¡
->
dec_ùx
->
æags
&
AV_CODEC_FLAG_BITEXACT
è? 
SWS_BITEXACT
:0));

783 ià(
ä
.
num
 && fr.
d’
)

784 
	`av_b´štf
(&
¬gs
, ":äame_¿‹=%d/%d", 
ä
.
num
, fr.
d’
);

785 
	`¢´štf
(
Çme
, Òame), "g¿ph %d iÅuˆäom sŒ—m %d:%d", 
fg
->
šdex
,

786 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

789 ià((
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
if‹r
->
f‹r
, 
bufãr_ft
, 
Çme
,

790 
¬gs
.
¡r
, 
NULL
, 
fg
->
g¿ph
)) < 0)

791 
ç
;

792 
·r
->
hw_äames_ùx
 = 
if‹r
->hw_frames_ctx;

793 
»t
 = 
	`av_bufãr¤c_·¿m‘”s_£t
(
if‹r
->
f‹r
, 
·r
);

794 ià(
»t
 < 0)

795 
ç
;

796 
	`av_ä“p
(&
·r
);

797 
Ï¡_f‹r
 = 
if‹r
->
f‹r
;

799 ià(
i¡
->
autÜÙ©e
) {

800 
th‘a
 = 
	`g‘_rÙ©iÚ
(
i¡
->
¡
);

802 ià(
	`çbs
(
th‘a
 - 90) < 1.0) {

803 
»t
 = 
	`š£¹_f‹r
(&
Ï¡_f‹r
, &
·d_idx
, "transpose", "clock");

804 } ià(
	`çbs
(
th‘a
 - 180) < 1.0) {

805 
»t
 = 
	`š£¹_f‹r
(&
Ï¡_f‹r
, &
·d_idx
, "hæ", 
NULL
);

806 ià(
»t
 < 0)

807  
»t
;

808 
»t
 = 
	`š£¹_f‹r
(&
Ï¡_f‹r
, &
·d_idx
, "væ", 
NULL
);

809 } ià(
	`çbs
(
th‘a
 - 270) < 1.0) {

810 
»t
 = 
	`š£¹_f‹r
(&
Ï¡_f‹r
, &
·d_idx
, "transpose", "cclock");

811 } ià(
	`çbs
(
th‘a
) > 1.0) {

812 
rÙ©e_buf
[64];

813 
	`¢´štf
(
rÙ©e_buf
, ÔÙ©e_buf), "%f*PI/180", 
th‘a
);

814 
»t
 = 
	`š£¹_f‹r
(&
Ï¡_f‹r
, &
·d_idx
, "rÙ©e", 
rÙ©e_buf
);

816 ià(
»t
 < 0)

817  
»t
;

820 ià(
do_deš‹¾aû
) {

821 
AVF‹rCÚ‹xt
 *
yadif
;

823 
	`¢´štf
(
Çme
, (name), "deinterlace_in_%d_%d",

824 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

825 ià((
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
yadif
,

826 
	`avf‹r_g‘_by_Çme
("yadif"),

827 
Çme
, "", 
NULL
,

828 
fg
->
g¿ph
)) < 0)

829  
»t
;

831 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 0, 
yadif
, 0)) < 0)

832  
»t
;

834 
Ï¡_f‹r
 = 
yadif
;

837 
	`¢´štf
(
Çme
, (name), "trim_in_%d_%d",

838 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

839 ià(
cİy_ts
) {

840 
tsoff£t
 = 
f
->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
 ? 0 : f->start_time;

841 ià(!
¡¬t_©_z”o
 && 
f
->
ùx
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

842 
tsoff£t
 +ğ
f
->
ùx
->
¡¬t_time
;

844 
»t
 = 
	`š£¹_Œim
(((
f
->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
è|| !f->
accu¿‹_£ek
) ?

845 
AV_NOPTS_VALUE
 : 
tsoff£t
, 
f
->
»cÜdšg_time
,

846 &
Ï¡_f‹r
, &
·d_idx
, 
Çme
);

847 ià(
»t
 < 0)

848  
»t
;

850 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 0, 
š
->
f‹r_ùx
, in->
·d_idx
)) < 0)

851  
»t
;

853 
ç
:

854 
	`av_ä“p
(&
·r
);

856  
»t
;

857 
	}
}

859 
	$cÚfigu»_šput_audio_f‹r
(
F‹rG¿ph
 *
fg
, 
IÅutF‹r
 *
if‹r
,

860 
AVF‹rInOut
 *
š
)

862 
AVF‹rCÚ‹xt
 *
Ï¡_f‹r
;

863 cÚ¡ 
AVF‹r
 *
abufãr_ft
 = 
	`avf‹r_g‘_by_Çme
("abuffer");

864 
IÅutSŒ—m
 *
i¡
 = 
if‹r
->ist;

865 
IÅutFe
 *
f
 = 
šput_fes
[
i¡
->
fe_šdex
];

866 
AVBPršt
 
¬gs
;

867 
Çme
[255];

868 
»t
, 
·d_idx
 = 0;

869 
št64_t
 
tsoff£t
 = 0;

871 ià(
i¡
->
dec_ùx
->
codec_ty³
 !ğ
AVMEDIA_TYPE_AUDIO
) {

872 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Cannot connect‡udio filtero‚on‡udio input\n");

873  
	`AVERROR
(
EINVAL
);

876 
	`av_b´št_š™
(&
¬gs
, 0, 
AV_BPRINT_SIZE_AUTOMATIC
);

877 
	`av_b´štf
(&
¬gs
, "time_base=%d/%d:sample_rate=%d:sample_fmt=%s",

878 1, 
if‹r
->
§m¶e_¿‹
,

879 
if‹r
->
§m¶e_¿‹
,

880 
	`av_g‘_§m¶e_fmt_Çme
(
if‹r
->
fÜm©
));

881 ià(
if‹r
->
chªÃl_Ïyout
)

882 
	`av_b´štf
(&
¬gs
, ":chªÃl_Ïyout=0x%"
PRIx64
,

883 
if‹r
->
chªÃl_Ïyout
);

885 
	`av_b´štf
(&
¬gs
, ":chªÃls=%d", 
if‹r
->
chªÃls
);

886 
	`¢´štf
(
Çme
, Òame), "g¿ph_%d_š_%d_%d", 
fg
->
šdex
,

887 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

889 ià((
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
if‹r
->
f‹r
, 
abufãr_ft
,

890 
Çme
, 
¬gs
.
¡r
, 
NULL
,

891 
fg
->
g¿ph
)) < 0)

892  
»t
;

893 
Ï¡_f‹r
 = 
if‹r
->
f‹r
;

895 
	#AUTO_INSERT_FILTER_INPUT
(
İt_Çme
, 
f‹r_Çme
, 
¬g
) do { \

896 
AVF‹rCÚ‹xt
 *
ft_ùx
; \

898 
	`av_log
(
NULL
, 
AV_LOG_INFO
, 
İt_Çme
 " is forwardedo†avfi " \

899 "sim¬lyØ-aà" 
f‹r_Çme
 "=%s.\n", 
¬g
); \

901 
	`¢´štf
(
Çme
, (name), "graph_%d_%s_in_%d_%d", \

902 
fg
->
šdex
, 
f‹r_Çme
, 
i¡
->
fe_šdex
, i¡->
¡
->index); \

903 
»t
 = 
	`avf‹r_g¿ph_ü—‹_f‹r
(&
ft_ùx
, \

904 
	`avf‹r_g‘_by_Çme
(
f‹r_Çme
), \

905 
Çme
, 
¬g
, 
NULL
, 
fg
->
g¿ph
); \

906 ià(
»t
 < 0) \

907  
»t
; \

909 
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 0, 
ft_ùx
, 0); \

910 ià(
»t
 < 0) \

911  
»t
; \

913 
Ï¡_f‹r
 = 
ft_ùx
; \

914 } 0)

	)

916 ià(
audio_sync_m‘hod
 > 0) {

917 
¬gs
[256] = {0};

919 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), "async=%d", 
audio_sync_m‘hod
);

920 ià(
audio_driá_th»shŞd
 != 0.1)

921 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), ":mš_h¬d_comp=%f", 
audio_driá_th»shŞd
);

922 ià(!
fg
->
»cÚfigu¿tiÚ
)

923 
	`av_¡¾ÿtf
(
¬gs
, (args), ":first_pts=0");

924 
	`AUTO_INSERT_FILTER_INPUT
("-async", "¬e§m¶e", 
¬gs
);

940 ià(
audio_vŞume
 != 256) {

941 
¬gs
[256];

943 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "-vol has been deprecated. Usehe volume "

946 
	`¢´štf
(
¬gs
, ×rgs), "%f", 
audio_vŞume
 / 256.);

947 
	`AUTO_INSERT_FILTER_INPUT
("-vŞ", "vŞume", 
¬gs
);

950 
	`¢´štf
(
Çme
, (name), "trim for input stream %d:%d",

951 
i¡
->
fe_šdex
, i¡->
¡
->
šdex
);

952 ià(
cİy_ts
) {

953 
tsoff£t
 = 
f
->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
 ? 0 : f->start_time;

954 ià(!
¡¬t_©_z”o
 && 
f
->
ùx
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

955 
tsoff£t
 +ğ
f
->
ùx
->
¡¬t_time
;

957 
»t
 = 
	`š£¹_Œim
(((
f
->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
è|| !f->
accu¿‹_£ek
) ?

958 
AV_NOPTS_VALUE
 : 
tsoff£t
, 
f
->
»cÜdšg_time
,

959 &
Ï¡_f‹r
, &
·d_idx
, 
Çme
);

960 ià(
»t
 < 0)

961  
»t
;

963 ià((
»t
 = 
	`avf‹r_lšk
(
Ï¡_f‹r
, 0, 
š
->
f‹r_ùx
, in->
·d_idx
)) < 0)

964  
»t
;

967 
	}
}

969 
	$cÚfigu»_šput_f‹r
(
F‹rG¿ph
 *
fg
, 
IÅutF‹r
 *
if‹r
,

970 
AVF‹rInOut
 *
š
)

972 ià(!
if‹r
->
i¡
->
dec
) {

973 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

975 
if‹r
->
i¡
->
fe_šdex
, if‹r->i¡->
¡
->
šdex
);

976  
AVERROR_DECODER_NOT_FOUND
;

978 
	`avf‹r_·d_g‘_ty³
(
š
->
f‹r_ùx
->
šput_·ds
, in->
·d_idx
)) {

979 
AVMEDIA_TYPE_VIDEO
:  
	`cÚfigu»_šput_video_f‹r
(
fg
, 
if‹r
, 
š
);

980 
AVMEDIA_TYPE_AUDIO
:  
	`cÚfigu»_šput_audio_f‹r
(
fg
, 
if‹r
, 
š
);

981 : 
	`av_as£¹0
(0);

983 
	}
}

985 
	$ş—nup_f‹rg¿ph
(
F‹rG¿ph
 *
fg
)

987 
i
;

988 
i
 = 0; i < 
fg
->
nb_ouuts
; i++)

989 
fg
->
ouuts
[
i
]->
f‹r
 = (
AVF‹rCÚ‹xt
 *)
NULL
;

990 
i
 = 0; i < 
fg
->
nb_šputs
; i++)

991 
fg
->
šputs
[
i
]->
f‹r
 = (
AVF‹rCÚ‹xt
 *)
NULL
;

992 
	`avf‹r_g¿ph_ä“
(&
fg
->
g¿ph
);

993 
	}
}

995 
	$cÚfigu»_f‹rg¿ph
(
F‹rG¿ph
 *
fg
)

997 
AVF‹rInOut
 *
šputs
, *
ouuts
, *
cur
;

998 
»t
, 
i
, 
sim¶e
 = 
	`f‹rg¿ph_is_sim¶e
(
fg
);

999 cÚ¡ *
g¿ph_desc
 = 
sim¶e
 ? 
fg
->
ouuts
[0]->
o¡
->
avf‹r
 :

1000 
fg
->
g¿ph_desc
;

1002 
	`ş—nup_f‹rg¿ph
(
fg
);

1003 ià(!(
fg
->
g¿ph
 = 
	`avf‹r_g¿ph_®loc
()))

1004  
	`AVERROR
(
ENOMEM
);

1006 ià(
sim¶e
) {

1007 
OuutSŒ—m
 *
o¡
 = 
fg
->
ouuts
[0]->ost;

1008 
¬gs
[512];

1009 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

1011 
fg
->
g¿ph
->
nb_th»ads
 = 
f‹r_nbth»ads
;

1013 
¬gs
[0] = 0;

1014 (
e
 = 
	`av_diù_g‘
(
o¡
->
sws_diù
, "",ƒ,

1015 
AV_DICT_IGNORE_SUFFIX
))) {

1016 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), "%s=%s:", 
e
->
key
,ƒ->
v®ue
);

1018 ià(
	`¡¾’
(
¬gs
))

1019 
¬gs
[
	`¡¾’
(args)-1] = 0;

1020 
fg
->
g¿ph
->
sÿË_sws_İts
 = 
	`av_¡rdup
(
¬gs
);

1022 
¬gs
[0] = 0;

1023 (
e
 = 
	`av_diù_g‘
(
o¡
->
swr_İts
, "",ƒ,

1024 
AV_DICT_IGNORE_SUFFIX
))) {

1025 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), "%s=%s:", 
e
->
key
,ƒ->
v®ue
);

1027 ià(
	`¡¾’
(
¬gs
))

1028 
¬gs
[
	`¡¾’
(args)-1] = 0;

1029 
	`av_İt_£t
(
fg
->
g¿ph
, "¬e§m¶e_swr_İts", 
¬gs
, 0);

1031 
¬gs
[0] = '\0';

1032 (
e
 = 
	`av_diù_g‘
(
fg
->
ouuts
[0]->
o¡
->
»§m¶e_İts
, "",ƒ,

1033 
AV_DICT_IGNORE_SUFFIX
))) {

1034 
	`av_¡¾ÿtf
(
¬gs
, ×rgs), "%s=%s:", 
e
->
key
,ƒ->
v®ue
);

1036 ià(
	`¡¾’
(
¬gs
))

1037 
¬gs
[
	`¡¾’
(args) - 1] = '\0';

1039 
e
 = 
	`av_diù_g‘
(
o¡
->
’cod”_İts
, "th»ads", 
NULL
, 0);

1040 ià(
e
)

1041 
	`av_İt_£t
(
fg
->
g¿ph
, "th»ads", 
e
->
v®ue
, 0);

1043 
fg
->
g¿ph
->
nb_th»ads
 = 
f‹r_com¶ex_nbth»ads
;

1046 ià((
»t
 = 
	`avf‹r_g¿ph_·r£2
(
fg
->
g¿ph
, 
g¿ph_desc
, &
šputs
, &
ouuts
)) < 0)

1047 
ç
;

1049 ià(
hw_deviû_ùx
) {

1050 
i
 = 0; i < 
fg
->
g¿ph
->
nb_f‹rs
; i++) {

1051 
fg
->
g¿ph
->
f‹rs
[
i
]->
hw_deviû_ùx
 = 
	`av_bufãr_»f
(hw_device_ctx);

1055 ià(
sim¶e
 && (!
šputs
 || iÅuts->
Ãxt
 || !
ouuts
 || outputs->next)) {

1056 cÚ¡ *
num_šputs
;

1057 cÚ¡ *
num_ouuts
;

1058 ià(!
ouuts
) {

1059 
num_ouuts
 = "0";

1060 } ià(
ouuts
->
Ãxt
) {

1061 
num_ouuts
 = ">1";

1063 
num_ouuts
 = "1";

1065 ià(!
šputs
) {

1066 
num_šputs
 = "0";

1067 } ià(
šputs
->
Ãxt
) {

1068 
num_šputs
 = ">1";

1070 
num_šputs
 = "1";

1072 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Simple filtergraph '%s' wasƒxpected "

1076 
g¿ph_desc
, 
num_šputs
, 
num_ouuts
);

1077 
»t
 = 
	`AVERROR
(
EINVAL
);

1078 
ç
;

1081 
cur
 = 
šputs
, 
i
 = 0; cur; cu¸ğcur->
Ãxt
, i++)

1082 ià((
»t
 = 
	`cÚfigu»_šput_f‹r
(
fg
, fg->
šputs
[
i
], 
cur
)) < 0) {

1083 
	`avf‹r_šout_ä“
(&
šputs
);

1084 
	`avf‹r_šout_ä“
(&
ouuts
);

1085 
ç
;

1087 
	`avf‹r_šout_ä“
(&
šputs
);

1089 
cur
 = 
ouuts
, 
i
 = 0; cur; cu¸ğcur->
Ãxt
, i++)

1090 
	`cÚfigu»_ouut_f‹r
(
fg
, fg->
ouuts
[
i
], 
cur
);

1091 
	`avf‹r_šout_ä“
(&
ouuts
);

1093 ià((
»t
 = 
	`avf‹r_g¿ph_cÚfig
(
fg
->
g¿ph
, 
NULL
)) < 0)

1094 
ç
;

1098 
i
 = 0; i < 
fg
->
nb_ouuts
; i++) {

1099 
OuutF‹r
 *
of‹r
 = 
fg
->
ouuts
[
i
];

1100 
AVF‹rCÚ‹xt
 *
sšk
 = 
of‹r
->
f‹r
;

1102 
of‹r
->
fÜm©
 = 
	`av_bufãrsšk_g‘_fÜm©
(
sšk
);

1104 
of‹r
->
width
 = 
	`av_bufãrsšk_g‘_w
(
sšk
);

1105 
of‹r
->
height
 = 
	`av_bufãrsšk_g‘_h
(
sšk
);

1107 
of‹r
->
§m¶e_¿‹
 = 
	`av_bufãrsšk_g‘_§m¶e_¿‹
(
sšk
);

1108 
of‹r
->
chªÃl_Ïyout
 = 
	`av_bufãrsšk_g‘_chªÃl_Ïyout
(
sšk
);

1111 
fg
->
»cÚfigu¿tiÚ
 = 1;

1113 
i
 = 0; i < 
fg
->
nb_ouuts
; i++) {

1114 
OuutSŒ—m
 *
o¡
 = 
fg
->
ouuts
[
i
]->ost;

1115 ià(!
o¡
->
’c
) {

1118 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Encoder (codec %s)‚ot found for output stream #%d:%d\n",

1119 
	`avcodec_g‘_Çme
(
o¡
->
¡
->
codeı¬
->
codec_id
), o¡->
fe_šdex
, o¡->
šdex
);

1120 
»t
 = 
	`AVERROR
(
EINVAL
);

1121 
ç
;

1123 ià(
o¡
->
’c
->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 &&

1124 !(
o¡
->
’c
->
ÿ·b™›s
 & 
AV_CODEC_CAP_VARIABLE_FRAME_SIZE
))

1125 
	`av_bufãrsšk_£t_äame_size
(
o¡
->
f‹r
->filter,

1126 
o¡
->
’c_ùx
->
äame_size
);

1129 
i
 = 0; i < 
fg
->
nb_šputs
; i++) {

1130 
	`av_fifo_size
(
fg
->
šputs
[
i
]->
äame_queue
)) {

1131 
AVF¿me
 *
tmp
;

1132 
	`av_fifo_g’”ic_»ad
(
fg
->
šputs
[
i
]->
äame_queue
, &
tmp
, Ñmp), 
NULL
);

1133 
»t
 = 
	`av_bufãr¤c_add_äame
(
fg
->
šputs
[
i
]->
f‹r
, 
tmp
);

1134 
	`av_äame_ä“
(&
tmp
);

1135 ià(
»t
 < 0)

1136 
ç
;

1141 
i
 = 0; i < 
fg
->
nb_šputs
; i++) {

1142 ià(
fg
->
šputs
[
i
]->
eof
) {

1143 
»t
 = 
	`av_bufãr¤c_add_äame
(
fg
->
šputs
[
i
]->
f‹r
, 
NULL
);

1144 ià(
»t
 < 0)

1145 
ç
;

1150 
i
 = 0; i < 
fg
->
nb_šputs
; i++) {

1151 
IÅutSŒ—m
 *
i¡
 = 
fg
->
šputs
[
i
]->ist;

1152 ià(
i¡
->
sub2video
.
sub_queue
 && i¡->sub2video.
äame
) {

1153 
	`av_fifo_size
(
i¡
->
sub2video
.
sub_queue
)) {

1154 
AVSubt™Ë
 
tmp
;

1155 
	`av_fifo_g’”ic_»ad
(
i¡
->
sub2video
.
sub_queue
, &
tmp
, Ñmp), 
NULL
);

1156 
	`sub2video_upd©e
(
i¡
, &
tmp
);

1157 
	`avsubt™Ë_ä“
(&
tmp
);

1164 
ç
:

1165 
	`ş—nup_f‹rg¿ph
(
fg
);

1166  
»t
;

1167 
	}
}

1169 
	$if‹r_·¿m‘”s_äom_äame
(
IÅutF‹r
 *
if‹r
, cÚ¡ 
AVF¿me
 *
äame
)

1171 
	`av_bufãr_uÄef
(&
if‹r
->
hw_äames_ùx
);

1173 
if‹r
->
fÜm©
 = 
äame
->format;

1175 
if‹r
->
width
 = 
äame
->width;

1176 
if‹r
->
height
 = 
äame
->height;

1177 
if‹r
->
§m¶e_a¥eù_¿tio
 = 
äame
->sample_aspect_ratio;

1179 
if‹r
->
§m¶e_¿‹
 = 
äame
->sample_rate;

1180 
if‹r
->
chªÃls
 = 
	`av_äame_g‘_chªÃls
(
äame
);

1181 
if‹r
->
chªÃl_Ïyout
 = 
äame
->channel_layout;

1183 ià(
äame
->
hw_äames_ùx
) {

1184 
if‹r
->
hw_äames_ùx
 = 
	`av_bufãr_»f
(
äame
->hw_frames_ctx);

1185 ià(!
if‹r
->
hw_äames_ùx
)

1186  
	`AVERROR
(
ENOMEM
);

1190 
	}
}

1192 
	$i¡_š_f‹rg¿ph
(
F‹rG¿ph
 *
fg
, 
IÅutSŒ—m
 *
i¡
)

1194 
i
;

1195 
i
 = 0; i < 
fg
->
nb_šputs
; i++)

1196 ià(
fg
->
šputs
[
i
]->
i¡
 == ist)

1199 
	}
}

1201 
	$f‹rg¿ph_is_sim¶e
(
F‹rG¿ph
 *
fg
)

1203  !
fg
->
g¿ph_desc
;

1204 
	}
}

	@ffmpeg_opt.c

21 
	~<¡dšt.h
>

23 
	~"ffm³g.h
"

24 
	~"cmduts.h
"

26 
	~"libavfÜm©/avfÜm©.h
"

28 
	~"libavcodec/avcodec.h
"

30 
	~"libavf‹r/avf‹r.h
"

32 
	~"libavut/avas£¹.h
"

33 
	~"libavut/av¡ršg.h
"

34 
	~"libavut/avut.h
"

35 
	~"libavut/chªÃl_Ïyout.h
"

36 
	~"libavut/šŒ—dwr™e.h
"

37 
	~"libavut/fifo.h
"

38 
	~"libavut/m©hem©ics.h
"

39 
	~"libavut/İt.h
"

40 
	~"libavut/·r£uts.h
"

41 
	~"libavut/pixdesc.h
"

42 
	~"libavut/pixfmt.h
"

44 
	#DEFAULT_PASS_LOGFILENAME_PREFIX
 "ffm³g2·ss"

	)

46 
	#MATCH_PER_STREAM_OPT
(
Çme
, 
ty³
, 
outv¬
, 
fmtùx
, 
¡
)\

48 
i
, 
»t
;\

49 
i
 = 0; i < 
o
->
nb_
 ## 
Çme
; i++) {\

50 *
¥ec
 = 
o
->
Çme
[
i
].
¥ecif›r
;\

51 ià((
»t
 = 
	`check_¡»am_¥ecif›r
(
fmtùx
, 
¡
, 
¥ec
)) > 0)\

52 
outv¬
 = 
o
->
Çme
[
i
].
u
.
ty³
;\

53 ià(
»t
 < 0)\

54 
	`ex™_´og¿m
(1);\

56 }

	)

58 
	#MATCH_PER_TYPE_OPT
(
Çme
, 
ty³
, 
outv¬
, 
fmtùx
, 
medŸty³
)\

60 
i
;\

61 
i
 = 0; i < 
o
->
nb_
 ## 
Çme
; i++) {\

62 *
¥ec
 = 
o
->
Çme
[
i
].
¥ecif›r
;\

63 ià(!
	`¡rcmp
(
¥ec
, 
medŸty³
))\

64 
outv¬
 = 
o
->
Çme
[
i
].
u
.
ty³
;\

66 }

	)

68 cÚ¡ 
HWAcûl
 
	ghwacûls
[] = {

69 #ià
HAVE_VDPAU_X11


70 { "vd·u", 
vd·u_š™
, 
HWACCEL_VDPAU
, 
AV_PIX_FMT_VDPAU
 },

72 #ià
HAVE_DXVA2_LIB


73 { "dxva2", 
dxva2_š™
, 
HWACCEL_DXVA2
, 
AV_PIX_FMT_DXVA2_VLD
 },

75 #ià
CONFIG_VDA


76 { "vda", 
videÙoŞbox_š™
, 
HWACCEL_VDA
, 
AV_PIX_FMT_VDA
 },

78 #ià
CONFIG_VIDEOTOOLBOX


79 { "videÙoŞbox", 
videÙoŞbox_š™
, 
HWACCEL_VIDEOTOOLBOX
, 
AV_PIX_FMT_VIDEOTOOLBOX
 },

81 #ià
CONFIG_LIBMFX


82 { "qsv", 
qsv_š™
, 
HWACCEL_QSV
, 
AV_PIX_FMT_QSV
 },

84 #ià
CONFIG_VAAPI


85 { "v¯pi", 
v¯pi_decode_š™
, 
HWACCEL_VAAPI
, 
AV_PIX_FMT_VAAPI
 },

87 #ià
CONFIG_CUVID


88 { "cuvid", 
cuvid_š™
, 
HWACCEL_CUVID
, 
AV_PIX_FMT_CUDA
 },

92 
	ghwacûl_Ïx_´ofe_check
 = 0;

93 
AVBufãrRef
 *
	ghw_deviû_ùx
;

95 *
	gv¡©s_f’ame
;

96 *
	gsdp_f’ame
;

98 
	gaudio_driá_th»shŞd
 = 0.1;

99 
	gdts_d–_th»shŞd
 = 10;

100 
	gdts_”rÜ_th»shŞd
 = 3600*30;

102 
	gaudio_vŞume
 = 256;

103 
	gaudio_sync_m‘hod
 = 0;

104 
	gvideo_sync_m‘hod
 = 
VSYNC_AUTO
;

105 
	gäame_drİ_th»shŞd
 = 0;

106 
	gdo_deš‹¾aû
 = 0;

107 
	gdo_b’chm¬k
 = 0;

108 
	gdo_b’chm¬k_®l
 = 0;

109 
	gdo_hex_dump
 = 0;

110 
	gdo_pkt_dump
 = 0;

111 
	gcİy_ts
 = 0;

112 
	g¡¬t_©_z”o
 = 0;

113 
	gcİy_tb
 = -1;

114 
	gdebug_ts
 = 0;

115 
	gex™_Ú_”rÜ
 = 0;

116 
	gabÜt_Ú_æags
 = 0;

117 
	g´št_¡©s
 = -1;

118 
	gqp_hi¡
 = 0;

119 
	g¡dš_š‹¿ùiÚ
 = 1;

120 
	gäame_b™s_³r_¿w_§m¶e
 = 0;

121 
	gmax_”rÜ_¿‹
 = 2.0/3;

122 
	gf‹r_nbth»ads
 = 0;

123 
	gf‹r_com¶ex_nbth»ads
 = 0;

124 
	gv¡©s_v”siÚ
 = 2;

127 
	gšŒa_Úly
 = 0;

128 
	gfe_ov”wr™e
 = 0;

129 
	gno_fe_ov”wr™e
 = 0;

130 
	gdo_p¢r
 = 0;

131 
	gšput_sync
;

132 
	gov”ride_ff£rv”
 = 0;

133 
	gšput_¡»am_pÙ’tŸÎy_avaabË
 = 0;

134 
	gignÜe_unknown_¡»ams
 = 0;

135 
	gcİy_unknown_¡»ams
 = 0;

137 
	$unš™_İtiÚs
(
O±iÚsCÚ‹xt
 *
o
)

139 cÚ¡ 
O±iÚDef
 *
po
 = 
İtiÚs
;

140 
i
;

143 
po
->
Çme
) {

144 *
d¡
 = (
ušt8_t
*)
o
 + 
po
->
u
.
off
;

146 ià(
po
->
æags
 & 
OPT_SPEC
) {

147 
S³cif›rO±
 **
so
 = 
d¡
;

148 
i
, *
couÁ
 = (*)(
so
 + 1);

149 
i
 = 0; i < *
couÁ
; i++) {

150 
	`av_ä“p
(&(*
so
)[
i
].
¥ecif›r
);

151 ià(
po
->
æags
 & 
OPT_STRING
)

152 
	`av_ä“p
(&(*
so
)[
i
].
u
.
¡r
);

154 
	`av_ä“p
(
so
);

155 *
couÁ
 = 0;

156 } ià(
po
->
æags
 & 
OPT_OFFSET
 &&…o->æag & 
OPT_STRING
)

157 
	`av_ä“p
(
d¡
);

158 
po
++;

161 
i
 = 0; i < 
o
->
nb_¡»am_m­s
; i++)

162 
	`av_ä“p
(&
o
->
¡»am_m­s
[
i
].
lškÏb–
);

163 
	`av_ä“p
(&
o
->
¡»am_m­s
);

164 
	`av_ä“p
(&
o
->
audio_chªÃl_m­s
);

165 
	`av_ä“p
(&
o
->
¡»amid_m­
);

166 
	`av_ä“p
(&
o
->
©chm’ts
);

167 
	}
}

169 
	$š™_İtiÚs
(
O±iÚsCÚ‹xt
 *
o
)

171 
	`mem£t
(
o
, 0, (*o));

173 
o
->
¡İ_time
 = 
INT64_MAX
;

174 
o
->
mux_max_d–ay
 = 0.7;

175 
o
->
¡¬t_time
 = 
AV_NOPTS_VALUE
;

176 
o
->
¡¬t_time_eof
 = 
AV_NOPTS_VALUE
;

177 
o
->
»cÜdšg_time
 = 
INT64_MAX
;

178 
o
->
lim™_fesize
 = 
UINT64_MAX
;

179 
o
->
ch­‹rs_šput_fe
 = 
INT_MAX
;

180 
o
->
accu¿‹_£ek
 = 1;

181 
	}
}

183 
	$show_hwacûls
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

185 
i
;

187 
	`´štf
("Hardware‡cceleration methods:\n");

188 
i
 = 0; 
hwacûls
[i].
Çme
; i++) {

189 
	`´štf
("%s\n", 
hwacûls
[
i
].
Çme
);

191 
	`´štf
("\n");

193 
	}
}

196 
AVDiùiÚ¬y
 *
	$¡r_¥ecif›rs
(
AVDiùiÚ¬y
 *
diù
)

198 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

199 
AVDiùiÚ¬y
 *
»t
 = 
NULL
;

201 (
e
 = 
	`av_diù_g‘
(
diù
, "",ƒ, 
AV_DICT_IGNORE_SUFFIX
))) {

202 *
p
 = 
	`¡rchr
(
e
->
key
, ':');

204 ià(
p
)

205 *
p
 = 0;

206 
	`av_diù_£t
(&
»t
, 
e
->
key
,ƒ->
v®ue
, 0);

207 ià(
p
)

208 *
p
 = ':';

210  
»t
;

211 
	}
}

213 
	$İt_abÜt_Ú
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

215 cÚ¡ 
AVO±iÚ
 
İts
[] = {

216 { "abÜt_Ú" , 
NULL
, 0, 
AV_OPT_TYPE_FLAGS
, { .
i64
 = 0 }, 
INT64_MIN
, 
INT64_MAX
, .
un™
 = "flags" },

217 { "em±y_ouut" , 
NULL
, 0, 
AV_OPT_TYPE_CONST
, { .
i64
 = 
ABORT_ON_FLAG_EMPTY_OUTPUT
 }, .
un™
 = "flags" },

218 { 
NULL
 },

220 cÚ¡ 
AVCÏss
 
şass
 = {

221 .
şass_Çme
 = "",

222 .
™em_Çme
 = 
av_deçuÉ_™em_Çme
,

223 .
İtiÚ
 = 
İts
,

224 .
v”siÚ
 = 
LIBAVUTIL_VERSION_INT
,

226 cÚ¡ 
AVCÏss
 *
pşass
 = &
şass
;

228  
	`av_İt_ev®_æags
(&
pşass
, &
İts
[0], 
¬g
, &
abÜt_Ú_æags
);

229 
	}
}

231 
	$İt_§meq
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

233 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Option '%s' was„emoved. "

236 
İt
, opt);

237  
	`AVERROR
(
EINVAL
);

238 
	}
}

240 
	$İt_video_chªÃl
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

242 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "This option is deprecated, use -channel.\n");

243  
	`İt_deçuÉ
(
İtùx
, "chªÃl", 
¬g
);

244 
	}
}

246 
	$İt_video_¡ªd¬d
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

248 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "This option is deprecated, use -standard.\n");

249  
	`İt_deçuÉ
(
İtùx
, "¡ªd¬d", 
¬g
);

250 
	}
}

252 
	$İt_audio_codec
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

254 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

255  
	`·r£_İtiÚ
(
o
, "codec:a", 
¬g
, 
İtiÚs
);

256 
	}
}

258 
	$İt_video_codec
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

260 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

261  
	`·r£_İtiÚ
(
o
, "codec:v", 
¬g
, 
İtiÚs
);

262 
	}
}

264 
	$İt_subt™Ë_codec
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

266 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

267  
	`·r£_İtiÚ
(
o
, "codec:s", 
¬g
, 
İtiÚs
);

268 
	}
}

270 
	$İt_d©a_codec
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

272 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

273  
	`·r£_İtiÚ
(
o
, "codec:d", 
¬g
, 
İtiÚs
);

274 
	}
}

276 
	$İt_m­
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

278 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

279 
SŒ—mM­
 *
m
 = 
NULL
;

280 
i
, 
Ãg©ive
 = 0, 
fe_idx
;

281 
sync_fe_idx
 = -1, 
sync_¡»am_idx
 = 0;

282 *
p
, *
sync
;

283 *
m­
;

284 *
®low_unu£d
;

286 ià(*
¬g
 == '-') {

287 
Ãg©ive
 = 1;

288 
¬g
++;

290 
m­
 = 
	`av_¡rdup
(
¬g
);

291 ià(!
m­
)

292  
	`AVERROR
(
ENOMEM
);

295 ià(
sync
 = 
	`¡rchr
(
m­
, ',')) {

296 *
sync
 = 0;

297 
sync_fe_idx
 = 
	`¡¹Ş
(
sync
 + 1, &sync, 0);

298 ià(
sync_fe_idx
 >ğ
nb_šput_fes
 || sync_file_idx < 0) {

299 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id synøfšdex: %d.\n", 
sync_fe_idx
);

300 
	`ex™_´og¿m
(1);

302 ià(*
sync
)

303 
sync
++;

304 
i
 = 0; i < 
šput_fes
[
sync_fe_idx
]->
nb_¡»ams
; i++)

305 ià(
	`check_¡»am_¥ecif›r
(
šput_fes
[
sync_fe_idx
]->
ùx
,

306 
šput_fes
[
sync_fe_idx
]->
ùx
->
¡»ams
[
i
], 
sync
) == 1) {

307 
sync_¡»am_idx
 = 
i
;

310 ià(
i
 =ğ
šput_fes
[
sync_fe_idx
]->
nb_¡»ams
) {

311 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Sync stream specification in map %s does‚ot "

312 "m©ch‡ny sŒ—ms.\n", 
¬g
);

313 
	`ex™_´og¿m
(1);

318 ià(
m­
[0] == '[') {

320 cÚ¡ *
c
 = 
m­
 + 1;

321 
	`GROW_ARRAY
(
o
->
¡»am_m­s
, o->
nb_¡»am_m­s
);

322 
m
 = &
o
->
¡»am_m­s
[o->
nb_¡»am_m­s
 - 1];

323 
m
->
lškÏb–
 = 
	`av_g‘_tok’
(&
c
, "]");

324 ià(!
m
->
lškÏb–
) {

325 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Inv®id ouuˆlšk†ab–: %s.\n", 
m­
);

326 
	`ex™_´og¿m
(1);

329 ià(
®low_unu£d
 = 
	`¡rchr
(
m­
, '?'))

330 *
®low_unu£d
 = 0;

331 
fe_idx
 = 
	`¡¹Ş
(
m­
, &
p
, 0);

332 ià(
fe_idx
 >ğ
nb_šput_fes
 || file_idx < 0) {

333 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id iÅuˆfšdex: %d.\n", 
fe_idx
);

334 
	`ex™_´og¿m
(1);

336 ià(
Ãg©ive
)

338 
i
 = 0; i < 
o
->
nb_¡»am_m­s
; i++) {

339 
m
 = &
o
->
¡»am_m­s
[
i
];

340 ià(
fe_idx
 =ğ
m
->
fe_šdex
 &&

341 
	`check_¡»am_¥ecif›r
(
šput_fes
[
m
->
fe_šdex
]->
ùx
,

342 
šput_fes
[
m
->
fe_šdex
]->
ùx
->
¡»ams
[m->
¡»am_šdex
],

343 *
p
 == ':' ?… + 1 :…) > 0)

344 
m
->
di§bËd
 = 1;

347 
i
 = 0; i < 
šput_fes
[
fe_idx
]->
nb_¡»ams
; i++) {

348 ià(
	`check_¡»am_¥ecif›r
(
šput_fes
[
fe_idx
]->
ùx
, iÅut_fes[fe_idx]->ùx->
¡»ams
[
i
],

349 *
p
 == ':' ?… + 1 :…) <= 0)

351 
	`GROW_ARRAY
(
o
->
¡»am_m­s
, o->
nb_¡»am_m­s
);

352 
m
 = &
o
->
¡»am_m­s
[o->
nb_¡»am_m­s
 - 1];

354 
m
->
fe_šdex
 = 
fe_idx
;

355 
m
->
¡»am_šdex
 = 
i
;

357 ià(
sync_fe_idx
 >= 0) {

358 
m
->
sync_fe_šdex
 = 
sync_fe_idx
;

359 
m
->
sync_¡»am_šdex
 = 
sync_¡»am_idx
;

361 
m
->
sync_fe_šdex
 = 
fe_idx
;

362 
m
->
sync_¡»am_šdex
 = 
i
;

367 ià(!
m
) {

368 ià(
®low_unu£d
) {

369 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "SŒ—m m­ '%s' m©che nØ¡»ams; ignÜšg.\n", 
¬g
);

371 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Stream map '%s' matches‚o streams.\n"

372 "TØignÜthis,‡dd‡¿šg '?'Øthm­.\n", 
¬g
);

373 
	`ex™_´og¿m
(1);

377 
	`av_ä“p
(&
m­
);

379 
	}
}

381 
	$İt_©ch
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

383 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

384 
	`GROW_ARRAY
(
o
->
©chm’ts
, o->
nb_©chm’ts
);

385 
o
->
©chm’ts
[o->
nb_©chm’ts
 - 1] = 
¬g
;

387 
	}
}

389 
	$İt_m­_chªÃl
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

391 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

392 
n
;

393 
AVSŒ—m
 *
¡
;

394 
AudioChªÃlM­
 *
m
;

396 
	`GROW_ARRAY
(
o
->
audio_chªÃl_m­s
, o->
nb_audio_chªÃl_m­s
);

397 
m
 = &
o
->
audio_chªÃl_m­s
[o->
nb_audio_chªÃl_m­s
 - 1];

400 
n
 = 
	`ssÿnf
(
¬g
, "%d:%d.%d", &
m
->
chªÃl_idx
, &m->
ofe_idx
, &m->
o¡»am_idx
);

401 ià((
n
 =ğ1 ||‚ =ğ3è&& 
m
->
chªÃl_idx
 == -1) {

402 
m
->
fe_idx
 = m->
¡»am_idx
 = -1;

403 ià(
n
 == 1)

404 
m
->
ofe_idx
 = m->
o¡»am_idx
 = -1;

409 
n
 = 
	`ssÿnf
(
¬g
, "%d.%d.%d:%d.%d",

410 &
m
->
fe_idx
, &m->
¡»am_idx
, &m->
chªÃl_idx
,

411 &
m
->
ofe_idx
, &m->
o¡»am_idx
);

413 ià(
n
 != 3 &&‚ != 5) {

414 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Syntaxƒrror, mapchan usage: "

416 
	`ex™_´og¿m
(1);

419 ià(
n
 != 5)

420 
m
->
ofe_idx
 = m->
o¡»am_idx
 = -1;

423 ià(
m
->
fe_idx
 < 0 || m->fe_idx >ğ
nb_šput_fes
) {

424 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "mapchan: invalid input file index: %d\n",

425 
m
->
fe_idx
);

426 
	`ex™_´og¿m
(1);

428 ià(
m
->
¡»am_idx
 < 0 ||

429 
m
->
¡»am_idx
 >ğ
šput_fes
[m->
fe_idx
]->
nb_¡»ams
) {

430 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "mapchan: invalid input file stream index #%d.%d\n",

431 
m
->
fe_idx
, m->
¡»am_idx
);

432 
	`ex™_´og¿m
(1);

434 
¡
 = 
šput_fes
[
m
->
fe_idx
]->
ùx
->
¡»ams
[m->
¡»am_idx
];

435 ià(
¡
->
codeı¬
->
codec_ty³
 !ğ
AVMEDIA_TYPE_AUDIO
) {

436 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "mapchan: stream #%d.%d is‚ot‡n‡udio stream.\n",

437 
m
->
fe_idx
, m->
¡»am_idx
);

438 
	`ex™_´og¿m
(1);

440 ià(
m
->
chªÃl_idx
 < 0 || m->chªÃl_idx >ğ
¡
->
codeı¬
->
chªÃls
) {

441 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "mapchan: invalid‡udio channel #%d.%d.%d\n",

442 
m
->
fe_idx
, m->
¡»am_idx
, m->
chªÃl_idx
);

443 
	`ex™_´og¿m
(1);

446 
	}
}

448 
	$İt_sdp_fe
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

450 
	`av_ä“
(
sdp_f’ame
);

451 
sdp_f’ame
 = 
	`av_¡rdup
(
¬g
);

453 
	}
}

455 #ià
CONFIG_VAAPI


456 
	$İt_v¯pi_deviû
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

458 
”r
;

459 
”r
 = 
	`v¯pi_deviû_š™
(
¬g
);

460 ià(
”r
 < 0)

461 
	`ex™_´og¿m
(1);

463 
	}
}

473 
	$·r£_m‘a_ty³
(*
¬g
, *
ty³
, *
šdex
, cÚ¡ **
¡»am_¥ec
)

475 ià(*
¬g
) {

476 *
ty³
 = *
¬g
;

477 *
¬g
) {

481 ià(*(++
¬g
) && *arg != ':') {

482 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id m‘ad©¨¥ecif›¸%s.\n", 
¬g
);

483 
	`ex™_´og¿m
(1);

485 *
¡»am_¥ec
 = *
¬g
 == ':' ?‡rg + 1 : "";

489 ià(*(++
¬g
) == ':')

490 *
šdex
 = 
	`¡¹Ş
(++
¬g
, 
NULL
, 0);

493 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id m‘ad©¨ty³ %c.\n", *
¬g
);

494 
	`ex™_´og¿m
(1);

497 *
ty³
 = 'g';

498 
	}
}

500 
	$cİy_m‘ad©a
(*
out¥ec
, *
š¥ec
, 
AVFÜm©CÚ‹xt
 *
oc
, AVFÜm©CÚ‹xˆ*
ic
, 
O±iÚsCÚ‹xt
 *
o
)

502 
AVDiùiÚ¬y
 **
m‘a_š
 = 
NULL
;

503 
AVDiùiÚ¬y
 **
m‘a_out
 = 
NULL
;

504 
i
, 
»t
 = 0;

505 
ty³_š
, 
ty³_out
;

506 cÚ¡ *
i¡»am_¥ec
 = 
NULL
, *
o¡»am_¥ec
 = NULL;

507 
idx_š
 = 0, 
idx_out
 = 0;

509 
	`·r£_m‘a_ty³
(
š¥ec
, &
ty³_š
, &
idx_š
, &
i¡»am_¥ec
);

510 
	`·r£_m‘a_ty³
(
out¥ec
, &
ty³_out
, &
idx_out
, &
o¡»am_¥ec
);

512 ià(!
ic
) {

513 ià(
ty³_out
 =ğ'g' || !*
out¥ec
)

514 
o
->
m‘ad©a_glob®_mªu®
 = 1;

515 ià(
ty³_out
 =ğ's' || !*
out¥ec
)

516 
o
->
m‘ad©a_¡»ams_mªu®
 = 1;

517 ià(
ty³_out
 =ğ'c' || !*
out¥ec
)

518 
o
->
m‘ad©a_ch­‹rs_mªu®
 = 1;

522 ià(
ty³_š
 =ğ'g' || 
ty³_out
 == 'g')

523 
o
->
m‘ad©a_glob®_mªu®
 = 1;

524 ià(
ty³_š
 =ğ's' || 
ty³_out
 == 's')

525 
o
->
m‘ad©a_¡»ams_mªu®
 = 1;

526 ià(
ty³_š
 =ğ'c' || 
ty³_out
 == 'c')

527 
o
->
m‘ad©a_ch­‹rs_mªu®
 = 1;

530 ià(!
ic
)

533 
	#METADATA_CHECK_INDEX
(
šdex
, 
nb_–ems
, 
desc
)\

534 ià((
šdex
è< 0 || (šdexè>ğ(
nb_–ems
)) {\

535 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid %s index %d while…rocessing metadata maps.\n",\

536 (
desc
), (
šdex
));\

537 
	`ex™_´og¿m
(1);\

538 }

	)

540 
	#SET_DICT
(
ty³
, 
m‘a
, 
cÚ‹xt
, 
šdex
)\

541 
ty³
) {\

543 
m‘a
 = &
cÚ‹xt
->
m‘ad©a
;\

546 
	`METADATA_CHECK_INDEX
(
šdex
, 
cÚ‹xt
->
nb_ch­‹rs
, "chapter")\

547 
m‘a
 = &
cÚ‹xt
->
ch­‹rs
[
šdex
]->
m‘ad©a
;\

550 
	`METADATA_CHECK_INDEX
(
šdex
, 
cÚ‹xt
->
nb_´og¿ms
, "program")\

551 
m‘a
 = &
cÚ‹xt
->
´og¿ms
[
šdex
]->
m‘ad©a
;\

555 : 
	`av_as£¹0
(0);\

557 

	)

558 
	`SET_DICT
(
ty³_š
, 
m‘a_š
, 
ic
, 
idx_š
);

559 
	`SET_DICT
(
ty³_out
, 
m‘a_out
, 
oc
, 
idx_out
);

562 ià(
ty³_š
 == 's') {

563 
i
 = 0; i < 
ic
->
nb_¡»ams
; i++) {

564 ià((
»t
 = 
	`check_¡»am_¥ecif›r
(
ic
, ic->
¡»ams
[
i
], 
i¡»am_¥ec
)) > 0) {

565 
m‘a_š
 = &
ic
->
¡»ams
[
i
]->
m‘ad©a
;

567 } ià(
»t
 < 0)

568 
	`ex™_´og¿m
(1);

570 ià(!
m‘a_š
) {

571 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SŒ—m s³cif›¸% dÛ nÙ m©ch‡ny sŒ—ms.\n", 
i¡»am_¥ec
);

572 
	`ex™_´og¿m
(1);

576 ià(
ty³_out
 == 's') {

577 
i
 = 0; i < 
oc
->
nb_¡»ams
; i++) {

578 ià((
»t
 = 
	`check_¡»am_¥ecif›r
(
oc
, oc->
¡»ams
[
i
], 
o¡»am_¥ec
)) > 0) {

579 
m‘a_out
 = &
oc
->
¡»ams
[
i
]->
m‘ad©a
;

580 
	`av_diù_cİy
(
m‘a_out
, *
m‘a_š
, 
AV_DICT_DONT_OVERWRITE
);

581 } ià(
»t
 < 0)

582 
	`ex™_´og¿m
(1);

585 
	`av_diù_cİy
(
m‘a_out
, *
m‘a_š
, 
AV_DICT_DONT_OVERWRITE
);

588 
	}
}

590 
	$İt_»cÜdšg_time¡amp
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

592 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

593 
buf
[128];

594 
št64_t
 
»cÜdšg_time¡amp
 = 
	`·r£_time_Ü_d›
(
İt
, 
¬g
, 0) / 1E6;

595 
tm
 
time
 = *
	`gmtime
((
time_t
*)&
»cÜdšg_time¡amp
);

596 ià(!
	`¡ráime
(
buf
, (buf), "ü—tiÚ_time=%Y-%m-%dT%H:%M:%S%z", &
time
))

598 
	`·r£_İtiÚ
(
o
, "m‘ad©a", 
buf
, 
İtiÚs
);

600 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "%s is deprecated, sethe 'creation_time' metadata "

601 "g in¡—d.\n", 
İt
);

603 
	}
}

605 
AVCodec
 *
	$fšd_codec_Ü_d›
(cÚ¡ *
Çme
, 
AVMedŸTy³
 
ty³
, 
’cod”
)

607 cÚ¡ 
AVCodecDesütÜ
 *
desc
;

608 cÚ¡ *
codec_¡ršg
 = 
’cod”
 ? "encoder" : "decoder";

609 
AVCodec
 *
codec
;

611 
codec
 = 
’cod”
 ?

612 
	`avcodec_fšd_’cod”_by_Çme
(
Çme
) :

613 
	`avcodec_fšd_decod”_by_Çme
(
Çme
);

615 ià(!
codec
 && (
desc
 = 
	`avcodec_desütÜ_g‘_by_Çme
(
Çme
))) {

616 
codec
 = 
’cod”
 ? 
	`avcodec_fšd_’cod”
(
desc
->
id
) :

617 
	`avcodec_fšd_decod”
(
desc
->
id
);

618 ià(
codec
)

619 
	`av_log
(
NULL
, 
AV_LOG_VERBOSE
, "Matched %s '%s' for codec '%s'.\n",

620 
codec_¡ršg
, 
codec
->
Çme
, 
desc
->name);

623 ià(!
codec
) {

624 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UnknowÀ% '%s'\n", 
codec_¡ršg
, 
Çme
);

625 
	`ex™_´og¿m
(1);

627 ià(
codec
->
ty³
 !=ype) {

628 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id % ty³ '%s'\n", 
codec_¡ršg
, 
Çme
);

629 
	`ex™_´og¿m
(1);

631  
codec
;

632 
	}
}

634 
AVCodec
 *
	$choo£_decod”
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
s
, 
AVSŒ—m
 *
¡
)

636 *
codec_Çme
 = 
NULL
;

638 
	`MATCH_PER_STREAM_OPT
(
codec_Çmes
, 
¡r
, 
codec_Çme
, 
s
, 
¡
);

639 ià(
codec_Çme
) {

640 
AVCodec
 *
codec
 = 
	`fšd_codec_Ü_d›
(
codec_Çme
, 
¡
->
codeı¬
->
codec_ty³
, 0);

641 
¡
->
codeı¬
->
codec_id
 = 
codec
->
id
;

642  
codec
;

644  
	`avcodec_fšd_decod”
(
¡
->
codeı¬
->
codec_id
);

645 
	}
}

649 
	$add_šput_¡»ams
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
ic
)

651 
i
, 
»t
;

653 
i
 = 0; i < 
ic
->
nb_¡»ams
; i++) {

654 
AVSŒ—m
 *
¡
 = 
ic
->
¡»ams
[
i
];

655 
AVCodecP¬am‘”s
 *
·r
 = 
¡
->
codeı¬
;

656 
IÅutSŒ—m
 *
i¡
 = 
	`av_m®locz
((*ist));

657 *
äam”©e
 = 
NULL
, *
hwacûl
 = NULL, *
hwacûl_deviû
 = NULL;

658 *
hwacûl_ouut_fÜm©
 = 
NULL
;

659 *
codec_g
 = 
NULL
;

660 *
Ãxt
;

661 *
disÿrd_¡r
 = 
NULL
;

662 cÚ¡ 
AVCÏss
 *
cc
 = 
	`avcodec_g‘_şass
();

663 cÚ¡ 
AVO±iÚ
 *
disÿrd_İt
 = 
	`av_İt_fšd
(&
cc
, "sk_äame", 
NULL
, 0, 0);

665 ià(!
i¡
)

666 
	`ex™_´og¿m
(1);

668 
	`GROW_ARRAY
(
šput_¡»ams
, 
nb_šput_¡»ams
);

669 
šput_¡»ams
[
nb_šput_¡»ams
 - 1] = 
i¡
;

671 
i¡
->
¡
 = st;

672 
i¡
->
fe_šdex
 = 
nb_šput_fes
;

673 
i¡
->
disÿrd
 = 1;

674 
¡
->
disÿrd
 = 
AVDISCARD_ALL
;

675 
i¡
->
nb_§m¶es
 = 0;

676 
i¡
->
mš_±s
 = 
INT64_MAX
;

677 
i¡
->
max_±s
 = 
INT64_MIN
;

679 
i¡
->
ts_sÿË
 = 1.0;

680 
	`MATCH_PER_STREAM_OPT
(
ts_sÿË
, 
dbl
, 
i¡
->ts_sÿË, 
ic
, 
¡
);

682 
i¡
->
autÜÙ©e
 = 1;

683 
	`MATCH_PER_STREAM_OPT
(
autÜÙ©e
, 
i
, 
i¡
->autÜÙ©e, 
ic
, 
¡
);

685 
	`MATCH_PER_STREAM_OPT
(
codec_gs
, 
¡r
, 
codec_g
, 
ic
, 
¡
);

686 ià(
codec_g
) {

687 
ušt32_t
 
g
 = 
	`¡¹Ş
(
codec_g
, &
Ãxt
, 0);

688 ià(*
Ãxt
)

689 
g
 = 
	`AV_RL32
(
codec_g
);

690 
¡
->
codeı¬
->
codec_g
 = 
g
;

693 
i¡
->
dec
 = 
	`choo£_decod”
(
o
, 
ic
, 
¡
);

694 
i¡
->
decod”_İts
 = 
	`f‹r_codec_İts
(
o
->
g
->
codec_İts
, i¡->
¡
->
codeı¬
->
codec_id
, 
ic
, st, i¡->
dec
);

696 
i¡
->
»š™_f‹rs
 = -1;

697 
	`MATCH_PER_STREAM_OPT
(
»š™_f‹rs
, 
i
, 
i¡
->»š™_f‹rs, 
ic
, 
¡
);

699 
	`MATCH_PER_STREAM_OPT
(
disÿrd
, 
¡r
, 
disÿrd_¡r
, 
ic
, 
¡
);

700 
i¡
->
u£r_£t_disÿrd
 = 
AVDISCARD_NONE
;

701 ià(
disÿrd_¡r
 && 
	`av_İt_ev®_št
(&
cc
, 
disÿrd_İt
, disÿrd_¡r, &
i¡
->
u£r_£t_disÿrd
) < 0) {

702 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error…arsing discard %s.\n",

703 
disÿrd_¡r
);

704 
	`ex™_´og¿m
(1);

707 
i¡
->
f‹r_š_»sÿË_d–_Ï¡
 = 
AV_NOPTS_VALUE
;

709 
i¡
->
dec_ùx
 = 
	`avcodec_®loc_cÚ‹xt3
(i¡->
dec
);

710 ià(!
i¡
->
dec_ùx
) {

711 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error‡llocatinghe decoder context.\n");

712 
	`ex™_´og¿m
(1);

715 
»t
 = 
	`avcodec_·¿m‘”s_to_cÚ‹xt
(
i¡
->
dec_ùx
, 
·r
);

716 ià(
»t
 < 0) {

717 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error initializinghe decoder context.\n");

718 
	`ex™_´og¿m
(1);

721 
·r
->
codec_ty³
) {

722 
AVMEDIA_TYPE_VIDEO
:

723 if(!
i¡
->
dec
)

724 
i¡
->
dec
 = 
	`avcodec_fšd_decod”
(
·r
->
codec_id
);

725 #ià
FF_API_EMU_EDGE


726 ià(
	`av_codec_g‘_low»s
(
¡
->
codec
)) {

727 
	`av_codec_£t_low»s
(
i¡
->
dec_ùx
, 
	`av_codec_g‘_low»s
(
¡
->
codec
));

728 
i¡
->
dec_ùx
->
width
 = 
¡
->
codec
->width;

729 
i¡
->
dec_ùx
->
height
 = 
¡
->
codec
->height;

730 
i¡
->
dec_ùx
->
coded_width
 = 
¡
->
codec
->coded_width;

731 
i¡
->
dec_ùx
->
coded_height
 = 
¡
->
codec
->coded_height;

732 
i¡
->
dec_ùx
->
æags
 |ğ
CODEC_FLAG_EMU_EDGE
;

737 
i¡
->
dec_ùx
->
äam”©e
 = 
¡
->
avg_äame_¿‹
;

739 
	`MATCH_PER_STREAM_OPT
(
äame_¿‹s
, 
¡r
, 
äam”©e
, 
ic
, 
¡
);

740 ià(
äam”©e
 && 
	`av_·r£_video_¿‹
(&
i¡
->framerate,

741 
äam”©e
) < 0) {

742 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error…arsing framerate %s.\n",

743 
äam”©e
);

744 
	`ex™_´og¿m
(1);

747 
i¡
->
tİ_f›ld_fœ¡
 = -1;

748 
	`MATCH_PER_STREAM_OPT
(
tİ_f›ld_fœ¡
, 
i
, 
i¡
->tİ_f›ld_fœ¡, 
ic
, 
¡
);

750 
	`MATCH_PER_STREAM_OPT
(
hwacûls
, 
¡r
, 
hwacûl
, 
ic
, 
¡
);

751 ià(
hwacûl
) {

752 ià(!
	`¡rcmp
(
hwacûl
, "none"))

753 
i¡
->
hwacûl_id
 = 
HWACCEL_NONE
;

754 ià(!
	`¡rcmp
(
hwacûl
, "auto"))

755 
i¡
->
hwacûl_id
 = 
HWACCEL_AUTO
;

757 
i
;

758 
i
 = 0; 
hwacûls
[i].
Çme
; i++) {

759 ià(!
	`¡rcmp
(
hwacûls
[
i
].
Çme
, 
hwacûl
)) {

760 
i¡
->
hwacûl_id
 = 
hwacûls
[
i
].
id
;

765 ià(!
i¡
->
hwacûl_id
) {

766 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Unrecognized hwaccel: %s.\n",

767 
hwacûl
);

768 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Supported hwaccels: ");

769 
i
 = 0; 
hwacûls
[i].
Çme
; i++)

770 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "% ", 
hwacûls
[
i
].
Çme
);

771 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "\n");

772 
	`ex™_´og¿m
(1);

777 
	`MATCH_PER_STREAM_OPT
(
hwacûl_deviûs
, 
¡r
, 
hwacûl_deviû
, 
ic
, 
¡
);

778 ià(
hwacûl_deviû
) {

779 
i¡
->
hwacûl_deviû
 = 
	`av_¡rdup
(hwaccel_device);

780 ià(!
i¡
->
hwacûl_deviû
)

781 
	`ex™_´og¿m
(1);

784 
	`MATCH_PER_STREAM_OPT
(
hwacûl_ouut_fÜm©s
, 
¡r
,

785 
hwacûl_ouut_fÜm©
, 
ic
, 
¡
);

786 ià(
hwacûl_ouut_fÜm©
) {

787 
i¡
->
hwacûl_ouut_fÜm©
 = 
	`av_g‘_pix_fmt
(hwaccel_output_format);

788 ià(
i¡
->
hwacûl_ouut_fÜm©
 =ğ
AV_PIX_FMT_NONE
) {

789 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Unrecognised hwaccel output "

790 "fÜm©: %s", 
hwacûl_ouut_fÜm©
);

793 
i¡
->
hwacûl_ouut_fÜm©
 = 
AV_PIX_FMT_NONE
;

796 
i¡
->
hwacûl_pix_fmt
 = 
AV_PIX_FMT_NONE
;

799 
AVMEDIA_TYPE_AUDIO
:

800 
i¡
->
guess_Ïyout_max
 = 
INT_MAX
;

801 
	`MATCH_PER_STREAM_OPT
(
guess_Ïyout_max
, 
i
, 
i¡
->guess_Ïyout_max, 
ic
, 
¡
);

802 
	`guess_šput_chªÃl_Ïyout
(
i¡
);

804 
AVMEDIA_TYPE_DATA
:

805 
AVMEDIA_TYPE_SUBTITLE
: {

806 *
ÿnvas_size
 = 
NULL
;

807 if(!
i¡
->
dec
)

808 
i¡
->
dec
 = 
	`avcodec_fšd_decod”
(
·r
->
codec_id
);

809 
	`MATCH_PER_STREAM_OPT
(
fix_sub_du¿tiÚ
, 
i
, 
i¡
->fix_sub_du¿tiÚ, 
ic
, 
¡
);

810 
	`MATCH_PER_STREAM_OPT
(
ÿnvas_sizes
, 
¡r
, 
ÿnvas_size
, 
ic
, 
¡
);

811 ià(
ÿnvas_size
 &&

812 
	`av_·r£_video_size
(&
i¡
->
dec_ùx
->
width
, &i¡->dec_ùx->
height
, 
ÿnvas_size
) < 0) {

813 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id cªva size: %s.\n", 
ÿnvas_size
);

814 
	`ex™_´og¿m
(1);

818 
AVMEDIA_TYPE_ATTACHMENT
:

819 
AVMEDIA_TYPE_UNKNOWN
:

822 
	`abÜt
();

825 
»t
 = 
	`avcodec_·¿m‘”s_äom_cÚ‹xt
(
·r
, 
i¡
->
dec_ùx
);

826 ià(
»t
 < 0) {

827 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error initializinghe decoder context.\n");

828 
	`ex™_´og¿m
(1);

831 
	}
}

833 
	$as£¹_fe_ov”wr™e
(cÚ¡ *
f’ame
)

835 ià(
fe_ov”wr™e
 && 
no_fe_ov”wr™e
) {

836 
	`årštf
(
¡d”r
, "Error, both -y‡nd -n supplied. Exiting.\n");

837 
	`ex™_´og¿m
(1);

840 ià(!
fe_ov”wr™e
) {

841 cÚ¡ *
´Ùo_Çme
 = 
	`avio_fšd_´ÙocŞ_Çme
(
f’ame
);

842 ià(
´Ùo_Çme
 && !
	`¡rcmp
ÕrÙo_Çme, "fe"è&& 
	`avio_check
(
f’ame
, 0) == 0) {

843 ià(
¡dš_š‹¿ùiÚ
 && !
no_fe_ov”wr™e
) {

844 
	`årštf
(
¡d”r
,"F'%s'‡Ì—dyƒxi¡s. Ov”wr™? [y/N] ", 
f’ame
);

845 
	`fæush
(
¡d”r
);

846 
	`‹rm_ex™
();

847 
	`sigÇl
(
SIGINT
, 
SIG_DFL
);

848 ià(!
	`»ad_ye¢o
()) {

849 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Not overwriting -ƒxiting\n");

850 
	`ex™_´og¿m
(1);

852 
	`‹rm_š™
();

855 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "F'%s'‡Ì—dyƒxi¡s. Ex™šg.\n", 
f’ame
);

856 
	`ex™_´og¿m
(1);

860 
	}
}

862 
	$dump_©chm’t
(
AVSŒ—m
 *
¡
, cÚ¡ *
f’ame
)

864 
»t
;

865 
AVIOCÚ‹xt
 *
out
 = 
NULL
;

866 
AVDiùiÚ¬yEÁry
 *
e
;

868 ià(!
¡
->
codeı¬
->
exŒad©a_size
) {

869 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Noƒxtradatao dump in stream #%d:%d.\n",

870 
nb_šput_fes
 - 1, 
¡
->
šdex
);

873 ià(!*
f’ame
 && (
e
 = 
	`av_diù_g‘
(
¡
->
m‘ad©a
, "f’ame", 
NULL
, 0)))

874 
f’ame
 = 
e
->
v®ue
;

875 ià(!*
f’ame
) {

876 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "No filename specified‡nd‚o 'filename'ag"

877 "š sŒ—m #%d:%d.\n", 
nb_šput_fes
 - 1, 
¡
->
šdex
);

878 
	`ex™_´og¿m
(1);

881 
	`as£¹_fe_ov”wr™e
(
f’ame
);

883 ià((
»t
 = 
	`avio_İ’2
(&
out
, 
f’ame
, 
AVIO_FLAG_WRITE
, &
št_cb
, 
NULL
)) < 0) {

884 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot open file %s for writing.\n",

885 
f’ame
);

886 
	`ex™_´og¿m
(1);

889 
	`avio_wr™e
(
out
, 
¡
->
codeı¬
->
exŒad©a
, st->codeı¬->
exŒad©a_size
);

890 
	`avio_æush
(
out
);

891 
	`avio_şo£
(
out
);

892 
	}
}

894 
	$İ’_šput_fe
(
O±iÚsCÚ‹xt
 *
o
, cÚ¡ *
f’ame
)

896 
IÅutFe
 *
f
;

897 
AVFÜm©CÚ‹xt
 *
ic
;

898 
AVIÅutFÜm©
 *
fe_ifÜm©
 = 
NULL
;

899 
”r
, 
i
, 
»t
;

900 
št64_t
 
time¡amp
;

901 
AVDiùiÚ¬y
 **
İts
;

902 
AVDiùiÚ¬y
 *
unu£d_İts
 = 
NULL
;

903 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

904 
Üig_nb_¡»ams
;

905 * 
video_codec_Çme
 = 
NULL
;

906 * 
audio_codec_Çme
 = 
NULL
;

907 *
subt™Ë_codec_Çme
 = 
NULL
;

908 * 
d©a_codec_Çme
 = 
NULL
;

909 
sÿn_®l_pmts_£t
 = 0;

911 ià(
o
->
fÜm©
) {

912 ià(!(
fe_ifÜm©
 = 
	`av_fšd_šput_fÜm©
(
o
->
fÜm©
))) {

913 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UnknowÀšpuˆfÜm©: '%s'\n", 
o
->
fÜm©
);

914 
	`ex™_´og¿m
(1);

918 ià(!
	`¡rcmp
(
f’ame
, "-"))

919 
f’ame
 = "pipe:";

921 
¡dš_š‹¿ùiÚ
 &ğ
	`¡ºcmp
(
f’ame
, "pipe:", 5) &&

922 
	`¡rcmp
(
f’ame
, "/dev/stdin");

925 
ic
 = 
	`avfÜm©_®loc_cÚ‹xt
();

926 ià(!
ic
) {

927 
	`´št_”rÜ
(
f’ame
, 
	`AVERROR
(
ENOMEM
));

928 
	`ex™_´og¿m
(1);

930 
ic
->
æags
 |ğ
AVFMT_FLAG_KEEP_SIDE_DATA
;

931 ià(
o
->
nb_audio_§m¶e_¿‹
) {

932 
	`av_diù_£t_št
(&
o
->
g
->
fÜm©_İts
, "§m¶e_¿‹", o->
audio_§m¶e_¿‹
[o->
nb_audio_§m¶e_¿‹
 - 1].
u
.
i
, 0);

934 ià(
o
->
nb_audio_chªÃls
) {

938 ià(
fe_ifÜm©
 && fe_ifÜm©->
´iv_şass
 &&

939 
	`av_İt_fšd
(&
fe_ifÜm©
->
´iv_şass
, "chªÃls", 
NULL
, 0,

940 
AV_OPT_SEARCH_FAKE_OBJ
)) {

941 
	`av_diù_£t_št
(&
o
->
g
->
fÜm©_İts
, "chªÃls", o->
audio_chªÃls
[o->
nb_audio_chªÃls
 - 1].
u
.
i
, 0);

944 ià(
o
->
nb_äame_¿‹s
) {

947 ià(
fe_ifÜm©
 && fe_ifÜm©->
´iv_şass
 &&

948 
	`av_İt_fšd
(&
fe_ifÜm©
->
´iv_şass
, "äam”©e", 
NULL
, 0,

949 
AV_OPT_SEARCH_FAKE_OBJ
)) {

950 
	`av_diù_£t
(&
o
->
g
->
fÜm©_İts
, "framerate",

951 
o
->
äame_¿‹s
[o->
nb_äame_¿‹s
 - 1].
u
.
¡r
, 0);

954 ià(
o
->
nb_äame_sizes
) {

955 
	`av_diù_£t
(&
o
->
g
->
fÜm©_İts
, "video_size", o->
äame_sizes
[o->
nb_äame_sizes
 - 1].
u
.
¡r
, 0);

957 ià(
o
->
nb_äame_pix_fmts
)

958 
	`av_diù_£t
(&
o
->
g
->
fÜm©_İts
, "pix–_fÜm©", o->
äame_pix_fmts
[o->
nb_äame_pix_fmts
 - 1].
u
.
¡r
, 0);

960 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
video_codec_Çme
, 
ic
, "v");

961 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
audio_codec_Çme
, 
ic
, "a");

962 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
subt™Ë_codec_Çme
, 
ic
, "s");

963 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
d©a_codec_Çme
, 
ic
, "d");

965 
ic
->
video_codec_id
 = 
video_codec_Çme
 ?

966 
	`fšd_codec_Ü_d›
(
video_codec_Çme
 , 
AVMEDIA_TYPE_VIDEO
 , 0)->
id
 : 
AV_CODEC_ID_NONE
;

967 
ic
->
audio_codec_id
 = 
audio_codec_Çme
 ?

968 
	`fšd_codec_Ü_d›
(
audio_codec_Çme
 , 
AVMEDIA_TYPE_AUDIO
 , 0)->
id
 : 
AV_CODEC_ID_NONE
;

969 
ic
->
subt™Ë_codec_id
ğ
subt™Ë_codec_Çme
 ?

970 
	`fšd_codec_Ü_d›
(
subt™Ë_codec_Çme
, 
AVMEDIA_TYPE_SUBTITLE
, 0)->
id
 : 
AV_CODEC_ID_NONE
;

971 
ic
->
d©a_codec_id
 = 
d©a_codec_Çme
 ?

972 
	`fšd_codec_Ü_d›
(
d©a_codec_Çme
, 
AVMEDIA_TYPE_DATA
, 0)->
id
 : 
AV_CODEC_ID_NONE
;

974 ià(
video_codec_Çme
)

975 
	`av_fÜm©_£t_video_codec
 (
ic
, 
	`fšd_codec_Ü_d›
(
video_codec_Çme
 , 
AVMEDIA_TYPE_VIDEO
 , 0));

976 ià(
audio_codec_Çme
)

977 
	`av_fÜm©_£t_audio_codec
 (
ic
, 
	`fšd_codec_Ü_d›
(
audio_codec_Çme
 , 
AVMEDIA_TYPE_AUDIO
 , 0));

978 ià(
subt™Ë_codec_Çme
)

979 
	`av_fÜm©_£t_subt™Ë_codec
(
ic
, 
	`fšd_codec_Ü_d›
(
subt™Ë_codec_Çme
, 
AVMEDIA_TYPE_SUBTITLE
, 0));

980 ià(
d©a_codec_Çme
)

981 
	`av_fÜm©_£t_d©a_codec
(
ic
, 
	`fšd_codec_Ü_d›
(
d©a_codec_Çme
, 
AVMEDIA_TYPE_DATA
, 0));

983 
ic
->
æags
 |ğ
AVFMT_FLAG_NONBLOCK
;

984 
ic
->
š‹¼u±_ÿÎback
 = 
št_cb
;

986 ià(!
	`av_diù_g‘
(
o
->
g
->
fÜm©_İts
, "sÿn_®l_pmts", 
NULL
, 
AV_DICT_MATCH_CASE
)) {

987 
	`av_diù_£t
(&
o
->
g
->
fÜm©_İts
, "sÿn_®l_pmts", "1", 
AV_DICT_DONT_OVERWRITE
);

988 
sÿn_®l_pmts_£t
 = 1;

991 
”r
 = 
	`avfÜm©_İ’_šput
(&
ic
, 
f’ame
, 
fe_ifÜm©
, &
o
->
g
->
fÜm©_İts
);

992 ià(
”r
 < 0) {

993 
	`´št_”rÜ
(
f’ame
, 
”r
);

994 ià(
”r
 =ğ
AVERROR_PROTOCOL_NOT_FOUND
)

995 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Did you m—Àfe:%s?\n", 
f’ame
);

996 
	`ex™_´og¿m
(1);

998 ià(
sÿn_®l_pmts_£t
)

999 
	`av_diù_£t
(&
o
->
g
->
fÜm©_İts
, "sÿn_®l_pmts", 
NULL
, 
AV_DICT_MATCH_CASE
);

1000 
	`»move_avİtiÚs
(&
o
->
g
->
fÜm©_İts
, o->g->
codec_İts
);

1001 
	`as£¹_avİtiÚs
(
o
->
g
->
fÜm©_İts
);

1004 
i
 = 0; i < 
ic
->
nb_¡»ams
; i++)

1005 
	`choo£_decod”
(
o
, 
ic
, ic->
¡»ams
[
i
]);

1008 
İts
 = 
	`£tup_fšd_¡»am_šfo_İts
(
ic
, 
o
->
g
->
codec_İts
);

1009 
Üig_nb_¡»ams
 = 
ic
->
nb_¡»ams
;

1013 
»t
 = 
	`avfÜm©_fšd_¡»am_šfo
(
ic
, 
İts
);

1014 ià(
»t
 < 0) {

1015 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s: could‚Ù fšd codeø·¿m‘”s\n", 
f’ame
);

1016 ià(
ic
->
nb_¡»ams
 == 0) {

1017 
	`avfÜm©_şo£_šput
(&
ic
);

1018 
	`ex™_´og¿m
(1);

1022 ià(
o
->
¡¬t_time_eof
 !ğ
AV_NOPTS_VALUE
) {

1023 ià(
ic
->
du¿tiÚ
>0) {

1024 
o
->
¡¬t_time
 = o->
¡¬t_time_eof
 + 
ic
->
du¿tiÚ
;

1026 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "CªnÙ u£ -s£of, du¿tiÚ oà% nÙ known\n", 
f’ame
);

1028 
time¡amp
 = (
o
->
¡¬t_time
 =ğ
AV_NOPTS_VALUE
) ? 0 : o->start_time;

1030 ià(!
o
->
£ek_time¡amp
 && 
ic
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
)

1031 
time¡amp
 +ğ
ic
->
¡¬t_time
;

1034 ià(
o
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
) {

1035 
št64_t
 
£ek_time¡amp
 = 
time¡amp
;

1037 ià(!(
ic
->
ifÜm©
->
æags
 & 
AVFMT_SEEK_TO_PTS
)) {

1038 
dts_heuri¡ic
 = 0;

1039 
i
=0; i<
ic
->
nb_¡»ams
; i++) {

1040 cÚ¡ 
AVCodecP¬am‘”s
 *
·r
 = 
ic
->
¡»ams
[
i
]->
codeı¬
;

1041 ià(
·r
->
video_d–ay
)

1042 
dts_heuri¡ic
 = 1;

1044 ià(
dts_heuri¡ic
) {

1045 
£ek_time¡amp
 -ğ3*
AV_TIME_BASE
 / 23;

1048 
»t
 = 
	`avfÜm©_£ek_fe
(
ic
, -1, 
INT64_MIN
, 
£ek_time¡amp
, seek_timestamp, 0);

1049 ià(
»t
 < 0) {

1050 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "%s: could‚ot seeko…osition %0.3f\n",

1051 
f’ame
, ()
time¡amp
 / 
AV_TIME_BASE
);

1056 
	`add_šput_¡»ams
(
o
, 
ic
);

1059 
	`av_dump_fÜm©
(
ic
, 
nb_šput_fes
, 
f’ame
, 0);

1061 
	`GROW_ARRAY
(
šput_fes
, 
nb_šput_fes
);

1062 
f
 = 
	`av_m®locz
((*f));

1063 ià(!
f
)

1064 
	`ex™_´og¿m
(1);

1065 
šput_fes
[
nb_šput_fes
 - 1] = 
f
;

1067 
f
->
ùx
 = 
ic
;

1068 
f
->
i¡_šdex
 = 
nb_šput_¡»ams
 - 
ic
->
nb_¡»ams
;

1069 
f
->
¡¬t_time
 = 
o
->start_time;

1070 
f
->
»cÜdšg_time
 = 
o
->recording_time;

1071 
f
->
šput_ts_off£t
 = 
o
->input_ts_offset;

1072 
f
->
ts_off£t
 = 
o
->
šput_ts_off£t
 - (
cİy_ts
 ? (
¡¬t_©_z”o
 && 
ic
->
¡¬t_time
 !ğ
AV_NOPTS_VALUE
 ? ic->¡¬t_tim: 0è: 
time¡amp
);

1073 
f
->
nb_¡»ams
 = 
ic
->nb_streams;

1074 
f
->
¿‹_emu
 = 
o
->rate_emu;

1075 
f
->
accu¿‹_£ek
 = 
o
->accurate_seek;

1076 
f
->
loİ
 = 
o
->loop;

1077 
f
->
du¿tiÚ
 = 0;

1078 
f
->
time_ba£
 = (
AVR©iÚ®
){ 1, 1 };

1079 #ià
HAVE_PTHREADS


1080 
f
->
th»ad_queue_size
 = 
o
->thread_queue_size > 0 ? o->thread_queue_size : 8;

1084 
unu£d_İts
 = 
	`¡r_¥ecif›rs
(
o
->
g
->
codec_İts
);

1085 
i
 = 
f
->
i¡_šdex
; i < 
nb_šput_¡»ams
; i++) {

1086 
e
 = 
NULL
;

1087 (
e
 = 
	`av_diù_g‘
(
šput_¡»ams
[
i
]->
decod”_İts
, "",ƒ,

1088 
AV_DICT_IGNORE_SUFFIX
)))

1089 
	`av_diù_£t
(&
unu£d_İts
, 
e
->
key
, 
NULL
, 0);

1092 
e
 = 
NULL
;

1093 (
e
 = 
	`av_diù_g‘
(
unu£d_İts
, "",ƒ, 
AV_DICT_IGNORE_SUFFIX
))) {

1094 cÚ¡ 
AVCÏss
 *
şass
 = 
	`avcodec_g‘_şass
();

1095 cÚ¡ 
AVO±iÚ
 *
İtiÚ
 = 
	`av_İt_fšd
(&
şass
, 
e
->
key
, 
NULL
, 0,

1096 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
);

1097 cÚ¡ 
AVCÏss
 *
fşass
 = 
	`avfÜm©_g‘_şass
();

1098 cÚ¡ 
AVO±iÚ
 *
fİtiÚ
 = 
	`av_İt_fšd
(&
fşass
, 
e
->
key
, 
NULL
, 0,

1099 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
);

1100 ià(!
İtiÚ
 || 
fİtiÚ
)

1104 ià(!(
İtiÚ
->
æags
 & 
AV_OPT_FLAG_DECODING_PARAM
)) {

1105 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Codec AVOption %s (%s) specified for "

1106 "špuˆf#%d (%sèi nÙ‡ decodšg o±iÚ.\n", 
e
->
key
,

1107 
İtiÚ
->
h–p
 ? o±iÚ->h–°: "", 
nb_šput_fes
 - 1,

1108 
f’ame
);

1109 
	`ex™_´og¿m
(1);

1112 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Codec AVOption %s (%s) specified for "

1116 "which wa nÙ‡ùu®ly u£d fÜ‡ny sŒ—m.\n", 
e
->
key
,

1117 
İtiÚ
->
h–p
 ? o±iÚ->h–°: "", 
nb_šput_fes
 - 1, 
f’ame
);

1119 
	`av_diù_ä“
(&
unu£d_İts
);

1121 
i
 = 0; i < 
o
->
nb_dump_©chm’t
; i++) {

1122 
j
;

1124 
j
 = 0; j < 
ic
->
nb_¡»ams
; j++) {

1125 
AVSŒ—m
 *
¡
 = 
ic
->
¡»ams
[
j
];

1127 ià(
	`check_¡»am_¥ecif›r
(
ic
, 
¡
, 
o
->
dump_©chm’t
[
i
].
¥ecif›r
) == 1)

1128 
	`dump_©chm’t
(
¡
, 
o
->
dump_©chm’t
[
i
].
u
.
¡r
);

1132 
i
 = 0; i < 
Üig_nb_¡»ams
; i++)

1133 
	`av_diù_ä“
(&
İts
[
i
]);

1134 
	`av_ä“p
(&
İts
);

1136 
šput_¡»am_pÙ’tŸÎy_avaabË
 = 1;

1139 
	}
}

1141 
ušt8_t
 *
	$g‘_lše
(
AVIOCÚ‹xt
 *
s
)

1143 
AVIOCÚ‹xt
 *
lše
;

1144 
ušt8_t
 *
buf
;

1145 
c
;

1147 ià(
	`avio_İ’_dyn_buf
(&
lše
) < 0) {

1148 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡lloc buffer for„eading…reset.\n");

1149 
	`ex™_´og¿m
(1);

1152 (
c
 = 
	`avio_r8
(
s
)) && c != '\n')

1153 
	`avio_w8
(
lše
, 
c
);

1154 
	`avio_w8
(
lše
, 0);

1155 
	`avio_şo£_dyn_buf
(
lše
, &
buf
);

1157  
buf
;

1158 
	}
}

1160 
	$g‘_´e£t_fe_2
(cÚ¡ *
´e£t_Çme
, cÚ¡ *
codec_Çme
, 
AVIOCÚ‹xt
 **
s
)

1162 
i
, 
»t
 = -1;

1163 
f’ame
[1000];

1164 cÚ¡ *
ba£
[3] = { 
	`g‘’v
("AVCONV_DATADIR"),

1165 
	`g‘’v
("HOME"),

1166 
AVCONV_DATADIR
,

1169 
i
 = 0; i < 
	`FF_ARRAY_ELEMS
(
ba£
è&& 
»t
 < 0; i++) {

1170 ià(!
ba£
[
i
])

1172 ià(
codec_Çme
) {

1173 
	`¢´štf
(
f’ame
, (f’ame), "%s%s/%s-%s.av´e£t", 
ba£
[
i
],

1174 
i
 !ğ1 ? "" : "/.avcÚv", 
codec_Çme
, 
´e£t_Çme
);

1175 
»t
 = 
	`avio_İ’2
(
s
, 
f’ame
, 
AVIO_FLAG_READ
, &
št_cb
, 
NULL
);

1177 ià(
»t
 < 0) {

1178 
	`¢´štf
(
f’ame
, (f’ame), "%s%s/%s.av´e£t", 
ba£
[
i
],

1179 
i
 !ğ1 ? "" : "/.avcÚv", 
´e£t_Çme
);

1180 
»t
 = 
	`avio_İ’2
(
s
, 
f’ame
, 
AVIO_FLAG_READ
, &
št_cb
, 
NULL
);

1183  
»t
;

1184 
	}
}

1186 
	$choo£_’cod”
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
s
, 
OuutSŒ—m
 *
o¡
)

1188 
AVMedŸTy³
 
ty³
 = 
o¡
->
¡
->
codeı¬
->
codec_ty³
;

1189 *
codec_Çme
 = 
NULL
;

1191 ià(
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||y³ =ğ
AVMEDIA_TYPE_AUDIO
 ||y³ =ğ
AVMEDIA_TYPE_SUBTITLE
) {

1192 
	`MATCH_PER_STREAM_OPT
(
codec_Çmes
, 
¡r
, 
codec_Çme
, 
s
, 
o¡
->
¡
);

1193 ià(!
codec_Çme
) {

1194 
o¡
->
¡
->
codeı¬
->
codec_id
 = 
	`av_guess_codec
(
s
->
ofÜm©
, 
NULL
, s->
f’ame
,

1195 
NULL
, 
o¡
->
¡
->
codeı¬
->
codec_ty³
);

1196 
o¡
->
’c
 = 
	`avcodec_fšd_’cod”
(o¡->
¡
->
codeı¬
->
codec_id
);

1197 ià(!
o¡
->
’c
) {

1198 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Automaticƒncoder selection failed for "

1201 
o¡
->
fe_šdex
, o¡->
šdex
, 
s
->
ofÜm©
->
Çme
,

1202 
	`avcodec_g‘_Çme
(
o¡
->
¡
->
codeı¬
->
codec_id
));

1203  
AVERROR_ENCODER_NOT_FOUND
;

1205 } ià(!
	`¡rcmp
(
codec_Çme
, "copy"))

1206 
o¡
->
¡»am_cİy
 = 1;

1208 
o¡
->
’c
 = 
	`fšd_codec_Ü_d›
(
codec_Çme
, o¡->
¡
->
codeı¬
->
codec_ty³
, 1);

1209 
o¡
->
¡
->
codeı¬
->
codec_id
 = o¡->
’c
->
id
;

1211 
o¡
->
’codšg_Ãeded
 = !o¡->
¡»am_cİy
;

1214 
o¡
->
¡»am_cİy
 = 1;

1215 
o¡
->
’codšg_Ãeded
 = 0;

1219 
	}
}

1221 
OuutSŒ—m
 *
	$Ãw_ouut_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
AVMedŸTy³
 
ty³
, 
sourû_šdex
)

1223 
OuutSŒ—m
 *
o¡
;

1224 
AVSŒ—m
 *
¡
 = 
	`avfÜm©_Ãw_¡»am
(
oc
, 
NULL
);

1225 
idx
 = 
oc
->
nb_¡»ams
 - 1, 
»t
 = 0;

1226 cÚ¡ *
bsfs
 = 
NULL
, *
time_ba£
 = NULL;

1227 *
Ãxt
, *
codec_g
 = 
NULL
;

1228 
qsÿË
 = -1;

1229 
i
;

1231 ià(!
¡
) {

1232 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡lloc stream.\n");

1233 
	`ex™_´og¿m
(1);

1236 ià(
oc
->
nb_¡»ams
 - 1 < 
o
->
nb_¡»amid_m­
)

1237 
¡
->
id
 = 
o
->
¡»amid_m­
[
oc
->
nb_¡»ams
 - 1];

1239 
	`GROW_ARRAY
(
ouut_¡»ams
, 
nb_ouut_¡»ams
);

1240 ià(!(
o¡
 = 
	`av_m®locz
((*ost))))

1241 
	`ex™_´og¿m
(1);

1242 
ouut_¡»ams
[
nb_ouut_¡»ams
 - 1] = 
o¡
;

1244 
o¡
->
fe_šdex
 = 
nb_ouut_fes
 - 1;

1245 
o¡
->
šdex
 = 
idx
;

1246 
o¡
->
¡
 = st;

1247 
¡
->
codeı¬
->
codec_ty³
 = 
ty³
;

1249 
»t
 = 
	`choo£_’cod”
(
o
, 
oc
, 
o¡
);

1250 ià(
»t
 < 0) {

1251 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error selecting‡nƒncoder for stream "

1252 "%d:%d\n", 
o¡
->
fe_šdex
, o¡->
šdex
);

1253 
	`ex™_´og¿m
(1);

1256 
o¡
->
’c_ùx
 = 
	`avcodec_®loc_cÚ‹xt3
(o¡->
’c
);

1257 ià(!
o¡
->
’c_ùx
) {

1258 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error‡llocatingheƒncoding context.\n");

1259 
	`ex™_´og¿m
(1);

1261 
o¡
->
’c_ùx
->
codec_ty³
 = 
ty³
;

1263 
o¡
->
»f_·r
 = 
	`avcodec_·¿m‘”s_®loc
();

1264 ià(!
o¡
->
»f_·r
) {

1265 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error‡llocatingheƒncoding…arameters.\n");

1266 
	`ex™_´og¿m
(1);

1269 ià(
o¡
->
’c
) {

1270 
AVIOCÚ‹xt
 *
s
 = 
NULL
;

1271 *
buf
 = 
NULL
, *
¬g
 = NULL, *
´e£t
 = NULL;

1273 
o¡
->
’cod”_İts
 = 
	`f‹r_codec_İts
(
o
->
g
->
codec_İts
, o¡->
’c
->
id
, 
oc
, 
¡
, ost->enc);

1275 
	`MATCH_PER_STREAM_OPT
(
´e£ts
, 
¡r
, 
´e£t
, 
oc
, 
¡
);

1276 ià(
´e£t
 && (!(
»t
 = 
	`g‘_´e£t_fe_2
Õ»£t, 
o¡
->
’c
->
Çme
, &
s
)))) {

1278 
buf
 = 
	`g‘_lše
(
s
);

1279 ià(!
buf
[0] || buf[0] == '#') {

1280 
	`av_ä“
(
buf
);

1283 ià(!(
¬g
 = 
	`¡rchr
(
buf
, '='))) {

1284 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid†ine found inhe…reset file.\n");

1285 
	`ex™_´og¿m
(1);

1287 *
¬g
++ = 0;

1288 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, 
buf
, 
¬g
, 
AV_DICT_DONT_OVERWRITE
);

1289 
	`av_ä“
(
buf
);

1290 } !
s
->
eof_»ached
);

1291 
	`avio_şo£p
(&
s
);

1293 ià(
»t
) {

1294 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

1296 
´e£t
, 
o¡
->
fe_šdex
, o¡->
šdex
);

1297 
	`ex™_´og¿m
(1);

1300 
o¡
->
’cod”_İts
 = 
	`f‹r_codec_İts
(
o
->
g
->
codec_İts
, 
AV_CODEC_ID_NONE
, 
oc
, 
¡
, 
NULL
);

1303 
	`MATCH_PER_STREAM_OPT
(
time_ba£s
, 
¡r
, 
time_ba£
, 
oc
, 
¡
);

1304 ià(
time_ba£
) {

1305 
AVR©iÚ®
 
q
;

1306 ià(
	`av_·r£_¿tio
(&
q
, 
time_ba£
, 
INT_MAX
, 0, 
NULL
) < 0 ||

1307 
q
.
num
 <ğ0 || q.
d’
 <= 0) {

1308 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®idimba£: %s\n", 
time_ba£
);

1309 
	`ex™_´og¿m
(1);

1311 
¡
->
time_ba£
 = 
q
;

1314 
o¡
->
max_äames
 = 
INT64_MAX
;

1315 
	`MATCH_PER_STREAM_OPT
(
max_äames
, 
i64
, 
o¡
->max_äames, 
oc
, 
¡
);

1316 
i
 = 0; i<
o
->
nb_max_äames
; i++) {

1317 *
p
 = 
o
->
max_äames
[
i
].
¥ecif›r
;

1318 ià(!*
p
 && 
ty³
 !ğ
AVMEDIA_TYPE_VIDEO
) {

1319 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Applying unspecific -frameso‚on video streams, maybe you meant -vframes ?\n");

1324 
o¡
->
cİy_´iÜ_¡¬t
 = -1;

1325 
	`MATCH_PER_STREAM_OPT
(
cİy_´iÜ_¡¬t
, 
i
, 
o¡
->cİy_´iÜ_¡¬t, 
oc
 ,
¡
);

1327 
	`MATCH_PER_STREAM_OPT
(
b™¡»am_f‹rs
, 
¡r
, 
bsfs
, 
oc
, 
¡
);

1328 
bsfs
 && *bsfs) {

1329 cÚ¡ 
AVB™SŒ—mF‹r
 *
f‹r
;

1330 *
bsf
, *
bsf_İtiÚs_¡r
, *
bsf_Çme
;

1332 
bsf
 = 
	`av_g‘_tok’
(&
bsfs
, ",");

1333 ià(!
bsf
)

1334 
	`ex™_´og¿m
(1);

1335 
bsf_Çme
 = 
	`av_¡¹ok
(
bsf
, "=", &
bsf_İtiÚs_¡r
);

1336 ià(!
bsf_Çme
)

1337 
	`ex™_´og¿m
(1);

1339 
f‹r
 = 
	`av_bsf_g‘_by_Çme
(
bsf_Çme
);

1340 ià(!
f‹r
) {

1341 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UnknowÀb™¡»am f‹¸%s\n", 
bsf_Çme
);

1342 
	`ex™_´og¿m
(1);

1345 
o¡
->
bsf_ùx
 = 
	`av_»®loc_¬¿y
(ost->bsf_ctx,

1346 
o¡
->
nb_b™¡»am_f‹rs
 + 1,

1347 (*
o¡
->
bsf_ùx
));

1348 ià(!
o¡
->
bsf_ùx
)

1349 
	`ex™_´og¿m
(1);

1351 
»t
 = 
	`av_bsf_®loc
(
f‹r
, &
o¡
->
bsf_ùx
[o¡->
nb_b™¡»am_f‹rs
]);

1352 ià(
»t
 < 0) {

1353 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error‡llocating‡ bitstream filter context\n");

1354 
	`ex™_´og¿m
(1);

1357 
o¡
->
nb_b™¡»am_f‹rs
++;

1359 ià(
bsf_İtiÚs_¡r
 && 
f‹r
->
´iv_şass
) {

1360 cÚ¡ 
AVO±iÚ
 *
İt
 = 
	`av_İt_Ãxt
(
o¡
->
bsf_ùx
[o¡->
nb_b™¡»am_f‹rs
-1]->
´iv_d©a
, 
NULL
);

1361 cÚ¡ * 
shÜthªd
[2] = {
NULL
};

1363 ià(
İt
)

1364 
shÜthªd
[0] = 
İt
->
Çme
;

1366 
»t
 = 
	`av_İt_£t_äom_¡ršg
(
o¡
->
bsf_ùx
[o¡->
nb_b™¡»am_f‹rs
-1]->
´iv_d©a
, 
bsf_İtiÚs_¡r
, 
shÜthªd
, "=", ":");

1367 ià(
»t
 < 0) {

1368 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü…¬sšg o±iÚ fÜ b™¡»am f‹¸%s\n", 
bsf_Çme
);

1369 
	`ex™_´og¿m
(1);

1372 
	`av_ä“p
(&
bsf
);

1374 ià(*
bsfs
)

1375 
bsfs
++;

1377 ià(
o¡
->
nb_b™¡»am_f‹rs
) {

1378 
o¡
->
bsf_exŒad©a_upd©ed
 = 
	`av_m®locz_¬¿y
(o¡->
nb_b™¡»am_f‹rs
, (*ost->bsf_extradata_updated));

1379 ià(!
o¡
->
bsf_exŒad©a_upd©ed
) {

1380 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Bitstream filter memory‡llocation failed\n");

1381 
	`ex™_´og¿m
(1);

1385 
	`MATCH_PER_STREAM_OPT
(
codec_gs
, 
¡r
, 
codec_g
, 
oc
, 
¡
);

1386 ià(
codec_g
) {

1387 
ušt32_t
 
g
 = 
	`¡¹Ş
(
codec_g
, &
Ãxt
, 0);

1388 ià(*
Ãxt
)

1389 
g
 = 
	`AV_RL32
(
codec_g
);

1390 
o¡
->
¡
->
codeı¬
->
codec_g
 =

1391 
o¡
->
’c_ùx
->
codec_g
 = 
g
;

1394 
	`MATCH_PER_STREAM_OPT
(
qsÿË
, 
dbl
, qsÿË, 
oc
, 
¡
);

1395 ià(
qsÿË
 >= 0) {

1396 
o¡
->
’c_ùx
->
æags
 |ğ
AV_CODEC_FLAG_QSCALE
;

1397 
o¡
->
’c_ùx
->
glob®_qu®™y
 = 
FF_QP2LAMBDA
 * 
qsÿË
;

1400 
	`MATCH_PER_STREAM_OPT
(
di¥os™iÚ
, 
¡r
, 
o¡
->di¥os™iÚ, 
oc
, 
¡
);

1401 
o¡
->
di¥os™iÚ
 = 
	`av_¡rdup
(ost->disposition);

1403 
o¡
->
max_muxšg_queue_size
 = 128;

1404 
	`MATCH_PER_STREAM_OPT
(
max_muxšg_queue_size
, 
i
, 
o¡
->max_muxšg_queue_size, 
oc
, 
¡
);

1405 
o¡
->
max_muxšg_queue_size
 *ğ(
AVPack‘
);

1407 ià(
oc
->
ofÜm©
->
æags
 & 
AVFMT_GLOBALHEADER
)

1408 
o¡
->
’c_ùx
->
æags
 |ğ
AV_CODEC_FLAG_GLOBAL_HEADER
;

1410 
	`av_diù_cİy
(&
o¡
->
sws_diù
, 
o
->
g
->sws_dict, 0);

1412 
	`av_diù_cİy
(&
o¡
->
swr_İts
, 
o
->
g
->swr_opts, 0);

1413 ià(
o¡
->
’c
 && 
	`av_g‘_exaù_b™s_³r_§m¶e
(o¡->’c->
id
) == 24)

1414 
	`av_diù_£t
(&
o¡
->
swr_İts
, "output_sample_bits", "24", 0);

1416 
	`av_diù_cİy
(&
o¡
->
»§m¶e_İts
, 
o
->
g
->resample_opts, 0);

1418 
o¡
->
sourû_šdex
 = source_index;

1419 ià(
sourû_šdex
 >= 0) {

1420 
o¡
->
sync_i¡
 = 
šput_¡»ams
[
sourû_šdex
];

1421 
šput_¡»ams
[
sourû_šdex
]->
disÿrd
 = 0;

1422 
šput_¡»ams
[
sourû_šdex
]->
¡
->
disÿrd
 = iÅut_¡»ams[sourû_šdex]->
u£r_£t_disÿrd
;

1424 
o¡
->
Ï¡_mux_dts
 = 
AV_NOPTS_VALUE
;

1426 
o¡
->
muxšg_queue
 = 
	`av_fifo_®loc
(8 * (
AVPack‘
));

1427 ià(!
o¡
->
muxšg_queue
)

1428 
	`ex™_´og¿m
(1);

1430  
o¡
;

1431 
	}
}

1433 
	$·r£_m©rix_cÛffs
(
ušt16_t
 *
de¡
, cÚ¡ *
¡r
)

1435 
i
;

1436 cÚ¡ *
p
 = 
¡r
;

1437 
i
 = 0;; i++) {

1438 
de¡
[
i
] = 
	`©oi
(
p
);

1439 ià(
i
 == 63)

1441 
p
 = 
	`¡rchr
(p, ',');

1442 ià(!
p
) {

1443 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "SyÁaxƒ¼Ü iÀm©rix \"%s\"‡ˆcÛfà%d\n", 
¡r
, 
i
);

1444 
	`ex™_´og¿m
(1);

1446 
p
++;

1448 
	}
}

1451 
ušt8_t
 *
	$»ad_fe
(cÚ¡ *
f’ame
)

1453 
AVIOCÚ‹xt
 *
pb
 = 
NULL
;

1454 
AVIOCÚ‹xt
 *
dyn_buf
 = 
NULL
;

1455 
»t
 = 
	`avio_İ’
(&
pb
, 
f’ame
, 
AVIO_FLAG_READ
);

1456 
ušt8_t
 
buf
[1024], *
¡r
;

1458 ià(
»t
 < 0) {

1459 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "E¼Ü o³nšg f%s.\n", 
f’ame
);

1460  
NULL
;

1463 
»t
 = 
	`avio_İ’_dyn_buf
(&
dyn_buf
);

1464 ià(
»t
 < 0) {

1465 
	`avio_şo£p
(&
pb
);

1466  
NULL
;

1468 (
»t
 = 
	`avio_»ad
(
pb
, 
buf
, (buf))) > 0)

1469 
	`avio_wr™e
(
dyn_buf
, 
buf
, 
»t
);

1470 
	`avio_w8
(
dyn_buf
, 0);

1471 
	`avio_şo£p
(&
pb
);

1473 
»t
 = 
	`avio_şo£_dyn_buf
(
dyn_buf
, &
¡r
);

1474 ià(
»t
 < 0)

1475  
NULL
;

1476  
¡r
;

1477 
	}
}

1479 *
	$g‘_o¡_f‹rs
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
,

1480 
OuutSŒ—m
 *
o¡
)

1482 
AVSŒ—m
 *
¡
 = 
o¡
->st;

1484 ià(
o¡
->
f‹rs_süt
 && o¡->
f‹rs
) {

1485 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Both -filter‡nd -filter_script set for "

1486 "ouuˆ¡»am #%d:%d.\n", 
nb_ouut_fes
, 
¡
->
šdex
);

1487 
	`ex™_´og¿m
(1);

1490 ià(
o¡
->
f‹rs_süt
)

1491  
	`»ad_fe
(
o¡
->
f‹rs_süt
);

1492 ià(
o¡
->
f‹rs
)

1493  
	`av_¡rdup
(
o¡
->
f‹rs
);

1495  
	`av_¡rdup
(
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ?

1497 
	}
}

1499 
	$check_¡»amcİy_f‹rs
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
,

1500 cÚ¡ 
OuutSŒ—m
 *
o¡
, 
AVMedŸTy³
 
ty³
)

1502 ià(
o¡
->
f‹rs_süt
 || o¡->
f‹rs
) {

1503 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

1506 
o¡
->
f‹rs
 ? "Filtergraph" : "Filtergraph script",

1507 
o¡
->
f‹rs
 ? o¡->f‹r : o¡->
f‹rs_süt
,

1508 
	`av_g‘_medŸ_ty³_¡ršg
(
ty³
), 
o¡
->
fe_šdex
, o¡->
šdex
);

1509 
	`ex™_´og¿m
(1);

1511 
	}
}

1513 
OuutSŒ—m
 *
	$Ãw_video_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1515 
AVSŒ—m
 *
¡
;

1516 
OuutSŒ—m
 *
o¡
;

1517 
AVCodecCÚ‹xt
 *
video_’c
;

1518 *
äame_¿‹
 = 
NULL
, *
äame_a¥eù_¿tio
 = NULL;

1520 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_VIDEO
, 
sourû_šdex
);

1521 
¡
 = 
o¡
->st;

1522 
video_’c
 = 
o¡
->
’c_ùx
;

1524 
	`MATCH_PER_STREAM_OPT
(
äame_¿‹s
, 
¡r
, 
äame_¿‹
, 
oc
, 
¡
);

1525 ià(
äame_¿‹
 && 
	`av_·r£_video_¿‹
(&
o¡
->frame_rate, frame_rate) < 0) {

1526 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id f¿m”©v®ue: %s\n", 
äame_¿‹
);

1527 
	`ex™_´og¿m
(1);

1529 ià(
äame_¿‹
 && 
video_sync_m‘hod
 =ğ
VSYNC_PASSTHROUGH
)

1530 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Using -vsync 0‡nd -r can…roduce invalid output files\n");

1532 
	`MATCH_PER_STREAM_OPT
(
äame_a¥eù_¿tios
, 
¡r
, 
äame_a¥eù_¿tio
, 
oc
, 
¡
);

1533 ià(
äame_a¥eù_¿tio
) {

1534 
AVR©iÚ®
 
q
;

1535 ià(
	`av_·r£_¿tio
(&
q
, 
äame_a¥eù_¿tio
, 255, 0, 
NULL
) < 0 ||

1536 
q
.
num
 <ğ0 || q.
d’
 <= 0) {

1537 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id‡¥eù„©io: %s\n", 
äame_a¥eù_¿tio
);

1538 
	`ex™_´og¿m
(1);

1540 
o¡
->
äame_a¥eù_¿tio
 = 
q
;

1543 
	`MATCH_PER_STREAM_OPT
(
f‹r_süts
, 
¡r
, 
o¡
->
f‹rs_süt
, 
oc
, 
¡
);

1544 
	`MATCH_PER_STREAM_OPT
(
f‹rs
, 
¡r
, 
o¡
->f‹rs, 
oc
, 
¡
);

1546 ià(!
o¡
->
¡»am_cİy
) {

1547 cÚ¡ *
p
 = 
NULL
;

1548 *
äame_size
 = 
NULL
;

1549 *
äame_pix_fmt
 = 
NULL
;

1550 *
šŒa_m©rix
 = 
NULL
, *
š‹r_m©rix
 = NULL;

1551 *
chroma_šŒa_m©rix
 = 
NULL
;

1552 
do_·ss
 = 0;

1553 
i
;

1555 
	`MATCH_PER_STREAM_OPT
(
äame_sizes
, 
¡r
, 
äame_size
, 
oc
, 
¡
);

1556 ià(
äame_size
 && 
	`av_·r£_video_size
(&
video_’c
->
width
, &video_’c->
height
, frame_size) < 0) {

1557 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id f¿msize: %s.\n", 
äame_size
);

1558 
	`ex™_´og¿m
(1);

1561 
video_’c
->
b™s_³r_¿w_§m¶e
 = 
äame_b™s_³r_¿w_§m¶e
;

1562 
	`MATCH_PER_STREAM_OPT
(
äame_pix_fmts
, 
¡r
, 
äame_pix_fmt
, 
oc
, 
¡
);

1563 ià(
äame_pix_fmt
 && *frame_pix_fmt == '+') {

1564 
o¡
->
k“p_pix_fmt
 = 1;

1565 ià(!*++
äame_pix_fmt
)

1566 
äame_pix_fmt
 = 
NULL
;

1568 ià(
äame_pix_fmt
 && (
video_’c
->
pix_fmt
 = 
	`av_g‘_pix_fmt
(äame_pix_fmt)è=ğ
AV_PIX_FMT_NONE
) {

1569 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UnknowÀpix– fÜm©„eque¡ed: %s.\n", 
äame_pix_fmt
);

1570 
	`ex™_´og¿m
(1);

1572 
¡
->
§m¶e_a¥eù_¿tio
 = 
video_’c
->sample_aspect_ratio;

1574 ià(
šŒa_Úly
)

1575 
video_’c
->
gİ_size
 = 0;

1576 
	`MATCH_PER_STREAM_OPT
(
šŒa_m©riûs
, 
¡r
, 
šŒa_m©rix
, 
oc
, 
¡
);

1577 ià(
šŒa_m©rix
) {

1578 ià(!(
video_’c
->
šŒa_m©rix
 = 
	`av_m®locz
((*video_enc->intra_matrix) * 64))) {

1579 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡llocate memory for intra matrix.\n");

1580 
	`ex™_´og¿m
(1);

1582 
	`·r£_m©rix_cÛffs
(
video_’c
->
šŒa_m©rix
, intra_matrix);

1584 
	`MATCH_PER_STREAM_OPT
(
chroma_šŒa_m©riûs
, 
¡r
, 
chroma_šŒa_m©rix
, 
oc
, 
¡
);

1585 ià(
chroma_šŒa_m©rix
) {

1586 
ušt16_t
 *
p
 = 
	`av_m®locz
((*
video_’c
->
chroma_šŒa_m©rix
) * 64);

1587 ià(!
p
) {

1588 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡llocate memory for intra matrix.\n");

1589 
	`ex™_´og¿m
(1);

1591 
	`av_codec_£t_chroma_šŒa_m©rix
(
video_’c
, 
p
);

1592 
	`·r£_m©rix_cÛffs
(
p
, 
chroma_šŒa_m©rix
);

1594 
	`MATCH_PER_STREAM_OPT
(
š‹r_m©riûs
, 
¡r
, 
š‹r_m©rix
, 
oc
, 
¡
);

1595 ià(
š‹r_m©rix
) {

1596 ià(!(
video_’c
->
š‹r_m©rix
 = 
	`av_m®locz
((*video_enc->inter_matrix) * 64))) {

1597 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot‡llocate memory for inter matrix.\n");

1598 
	`ex™_´og¿m
(1);

1600 
	`·r£_m©rix_cÛffs
(
video_’c
->
š‹r_m©rix
, inter_matrix);

1603 
	`MATCH_PER_STREAM_OPT
(
rc_ov”rides
, 
¡r
, 
p
, 
oc
, 
¡
);

1604 
i
 = 0; 
p
; i++) {

1605 
¡¬t
, 
’d
, 
q
;

1606 
e
 = 
	`ssÿnf
(
p
, "%d,%d,%d", &
¡¬t
, &
’d
, &
q
);

1607 ià(
e
 != 3) {

1608 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "error…arsing„c_override\n");

1609 
	`ex™_´og¿m
(1);

1611 
video_’c
->
rc_ov”ride
 =

1612 
	`av_»®loc_¬¿y
(
video_’c
->
rc_ov”ride
,

1613 
i
 + 1, (
RcOv”ride
));

1614 ià(!
video_’c
->
rc_ov”ride
) {

1615 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot (re)allocate memory for„c_override.\n");

1616 
	`ex™_´og¿m
(1);

1618 
video_’c
->
rc_ov”ride
[
i
].
¡¬t_äame
 = 
¡¬t
;

1619 
video_’c
->
rc_ov”ride
[
i
].
’d_äame
 = 
’d
;

1620 ià(
q
 > 0) {

1621 
video_’c
->
rc_ov”ride
[
i
].
qsÿË
 = 
q
;

1622 
video_’c
->
rc_ov”ride
[
i
].
qu®™y_çùÜ
 = 1.0;

1625 
video_’c
->
rc_ov”ride
[
i
].
qsÿË
 = 0;

1626 
video_’c
->
rc_ov”ride
[
i
].
qu®™y_çùÜ
 = -
q
/100.0;

1628 
p
 = 
	`¡rchr
(p, '/');

1629 ià(
p
)…++;

1631 
video_’c
->
rc_ov”ride_couÁ
 = 
i
;

1633 ià(
do_p¢r
)

1634 
video_’c
->
æags
|ğ
AV_CODEC_FLAG_PSNR
;

1637 
	`MATCH_PER_STREAM_OPT
(
·ss
, 
i
, 
do_·ss
, 
oc
, 
¡
);

1638 ià(
do_·ss
) {

1639 ià(
do_·ss
 & 1) {

1640 
video_’c
->
æags
 |ğ
AV_CODEC_FLAG_PASS1
;

1641 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, "æags", "+·ss1", 
AV_DICT_APPEND
);

1643 ià(
do_·ss
 & 2) {

1644 
video_’c
->
æags
 |ğ
AV_CODEC_FLAG_PASS2
;

1645 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, "æags", "+·ss2", 
AV_DICT_APPEND
);

1649 
	`MATCH_PER_STREAM_OPT
(
·s¦ogfes
, 
¡r
, 
o¡
->
logfe_´efix
, 
oc
, 
¡
);

1650 ià(
o¡
->
logfe_´efix
 &&

1651 !(
o¡
->
logfe_´efix
 = 
	`av_¡rdup
(ost->logfile_prefix)))

1652 
	`ex™_´og¿m
(1);

1654 ià(
do_·ss
) {

1655 
logf’ame
[1024];

1656 
FILE
 *
f
;

1658 
	`¢´štf
(
logf’ame
, (logfilename), "%s-%d.log",

1659 
o¡
->
logfe_´efix
 ? ost->logfile_prefix :

1660 
DEFAULT_PASS_LOGFILENAME_PREFIX
,

1661 
i
);

1662 ià(!
	`¡rcmp
(
o¡
->
’c
->
Çme
, "libx264")) {

1663 
	`av_diù_£t
(&
o¡
->
’cod”_İts
, "¡©s", 
logf’ame
, 
AV_DICT_DONT_OVERWRITE
);

1665 ià(
video_’c
->
æags
 & 
AV_CODEC_FLAG_PASS2
) {

1666 *
logbufãr
 = 
	`»ad_fe
(
logf’ame
);

1668 ià(!
logbufãr
) {

1669 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error„eading†og file '%s' for…ass-2ƒncoding\n",

1670 
logf’ame
);

1671 
	`ex™_´og¿m
(1);

1673 
video_’c
->
¡©s_š
 = 
logbufãr
;

1675 ià(
video_’c
->
æags
 & 
AV_CODEC_FLAG_PASS1
) {

1676 
f
 = 
	`av_fİ’_utf8
(
logf’ame
, "wb");

1677 ià(!
f
) {

1678 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

1680 
logf’ame
, 
	`¡»¼Ü
(
”ºo
));

1681 
	`ex™_´og¿m
(1);

1683 
o¡
->
logfe
 = 
f
;

1688 
	`MATCH_PER_STREAM_OPT
(
fÜûd_key_äames
, 
¡r
, 
o¡
->
fÜûd_keyäames
, 
oc
, 
¡
);

1689 ià(
o¡
->
fÜûd_keyäames
)

1690 
o¡
->
fÜûd_keyäames
 = 
	`av_¡rdup
(ost->forced_keyframes);

1692 
	`MATCH_PER_STREAM_OPT
(
fÜû_ås
, 
i
, 
o¡
->fÜû_ås, 
oc
, 
¡
);

1694 
o¡
->
tİ_f›ld_fœ¡
 = -1;

1695 
	`MATCH_PER_STREAM_OPT
(
tİ_f›ld_fœ¡
, 
i
, 
o¡
->tİ_f›ld_fœ¡, 
oc
, 
¡
);

1698 
o¡
->
avf‹r
 = 
	`g‘_o¡_f‹rs
(
o
, 
oc
, ost);

1699 ià(!
o¡
->
avf‹r
)

1700 
	`ex™_´og¿m
(1);

1702 
	`MATCH_PER_STREAM_OPT
(
cİy_š™Ÿl_nÚkeyäames
, 
i
, 
o¡
->cİy_š™Ÿl_nÚkeyäames, 
oc
 ,
¡
);

1705 ià(
o¡
->
¡»am_cİy
)

1706 
	`check_¡»amcİy_f‹rs
(
o
, 
oc
, 
o¡
, 
AVMEDIA_TYPE_VIDEO
);

1708  
o¡
;

1709 
	}
}

1711 
OuutSŒ—m
 *
	$Ãw_audio_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1713 
n
;

1714 
AVSŒ—m
 *
¡
;

1715 
OuutSŒ—m
 *
o¡
;

1716 
AVCodecCÚ‹xt
 *
audio_’c
;

1718 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_AUDIO
, 
sourû_šdex
);

1719 
¡
 = 
o¡
->st;

1721 
audio_’c
 = 
o¡
->
’c_ùx
;

1722 
audio_’c
->
codec_ty³
 = 
AVMEDIA_TYPE_AUDIO
;

1724 
	`MATCH_PER_STREAM_OPT
(
f‹r_süts
, 
¡r
, 
o¡
->
f‹rs_süt
, 
oc
, 
¡
);

1725 
	`MATCH_PER_STREAM_OPT
(
f‹rs
, 
¡r
, 
o¡
->f‹rs, 
oc
, 
¡
);

1727 ià(!
o¡
->
¡»am_cİy
) {

1728 *
§m¶e_fmt
 = 
NULL
;

1730 
	`MATCH_PER_STREAM_OPT
(
audio_chªÃls
, 
i
, 
audio_’c
->
chªÃls
, 
oc
, 
¡
);

1732 
	`MATCH_PER_STREAM_OPT
(
§m¶e_fmts
, 
¡r
, 
§m¶e_fmt
, 
oc
, 
¡
);

1733 ià(
§m¶e_fmt
 &&

1734 (
audio_’c
->
§m¶e_fmt
 = 
	`av_g‘_§m¶e_fmt
(§m¶e_fmt)è=ğ
AV_SAMPLE_FMT_NONE
) {

1735 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id sam¶fÜm© '%s'\n", 
§m¶e_fmt
);

1736 
	`ex™_´og¿m
(1);

1739 
	`MATCH_PER_STREAM_OPT
(
audio_§m¶e_¿‹
, 
i
, 
audio_’c
->
§m¶e_¿‹
, 
oc
, 
¡
);

1741 
	`MATCH_PER_STREAM_OPT
(
­ad
, 
¡r
, 
o¡
->­ad, 
oc
, 
¡
);

1742 
o¡
->
­ad
 = 
	`av_¡rdup
(ost->apad);

1744 
o¡
->
avf‹r
 = 
	`g‘_o¡_f‹rs
(
o
, 
oc
, ost);

1745 ià(!
o¡
->
avf‹r
)

1746 
	`ex™_´og¿m
(1);

1749 
n
 = 0;‚ < 
o
->
nb_audio_chªÃl_m­s
;‚++) {

1750 
AudioChªÃlM­
 *
m­
 = &
o
->
audio_chªÃl_m­s
[
n
];

1751 ià((
m­
->
ofe_idx
 =ğ-1 || 
o¡
->
fe_šdex
 == map->ofile_idx) &&

1752 (
m­
->
o¡»am_idx
 =ğ-1 || 
o¡
->
¡
->
šdex
 == map->ostream_idx)) {

1753 
IÅutSŒ—m
 *
i¡
;

1755 ià(
m­
->
chªÃl_idx
 == -1) {

1756 
i¡
 = 
NULL
;

1757 } ià(
o¡
->
sourû_šdex
 < 0) {

1758 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Cannot determine input stream for channel mapping %d.%d\n",

1759 
o¡
->
fe_šdex
, o¡->
¡
->
šdex
);

1762 
i¡
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
];

1765 ià(!
i¡
 || (i¡->
fe_šdex
 =ğ
m­
->
fe_idx
 && i¡->
¡
->
šdex
 =ğm­->
¡»am_idx
)) {

1766 ià(
	`av_»®loı_¬¿y
(&
o¡
->
audio_chªÃls_m­
,

1767 
o¡
->
audio_chªÃls_m­³d
 + 1,

1768 (*
o¡
->
audio_chªÃls_m­
)

1770 
	`ex™_´og¿m
(1);

1772 
o¡
->
audio_chªÃls_m­
[o¡->
audio_chªÃls_m­³d
++] = 
m­
->
chªÃl_idx
;

1778 ià(
o¡
->
¡»am_cİy
)

1779 
	`check_¡»amcİy_f‹rs
(
o
, 
oc
, 
o¡
, 
AVMEDIA_TYPE_AUDIO
);

1781  
o¡
;

1782 
	}
}

1784 
OuutSŒ—m
 *
	$Ãw_d©a_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1786 
OuutSŒ—m
 *
o¡
;

1788 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_DATA
, 
sourû_šdex
);

1789 ià(!
o¡
->
¡»am_cİy
) {

1790 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Data streamƒncoding‚ot supported yet (only streamcopy)\n");

1791 
	`ex™_´og¿m
(1);

1794  
o¡
;

1795 
	}
}

1797 
OuutSŒ—m
 *
	$Ãw_unknown_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1799 
OuutSŒ—m
 *
o¡
;

1801 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_UNKNOWN
, 
sourû_šdex
);

1802 ià(!
o¡
->
¡»am_cİy
) {

1803 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Unknown streamƒncoding‚ot supported yet (only streamcopy)\n");

1804 
	`ex™_´og¿m
(1);

1807  
o¡
;

1808 
	}
}

1810 
OuutSŒ—m
 *
	$Ãw_©chm’t_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1812 
OuutSŒ—m
 *
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_ATTACHMENT
, 
sourû_šdex
);

1813 
o¡
->
¡»am_cİy
 = 1;

1814 
o¡
->
fšished
 = 1;

1815  
o¡
;

1816 
	}
}

1818 
OuutSŒ—m
 *
	$Ãw_subt™Ë_¡»am
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
oc
, 
sourû_šdex
)

1820 
AVSŒ—m
 *
¡
;

1821 
OuutSŒ—m
 *
o¡
;

1822 
AVCodecCÚ‹xt
 *
subt™Ë_’c
;

1824 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
oc
, 
AVMEDIA_TYPE_SUBTITLE
, 
sourû_šdex
);

1825 
¡
 = 
o¡
->st;

1826 
subt™Ë_’c
 = 
o¡
->
’c_ùx
;

1828 
subt™Ë_’c
->
codec_ty³
 = 
AVMEDIA_TYPE_SUBTITLE
;

1830 
	`MATCH_PER_STREAM_OPT
(
cİy_š™Ÿl_nÚkeyäames
, 
i
, 
o¡
->cİy_š™Ÿl_nÚkeyäames, 
oc
, 
¡
);

1832 ià(!
o¡
->
¡»am_cİy
) {

1833 *
äame_size
 = 
NULL
;

1835 
	`MATCH_PER_STREAM_OPT
(
äame_sizes
, 
¡r
, 
äame_size
, 
oc
, 
¡
);

1836 ià(
äame_size
 && 
	`av_·r£_video_size
(&
subt™Ë_’c
->
width
, &subt™Ë_’c->
height
, frame_size) < 0) {

1837 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id f¿msize: %s.\n", 
äame_size
);

1838 
	`ex™_´og¿m
(1);

1842  
o¡
;

1843 
	}
}

1846 
	$İt_¡»amid
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

1848 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

1849 
idx
;

1850 *
p
;

1851 
idx_¡r
[16];

1853 
	`av_¡¾ıy
(
idx_¡r
, 
¬g
, (idx_str));

1854 
p
 = 
	`¡rchr
(
idx_¡r
, ':');

1855 ià(!
p
) {

1856 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

1858 
¬g
, 
İt
);

1859 
	`ex™_´og¿m
(1);

1861 *
p
++ = '\0';

1862 
idx
 = 
	`·r£_numb”_Ü_d›
(
İt
, 
idx_¡r
, 
OPT_INT
, 0, 
MAX_STREAMS
-1);

1863 
o
->
¡»amid_m­
 = 
	`grow_¬¿y
(o->¡»amid_m­, (*o->¡»amid_m­), &o->
nb_¡»amid_m­
, 
idx
+1);

1864 
o
->
¡»amid_m­
[
idx
] = 
	`·r£_numb”_Ü_d›
(
İt
, 
p
, 
OPT_INT
, 0, 
INT_MAX
);

1866 
	}
}

1868 
	$cİy_ch­‹rs
(
IÅutFe
 *
ife
, 
OuutFe
 *
ofe
, 
cİy_m‘ad©a
)

1870 
AVFÜm©CÚ‹xt
 *
is
 = 
ife
->
ùx
;

1871 
AVFÜm©CÚ‹xt
 *
os
 = 
ofe
->
ùx
;

1872 
AVCh­‹r
 **
tmp
;

1873 
i
;

1875 
tmp
 = 
	`av_»®loc_f
(
os
->
ch­‹rs
, 
is
->
nb_ch­‹rs
 + os->nb_chapters, (*os->chapters));

1876 ià(!
tmp
)

1877  
	`AVERROR
(
ENOMEM
);

1878 
os
->
ch­‹rs
 = 
tmp
;

1880 
i
 = 0; i < 
is
->
nb_ch­‹rs
; i++) {

1881 
AVCh­‹r
 *
š_ch
 = 
is
->
ch­‹rs
[
i
], *
out_ch
;

1882 
št64_t
 
¡¬t_time
 = (
ofe
->¡¬t_tim=ğ
AV_NOPTS_VALUE
) ? 0 : ofile->start_time;

1883 
št64_t
 
ts_off
 = 
	`av_»sÿË_q
(
¡¬t_time
 - 
ife
->
ts_off£t
,

1884 
AV_TIME_BASE_Q
, 
š_ch
->
time_ba£
);

1885 
št64_t
 
¹
 = (
ofe
->
»cÜdšg_time
 =ğ
INT64_MAX
) ? INT64_MAX :

1886 
	`av_»sÿË_q
(
ofe
->
»cÜdšg_time
, 
AV_TIME_BASE_Q
, 
š_ch
->
time_ba£
);

1889 ià(
š_ch
->
’d
 < 
ts_off
)

1891 ià(
¹
 !ğ
INT64_MAX
 && 
š_ch
->
¡¬t
 >„ˆ+ 
ts_off
)

1894 
out_ch
 = 
	`av_m®locz
((
AVCh­‹r
));

1895 ià(!
out_ch
)

1896  
	`AVERROR
(
ENOMEM
);

1898 
out_ch
->
id
 = 
š_ch
->id;

1899 
out_ch
->
time_ba£
 = 
š_ch
->time_base;

1900 
out_ch
->
¡¬t
 = 
	`FFMAX
(0, 
š_ch
->¡¬ˆ- 
ts_off
);

1901 
out_ch
->
’d
 = 
	`FFMIN
(
¹
, 
š_ch
->’d - 
ts_off
);

1903 ià(
cİy_m‘ad©a
)

1904 
	`av_diù_cİy
(&
out_ch
->
m‘ad©a
, 
š_ch
->metadata, 0);

1906 
os
->
ch­‹rs
[os->
nb_ch­‹rs
++] = 
out_ch
;

1909 
	}
}

1911 
	$»ad_ff£rv”_¡»ams
(
O±iÚsCÚ‹xt
 *
o
, 
AVFÜm©CÚ‹xt
 *
s
, cÚ¡ *
f’ame
)

1913 
i
, 
”r
;

1914 
AVFÜm©CÚ‹xt
 *
ic
 = 
	`avfÜm©_®loc_cÚ‹xt
();

1916 
ic
->
æags
 |ğ
AVFMT_FLAG_KEEP_SIDE_DATA
;

1917 
ic
->
š‹¼u±_ÿÎback
 = 
št_cb
;

1918 
”r
 = 
	`avfÜm©_İ’_šput
(&
ic
, 
f’ame
, 
NULL
, NULL);

1919 ià(
”r
 < 0)

1920  
”r
;

1922 
i
=0;i<
ic
->
nb_¡»ams
;i++) {

1923 
AVSŒ—m
 *
¡
;

1924 
OuutSŒ—m
 *
o¡
;

1925 
AVCodec
 *
codec
;

1926 cÚ¡ *
’c_cÚfig
;

1928 
codec
 = 
	`avcodec_fšd_’cod”
(
ic
->
¡»ams
[
i
]->
codeı¬
->
codec_id
);

1929 ià(!
codec
) {

1930 
	`av_log
(
s
, 
AV_LOG_ERROR
, "nØ’cod” found fÜ codeøid %i\n", 
ic
->
¡»ams
[
i
]->
codeı¬
->
codec_id
);

1931  
	`AVERROR
(
EINVAL
);

1933 ià(
codec
->
ty³
 =ğ
AVMEDIA_TYPE_AUDIO
)

1934 
	`İt_audio_codec
(
o
, "c:a", 
codec
->
Çme
);

1935 ià(
codec
->
ty³
 =ğ
AVMEDIA_TYPE_VIDEO
)

1936 
	`İt_video_codec
(
o
, "c:v", 
codec
->
Çme
);

1937 
o¡
 = 
	`Ãw_ouut_¡»am
(
o
, 
s
, 
codec
->
ty³
, -1);

1938 
¡
 = 
o¡
->st;

1940 
	`avcodec_g‘_cÚ‹xt_deçuÉs3
(
¡
->
codec
, codec);

1941 
’c_cÚfig
 = 
	`av_¡»am_g‘_»comm’ded_’cod”_cÚfigu¿tiÚ
(
ic
->
¡»ams
[
i
]);

1942 ià(
’c_cÚfig
) {

1943 
AVDiùiÚ¬y
 *
İts
 = 
NULL
;

1944 
	`av_diù_·r£_¡ršg
(&
İts
, 
’c_cÚfig
, "=", ",", 0);

1945 
	`av_İt_£t_diù2
(
¡
->
codec
, &
İts
, 
AV_OPT_SEARCH_CHILDREN
);

1946 
	`av_diù_ä“
(&
İts
);

1949 ià(
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 && !
o¡
->
¡»am_cİy
)

1950 
	`choo£_§m¶e_fmt
(
¡
, 
codec
);

1951 ià(
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 && !
o¡
->
¡»am_cİy
)

1952 
	`choo£_pix–_fmt
(
¡
, st->
codec
, codec, st->
codeı¬
->
fÜm©
);

1953 
	`avcodec_cİy_cÚ‹xt
(
o¡
->
’c_ùx
, 
¡
->
codec
);

1954 ià(
’c_cÚfig
)

1955 
	`av_diù_·r£_¡ršg
(&
o¡
->
’cod”_İts
, 
’c_cÚfig
, "=", ",", 0);

1958 
	`avfÜm©_şo£_šput
(&
ic
);

1959  
”r
;

1960 
	}
}

1962 
	$š™_ouut_f‹r
(
OuutF‹r
 *
of‹r
, 
O±iÚsCÚ‹xt
 *
o
,

1963 
AVFÜm©CÚ‹xt
 *
oc
)

1965 
OuutSŒ—m
 *
o¡
;

1967 
of‹r
->
ty³
) {

1968 
AVMEDIA_TYPE_VIDEO
: 
o¡
 = 
	`Ãw_video_¡»am
(
o
, 
oc
, -1); ;

1969 
AVMEDIA_TYPE_AUDIO
: 
o¡
 = 
	`Ãw_audio_¡»am
(
o
, 
oc
, -1); ;

1971 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Only video‡nd‡udio filters‡re supported "

1973 
	`ex™_´og¿m
(1);

1976 
o¡
->
sourû_šdex
 = -1;

1977 
o¡
->
f‹r
 = 
of‹r
;

1979 
of‹r
->
o¡
 = ost;

1980 
of‹r
->
fÜm©
 = -1;

1982 ià(
o¡
->
¡»am_cİy
) {

1983 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Streamcopy„equested for output stream %d:%d, "

1985 "ÿÂÙ bu£dog‘h”.\n", 
o¡
->
fe_šdex
, o¡->
šdex
);

1986 
	`ex™_´og¿m
(1);

1989 ià(
o¡
->
avf‹r
 && (o¡->
f‹rs
 || o¡->
f‹rs_süt
)) {

1990 cÚ¡ *
İt
 = 
o¡
->
f‹rs
 ? "-vf/-af/-filter" : "-filter_script";

1991 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

1995 
o¡
->
f‹rs
 ? "Filtergraph" : "Filtergraph script",

1996 
o¡
->
f‹rs
 ? o¡->f‹r : o¡->
f‹rs_süt
,

1997 
İt
, 
o¡
->
fe_šdex
, o¡->
šdex
, opt);

1998 
	`ex™_´og¿m
(1);

2001 
	`avf‹r_šout_ä“
(&
of‹r
->
out_tmp
);

2002 
	}
}

2004 
	$š™_com¶ex_f‹rs
()

2006 
i
, 
»t
 = 0;

2008 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

2009 
»t
 = 
	`š™_com¶ex_f‹rg¿ph
(
f‹rg¿phs
[
i
]);

2010 ià(
»t
 < 0)

2011  
»t
;

2014 
	}
}

2016 
	$İ’_ouut_fe
(
O±iÚsCÚ‹xt
 *
o
, cÚ¡ *
f’ame
)

2018 
AVFÜm©CÚ‹xt
 *
oc
;

2019 
i
, 
j
, 
”r
;

2020 
AVOuutFÜm©
 *
fe_ofÜm©
;

2021 
OuutFe
 *
of
;

2022 
OuutSŒ—m
 *
o¡
;

2023 
IÅutSŒ—m
 *
i¡
;

2024 
AVDiùiÚ¬y
 *
unu£d_İts
 = 
NULL
;

2025 
AVDiùiÚ¬yEÁry
 *
e
 = 
NULL
;

2026 
fÜm©_æags
 = 0;

2028 ià(
o
->
¡İ_time
 !ğ
INT64_MAX
 && o->
»cÜdšg_time
 != INT64_MAX) {

2029 
o
->
¡İ_time
 = 
INT64_MAX
;

2030 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "-t‡nd -to cannot be usedogether; using -t.\n");

2033 ià(
o
->
¡İ_time
 !ğ
INT64_MAX
 && o->
»cÜdšg_time
 == INT64_MAX) {

2034 
št64_t
 
¡¬t_time
 = 
o
->¡¬t_tim=ğ
AV_NOPTS_VALUE
 ? 0 : o->start_time;

2035 ià(
o
->
¡İ_time
 <ğ
¡¬t_time
) {

2036 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "-to value smallerhan -ss;‡borting.\n");

2037 
	`ex™_´og¿m
(1);

2039 
o
->
»cÜdšg_time
 = o->
¡İ_time
 - 
¡¬t_time
;

2043 
	`GROW_ARRAY
(
ouut_fes
, 
nb_ouut_fes
);

2044 
of
 = 
	`av_m®locz
((*of));

2045 ià(!
of
)

2046 
	`ex™_´og¿m
(1);

2047 
ouut_fes
[
nb_ouut_fes
 - 1] = 
of
;

2049 
of
->
o¡_šdex
 = 
nb_ouut_¡»ams
;

2050 
of
->
»cÜdšg_time
 = 
o
->recording_time;

2051 
of
->
¡¬t_time
 = 
o
->start_time;

2052 
of
->
lim™_fesize
 = 
o
->limit_filesize;

2053 
of
->
shÜ‹¡
 = 
o
->shortest;

2054 
	`av_diù_cİy
(&
of
->
İts
, 
o
->
g
->
fÜm©_İts
, 0);

2056 ià(!
	`¡rcmp
(
f’ame
, "-"))

2057 
f’ame
 = "pipe:";

2059 
”r
 = 
	`avfÜm©_®loc_ouut_cÚ‹xt2
(&
oc
, 
NULL
, 
o
->
fÜm©
, 
f’ame
);

2060 ià(!
oc
) {

2061 
	`´št_”rÜ
(
f’ame
, 
”r
);

2062 
	`ex™_´og¿m
(1);

2065 
of
->
ùx
 = 
oc
;

2066 ià(
o
->
»cÜdšg_time
 !ğ
INT64_MAX
)

2067 
oc
->
du¿tiÚ
 = 
o
->
»cÜdšg_time
;

2069 
fe_ofÜm©
ğ
oc
->
ofÜm©
;

2070 
oc
->
š‹¼u±_ÿÎback
 = 
št_cb
;

2072 
e
 = 
	`av_diù_g‘
(
o
->
g
->
fÜm©_İts
, "fæags", 
NULL
, 0);

2073 ià(
e
) {

2074 cÚ¡ 
AVO±iÚ
 *
o
 = 
	`av_İt_fšd
(
oc
, "fæags", 
NULL
, 0, 0);

2075 
	`av_İt_ev®_æags
(
oc
, 
o
, 
e
->
v®ue
, &
fÜm©_æags
);

2079 
i
 = 0; i < 
nb_f‹rg¿phs
; i++) {

2080 
F‹rG¿ph
 *
fg
 = 
f‹rg¿phs
[
i
];

2081 
j
 = 0; j < 
fg
->
nb_ouuts
; j++) {

2082 
OuutF‹r
 *
of‹r
 = 
fg
->
ouuts
[
j
];

2084 ià(!
of‹r
->
out_tmp
 || of‹r->out_tmp->
Çme
)

2087 
of‹r
->
ty³
) {

2088 
AVMEDIA_TYPE_VIDEO
: 
o
->
video_di§bË
 = 1; ;

2089 
AVMEDIA_TYPE_AUDIO
: 
o
->
audio_di§bË
 = 1; ;

2090 
AVMEDIA_TYPE_SUBTITLE
: 
o
->
subt™Ë_di§bË
 = 1; ;

2092 
	`š™_ouut_f‹r
(
of‹r
, 
o
, 
oc
);

2097 ià(!
	`¡rcmp
(
fe_ofÜm©
->
Çme
, "ffm") &&

2098 !(
fÜm©_æags
 & 
AVFMT_FLAG_BITEXACT
) &&

2099 
	`av_¡r¡¬t
(
f’ame
, "h‰p:", 
NULL
)) {

2100 
”r
 = 
	`·r£_İtiÚ
(
o
, "m‘ad©a", "ü—tiÚ_timeòow", 
İtiÚs
);

2101 ià(
”r
 < 0) {

2102 
	`´št_”rÜ
(
f’ame
, 
”r
);

2103 
	`ex™_´og¿m
(1);

2107 ià(!
	`¡rcmp
(
fe_ofÜm©
->
Çme
, "ffm"è&& !
ov”ride_ff£rv”
 &&

2108 
	`av_¡r¡¬t
(
f’ame
, "h‰p:", 
NULL
)) {

2109 
j
;

2112 
”r
 = 
	`»ad_ff£rv”_¡»ams
(
o
, 
oc
, 
f’ame
);

2113 ià(
”r
 < 0) {

2114 
	`´št_”rÜ
(
f’ame
, 
”r
);

2115 
	`ex™_´og¿m
(1);

2117 
j
 = 
nb_ouut_¡»ams
 - 
oc
->
nb_¡»ams
; j <‚b_output_streams; j++) {

2118 
o¡
 = 
ouut_¡»ams
[
j
];

2119 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

2120 
i¡
 = 
šput_¡»ams
[
i
];

2121 if(
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
o¡
->st->codecpar->codec_type){

2122 
o¡
->
sync_i¡
ğ
i¡
;

2123 
o¡
->
sourû_šdex
ğ
i
;

2124 if(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
èo¡->
avf‹r
 = 
	`av_¡rdup
("anull");

2125 if(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
èo¡->
avf‹r
 = 
	`av_¡rdup
("null");

2126 
i¡
->
disÿrd
 = 0;

2127 
i¡
->
¡
->
disÿrd
 = i¡->
u£r_£t_disÿrd
;

2131 if(!
o¡
->
sync_i¡
){

2132 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Missšg % ¡»am which i »quœed byhi ffm\n", 
	`av_g‘_medŸ_ty³_¡ršg
(
o¡
->
¡
->
codeı¬
->
codec_ty³
));

2133 
	`ex™_´og¿m
(1);

2136 } ià(!
o
->
nb_¡»am_m­s
) {

2137 *
subt™Ë_codec_Çme
 = 
NULL
;

2141 ià(!
o
->
video_di§bË
 && 
	`av_guess_codec
(
oc
->
ofÜm©
, 
NULL
, 
f’ame
, NULL, 
AVMEDIA_TYPE_VIDEO
è!ğ
AV_CODEC_ID_NONE
) {

2142 
¬—
 = 0, 
idx
 = -1;

2143 
qü
 = 
	`avfÜm©_qu”y_codec
(
oc
->
ofÜm©
, oc->ofÜm©->
video_codec
, 0);

2144 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

2145 
Ãw_¬—
;

2146 
i¡
 = 
šput_¡»ams
[
i
];

2147 
Ãw_¬—
 = 
i¡
->
¡
->
codeı¬
->
width
 * i¡->¡->codeı¬->
height
 + 100000000*!!i¡->¡->
codec_šfo_nb_äames
;

2148 if((
qü
!=
	`MKTAG
('A', 'P', 'I', 'C')è&& (
i¡
->
¡
->
di¥os™iÚ
 & 
AV_DISPOSITION_ATTACHED_PIC
))

2149 
Ãw_¬—
 = 1;

2150 ià(
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 &&

2151 
Ãw_¬—
 > 
¬—
) {

2152 if((
qü
==
	`MKTAG
('A', 'P', 'I', 'C')è&& !(
i¡
->
¡
->
di¥os™iÚ
 & 
AV_DISPOSITION_ATTACHED_PIC
))

2154 
¬—
 = 
Ãw_¬—
;

2155 
idx
 = 
i
;

2158 ià(
idx
 >= 0)

2159 
	`Ãw_video_¡»am
(
o
, 
oc
, 
idx
);

2163 ià(!
o
->
audio_di§bË
 && 
	`av_guess_codec
(
oc
->
ofÜm©
, 
NULL
, 
f’ame
, NULL, 
AVMEDIA_TYPE_AUDIO
è!ğ
AV_CODEC_ID_NONE
) {

2164 
be¡_scÜe
 = 0, 
idx
 = -1;

2165 
i
 = 0; i < 
nb_šput_¡»ams
; i++) {

2166 
scÜe
;

2167 
i¡
 = 
šput_¡»ams
[
i
];

2168 
scÜe
 = 
i¡
->
¡
->
codeı¬
->
chªÃls
 + 100000000*!!i¡->¡->
codec_šfo_nb_äames
;

2169 ià(
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
 &&

2170 
scÜe
 > 
be¡_scÜe
) {

2171 
be¡_scÜe
 = 
scÜe
;

2172 
idx
 = 
i
;

2175 ià(
idx
 >= 0)

2176 
	`Ãw_audio_¡»am
(
o
, 
oc
, 
idx
);

2180 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
subt™Ë_codec_Çme
, 
oc
, "s");

2181 ià(!
o
->
subt™Ë_di§bË
 && (
	`avcodec_fšd_’cod”
(
oc
->
ofÜm©
->
subt™Ë_codec
è|| 
subt™Ë_codec_Çme
)) {

2182 
i
 = 0; i < 
nb_šput_¡»ams
; i++)

2183 ià(
šput_¡»ams
[
i
]->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_SUBTITLE
) {

2184 
AVCodecDesütÜ
 cÚ¡ *
šput_desütÜ
 =

2185 
	`avcodec_desütÜ_g‘
(
šput_¡»ams
[
i
]->
¡
->
codeı¬
->
codec_id
);

2186 
AVCodecDesütÜ
 cÚ¡ *
ouut_desütÜ
 = 
NULL
;

2187 
AVCodec
 cÚ¡ *
ouut_codec
 =

2188 
	`avcodec_fšd_’cod”
(
oc
->
ofÜm©
->
subt™Ë_codec
);

2189 
šput_´İs
 = 0, 
ouut_´İs
 = 0;

2190 ià(
ouut_codec
)

2191 
ouut_desütÜ
 = 
	`avcodec_desütÜ_g‘
(
ouut_codec
->
id
);

2192 ià(
šput_desütÜ
)

2193 
šput_´İs
 = 
šput_desütÜ
->
´İs
 & (
AV_CODEC_PROP_TEXT_SUB
 | 
AV_CODEC_PROP_BITMAP_SUB
);

2194 ià(
ouut_desütÜ
)

2195 
ouut_´İs
 = 
ouut_desütÜ
->
´İs
 & (
AV_CODEC_PROP_TEXT_SUB
 | 
AV_CODEC_PROP_BITMAP_SUB
);

2196 ià(
subt™Ë_codec_Çme
 ||

2197 
šput_´İs
 & 
ouut_´İs
 ||

2199 
šput_desütÜ
 && 
ouut_desütÜ
 &&

2200 (!
šput_desütÜ
->
´İs
 ||

2201 !
ouut_desütÜ
->
´İs
)) {

2202 
	`Ãw_subt™Ë_¡»am
(
o
, 
oc
, 
i
);

2208 ià(!
o
->
d©a_di§bË
 ) {

2209 
AVCodecID
 
codec_id
 = 
	`av_guess_codec
(
oc
->
ofÜm©
, 
NULL
, 
f’ame
, NULL, 
AVMEDIA_TYPE_DATA
);

2210 
i
 = 0; 
codec_id
 !ğ
AV_CODEC_ID_NONE
 && i < 
nb_šput_¡»ams
; i++) {

2211 ià(
šput_¡»ams
[
i
]->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_DATA


2212 && 
šput_¡»ams
[
i
]->
¡
->
codeı¬
->
codec_id
 == codec_id )

2213 
	`Ãw_d©a_¡»am
(
o
, 
oc
, 
i
);

2217 
i
 = 0; i < 
o
->
nb_¡»am_m­s
; i++) {

2218 
SŒ—mM­
 *
m­
 = &
o
->
¡»am_m­s
[
i
];

2220 ià(
m­
->
di§bËd
)

2223 ià(
m­
->
lškÏb–
) {

2224 
F‹rG¿ph
 *
fg
;

2225 
OuutF‹r
 *
of‹r
 = 
NULL
;

2226 
j
, 
k
;

2228 
j
 = 0; j < 
nb_f‹rg¿phs
; j++) {

2229 
fg
 = 
f‹rg¿phs
[
j
];

2230 
k
 = 0; k < 
fg
->
nb_ouuts
; k++) {

2231 
AVF‹rInOut
 *
out
 = 
fg
->
ouuts
[
k
]->
out_tmp
;

2232 ià(
out
 && !
	`¡rcmp
(out->
Çme
, 
m­
->
lškÏb–
)) {

2233 
of‹r
 = 
fg
->
ouuts
[
k
];

2234 
loİ_’d
;

2238 
loİ_’d
:

2239 ià(!
of‹r
) {

2240 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Output with†abel '%s' does‚otƒxist "

2241 "š‡ny defšed f‹¸g¿ph, o¸wa ®»ady u£dƒl£wh”e.\n", 
m­
->
lškÏb–
);

2242 
	`ex™_´og¿m
(1);

2244 
	`š™_ouut_f‹r
(
of‹r
, 
o
, 
oc
);

2246 
¤c_idx
 = 
šput_fes
[
m­
->
fe_šdex
]->
i¡_šdex
 + m­->
¡»am_šdex
;

2248 
i¡
 = 
šput_¡»ams
[
šput_fes
[
m­
->
fe_šdex
]->
i¡_šdex
 + m­->
¡»am_šdex
];

2249 if(
o
->
subt™Ë_di§bË
 && 
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_SUBTITLE
)

2251 if(
o
-> 
audio_di§bË
 && 
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
)

2253 if(
o
-> 
video_di§bË
 && 
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
)

2255 if(
o
-> 
d©a_di§bË
 && 
i¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_DATA
)

2258 
o¡
 = 
NULL
;

2259 
i¡
->
¡
->
codeı¬
->
codec_ty³
) {

2260 
AVMEDIA_TYPE_VIDEO
: 
o¡
 = 
	`Ãw_video_¡»am
 (
o
, 
oc
, 
¤c_idx
); ;

2261 
AVMEDIA_TYPE_AUDIO
: 
o¡
 = 
	`Ãw_audio_¡»am
 (
o
, 
oc
, 
¤c_idx
); ;

2262 
AVMEDIA_TYPE_SUBTITLE
: 
o¡
 = 
	`Ãw_subt™Ë_¡»am
 (
o
, 
oc
, 
¤c_idx
); ;

2263 
AVMEDIA_TYPE_DATA
: 
o¡
 = 
	`Ãw_d©a_¡»am
 (
o
, 
oc
, 
¤c_idx
); ;

2264 
AVMEDIA_TYPE_ATTACHMENT
: 
o¡
 = 
	`Ãw_©chm’t_¡»am
(
o
, 
oc
, 
¤c_idx
); ;

2265 
AVMEDIA_TYPE_UNKNOWN
:

2266 ià(
cİy_unknown_¡»ams
) {

2267 
o¡
 = 
	`Ãw_unknown_¡»am
 (
o
, 
oc
, 
¤c_idx
);

2271 
	`av_log
(
NULL
, 
ignÜe_unknown_¡»ams
 ? 
AV_LOG_WARNING
 : 
AV_LOG_FATAL
,

2273 
m­
->
fe_šdex
, m­->
¡»am_šdex
);

2274 ià(!
ignÜe_unknown_¡»ams
) {

2275 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

2279 
	`ex™_´og¿m
(1);

2282 ià(
o¡
)

2283 
o¡
->
sync_i¡
 = 
šput_¡»ams
[ 
šput_fes
[
m­
->
sync_fe_šdex
]->
i¡_šdex


2284 + 
m­
->
sync_¡»am_šdex
];

2290 
i
 = 0; i < 
o
->
nb_©chm’ts
; i++) {

2291 
AVIOCÚ‹xt
 *
pb
;

2292 
ušt8_t
 *
©chm’t
;

2293 cÚ¡ *
p
;

2294 
št64_t
 
Ën
;

2296 ià((
”r
 = 
	`avio_İ’2
(&
pb
, 
o
->
©chm’ts
[
i
], 
AVIO_FLAG_READ
, &
št_cb
, 
NULL
)) < 0) {

2297 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot open‡ttachment file %s.\n",

2298 
o
->
©chm’ts
[
i
]);

2299 
	`ex™_´og¿m
(1);

2301 ià((
Ën
 = 
	`avio_size
(
pb
)) <= 0) {

2302 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot get size ofhe‡ttachment %s.\n",

2303 
o
->
©chm’ts
[
i
]);

2304 
	`ex™_´og¿m
(1);

2306 ià(!(
©chm’t
 = 
	`av_m®loc
(
Ën
))) {

2307 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Attachment %soo†argeo fit into memory.\n",

2308 
o
->
©chm’ts
[
i
]);

2309 
	`ex™_´og¿m
(1);

2311 
	`avio_»ad
(
pb
, 
©chm’t
, 
Ën
);

2313 
o¡
 = 
	`Ãw_©chm’t_¡»am
(
o
, 
oc
, -1);

2314 
o¡
->
¡»am_cİy
 = 0;

2315 
o¡
->
©chm’t_f’ame
 = 
o
->
©chm’ts
[
i
];

2316 
o¡
->
¡
->
codeı¬
->
exŒad©a
 = 
©chm’t
;

2317 
o¡
->
¡
->
codeı¬
->
exŒad©a_size
 = 
Ën
;

2319 
p
 = 
	`¡¼chr
(
o
->
©chm’ts
[
i
], '/');

2320 
	`av_diù_£t
(&
o¡
->
¡
->
m‘ad©a
, "f’ame", (
p
 && *pè?… + 1 : 
o
->
©chm’ts
[
i
], 
AV_DICT_DONT_OVERWRITE
);

2321 
	`avio_şo£p
(&
pb
);

2324 #ià
FF_API_LAVF_AVCTX


2325 
i
 = 
nb_ouut_¡»ams
 - 
oc
->
nb_¡»ams
; i <‚b_output_streams; i++) {

2326 
AVDiùiÚ¬yEÁry
 *
e
;

2327 
o¡
 = 
ouut_¡»ams
[
i
];

2329 ià((
o¡
->
¡»am_cİy
 || o¡->
©chm’t_f’ame
)

2330 && (
e
 = 
	`av_diù_g‘
(
o
->
g
->
codec_İts
, "æags", 
NULL
, 
AV_DICT_IGNORE_SUFFIX
))

2331 && (!
e
->
key
[5] || 
	`check_¡»am_¥ecif›r
(
oc
, 
o¡
->
¡
,ƒ->key+6)))

2332 ià(
	`av_İt_£t
(
o¡
->
¡
->
codec
, "æags", 
e
->
v®ue
, 0) < 0)

2333 
	`ex™_´og¿m
(1);

2337 ià(!
oc
->
nb_¡»ams
 && !(oc->
ofÜm©
->
æags
 & 
AVFMT_NOSTREAMS
)) {

2338 
	`av_dump_fÜm©
(
oc
, 
nb_ouut_fes
 - 1, oc->
f’ame
, 1);

2339 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Ouuˆf#%d dÛ nÙ cÚš‡ny sŒ—m\n", 
nb_ouut_fes
 - 1);

2340 
	`ex™_´og¿m
(1);

2344 
unu£d_İts
 = 
	`¡r_¥ecif›rs
(
o
->
g
->
codec_İts
);

2345 
i
 = 
of
->
o¡_šdex
; i < 
nb_ouut_¡»ams
; i++) {

2346 
e
 = 
NULL
;

2347 (
e
 = 
	`av_diù_g‘
(
ouut_¡»ams
[
i
]->
’cod”_İts
, "",ƒ,

2348 
AV_DICT_IGNORE_SUFFIX
)))

2349 
	`av_diù_£t
(&
unu£d_İts
, 
e
->
key
, 
NULL
, 0);

2352 
e
 = 
NULL
;

2353 (
e
 = 
	`av_diù_g‘
(
unu£d_İts
, "",ƒ, 
AV_DICT_IGNORE_SUFFIX
))) {

2354 cÚ¡ 
AVCÏss
 *
şass
 = 
	`avcodec_g‘_şass
();

2355 cÚ¡ 
AVO±iÚ
 *
İtiÚ
 = 
	`av_İt_fšd
(&
şass
, 
e
->
key
, 
NULL
, 0,

2356 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
);

2357 cÚ¡ 
AVCÏss
 *
fşass
 = 
	`avfÜm©_g‘_şass
();

2358 cÚ¡ 
AVO±iÚ
 *
fİtiÚ
 = 
	`av_İt_fšd
(&
fşass
, 
e
->
key
, 
NULL
, 0,

2359 
AV_OPT_SEARCH_CHILDREN
 | 
AV_OPT_SEARCH_FAKE_OBJ
);

2360 ià(!
İtiÚ
 || 
fİtiÚ
)

2364 ià(!(
İtiÚ
->
æags
 & 
AV_OPT_FLAG_ENCODING_PARAM
)) {

2365 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Codec AVOption %s (%s) specified for "

2366 "ouuˆf#%d (%sèi nÙ‡À’codšg o±iÚ.\n", 
e
->
key
,

2367 
İtiÚ
->
h–p
 ? o±iÚ->h–°: "", 
nb_ouut_fes
 - 1,

2368 
f’ame
);

2369 
	`ex™_´og¿m
(1);

2373 ià(!
	`¡rcmp
(
e
->
key
, "gop_timecode"))

2376 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Codec AVOption %s (%s) specified for "

2380 "which wa nÙ‡ùu®ly u£d fÜ‡ny sŒ—m.\n", 
e
->
key
,

2381 
İtiÚ
->
h–p
 ? o±iÚ->h–°: "", 
nb_ouut_fes
 - 1, 
f’ame
);

2383 
	`av_diù_ä“
(&
unu£d_İts
);

2386 
i
 = 
of
->
o¡_šdex
; i < 
nb_ouut_¡»ams
; i++) {

2387 
OuutSŒ—m
 *
o¡
 = 
ouut_¡»ams
[
i
];

2389 ià(
o¡
->
’codšg_Ãeded
 && o¡->
sourû_šdex
 >= 0) {

2390 
IÅutSŒ—m
 *
i¡
 = 
šput_¡»ams
[
o¡
->
sourû_šdex
];

2391 
i¡
->
decodšg_Ãeded
 |ğ
DECODING_FOR_OST
;

2393 ià(
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_VIDEO
 ||

2394 
o¡
->
¡
->
codeı¬
->
codec_ty³
 =ğ
AVMEDIA_TYPE_AUDIO
) {

2395 
”r
 = 
	`š™_sim¶e_f‹rg¿ph
(
i¡
, 
o¡
);

2396 ià(
”r
 < 0) {

2397 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2399 "%d:%d->%d:%d\n", 
i¡
->
fe_šdex
, 
o¡
->
sourû_šdex
,

2400 
nb_ouut_fes
 - 1, 
o¡
->
¡
->
šdex
);

2401 
	`ex™_´og¿m
(1);

2407 ià(
o¡
->
f‹r
) {

2408 
OuutF‹r
 *
f
 = 
o¡
->
f‹r
;

2409 
couÁ
;

2410 
o¡
->
’c_ùx
->
codec_ty³
) {

2411 
AVMEDIA_TYPE_VIDEO
:

2412 
f
->
äame_¿‹
 = 
o¡
->frame_rate;

2413 
f
->
width
 = 
o¡
->
’c_ùx
->width;

2414 
f
->
height
 = 
o¡
->
’c_ùx
->height;

2415 ià(
o¡
->
’c_ùx
->
pix_fmt
 !ğ
AV_PIX_FMT_NONE
) {

2416 
f
->
fÜm©
 = 
o¡
->
’c_ùx
->
pix_fmt
;

2417 } ià(
o¡
->
’c
->
pix_fmts
) {

2418 
couÁ
 = 0;

2419 
o¡
->
’c
->
pix_fmts
[
couÁ
] !ğ
AV_PIX_FMT_NONE
)

2420 
couÁ
++;

2421 
f
->
fÜm©s
 = 
	`av_m®locz_¬¿y
(
couÁ
 + 1, (*f->formats));

2422 ià(!
f
->
fÜm©s
)

2423 
	`ex™_´og¿m
(1);

2424 
	`memıy
(
f
->
fÜm©s
, 
o¡
->
’c
->
pix_fmts
, (
couÁ
 + 1) * (*f->formats));

2427 
AVMEDIA_TYPE_AUDIO
:

2428 ià(
o¡
->
’c_ùx
->
§m¶e_fmt
 !ğ
AV_SAMPLE_FMT_NONE
) {

2429 
f
->
fÜm©
 = 
o¡
->
’c_ùx
->
§m¶e_fmt
;

2430 } ià(
o¡
->
’c
->
§m¶e_fmts
) {

2431 
couÁ
 = 0;

2432 
o¡
->
’c
->
§m¶e_fmts
[
couÁ
] !ğ
AV_SAMPLE_FMT_NONE
)

2433 
couÁ
++;

2434 
f
->
fÜm©s
 = 
	`av_m®locz_¬¿y
(
couÁ
 + 1, (*f->formats));

2435 ià(!
f
->
fÜm©s
)

2436 
	`ex™_´og¿m
(1);

2437 
	`memıy
(
f
->
fÜm©s
, 
o¡
->
’c
->
§m¶e_fmts
, (
couÁ
 + 1) * (*f->formats));

2439 ià(
o¡
->
’c_ùx
->
§m¶e_¿‹
) {

2440 
f
->
§m¶e_¿‹
 = 
o¡
->
’c_ùx
->sample_rate;

2441 } ià(
o¡
->
’c
->
suµÜ‹d_§m¶”©es
) {

2442 
couÁ
 = 0;

2443 
o¡
->
’c
->
suµÜ‹d_§m¶”©es
[
couÁ
])

2444 
couÁ
++;

2445 
f
->
§m¶e_¿‹s
 = 
	`av_m®locz_¬¿y
(
couÁ
 + 1, (*f->sample_rates));

2446 ià(!
f
->
§m¶e_¿‹s
)

2447 
	`ex™_´og¿m
(1);

2448 
	`memıy
(
f
->
§m¶e_¿‹s
, 
o¡
->
’c
->
suµÜ‹d_§m¶”©es
,

2449 (
couÁ
 + 1è* (*
f
->
§m¶e_¿‹s
));

2451 ià(
o¡
->
’c_ùx
->
chªÃls
) {

2452 
f
->
chªÃl_Ïyout
 = 
	`av_g‘_deçuÉ_chªÃl_Ïyout
(
o¡
->
’c_ùx
->
chªÃls
);

2453 } ià(
o¡
->
’c
->
chªÃl_Ïyouts
) {

2454 
couÁ
 = 0;

2455 
o¡
->
’c
->
chªÃl_Ïyouts
[
couÁ
])

2456 
couÁ
++;

2457 
f
->
chªÃl_Ïyouts
 = 
	`av_m®locz_¬¿y
(
couÁ
 + 1, (*f->channel_layouts));

2458 ià(!
f
->
chªÃl_Ïyouts
)

2459 
	`ex™_´og¿m
(1);

2460 
	`memıy
(
f
->
chªÃl_Ïyouts
, 
o¡
->
’c
->channel_layouts,

2461 (
couÁ
 + 1è* (*
f
->
chªÃl_Ïyouts
));

2469 ià(
oc
->
ofÜm©
->
æags
 & 
AVFMT_NEEDNUMBER
) {

2470 ià(!
	`av_f’ame_numb”_‹¡
(
oc
->
f’ame
)) {

2471 
	`´št_”rÜ
(
oc
->
f’ame
, 
	`AVERROR
(
EINVAL
));

2472 
	`ex™_´og¿m
(1);

2476 ià(!(
oc
->
ofÜm©
->
æags
 & 
AVFMT_NOSTREAMS
è&& !
šput_¡»am_pÙ’tŸÎy_avaabË
) {

2477 
	`av_log
(
NULL
, 
AV_LOG_ERROR
,

2479 
	`ex™_´og¿m
(1);

2482 ià(!(
oc
->
ofÜm©
->
æags
 & 
AVFMT_NOFILE
)) {

2484 
	`as£¹_fe_ov”wr™e
(
f’ame
);

2487 ià((
”r
 = 
	`avio_İ’2
(&
oc
->
pb
, 
f’ame
, 
AVIO_FLAG_WRITE
,

2488 &
oc
->
š‹¼u±_ÿÎback
,

2489 &
of
->
İts
)) < 0) {

2490 
	`´št_”rÜ
(
f’ame
, 
”r
);

2491 
	`ex™_´og¿m
(1);

2493 } ià(
	`¡rcmp
(
oc
->
ofÜm©
->
Çme
, "image2")==0 && !
	`av_f’ame_numb”_‹¡
(
f’ame
))

2494 
	`as£¹_fe_ov”wr™e
(
f’ame
);

2496 ià(
o
->
mux_´–ßd
) {

2497 
	`av_diù_£t_št
(&
of
->
İts
, "´–ßd", 
o
->
mux_´–ßd
*
AV_TIME_BASE
, 0);

2499 
oc
->
max_d–ay
 = ()(
o
->
mux_max_d–ay
 * 
AV_TIME_BASE
);

2502 
i
 = 0; i < 
o
->
nb_m‘ad©a_m­
; i++) {

2503 *
p
;

2504 
š_fe_šdex
 = 
	`¡¹Ş
(
o
->
m‘ad©a_m­
[
i
].
u
.
¡r
, &
p
, 0);

2506 ià(
š_fe_šdex
 >ğ
nb_šput_fes
) {

2507 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id iÅuˆfšdex %d wh´oûssšg m‘ad©¨m­s\n", 
š_fe_šdex
);

2508 
	`ex™_´og¿m
(1);

2510 
	`cİy_m‘ad©a
(
o
->
m‘ad©a_m­
[
i
].
¥ecif›r
, *
p
 ?… + 1 :…, 
oc
,

2511 
š_fe_šdex
 >= 0 ?

2512 
šput_fes
[
š_fe_šdex
]->
ùx
 : 
NULL
, 
o
);

2516 ià(
o
->
ch­‹rs_šput_fe
 >ğ
nb_šput_fes
) {

2517 ià(
o
->
ch­‹rs_šput_fe
 =ğ
INT_MAX
) {

2519 
o
->
ch­‹rs_šput_fe
 = -1;

2520 
i
 = 0; i < 
nb_šput_fes
; i++)

2521 ià(
šput_fes
[
i
]->
ùx
->
nb_ch­‹rs
) {

2522 
o
->
ch­‹rs_šput_fe
 = 
i
;

2526 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Invalid input file index %d in chapter mapping.\n",

2527 
o
->
ch­‹rs_šput_fe
);

2528 
	`ex™_´og¿m
(1);

2531 ià(
o
->
ch­‹rs_šput_fe
 >= 0)

2532 
	`cİy_ch­‹rs
(
šput_fes
[
o
->
ch­‹rs_šput_fe
], 
of
,

2533 !
o
->
m‘ad©a_ch­‹rs_mªu®
);

2536 ià(!
o
->
m‘ad©a_glob®_mªu®
 && 
nb_šput_fes
){

2537 
	`av_diù_cİy
(&
oc
->
m‘ad©a
, 
šput_fes
[0]->
ùx
->metadata,

2538 
AV_DICT_DONT_OVERWRITE
);

2539 if(
o
->
»cÜdšg_time
 !ğ
INT64_MAX
)

2540 
	`av_diù_£t
(&
oc
->
m‘ad©a
, "du¿tiÚ", 
NULL
, 0);

2541 
	`av_diù_£t
(&
oc
->
m‘ad©a
, "ü—tiÚ_time", 
NULL
, 0);

2543 ià(!
o
->
m‘ad©a_¡»ams_mªu®
)

2544 
i
 = 
of
->
o¡_šdex
; i < 
nb_ouut_¡»ams
; i++) {

2545 
IÅutSŒ—m
 *
i¡
;

2546 ià(
ouut_¡»ams
[
i
]->
sourû_šdex
 < 0)

2548 
i¡
 = 
šput_¡»ams
[
ouut_¡»ams
[
i
]->
sourû_šdex
];

2549 
	`av_diù_cİy
(&
ouut_¡»ams
[
i
]->
¡
->
m‘ad©a
, 
i¡
->¡->m‘ad©a, 
AV_DICT_DONT_OVERWRITE
);

2550 ià(!
ouut_¡»ams
[
i
]->
¡»am_cİy
) {

2551 
	`av_diù_£t
(&
ouut_¡»ams
[
i
]->
¡
->
m‘ad©a
, "’cod”", 
NULL
, 0);

2556 
i
 = 0; i < 
o
->
nb_´og¿m
; i++) {

2557 cÚ¡ *
p
 = 
o
->
´og¿m
[
i
].
u
.
¡r
;

2558 
´ogid
 = 
i
+1;

2559 
AVProg¿m
 *
´og¿m
;

2561 *
p
) {

2562 cÚ¡ *
p2
 = 
	`av_g‘_tok’
(&
p
, ":");

2563 cÚ¡ *
to_d—Îoc
 = 
p2
;

2564 *
key
;

2565 ià(!
p2
)

2568 if(*
p
)…++;

2570 
key
 = 
	`av_g‘_tok’
(&
p2
, "=");

2571 ià(!
key
 || !*
p2
) {

2572 
	`av_ä“p
(&
to_d—Îoc
);

2573 
	`av_ä“p
(&
key
);

2576 
p2
++;

2578 ià(!
	`¡rcmp
(
key
, "program_num"))

2579 
´ogid
 = 
	`¡¹Ş
(
p2
, 
NULL
, 0);

2580 
	`av_ä“p
(&
to_d—Îoc
);

2581 
	`av_ä“p
(&
key
);

2584 
´og¿m
 = 
	`av_Ãw_´og¿m
(
oc
, 
´ogid
);

2586 
p
 = 
o
->
´og¿m
[
i
].
u
.
¡r
;

2587 *
p
) {

2588 cÚ¡ *
p2
 = 
	`av_g‘_tok’
(&
p
, ":");

2589 cÚ¡ *
to_d—Îoc
 = 
p2
;

2590 *
key
;

2591 ià(!
p2
)

2593 if(*
p
)…++;

2595 
key
 = 
	`av_g‘_tok’
(&
p2
, "=");

2596 ià(!
key
) {

2597 
	`av_log
(
NULL
, 
AV_LOG_FATAL
,

2599 
p2
);

2600 
	`ex™_´og¿m
(1);

2602 ià(!*
p2
)

2603 
	`ex™_´og¿m
(1);

2604 
p2
++;

2606 ià(!
	`¡rcmp
(
key
, "title")) {

2607 
	`av_diù_£t
(&
´og¿m
->
m‘ad©a
, "t™Ë", 
p2
, 0);

2608 } ià(!
	`¡rcmp
(
key
, "program_num")) {

2609 } ià(!
	`¡rcmp
(
key
, "st")) {

2610 
¡_num
 = 
	`¡¹Ş
(
p2
, 
NULL
, 0);

2611 
	`av_´og¿m_add_¡»am_šdex
(
oc
, 
´ogid
, 
¡_num
);

2613 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UnknowÀ´og¿m key %s.\n", 
key
);

2614 
	`ex™_´og¿m
(1);

2616 
	`av_ä“p
(&
to_d—Îoc
);

2617 
	`av_ä“p
(&
key
);

2622 
i
 = 0; i < 
o
->
nb_m‘ad©a
; i++) {

2623 
AVDiùiÚ¬y
 **
m
;

2624 
ty³
, *
v®
;

2625 cÚ¡ *
¡»am_¥ec
;

2626 
šdex
 = 0, 
j
, 
»t
 = 0;

2628 
v®
 = 
	`¡rchr
(
o
->
m‘ad©a
[
i
].
u
.
¡r
, '=');

2629 ià(!
v®
) {

2630 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "No '=' character in metadata string %s.\n",

2631 
o
->
m‘ad©a
[
i
].
u
.
¡r
);

2632 
	`ex™_´og¿m
(1);

2634 *
v®
++ = 0;

2636 
	`·r£_m‘a_ty³
(
o
->
m‘ad©a
[
i
].
¥ecif›r
, &
ty³
, &
šdex
, &
¡»am_¥ec
);

2637 ià(
ty³
 == 's') {

2638 
j
 = 0; j < 
oc
->
nb_¡»ams
; j++) {

2639 
o¡
 = 
ouut_¡»ams
[
nb_ouut_¡»ams
 - 
oc
->
nb_¡»ams
 + 
j
];

2640 ià((
»t
 = 
	`check_¡»am_¥ecif›r
(
oc
, oc->
¡»ams
[
j
], 
¡»am_¥ec
)) > 0) {

2641 ià(!
	`¡rcmp
(
o
->
m‘ad©a
[
i
].
u
.
¡r
, "rotate")) {

2642 *

;

2643 
th‘a
 = 
	`av_¡¹od
(
v®
, &

);

2644 ià(!*

) {

2645 
o¡
->
rÙ©e_ov”ridd’
 = 1;

2646 
o¡
->
rÙ©e_ov”ride_v®ue
 = 
th‘a
;

2649 
	`av_diù_£t
(&
oc
->
¡»ams
[
j
]->
m‘ad©a
, 
o
->m‘ad©a[
i
].
u
.
¡r
, *
v®
 ? v® : 
NULL
, 0);

2651 } ià(
»t
 < 0)

2652 
	`ex™_´og¿m
(1);

2656 
ty³
) {

2658 
m
 = &
oc
->
m‘ad©a
;

2661 ià(
šdex
 < 0 || index >ğ
oc
->
nb_ch­‹rs
) {

2662 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id ch­‹¸šdex %d iÀm‘ad©¨¥ecif›r.\n", 
šdex
);

2663 
	`ex™_´og¿m
(1);

2665 
m
 = &
oc
->
ch­‹rs
[
šdex
]->
m‘ad©a
;

2668 ià(
šdex
 < 0 || index >ğ
oc
->
nb_´og¿ms
) {

2669 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id…rog¿m index %d iÀm‘ad©¨¥ecif›r.\n", 
šdex
);

2670 
	`ex™_´og¿m
(1);

2672 
m
 = &
oc
->
´og¿ms
[
šdex
]->
m‘ad©a
;

2675 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Inv®id m‘ad©¨¥ecif›¸%s.\n", 
o
->
m‘ad©a
[
i
].
¥ecif›r
);

2676 
	`ex™_´og¿m
(1);

2678 
	`av_diù_£t
(
m
, 
o
->
m‘ad©a
[
i
].
u
.
¡r
, *
v®
 ? v® : 
NULL
, 0);

2683 
	}
}

2685 
	$İt_rg‘
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2687 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2688 ’um { 
PAL
, 
NTSC
, 
FILM
, 
UNKNOWN
 } 
nÜm
 = UNKNOWN;

2689 cÚ¡ *cÚ¡ 
äame_¿‹s
[] = { "25", "30000/1001", "24000/1001" };

2691 ià(!
	`¡ºcmp
(
¬g
, "pal-", 4)) {

2692 
nÜm
 = 
PAL
;

2693 
¬g
 += 4;

2694 } ià(!
	`¡ºcmp
(
¬g
, "ntsc-", 5)) {

2695 
nÜm
 = 
NTSC
;

2696 
¬g
 += 5;

2697 } ià(!
	`¡ºcmp
(
¬g
, "film-", 5)) {

2698 
nÜm
 = 
FILM
;

2699 
¬g
 += 5;

2702 ià(
nb_šput_fes
) {

2703 
i
, 
j
, 
ä
;

2704 
j
 = 0; j < 
nb_šput_fes
; j++) {

2705 
i
 = 0; i < 
šput_fes
[
j
]->
nb_¡»ams
; i++) {

2706 
AVSŒ—m
 *
¡
 = 
šput_fes
[
j
]->
ùx
->
¡»ams
[
i
];

2707 ià(
¡
->
codeı¬
->
codec_ty³
 !ğ
AVMEDIA_TYPE_VIDEO
)

2709 
ä
 = 
¡
->
time_ba£
.
d’
 * 1000 / st->time_ba£.
num
;

2710 ià(
ä
 == 25000) {

2711 
nÜm
 = 
PAL
;

2713 } ià((
ä
 == 29970) || (fr == 23976)) {

2714 
nÜm
 = 
NTSC
;

2718 ià(
nÜm
 !ğ
UNKNOWN
)

2722 ià(
nÜm
 !ğ
UNKNOWN
)

2723 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Assumšg % fÜ¬g‘.\n", 
nÜm
 =ğ
PAL
 ? "PAL" : "NTSC");

2726 ià(
nÜm
 =ğ
UNKNOWN
) {

2727 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Could‚ot determine‚orm (PAL/NTSC/NTSC-Film) forarget.\n");

2728 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Please…refixarget with \"pal-\", \"ntsc-\" or \"film-\",\n");

2729 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "or set‡ framerate with \"-r xxx\".\n");

2730 
	`ex™_´og¿m
(1);

2733 ià(!
	`¡rcmp
(
¬g
, "vcd")) {

2734 
	`İt_video_codec
(
o
, "c:v", "mpeg1video");

2735 
	`İt_audio_codec
(
o
, "c:a", "mp2");

2736 
	`·r£_İtiÚ
(
o
, "f", "vcd", 
İtiÚs
);

2738 
	`·r£_İtiÚ
(
o
, "s", 
nÜm
 =ğ
PAL
 ? "352x288" : "352x240", 
İtiÚs
);

2739 
	`·r£_İtiÚ
(
o
, "r", 
äame_¿‹s
[
nÜm
], 
İtiÚs
);

2740 
	`İt_deçuÉ
(
NULL
, "g", 
nÜm
 =ğ
PAL
 ? "15" : "18");

2742 
	`İt_deçuÉ
(
NULL
, "b:v", "1150000");

2743 
	`İt_deçuÉ
(
NULL
, "maxrate:v", "1150000");

2744 
	`İt_deçuÉ
(
NULL
, "minrate:v", "1150000");

2745 
	`İt_deçuÉ
(
NULL
, "bufsize:v", "327680");

2747 
	`İt_deçuÉ
(
NULL
, "b:a", "224000");

2748 
	`·r£_İtiÚ
(
o
, "¬", "44100", 
İtiÚs
);

2749 
	`·r£_İtiÚ
(
o
, "ac", "2", 
İtiÚs
);

2751 
	`İt_deçuÉ
(
NULL
, "packetsize", "2324");

2752 
	`İt_deçuÉ
(
NULL
, "muxrate", "1411200");

2759 
o
->
mux_´–ßd
 = (36000 + 3 * 1200) / 90000.0;

2760 } ià(!
	`¡rcmp
(
¬g
, "svcd")) {

2762 
	`İt_video_codec
(
o
, "c:v", "mpeg2video");

2763 
	`İt_audio_codec
(
o
, "c:a", "mp2");

2764 
	`·r£_İtiÚ
(
o
, "f", "svcd", 
İtiÚs
);

2766 
	`·r£_İtiÚ
(
o
, "s", 
nÜm
 =ğ
PAL
 ? "480x576" : "480x480", 
İtiÚs
);

2767 
	`·r£_İtiÚ
(
o
, "r", 
äame_¿‹s
[
nÜm
], 
İtiÚs
);

2768 
	`·r£_İtiÚ
(
o
, "pix_fmt", "yuv420p", 
İtiÚs
);

2769 
	`İt_deçuÉ
(
NULL
, "g", 
nÜm
 =ğ
PAL
 ? "15" : "18");

2771 
	`İt_deçuÉ
(
NULL
, "b:v", "2040000");

2772 
	`İt_deçuÉ
(
NULL
, "maxrate:v", "2516000");

2773 
	`İt_deçuÉ
(
NULL
, "minrate:v", "0");

2774 
	`İt_deçuÉ
(
NULL
, "bufsize:v", "1835008");

2775 
	`İt_deçuÉ
(
NULL
, "scan_offset", "1");

2777 
	`İt_deçuÉ
(
NULL
, "b:a", "224000");

2778 
	`·r£_İtiÚ
(
o
, "¬", "44100", 
İtiÚs
);

2780 
	`İt_deçuÉ
(
NULL
, "packetsize", "2324");

2782 } ià(!
	`¡rcmp
(
¬g
, "dvd")) {

2784 
	`İt_video_codec
(
o
, "c:v", "mpeg2video");

2785 
	`İt_audio_codec
(
o
, "c:a", "ac3");

2786 
	`·r£_İtiÚ
(
o
, "f", "dvd", 
İtiÚs
);

2788 
	`·r£_İtiÚ
(
o
, "s", 
nÜm
 =ğ
PAL
 ? "720x576" : "720x480", 
İtiÚs
);

2789 
	`·r£_İtiÚ
(
o
, "r", 
äame_¿‹s
[
nÜm
], 
İtiÚs
);

2790 
	`·r£_İtiÚ
(
o
, "pix_fmt", "yuv420p", 
İtiÚs
);

2791 
	`İt_deçuÉ
(
NULL
, "g", 
nÜm
 =ğ
PAL
 ? "15" : "18");

2793 
	`İt_deçuÉ
(
NULL
, "b:v", "6000000");

2794 
	`İt_deçuÉ
(
NULL
, "maxrate:v", "9000000");

2795 
	`İt_deçuÉ
(
NULL
, "minrate:v", "0");

2796 
	`İt_deçuÉ
(
NULL
, "bufsize:v", "1835008");

2798 
	`İt_deçuÉ
(
NULL
, "packetsize", "2048");

2799 
	`İt_deçuÉ
(
NULL
, "muxrate", "10080000");

2801 
	`İt_deçuÉ
(
NULL
, "b:a", "448000");

2802 
	`·r£_İtiÚ
(
o
, "¬", "48000", 
İtiÚs
);

2804 } ià(!
	`¡ºcmp
(
¬g
, "dv", 2)) {

2806 
	`·r£_İtiÚ
(
o
, "f", "dv", 
İtiÚs
);

2808 
	`·r£_İtiÚ
(
o
, "s", 
nÜm
 =ğ
PAL
 ? "720x576" : "720x480", 
İtiÚs
);

2809 
	`·r£_İtiÚ
(
o
, "pix_fmt", !
	`¡ºcmp
(
¬g
, "dv50", 4) ? "yuv422p" :

2810 
nÜm
 =ğ
PAL
 ? "yuv420p" : "yuv411p", 
İtiÚs
);

2811 
	`·r£_İtiÚ
(
o
, "r", 
äame_¿‹s
[
nÜm
], 
İtiÚs
);

2813 
	`·r£_İtiÚ
(
o
, "¬", "48000", 
İtiÚs
);

2814 
	`·r£_İtiÚ
(
o
, "ac", "2", 
İtiÚs
);

2817 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀrg‘: %s\n", 
¬g
);

2818  
	`AVERROR
(
EINVAL
);

2821 
	`av_diù_cİy
(&
o
->
g
->
codec_İts
, codec_İts, 
AV_DICT_DONT_OVERWRITE
);

2822 
	`av_diù_cİy
(&
o
->
g
->
fÜm©_İts
, fÜm©_İts, 
AV_DICT_DONT_OVERWRITE
);

2825 
	}
}

2827 
	$İt_v¡©s_fe
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2829 
	`av_ä“
 (
v¡©s_f’ame
);

2830 
v¡©s_f’ame
 = 
	`av_¡rdup
 (
¬g
);

2832 
	}
}

2834 
	$İt_v¡©s
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2836 
f’ame
[40];

2837 
time_t
 
today2
 = 
	`time
(
NULL
);

2838 
tm
 *
today
 = 
	`loÿÉime
(&
today2
);

2840 ià(!
today
) {

2841 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "UÇbËØg‘ cu¼’ˆtime: %s\n", 
	`¡»¼Ü
(
”ºo
));

2842 
	`ex™_´og¿m
(1);

2845 
	`¢´štf
(
f’ame
, (f’ame), "v¡©s_%02d%02d%02d.log", 
today
->
tm_hour
,oday->
tm_mš
,

2846 
today
->
tm_£c
);

2847  
	`İt_v¡©s_fe
(
NULL
, 
İt
, 
f’ame
);

2848 
	}
}

2850 
	$İt_video_äames
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2852 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2853  
	`·r£_İtiÚ
(
o
, "äames:v", 
¬g
, 
İtiÚs
);

2854 
	}
}

2856 
	$İt_audio_äames
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2858 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2859  
	`·r£_İtiÚ
(
o
, "äames:a", 
¬g
, 
İtiÚs
);

2860 
	}
}

2862 
	$İt_d©a_äames
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2864 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2865  
	`·r£_İtiÚ
(
o
, "äames:d", 
¬g
, 
İtiÚs
);

2866 
	}
}

2868 
	$İt_deçuÉ_Ãw
(
O±iÚsCÚ‹xt
 *
o
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2870 
»t
;

2871 
AVDiùiÚ¬y
 *
cbak
 = 
codec_İts
;

2872 
AVDiùiÚ¬y
 *
fbak
 = 
fÜm©_İts
;

2873 
codec_İts
 = 
NULL
;

2874 
fÜm©_İts
 = 
NULL
;

2876 
»t
 = 
	`İt_deçuÉ
(
NULL
, 
İt
, 
¬g
);

2878 
	`av_diù_cİy
(&
o
->
g
->
codec_İts
 , codec_opts, 0);

2879 
	`av_diù_cİy
(&
o
->
g
->
fÜm©_İts
, format_opts, 0);

2880 
	`av_diù_ä“
(&
codec_İts
);

2881 
	`av_diù_ä“
(&
fÜm©_İts
);

2882 
codec_İts
 = 
cbak
;

2883 
fÜm©_İts
 = 
fbak
;

2885  
»t
;

2886 
	}
}

2888 
	$İt_´e£t
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2890 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2891 
FILE
 *
f
=
NULL
;

2892 
f’ame
[1000], 
lše
[1000], 
tmp_lše
[1000];

2893 cÚ¡ *
codec_Çme
 = 
NULL
;

2895 
tmp_lše
[0] = *
İt
;

2896 
tmp_lše
[1] = 0;

2897 
	`MATCH_PER_TYPE_OPT
(
codec_Çmes
, 
¡r
, 
codec_Çme
, 
NULL
, 
tmp_lše
);

2899 ià(!(
f
 = 
	`g‘_´e£t_fe
(
f’ame
, (f’ame), 
¬g
, *
İt
 =ğ'f', 
codec_Çme
))) {

2900 if(!
	`¡ºcmp
(
¬g
, "libx264-los¦ess", 
	`¡¾’
("libx264-lossless"))){

2901 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Please use -preset <speed> -qp 0\n");

2903 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "FfÜ…»£ˆ'%s'‚Ù found\n", 
¬g
);

2904 
	`ex™_´og¿m
(1);

2907 
	`fg‘s
(
lše
, Öše), 
f
)) {

2908 *
key
 = 
tmp_lše
, *
v®ue
, *
’d±r
;

2910 ià(
	`¡rc¥n
(
lše
, "#\n\r") == 0)

2912 
	`av_¡¾ıy
(
tmp_lše
, 
lše
, (tmp_line));

2913 ià(!
	`av_¡¹ok
(
key
, "=", &
v®ue
) ||

2914 !
	`av_¡¹ok
(
v®ue
, "\r\n", &
’d±r
)) {

2915 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s: Inv®id syÁax: '%s'\n", 
f’ame
, 
lše
);

2916 
	`ex™_´og¿m
(1);

2918 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "få»£t[%s]: s‘ '%s' = '%s'\n", 
f’ame
, 
key
, 
v®ue
);

2920 ià(!
	`¡rcmp
(
key
, "acodec")è
	`İt_audio_codec
 (
o
, key, 
v®ue
);

2921 ià(!
	`¡rcmp
(
key
, "vcodec")è
	`İt_video_codec
 (
o
, key, 
v®ue
);

2922 ià(!
	`¡rcmp
(
key
, "scodec")è
	`İt_subt™Ë_codec
(
o
, key, 
v®ue
);

2923 ià(!
	`¡rcmp
(
key
, "dcodec")è
	`İt_d©a_codec
 (
o
, key, 
v®ue
);

2924 ià(
	`İt_deçuÉ_Ãw
(
o
, 
key
, 
v®ue
) < 0) {

2925 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s: Invalid option or‡rgument: '%s',…arsed‡s '%s' = '%s'\n",

2926 
f’ame
, 
lše
, 
key
, 
v®ue
);

2927 
	`ex™_´og¿m
(1);

2931 
	`fşo£
(
f
);

2934 
	}
}

2936 
	$İt_Şd2Ãw
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2938 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2939 *
s
 = 
	`av_a¥rštf
("%s:%c", 
İt
 + 1, *opt);

2940 
»t
 = 
	`·r£_İtiÚ
(
o
, 
s
, 
¬g
, 
İtiÚs
);

2941 
	`av_ä“
(
s
);

2942  
»t
;

2943 
	}
}

2945 
	$İt_b™¿‹
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2947 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2949 if(!
	`¡rcmp
(
İt
, "ab")){

2950 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, "b:a", 
¬g
, 0);

2952 } if(!
	`¡rcmp
(
İt
, "b")){

2953 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Please use -b:a or -b:v, -b is‡mbiguous\n");

2954 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, "b:v", 
¬g
, 0);

2957 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, 
İt
, 
¬g
, 0);

2959 
	}
}

2961 
	$İt_qsÿË
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2963 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2964 *
s
;

2965 
»t
;

2966 if(!
	`¡rcmp
(
İt
, "qscale")){

2967 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Please use -q:a or -q:v, -qscale is‡mbiguous\n");

2968  
	`·r£_İtiÚ
(
o
, "q:v", 
¬g
, 
İtiÚs
);

2970 
s
 = 
	`av_a¥rštf
("q%s", 
İt
 + 6);

2971 
»t
 = 
	`·r£_İtiÚ
(
o
, 
s
, 
¬g
, 
İtiÚs
);

2972 
	`av_ä“
(
s
);

2973  
»t
;

2974 
	}
}

2976 
	$İt_´ofe
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2978 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2979 if(!
	`¡rcmp
(
İt
, "profile")){

2980 
	`av_log
(
NULL
, 
AV_LOG_WARNING
, "Please use -profile:a or -profile:v, -profile is‡mbiguous\n");

2981 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, "´ofe:v", 
¬g
, 0);

2984 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, 
İt
, 
¬g
, 0);

2986 
	}
}

2988 
	$İt_video_f‹rs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2990 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2991  
	`·r£_İtiÚ
(
o
, "f‹r:v", 
¬g
, 
İtiÚs
);

2992 
	}
}

2994 
	$İt_audio_f‹rs
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

2996 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

2997  
	`·r£_İtiÚ
(
o
, "f‹r:a", 
¬g
, 
İtiÚs
);

2998 
	}
}

3000 
	$İt_vsync
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3002 ià(!
	`av_¡rÿ£cmp
(
¬g
, "cä")è
video_sync_m‘hod
 = 
VSYNC_CFR
;

3003 ià(!
	`av_¡rÿ£cmp
(
¬g
, "vä")è
video_sync_m‘hod
 = 
VSYNC_VFR
;

3004 ià(!
	`av_¡rÿ£cmp
(
¬g
, "·s¡hrough")è
video_sync_m‘hod
 = 
VSYNC_PASSTHROUGH
;

3005 ià(!
	`av_¡rÿ£cmp
(
¬g
, "drİ")è
video_sync_m‘hod
 = 
VSYNC_DROP
;

3007 ià(
video_sync_m‘hod
 =ğ
VSYNC_AUTO
)

3008 
video_sync_m‘hod
 = 
	`·r£_numb”_Ü_d›
("vsync", 
¬g
, 
OPT_INT
, 
VSYNC_AUTO
, 
VSYNC_VFR
);

3010 
	}
}

3012 
	$İt_timecode
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3014 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

3015 *
tü
 = 
	`av_a¥rštf
("timecode=%s", 
¬g
);

3016 
»t
 = 
	`·r£_İtiÚ
(
o
, "m‘ad©a:g", 
tü
, 
İtiÚs
);

3017 ià(
»t
 >= 0)

3018 
»t
 = 
	`av_diù_£t
(&
o
->
g
->
codec_İts
, "gİ_timecode", 
¬g
, 0);

3019 
	`av_ä“
(
tü
);

3021 
	}
}

3023 
	$İt_chªÃl_Ïyout
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3025 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

3026 
Ïyout_¡r
[32];

3027 *
¡»am_¡r
;

3028 *
ac_¡r
;

3029 
»t
, 
chªÃls
, 
ac_¡r_size
;

3030 
ušt64_t
 
Ïyout
;

3032 
Ïyout
 = 
	`av_g‘_chªÃl_Ïyout
(
¬g
);

3033 ià(!
Ïyout
) {

3034 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀchªÃÈÏyout: %s\n", 
¬g
);

3035  
	`AVERROR
(
EINVAL
);

3037 
	`¢´štf
(
Ïyout_¡r
, Öayout_¡r), "%"
PRIu64
, 
Ïyout
);

3038 
»t
 = 
	`İt_deçuÉ_Ãw
(
o
, 
İt
, 
Ïyout_¡r
);

3039 ià(
»t
 < 0)

3040  
»t
;

3043 
chªÃls
 = 
	`av_g‘_chªÃl_Ïyout_nb_chªÃls
(
Ïyout
);

3044 
	`¢´štf
(
Ïyout_¡r
, Öayout_¡r), "%d", 
chªÃls
);

3045 
¡»am_¡r
 = 
	`¡rchr
(
İt
, ':');

3046 
ac_¡r_size
 = 3 + (
¡»am_¡r
 ? 
	`¡¾’
(stream_str) : 0);

3047 
ac_¡r
 = 
	`av_m®locz
(
ac_¡r_size
);

3048 ià(!
ac_¡r
)

3049  
	`AVERROR
(
ENOMEM
);

3050 
	`av_¡¾ıy
(
ac_¡r
, "ac", 3);

3051 ià(
¡»am_¡r
)

3052 
	`av_¡¾ÿt
(
ac_¡r
, 
¡»am_¡r
, 
ac_¡r_size
);

3053 
»t
 = 
	`·r£_İtiÚ
(
o
, 
ac_¡r
, 
Ïyout_¡r
, 
İtiÚs
);

3054 
	`av_ä“
(
ac_¡r
);

3056  
»t
;

3057 
	}
}

3059 
	$İt_audio_qsÿË
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3061 
O±iÚsCÚ‹xt
 *
o
 = 
İtùx
;

3062  
	`·r£_İtiÚ
(
o
, "q:a", 
¬g
, 
İtiÚs
);

3063 
	}
}

3065 
	$İt_f‹r_com¶ex
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3067 
	`GROW_ARRAY
(
f‹rg¿phs
, 
nb_f‹rg¿phs
);

3068 ià(!(
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1] = 
	`av_m®locz
((*filtergraphs[0]))))

3069  
	`AVERROR
(
ENOMEM
);

3070 
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1]->
šdex
 =‚b_filtergraphs - 1;

3071 
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1]->
g¿ph_desc
 = 
	`av_¡rdup
(
¬g
);

3072 ià(!
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1]->
g¿ph_desc
)

3073  
	`AVERROR
(
ENOMEM
);

3075 
šput_¡»am_pÙ’tŸÎy_avaabË
 = 1;

3078 
	}
}

3080 
	$İt_f‹r_com¶ex_süt
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3082 
ušt8_t
 *
g¿ph_desc
 = 
	`»ad_fe
(
¬g
);

3083 ià(!
g¿ph_desc
)

3084  
	`AVERROR
(
EINVAL
);

3086 
	`GROW_ARRAY
(
f‹rg¿phs
, 
nb_f‹rg¿phs
);

3087 ià(!(
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1] = 
	`av_m®locz
((*filtergraphs[0]))))

3088  
	`AVERROR
(
ENOMEM
);

3089 
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1]->
šdex
 =‚b_filtergraphs - 1;

3090 
f‹rg¿phs
[
nb_f‹rg¿phs
 - 1]->
g¿ph_desc
 = graph_desc;

3092 
šput_¡»am_pÙ’tŸÎy_avaabË
 = 1;

3095 
	}
}

3097 
	$show_h–p_deçuÉ
(cÚ¡ *
İt
, cÚ¡ *
¬g
)

3100 cÚ¡ 
³r_fe
 = 
OPT_SPEC
 | 
OPT_OFFSET
 | 
OPT_PERFILE
;

3101 
show_advªûd
 = 0, 
show_avİtiÚs
 = 0;

3103 ià(
İt
 && *opt) {

3104 ià(!
	`¡rcmp
(
İt
, "long"))

3105 
show_advªûd
 = 1;

3106 ià(!
	`¡rcmp
(
İt
, "full"))

3107 
show_advªûd
 = 
show_avİtiÚs
 = 1;

3109 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "UnknowÀh–°İtiÚ '%s'.\n", 
İt
);

3112 
	`show_u§ge
();

3114 
	`´štf
("Getting help:\n"

3120 "\n", 
´og¿m_Çme
);

3122 
	`show_h–p_İtiÚs
(
İtiÚs
, "Print help / information / capabilities:",

3123 
OPT_EXIT
, 0, 0);

3125 
	`show_h–p_İtiÚs
(
İtiÚs
, "Global options (affect whole…rogram "

3127 0, 
³r_fe
 | 
OPT_EXIT
 | 
OPT_EXPERT
, 0);

3128 ià(
show_advªûd
)

3129 
	`show_h–p_İtiÚs
(
İtiÚs
, "Advªûd glob® o±iÚs:", 
OPT_EXPERT
,

3130 
³r_fe
 | 
OPT_EXIT
, 0);

3132 
	`show_h–p_İtiÚs
(
İtiÚs
, "Per-file main options:", 0,

3133 
OPT_EXPERT
 | 
OPT_AUDIO
 | 
OPT_VIDEO
 | 
OPT_SUBTITLE
 |

3134 
OPT_EXIT
, 
³r_fe
);

3135 ià(
show_advªûd
)

3136 
	`show_h–p_İtiÚs
(
İtiÚs
, "Advanced…er-file options:",

3137 
OPT_EXPERT
, 
OPT_AUDIO
 | 
OPT_VIDEO
 | 
OPT_SUBTITLE
, 
³r_fe
);

3139 
	`show_h–p_İtiÚs
(
İtiÚs
, "Video options:",

3140 
OPT_VIDEO
, 
OPT_EXPERT
 | 
OPT_AUDIO
, 0);

3141 ià(
show_advªûd
)

3142 
	`show_h–p_İtiÚs
(
İtiÚs
, "Advanced Video options:",

3143 
OPT_EXPERT
 | 
OPT_VIDEO
, 
OPT_AUDIO
, 0);

3145 
	`show_h–p_İtiÚs
(
İtiÚs
, "Audio options:",

3146 
OPT_AUDIO
, 
OPT_EXPERT
 | 
OPT_VIDEO
, 0);

3147 ià(
show_advªûd
)

3148 
	`show_h–p_İtiÚs
(
İtiÚs
, "Advanced Audio options:",

3149 
OPT_EXPERT
 | 
OPT_AUDIO
, 
OPT_VIDEO
, 0);

3150 
	`show_h–p_İtiÚs
(
İtiÚs
, "Subtitle options:",

3151 
OPT_SUBTITLE
, 0, 0);

3152 
	`´štf
("\n");

3154 ià(
show_avİtiÚs
) {

3155 
æags
 = 
AV_OPT_FLAG_DECODING_PARAM
 | 
AV_OPT_FLAG_ENCODING_PARAM
;

3156 
	`show_h–p_chd»n
(
	`avcodec_g‘_şass
(), 
æags
);

3157 
	`show_h–p_chd»n
(
	`avfÜm©_g‘_şass
(), 
æags
);

3158 #ià
CONFIG_SWSCALE


3159 
	`show_h–p_chd»n
(
	`sws_g‘_şass
(), 
æags
);

3161 
	`show_h–p_chd»n
(
	`swr_g‘_şass
(), 
AV_OPT_FLAG_AUDIO_PARAM
);

3162 
	`show_h–p_chd»n
(
	`avf‹r_g‘_şass
(), 
AV_OPT_FLAG_VIDEO_PARAM
 | 
AV_OPT_FLAG_AUDIO_PARAM
 | 
AV_OPT_FLAG_FILTERING_PARAM
);

3164 
	}
}

3166 
	$show_u§ge
()

3168 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "Hyper fast Audio‡nd Videoƒncoder\n");

3169 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "u§ge: % [İtiÚs] [[šfİtiÚs] -˜šfe]... {[outfİtiÚs] outfe}...\n", 
´og¿m_Çme
);

3170 
	`av_log
(
NULL
, 
AV_LOG_INFO
, "\n");

3171 
	}
}

3173 
	eO±Group
 {

3174 
	mGROUP_OUTFILE
,

3175 
	mGROUP_INFILE
,

3178 cÚ¡ 
O±iÚGroupDef
 
	ggroups
[] = {

3179 [
GROUP_OUTFILE
] = { "ouuˆu¾", 
NULL
, 
OPT_OUTPUT
 },

3180 [
GROUP_INFILE
] = { "špuˆu¾", "i", 
OPT_INPUT
 },

3183 
İ’_fes
(
O±iÚGroupLi¡
 *
l
, cÚ¡ *
šout
,

3184 (*
İ’_fe
)(
O±iÚsCÚ‹xt
*, const *))

3186 
i
, 
»t
;

3188 
i
 = 0; i < 
l
->
nb_groups
; i++) {

3189 
O±iÚGroup
 *
g
 = &
l
->
groups
[
i
];

3190 
O±iÚsCÚ‹xt
 
o
;

3192 
	`š™_İtiÚs
(&
o
);

3193 
o
.
g
 = g;

3195 
»t
 = 
	`·r£_İtgroup
(&
o
, 
g
);

3196 ià(
»t
 < 0) {

3197 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error…arsing options for %s file "

3198 "%s.\n", 
šout
, 
g
->
¬g
);

3199  
»t
;

3202 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "O³nšg‡À% fe: %s.\n", 
šout
, 
g
->
¬g
);

3203 
»t
 = 
	`İ’_fe
(&
o
, 
g
->
¬g
);

3204 
	`unš™_İtiÚs
(&
o
);

3205 ià(
»t
 < 0) {

3206 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Error opening %s file %s.\n",

3207 
šout
, 
g
->
¬g
);

3208  
»t
;

3210 
	`av_log
(
NULL
, 
AV_LOG_DEBUG
, "Successfully openedhe file.\n");

3214 
	}
}

3216 
	$ffm³g_·r£_İtiÚs
(
¬gc
, **
¬gv
)

3218 
O±iÚP¬£CÚ‹xt
 
oùx
;

3219 
ušt8_t
 
”rÜ
[128];

3220 
»t
;

3222 
	`mem£t
(&
oùx
, 0, (octx));

3225 
»t
 = 
	`¥l™_commªdlše
(&
oùx
, 
¬gc
, 
¬gv
, 
İtiÚs
, 
groups
,

3226 
	`FF_ARRAY_ELEMS
(
groups
));

3227 ià(
»t
 < 0) {

3228 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error splittinghe‡rgument†ist: ");

3229 
ç
;

3233 
»t
 = 
	`·r£_İtgroup
(
NULL
, &
oùx
.
glob®_İts
);

3234 ià(
»t
 < 0) {

3235 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error…arsing global options: ");

3236 
ç
;

3240 
	`‹rm_š™
();

3243 
»t
 = 
	`İ’_fes
(&
oùx
.
groups
[
GROUP_INFILE
], "šput", 
İ’_šput_fe
);

3244 ià(
»t
 < 0) {

3245 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error opening input files: ");

3246 
ç
;

3250 
»t
 = 
	`š™_com¶ex_f‹rs
();

3251 ià(
»t
 < 0) {

3252 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error initializing complex filters.\n");

3253 
ç
;

3257 
»t
 = 
	`İ’_fes
(&
oùx
.
groups
[
GROUP_OUTFILE
], "ouut", 
İ’_ouut_fe
);

3258 ià(
»t
 < 0) {

3259 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "Error opening output files: ");

3260 
ç
;

3263 
	`check_f‹r_ouuts
();

3265 
ç
:

3266 
	`unš™_·r£_cÚ‹xt
(&
oùx
);

3267 ià(
»t
 < 0) {

3268 
	`av_¡»¼Ü
(
»t
, 
”rÜ
, (error));

3269 
	`av_log
(
NULL
, 
AV_LOG_FATAL
, "%s\n", 
”rÜ
);

3271  
»t
;

3272 
	}
}

3274 
	$İt_´og»ss
(*
İtùx
, cÚ¡ *
İt
, cÚ¡ *
¬g
)

3276 
AVIOCÚ‹xt
 *
avio
 = 
NULL
;

3277 
»t
;

3279 ià(!
	`¡rcmp
(
¬g
, "-"))

3280 
¬g
 = "pipe:";

3281 
»t
 = 
	`avio_İ’2
(&
avio
, 
¬g
, 
AVIO_FLAG_WRITE
, &
št_cb
, 
NULL
);

3282 ià(
»t
 < 0) {

3283 
	`av_log
(
NULL
, 
AV_LOG_ERROR
, "Failedo open…rogress URL \"%s\": %s\n",

3284 
¬g
, 
	`av_”r2¡r
(
»t
));

3285  
»t
;

3287 
´og»ss_avio
 = 
avio
;

3289 
	}
}

3291 
	#OFFSET
(
x
è
	`off£tof
(
O±iÚsCÚ‹xt
, x)

	)

3292 cÚ¡ 
O±iÚDef
 
	gİtiÚs
[] = {

3294 
	~"cmduts_commÚ_İts.h
"

3295 { "f", 
HAS_ARG
 | 
OPT_STRING
 | 
OPT_OFFSET
 |

3296 
OPT_INPUT
 | 
OPT_OUTPUT
, { .
off
 = 
OFFSET
(
fÜm©
) },

3298 { "y", 
	gOPT_BOOL
, { &
	gfe_ov”wr™e
 },

3300 { "n", 
	gOPT_BOOL
, { &
	gno_fe_ov”wr™e
 },

3302 { "ignÜe_unknown", 
	gOPT_BOOL
, { &
	gignÜe_unknown_¡»ams
 },

3304 { "cİy_unknown", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gcİy_unknown_¡»ams
 },

3306 { "c", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3307 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
codec_Çmes
) },

3309 { "codec", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3310 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
codec_Çmes
) },

3312 { "´e", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3313 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
´e£ts
) },

3315 { "m­", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3316 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_m­
 },

3319 { "m­_chªÃl", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_m­_chªÃl
 },

3321 { "m­_m‘ad©a", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3322 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
m‘ad©a_m­
) },

3325 { "m­_ch­‹rs", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_EXPERT
 | 
	gOPT_OFFSET
 |

3326 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
ch­‹rs_šput_fe
) },

3328 { "t", 
	gHAS_ARG
 | 
	gOPT_TIME
 | 
	gOPT_OFFSET
 |

3329 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
»cÜdšg_time
) },

3332 { "to", 
	gHAS_ARG
 | 
	gOPT_TIME
 | 
	gOPT_OFFSET
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
¡İ_time
) },

3334 { "fs", 
	gHAS_ARG
 | 
	gOPT_INT64
 | 
	gOPT_OFFSET
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
lim™_fesize
) },

3336 { "ss", 
	gHAS_ARG
 | 
	gOPT_TIME
 | 
	gOPT_OFFSET
 |

3337 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
¡¬t_time
) },

3339 { "s£of", 
	gHAS_ARG
 | 
	gOPT_TIME
 | 
	gOPT_OFFSET
 |

3340 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
¡¬t_time_eof
) },

3342 { "£ek_time¡amp", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_OFFSET
 |

3343 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
£ek_time¡amp
) },

3345 { "accu¿‹_£ek", 
	gOPT_BOOL
 | 
	gOPT_OFFSET
 | 
	gOPT_EXPERT
 |

3346 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
accu¿‹_£ek
) },

3348 { "™soff£t", 
	gHAS_ARG
 | 
	gOPT_TIME
 | 
	gOPT_OFFSET
 |

3349 
	gOPT_EXPERT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
šput_ts_off£t
) },

3351 { "™ssÿË", 
	gHAS_ARG
 | 
	gOPT_DOUBLE
 | 
	gOPT_SPEC
 |

3352 
	gOPT_EXPERT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
ts_sÿË
) },

3354 { "time¡amp", 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_»cÜdšg_time¡amp
 },

3356 { "m‘ad©a", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
m‘ad©a
) },

3358 { "´og¿m", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
´og¿m
) },

3360 { "däames", 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_EXPERT
 |

3361 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_d©a_äames
 },

3363 { "b’chm¬k", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_b’chm¬k
 },

3365 { "b’chm¬k_®l", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_b’chm¬k_®l
 },

3367 { "´og»ss", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_´og»ss
 },

3369 { "¡dš", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	g¡dš_š‹¿ùiÚ
 },

3371 { "tim–im™", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_tim–im™
 },

3373 { "dump", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_pkt_dump
 },

3375 { "hex", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_hex_dump
 },

3377 { "»", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_OFFSET
 |

3378 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
¿‹_emu
) },

3380 { "rg‘", 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_rg‘
 },

3383 { "vsync", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_vsync
 },

3385 { "äame_drİ_th»shŞd", 
	gHAS_ARG
 | 
	gOPT_FLOAT
 | 
	gOPT_EXPERT
, { &
	gäame_drİ_th»shŞd
 },

3387 { "async", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_EXPERT
, { &
	gaudio_sync_m‘hod
 },

3389 { "adriá_th»shŞd", 
	gHAS_ARG
 | 
	gOPT_FLOAT
 | 
	gOPT_EXPERT
, { &
	gaudio_driá_th»shŞd
 },

3391 { "cİyts", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gcİy_ts
 },

3393 { "¡¬t_©_z”o", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	g¡¬t_©_z”o
 },

3395 { "cİytb", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_EXPERT
, { &
	gcİy_tb
 },

3397 { "shÜ‹¡", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_OFFSET
 |

3398 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
shÜ‹¡
) },

3400 { "­ad", 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 |

3401 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
­ad
) },

3403 { "dts_d–_th»shŞd", 
	gHAS_ARG
 | 
	gOPT_FLOAT
 | 
	gOPT_EXPERT
, { &
	gdts_d–_th»shŞd
 },

3405 { "dts_”rÜ_th»shŞd", 
	gHAS_ARG
 | 
	gOPT_FLOAT
 | 
	gOPT_EXPERT
, { &
	gdts_”rÜ_th»shŞd
 },

3407 { "x”rÜ", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gex™_Ú_”rÜ
 },

3409 { "abÜt_Ú", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_abÜt_Ú
 },

3411 { "cİyškf", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 |

3412 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
cİy_š™Ÿl_nÚkeyäames
) },

3414 { "cİy´iÜss", 
	gOPT_INT
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
cİy_´iÜ_¡¬t
) },

3416 { "äames", 
	gOPT_INT64
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
max_äames
) },

3418 { "g", 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 |

3419 
	gOPT_EXPERT
 | 
	gOPT_OUTPUT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
codec_gs
) },

3421 { "q", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_DOUBLE
 |

3422 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
qsÿË
) },

3424 { "qsÿË", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3425 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_qsÿË
 },

3427 { "´ofe", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_´ofe
 },

3429 { "f‹r", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
f‹rs
) },

3431 { "f‹r_th»ads", 
	gHAS_ARG
 | 
	gOPT_INT
, { &
	gf‹r_nbth»ads
 },

3433 { "f‹r_süt", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
f‹r_süts
) },

3435 { "»š™_f‹r", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
»š™_f‹rs
) },

3437 { "f‹r_com¶ex", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_f‹r_com¶ex
 },

3439 { "f‹r_com¶ex_th»ads", 
	gHAS_ARG
 | 
	gOPT_INT
, { &
	gf‹r_com¶ex_nbth»ads
 },

3441 { "Ïvfi", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_f‹r_com¶ex
 },

3443 { "f‹r_com¶ex_süt", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_f‹r_com¶ex_süt
 },

3445 { "¡©s", 
	gOPT_BOOL
, { &
	g´št_¡©s
 },

3447 { "©ch", 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_EXPERT
 |

3448 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_©ch
 },

3450 { "dump_©chm’t", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3451 
	gOPT_EXPERT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
dump_©chm’t
) },

3453 { "¡»am_loİ", 
	gOPT_INT
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_INPUT
 |

3454 
	gOPT_OFFSET
, { .
	goff
 = 
OFFSET
(
loİ
) }, "set‚umber ofimes input stream shall be†ooped", "loop count" },

3455 { "debug_ts", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdebug_ts
 },

3457 { "max_”rÜ_¿‹", 
	gHAS_ARG
 | 
	gOPT_FLOAT
, { &
	gmax_”rÜ_¿‹
 },

3459 { "disÿrd", 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 |

3460 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
disÿrd
) },

3462 { "di¥os™iÚ", 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 |

3463 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
di¥os™iÚ
) },

3465 { "th»ad_queue_size", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_OFFSET
 | 
	gOPT_EXPERT
 | 
	gOPT_INPUT
,

3466 { .
	goff
 = 
OFFSET
(
th»ad_queue_size
) },

3470 { "väames", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_video_äames
 },

3472 { "r", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3473 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
äame_¿‹s
) },

3475 { "s", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_SUBTITLE
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3476 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
äame_sizes
) },

3478 { "a¥eù", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3479 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
äame_a¥eù_¿tios
) },

3481 { "pix_fmt", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3482 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
äame_pix_fmts
) },

3484 { "b™s_³r_¿w_§m¶e", 
	gOPT_VIDEO
 | 
	gOPT_INT
 | 
	gHAS_ARG
, { &
	gäame_b™s_³r_¿w_§m¶e
 },

3486 { "šŒa", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gšŒa_Úly
 },

3488 { "vn", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_OFFSET
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
,{ .
	goff
 = 
OFFSET
(
video_di§bË
) },

3490 { "rc_ov”ride", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3491 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
rc_ov”rides
) },

3493 { "vcodec", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_INPUT
 |

3494 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_video_codec
 },

3496 { "§meq", 
	gOPT_VIDEO
 | 
	gOPT_EXPERT
 , { .
	gfunc_¬g
 = 
İt_§meq
 },

3498 { "§me_quªt", 
	gOPT_VIDEO
 | 
	gOPT_EXPERT
 , { .
	gfunc_¬g
 = 
İt_§meq
 },

3500 { "timecode", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_timecode
 },

3502 { "·ss", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_SPEC
 | 
	gOPT_INT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
·ss
) },

3504 { "·s¦ogfe", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 |

3505 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
·s¦ogfes
) },

3507 { "deš‹¾aû", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_deš‹¾aû
 },

3509 { "p¢r", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gdo_p¢r
 },

3511 { "v¡©s", 
	gOPT_VIDEO
 | 
	gOPT_EXPERT
 , { .
	gfunc_¬g
 = 
İt_v¡©s
 },

3513 { "v¡©s_fe", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 , { .
	gfunc_¬g
 = 
İt_v¡©s_fe
 },

3515 { "v¡©s_v”siÚ", 
	gOPT_VIDEO
 | 
	gOPT_INT
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 , { &
	gv¡©s_v”siÚ
 },

3517 { "vf", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_video_f‹rs
 },

3519 { "šŒa_m©rix", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3520 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
šŒa_m©riûs
) },

3522 { "š‹r_m©rix", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3523 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
š‹r_m©riûs
) },

3525 { "chroma_šŒa_m©rix", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 |

3526 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
chroma_šŒa_m©riûs
) },

3528 { "tİ", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_INT
| 
	gOPT_SPEC
 |

3529 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
tİ_f›ld_fœ¡
) },

3531 { "vg", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3532 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_Şd2Ãw
 },

3534 { "qphi¡", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 , { &
	gqp_hi¡
 },

3536 { "fÜû_ås", 
	gOPT_VIDEO
 | 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 |

3537 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
fÜû_ås
) },

3539 { "¡»amid", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3540 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_¡»amid
 },

3542 { "fÜû_key_äames", 
	gOPT_VIDEO
 | 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 |

3543 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
fÜûd_key_äames
) },

3545 { "ab", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_b™¿‹
 },

3547 { "b", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_b™¿‹
 },

3549 { "hwacûl", 
	gOPT_VIDEO
 | 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 |

3550 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
hwacûls
) },

3552 { "hwacûl_deviû", 
	gOPT_VIDEO
 | 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 |

3553 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
hwacûl_deviûs
) },

3555 { "hwacûl_ouut_fÜm©", 
	gOPT_VIDEO
 | 
	gOPT_STRING
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 |

3556 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
hwacûl_ouut_fÜm©s
) },

3558 #ià
CONFIG_VDA
 || 
CONFIG_VIDEOTOOLBOX


3559 { "videÙoŞbox_pixfmt", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_EXPERT
, { &
	gvideÙoŞbox_pixfmt
}, "" },

3561 { "hwacûls", 
	gOPT_EXIT
, { .
	gfunc_¬g
 = 
show_hwacûls
 },

3563 { "autÜÙ©e", 
	gHAS_ARG
 | 
	gOPT_BOOL
 | 
	gOPT_SPEC
 |

3564 
	gOPT_EXPERT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
autÜÙ©e
) },

3566 { "hwacûl_Ïx_´ofe_check", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	ghwacûl_Ïx_´ofe_check
},

3570 { "aäames", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_audio_äames
 },

3572 { "aq", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_audio_qsÿË
 },

3574 { "¬", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_SPEC
 |

3575 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
audio_§m¶e_¿‹
) },

3577 { "ac", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_SPEC
 |

3578 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
audio_chªÃls
) },

3580 { "ª", 
	gOPT_AUDIO
 | 
	gOPT_BOOL
 | 
	gOPT_OFFSET
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
,{ .
	goff
 = 
OFFSET
(
audio_di§bË
) },

3582 { "acodec", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 |

3583 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_audio_codec
 },

3585 { "©ag", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3586 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_Şd2Ãw
 },

3588 { "vŞ", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_INT
, { &
	gaudio_vŞume
 },

3590 { "§m¶e_fmt", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 |

3591 
	gOPT_STRING
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
§m¶e_fmts
) },

3593 { "chªÃl_Ïyout", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 |

3594 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_chªÃl_Ïyout
 },

3596 { "af", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_audio_f‹rs
 },

3598 { "guess_Ïyout_max", 
	gOPT_AUDIO
 | 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_SPEC
 | 
	gOPT_EXPERT
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
guess_Ïyout_max
) },

3602 { "¢", 
	gOPT_SUBTITLE
 | 
	gOPT_BOOL
 | 
	gOPT_OFFSET
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
subt™Ë_di§bË
) },

3604 { "scodec", 
	gOPT_SUBTITLE
 | 
	gHAS_ARG
 | 
	gOPT_PERFILE
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_subt™Ë_codec
 },

3606 { "¡ag", 
	gOPT_SUBTITLE
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_Şd2Ãw
 }

3608 { "fix_sub_du¿tiÚ", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_SUBTITLE
 | 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
fix_sub_du¿tiÚ
) },

3610 { "ÿnvas_size", 
	gOPT_SUBTITLE
 | 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_INPUT
, { .
	goff
 = 
OFFSET
(
ÿnvas_sizes
) },

3614 { "vc", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_VIDEO
, { .
	gfunc_¬g
 = 
İt_video_chªÃl
 },

3616 { "tv¡d", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_VIDEO
, { .
	gfunc_¬g
 = 
İt_video_¡ªd¬d
 },

3618 { "isync", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
, { &
	gšput_sync
 }, "this option is deprecated‡nd does‚othing", "" },

3621 { "muxd–ay", 
	gOPT_FLOAT
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_OFFSET
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
mux_max_d–ay
) },

3623 { "mux´–ßd", 
	gOPT_FLOAT
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_OFFSET
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
mux_´–ßd
) },

3625 { "ov”ride_ff£rv”", 
	gOPT_BOOL
 | 
	gOPT_EXPERT
 | 
	gOPT_OUTPUT
, { &
	gov”ride_ff£rv”
 },

3627 { "sdp_fe", 
	gHAS_ARG
 | 
	gOPT_EXPERT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_sdp_fe
 },

3630 { "time_ba£", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_EXPERT
 | 
	gOPT_SPEC
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
time_ba£s
) },

3633 { "bsf", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_SPEC
 | 
	gOPT_EXPERT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
b™¡»am_f‹rs
) },

3635 { "absf", 
	gHAS_ARG
 | 
	gOPT_AUDIO
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_Şd2Ãw
 },

3637 { "vbsf", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_Şd2Ãw
 },

3640 { "­»", 
	gHAS_ARG
 | 
	gOPT_AUDIO
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_´e£t
 },

3642 { "v´e", 
	gOPT_VIDEO
 | 
	gHAS_ARG
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_´e£t
 },

3644 { "¥»", 
	gHAS_ARG
 | 
	gOPT_SUBTITLE
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_´e£t
 },

3646 { "å»", 
	gHAS_ARG
 | 
	gOPT_EXPERT
| 
	gOPT_PERFILE
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_´e£t
 },

3649 { "max_muxšg_queue_size", 
	gHAS_ARG
 | 
	gOPT_INT
 | 
	gOPT_SPEC
 | 
	gOPT_EXPERT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
max_muxšg_queue_size
) },

3653 { "dcodec", 
	gHAS_ARG
 | 
	gOPT_DATA
 | 
	gOPT_PERFILE
 | 
	gOPT_EXPERT
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	gfunc_¬g
 = 
İt_d©a_codec
 },

3655 { "dn", 
	gOPT_BOOL
 | 
	gOPT_VIDEO
 | 
	gOPT_OFFSET
 | 
	gOPT_INPUT
 | 
	gOPT_OUTPUT
, { .
	goff
 = 
OFFSET
(
d©a_di§bË
) },

3658 #ià
CONFIG_VAAPI


3659 { "v¯pi_deviû", 
	gHAS_ARG
 | 
	gOPT_EXPERT
, { .
	gfunc_¬g
 = 
İt_v¯pi_deviû
 },

3663 #ià
CONFIG_QSV


3664 { "qsv_deviû", 
	gHAS_ARG
 | 
	gOPT_STRING
 | 
	gOPT_EXPERT
, { &
	gqsv_deviû
 },

3668 { 
	gNULL
, },

	@
1
.
0
5
64
cmdutils.c
ffmpeg.c
ffmpeg_cuvid.c
ffmpeg_filter.c
ffmpeg_opt.c
